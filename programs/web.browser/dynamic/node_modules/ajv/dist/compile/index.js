function module(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveSchema=t.getCompilingSchema=t.resolveRef=t.compileSchema=t.SchemaEnv=void 0;let s=e("./codegen"),a=e("../runtime/validation_error"),i=e("./names"),o=e("./resolve"),r=e("./util"),l=e("./validate");class c{constructor(e){var t;let s;this.refs={},this.dynamicAnchors={},"object"==typeof e.schema&&(s=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=null!==(t=e.baseId)&&void 0!==t?t:(0,o.normalizeId)(null==s?void 0:s[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=null==s?void 0:s.$async,this.refs={}}}function n(e){let t,r;let c=d.call(this,e);if(c)return c;let n=(0,o.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:h,lines:u}=this.opts.code,{ownProperties:f}=this.opts,m=new s.CodeGen(this.scope,{es5:h,lines:u,ownProperties:f});e.$async&&(t=m.scopeValue("Error",{ref:a.default,code:(0,s._)`require("ajv/dist/runtime/validation_error").default`}));let p=m.scopeName("validate");e.validateName=p;let v={gen:m,allErrors:this.opts.allErrors,data:i.default.data,parentData:i.default.parentData,parentDataProperty:i.default.parentDataProperty,dataNames:[i.default.data],dataPathArr:[s.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:m.scopeValue("schema",!0===this.opts.code.source?{ref:e.schema,code:(0,s.stringify)(e.schema)}:{ref:e.schema}),validateName:p,ValidationError:t,schema:e.schema,schemaEnv:e,rootId:n,baseId:e.baseId||n,schemaPath:s.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,s._)`""`,opts:this.opts,self:this};try{this._compilations.add(e),(0,l.validateFunctionCode)(v),m.optimize(this.opts.code.optimize);let t=m.toString();r=`${m.scopeRefs(i.default.scope)}return ${t}`,this.opts.code.process&&(r=this.opts.code.process(r,e));let a=Function(`${i.default.self}`,`${i.default.scope}`,r),o=a(this,this.scope.get());if(this.scope.value(p,{ref:o}),o.errors=null,o.schema=e.schema,o.schemaEnv=e,e.$async&&(o.$async=!0),!0===this.opts.code.source&&(o.source={validateName:p,validateCode:t,scopeValues:m._values}),this.opts.unevaluated){let{props:e,items:t}=v;o.evaluated={props:e instanceof s.Name?void 0:e,items:t instanceof s.Name?void 0:t,dynamicProps:e instanceof s.Name,dynamicItems:t instanceof s.Name},o.source&&(o.source.evaluated=(0,s.stringify)(o.evaluated))}return e.validate=o,e}catch(t){throw delete e.validate,delete e.validateName,r&&this.logger.error("Error compiling schema, function code:",r),t}finally{this._compilations.delete(e)}}function h(e){return(0,o.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:n.call(this,e)}function d(e){for(let a of this._compilations){var t,s;if(a.schema===e.schema&&a.root===e.root&&a.baseId===e.baseId)return a}}function u(e,t){let s;for(;"string"==typeof(s=this.refs[t]);)t=s;return s||this.schemas[t]||f.call(this,e,t)}function f(e,t){let s=this.opts.uriResolver.parse(t),a=(0,o._getFullPath)(this.opts.uriResolver,s),i=(0,o.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&a===i)return p.call(this,s,e);let r=(0,o.normalizeId)(a),l=this.refs[r]||this.schemas[r];if("string"==typeof l){let t=f.call(this,e,l);if("object"!=typeof(null==t?void 0:t.schema))return;return p.call(this,s,t)}if("object"==typeof(null==l?void 0:l.schema)){if(l.validate||n.call(this,l),r===(0,o.normalizeId)(t)){let{schema:t}=l,{schemaId:s}=this.opts,a=t[s];return a&&(i=(0,o.resolveUrl)(this.opts.uriResolver,i,a)),new c({schema:t,schemaId:s,root:e,baseId:i})}return p.call(this,s,l)}}t.SchemaEnv=c,t.compileSchema=n,t.resolveRef=function(e,t,s){var a;s=(0,o.resolveUrl)(this.opts.uriResolver,t,s);let i=e.refs[s];if(i)return i;let r=u.call(this,e,s);if(void 0===r){let i=null===(a=e.localRefs)||void 0===a?void 0:a[s],{schemaId:o}=this.opts;i&&(r=new c({schema:i,schemaId:o,root:e,baseId:t}))}if(void 0!==r)return e.refs[s]=h.call(this,r)},t.getCompilingSchema=d,t.resolveSchema=f;let m=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function p(e,{baseId:t,schema:s,root:a}){var i;let l;if((null===(i=e.fragment)||void 0===i?void 0:i[0])!=="/")return;for(let a of e.fragment.slice(1).split("/")){if("boolean"==typeof s)return;let e=s[(0,r.unescapeFragment)(a)];if(void 0===e)return;s=e;let i="object"==typeof s&&s[this.opts.schemaId];!m.has(a)&&i&&(t=(0,o.resolveUrl)(this.opts.uriResolver,t,i))}if("boolean"!=typeof s&&s.$ref&&!(0,r.schemaHasRulesButRef)(s,this.RULES)){let e=(0,o.resolveUrl)(this.opts.uriResolver,t,s.$ref);l=f.call(this,a,e)}let{schemaId:n}=this.opts;if((l=l||new c({schema:s,schemaId:n,root:a,baseId:t})).schema!==l.root.schema)return l}}
//# sourceMappingURL=/dynamic/node_modules/ajv/dist/compile/ef1049c3094e9472a77dc714640272ad1dbd9ce8.map
