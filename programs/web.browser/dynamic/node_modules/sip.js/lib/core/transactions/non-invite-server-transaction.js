function module(e,t,s){let r,i,n;s.export({NonInviteServerTransaction:()=>o}),s.link("../timers",{Timers(e){r=e}},0),s.link("./server-transaction",{ServerTransaction(e){i=e}},1),s.link("./transaction-state",{TransactionState(e){n=e}},2);class o extends i{constructor(e,t,s){super(e,t,s,n.Trying,"sip.transaction.nist")}dispose(){this.J&&(clearTimeout(this.J),this.J=void 0),super.dispose()}get kind(){return"nist"}receiveRequest(e){switch(this.state){case n.Trying:break;case n.Proceeding:if(!this.lastResponse)throw Error("Last response undefined.");this.send(this.lastResponse).catch(e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")});break;case n.Completed:if(!this.lastResponse)throw Error("Last response undefined.");this.send(this.lastResponse).catch(e=>{this.logTransportError(e,"Failed to send retransmission of final response.")});break;case n.Terminated:break;default:throw Error(`Invalid state ${this.state}`)}}receiveResponse(e,t){if(e<100||e>699)throw Error(`Invalid status code ${e}`);if(e>100&&e<=199)throw Error("Provisional response other than 100 not allowed.");switch(this.state){case n.Trying:if(this.lastResponse=t,e>=100&&e<200){this.stateTransition(n.Proceeding),this.send(t).catch(e=>{this.logTransportError(e,"Failed to send provisional response.")});return}if(e>=200&&e<=699){this.stateTransition(n.Completed),this.send(t).catch(e=>{this.logTransportError(e,"Failed to send final response.")});return}break;case n.Proceeding:if(this.lastResponse=t,e>=200&&e<=699){this.stateTransition(n.Completed),this.send(t).catch(e=>{this.logTransportError(e,"Failed to send final response.")});return}break;case n.Completed:return;case n.Terminated:break;default:throw Error(`Invalid state ${this.state}`)}let s=`Non-INVITE server transaction received unexpected ${e} response from TU while in state ${this.state}.`;throw this.logger.error(s),Error(s)}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(n.Terminated,!0)}typeToString(){return"non-INVITE server transaction"}stateTransition(e,t=!1){let s=()=>{throw Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case n.Trying:s();break;case n.Proceeding:this.state!==n.Trying&&s();break;case n.Completed:this.state!==n.Trying&&this.state!==n.Proceeding&&s();break;case n.Terminated:this.state===n.Proceeding||this.state===n.Completed||t||s();break;default:s()}e===n.Completed&&(this.J=setTimeout(()=>this.timerJ(),r.TIMER_J)),e===n.Terminated&&this.dispose(),this.setState(e)}timerJ(){this.logger.debug(`Timer J expired for NON-INVITE server transaction ${this.id}.`),this.state===n.Completed&&this.stateTransition(n.Terminated)}}}
//# sourceMappingURL=/dynamic/node_modules/sip.js/lib/core/transactions/39cbf53ab81b6f584124b02a3cf2bb44dc0aa3eb.map
