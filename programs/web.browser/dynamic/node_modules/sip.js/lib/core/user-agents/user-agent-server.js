function module(t,e,s){let r,n,a,i,o,c;s.export({UserAgentServer:()=>h}),s.link("../exceptions",{TransactionStateError(t){r=t}},0),s.link("../messages",{constructOutgoingResponse(t){n=t}},1),s.link("../messages/utils",{newTag(t){a=t}},2),s.link("../transactions",{InviteServerTransaction(t){i=t},NonInviteServerTransaction(t){o=t},TransactionState(t){c=t}},3);class h{constructor(t,e,s,r){this.transactionConstructor=t,this.core=e,this.message=s,this.delegate=r,this.logger=this.loggerFactory.getLogger("sip.user-agent-server"),this.toTag=s.toTag?s.toTag:a(),this.init()}dispose(){this.transaction.dispose()}get loggerFactory(){return this.core.loggerFactory}get transaction(){if(!this._transaction)throw Error("Transaction undefined.");return this._transaction}accept(t={statusCode:200}){if(!this.acceptable)throw new r(`${this.message.method} not acceptable in state ${this.transaction.state}.`);let e=t.statusCode;if(e<200||e>299)throw TypeError(`Invalid statusCode: ${e}`);let s=this.reply(t);return s}progress(t={statusCode:180}){if(!this.progressable)throw new r(`${this.message.method} not progressable in state ${this.transaction.state}.`);let e=t.statusCode;if(e<101||e>199)throw TypeError(`Invalid statusCode: ${e}`);let s=this.reply(t);return s}redirect(t,e={statusCode:302}){if(!this.redirectable)throw new r(`${this.message.method} not redirectable in state ${this.transaction.state}.`);let s=e.statusCode;if(s<300||s>399)throw TypeError(`Invalid statusCode: ${s}`);let n=[];t.forEach(t=>n.push(`Contact: ${t.toString()}`)),e.extraHeaders=(e.extraHeaders||[]).concat(n);let a=this.reply(e);return a}reject(t={statusCode:480}){if(!this.rejectable)throw new r(`${this.message.method} not rejectable in state ${this.transaction.state}.`);let e=t.statusCode;if(e<400||e>699)throw TypeError(`Invalid statusCode: ${e}`);let s=this.reply(t);return s}trying(t){if(!this.tryingable)throw new r(`${this.message.method} not tryingable in state ${this.transaction.state}.`);let e=this.reply({statusCode:100});return e}receiveCancel(t){this.delegate&&this.delegate.onCancel&&this.delegate.onCancel(t)}get acceptable(){if(this.transaction instanceof i)return this.transaction.state===c.Proceeding||this.transaction.state===c.Accepted;if(this.transaction instanceof o)return this.transaction.state===c.Trying||this.transaction.state===c.Proceeding;throw Error("Unknown transaction type.")}get progressable(){if(this.transaction instanceof i)return this.transaction.state===c.Proceeding;if(this.transaction instanceof o)return!1;throw Error("Unknown transaction type.")}get redirectable(){if(this.transaction instanceof i)return this.transaction.state===c.Proceeding;if(this.transaction instanceof o)return this.transaction.state===c.Trying||this.transaction.state===c.Proceeding;throw Error("Unknown transaction type.")}get rejectable(){if(this.transaction instanceof i)return this.transaction.state===c.Proceeding;if(this.transaction instanceof o)return this.transaction.state===c.Trying||this.transaction.state===c.Proceeding;throw Error("Unknown transaction type.")}get tryingable(){if(this.transaction instanceof i)return this.transaction.state===c.Proceeding;if(this.transaction instanceof o)return this.transaction.state===c.Trying;throw Error("Unknown transaction type.")}reply(t){t.toTag||100===t.statusCode||(t.toTag=this.toTag),t.userAgent=t.userAgent||this.core.configuration.userAgentHeaderFieldValue,t.supported=t.supported||this.core.configuration.supportedOptionTagsResponse;let e=n(this.message,t);return this.transaction.receiveResponse(t.statusCode,e.message),e}init(){let t={loggerFactory:this.loggerFactory,onStateChange:t=>{t===c.Terminated&&(this.core.userAgentServers.delete(s),this.dispose())},onTransportError:t=>{this.logger.error(t.message),this.delegate&&this.delegate.onTransportError?this.delegate.onTransportError(t):this.logger.error("User agent server response transport error.")}},e=new this.transactionConstructor(this.message,this.core.transport,t);this._transaction=e;let s=e.id;this.core.userAgentServers.set(e.id,this)}}}
//# sourceMappingURL=/dynamic/node_modules/sip.js/lib/core/user-agents/24f113db1cd0dbf648c25c60ebc0a0e20b70b1d1.map
