)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/reports/hooks/useAgentsSection.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\n\nimport { useSort } from '../../../../../client/components/GenericTable/hooks/useSort';\nimport { getPeriodRange } from '../../../components/dashboards/periods';\nimport { usePeriodSelectorStorage } from '../../../components/dashboards/usePeriodSelectorStorage';\nimport { COLORS, PERIOD_OPTIONS } from '../components/constants';\nimport { formatPeriodDescription } from '../utils/formatPeriodDescription';\nimport { useDefaultDownload } from './useDefaultDownload';\n\nconst formatChartData = (data: { label: string; value: number }[] | undefined = []) =>\n\tdata.map((item) => ({\n\t\t...item,\n\t\tcolor: COLORS.info,\n\t}));\n\nexport const useAgentsSection = () => {\n\tconst t = useTranslation();\n\tconst [period, periodSelectorProps] = usePeriodSelectorStorage('reports-agents-period', PERIOD_OPTIONS);\n\tconst getConversationsByAgent = useEndpoint('GET', '/v1/livechat/analytics/dashboards/conversations-by-agent');\n\tconst { sortBy, sortDirection, setSort } = useSort<'name' | 'total'>('total', 'desc');\n\n\tconst {\n\t\tdata: { data, total = 0, unspecified = 0 } = { data: [], total: 0 },\n\t\trefetch,\n\t\tisLoading,\n\t\tisError,\n\t\tisSuccess,\n\t} = useQuery(\n\t\t['omnichannel-reports', 'conversations-by-agent', period, sortBy, sortDirection],\n\t\tasync () => {\n\t\t\tconst { start, end } = getPeriodRange(period);\n\t\t\tconst response = await getConversationsByAgent({\n\t\t\t\tstart: start.toISOString(),\n\t\t\t\tend: end.toISOString(),\n\t\t\t\tsort: JSON.stringify({ [sortBy]: sortDirection === 'asc' ? 1 : -1 }),\n\t\t\t});\n\t\t\treturn { ...response, data: formatChartData(response.data) };\n\t\t},\n\t\t{\n\t\t\trefetchInterval: 5 * 60 * 1000,\n\t\t},\n\t);\n\n\tconst title = t('Conversations_by_agents');\n\n\tconst subtitleTotals = t('__agents__agents_and__count__conversations__period__', {\n\t\tagents: data.length ?? 0,\n\t\tcount: total,\n\t\tperiod: formatPeriodDescription(period, t),\n\t});\n\tconst subtitleUnspecified = unspecified > 0 ? `(${t('__count__without__assignee__', { count: unspecified })})` : '';\n\tconst subtitle = `${subtitleTotals} ${subtitleUnspecified}`;\n\tconst emptyStateSubtitle = t('Omnichannel_Reports_Agents_Empty_Subtitle');\n\n\tconst downloadProps = useDefaultDownload({ columnName: t('Agents'), title, data, period });\n\n\treturn useMemo(\n\t\t() => ({\n\t\t\tid: 'conversations-by-agent',\n\t\t\ttitle,\n\t\t\tsubtitle,\n\t\t\temptyStateSubtitle,\n\t\t\tdata,\n\t\t\ttotal,\n\t\t\tisLoading,\n\t\t\tisError,\n\t\t\tisDataFound: isSuccess && data.length > 0,\n\t\t\tperiodSelectorProps,\n\t\t\tperiod,\n\t\t\tdownloadProps,\n\t\t\tsortBy,\n\t\t\tsortDirection,\n\t\t\tsetSort,\n\t\t\tonRetry: refetch,\n\t\t}),\n\t\t[\n\t\t\ttitle,\n\t\t\tsubtitle,\n\t\t\temptyStateSubtitle,\n\t\t\tdata,\n\t\t\ttotal,\n\t\t\tisLoading,\n\t\t\tisError,\n\t\t\tisSuccess,\n\t\t\tperiodSelectorProps,\n\t\t\tperiod,\n\t\t\tdownloadProps,\n\t\t\tsortBy,\n\t\t\tsortDirection,\n\t\t\tsetSort,\n\t\t\trefetch,\n\t\t],\n\t);\n};\n",null],"names":["_objectSpread","useEndpoint","useTranslation","useQuery","useMemo","useSort","getPeriodRange","usePeriodSelectorStorage","COLORS","PERIOD_OPTIONS","formatPeriodDescription","useDefaultDownload","module","link","default","v","export","useAgentsSection","formatChartData","data","map","item","color","info","_data$length","t","period","periodSelectorProps","getConversationsByAgent","sortBy","sortDirection","setSort","total","unspecified","refetch","isLoading","isError","isSuccess","start","end","response","toISOString","sort","JSON","stringify","refetchInterval","title","subtitleTotals","agents","length","count","subtitleUnspecified","concat","subtitle","emptyStateSubtitle","downloadProps","columnName","id","isDataFound","onRetry"],"mappings":"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"}