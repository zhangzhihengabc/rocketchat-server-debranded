)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/components/CannedResponse/MarkdownTextEditor/index.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Divider, PositionAnimated, Tile } from '@rocket.chat/fuselage';\nimport { useUserPreference, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { FC } from 'react';\nimport React, { memo, useCallback, useRef, useState } from 'react';\n\nimport { Backdrop } from '../../../../../../client/components/Backdrop';\nimport { useEmojiPicker } from '../../../../../../client/contexts/EmojiPickerContext';\nimport TextEditor from '../TextEditor';\nimport InsertPlaceholderDropdown from './InsertPlaceholderDropdown';\n\nconst MarkdownTextEditor: FC<{ onChange: any; value: string }> = ({ onChange, value }) => {\n\tconst t = useTranslation();\n\tconst useEmojisPreference = useUserPreference('useEmojis');\n\n\tconst textAreaRef = useRef<HTMLTextAreaElement>(null);\n\tconst ref = useRef<HTMLButtonElement>(null);\n\n\tconst [visible, setVisible] = useState(false);\n\n\tconst { open: openEmojiPicker } = useEmojiPicker();\n\n\tconst useMarkdownSyntax = (char: '*' | '_' | '~' | '[]()'): (() => void) =>\n\t\tuseCallback(() => {\n\t\t\tif (textAreaRef?.current) {\n\t\t\t\tconst text = textAreaRef.current.value;\n\t\t\t\tconst startPos = textAreaRef.current.selectionStart;\n\t\t\t\tconst endPos = textAreaRef.current.selectionEnd;\n\n\t\t\t\tif (char === '[]()') {\n\t\t\t\t\tif (startPos !== endPos) {\n\t\t\t\t\t\ttextAreaRef.current.value = `${text.slice(0, startPos)}[${text.slice(startPos, endPos)}]()${text.slice(endPos)}`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttextAreaRef.current.value = `${text.slice(0, startPos)}${char}${text.slice(startPos, endPos)}${char}${text.slice(endPos)}`;\n\t\t\t\t}\n\t\t\t\ttextAreaRef.current.focus();\n\n\t\t\t\tif (char === '[]()') {\n\t\t\t\t\tif (startPos === endPos) {\n\t\t\t\t\t\ttextAreaRef.current.setSelectionRange(startPos, endPos);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttextAreaRef.current.setSelectionRange(endPos + 3, endPos + 3);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttextAreaRef.current.setSelectionRange(startPos + 1, endPos + 1);\n\t\t\t\t}\n\n\t\t\t\tonChange(textAreaRef.current.value);\n\t\t\t}\n\t\t}, [char]);\n\n\tconst onClickEmoji = (emoji: string): void => {\n\t\tif (textAreaRef?.current) {\n\t\t\tconst text = textAreaRef.current.value;\n\t\t\tconst startPos = textAreaRef.current.selectionStart;\n\t\t\tconst emojiValue = `:${emoji}: `;\n\n\t\t\ttextAreaRef.current.value = text.slice(0, startPos) + emojiValue + text.slice(startPos);\n\n\t\t\ttextAreaRef.current.focus();\n\t\t\ttextAreaRef.current.setSelectionRange(startPos + emojiValue.length, startPos + emojiValue.length);\n\n\t\t\tonChange(textAreaRef.current.value);\n\t\t}\n\t};\n\n\tconst handleOpenEmojiPicker = (): void => {\n\t\tif (!useEmojisPreference) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!textAreaRef?.current) {\n\t\t\tthrow new Error('Missing textAreaRef');\n\t\t}\n\n\t\topenEmojiPicker(textAreaRef.current, (emoji: string) => onClickEmoji(emoji));\n\t};\n\n\tconst openPlaceholderSelect = (): void => {\n\t\ttextAreaRef?.current && textAreaRef.current.focus();\n\t\tsetVisible(!visible);\n\t};\n\n\treturn (\n\t\t<TextEditor>\n\t\t\t<TextEditor.Toolbox>\n\t\t\t\t<Box display='flex' flexDirection='row'>\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='bold' action={useMarkdownSyntax('*')} title={t('Bold')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='italic' action={useMarkdownSyntax('_')} title={t('Italic')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='strike' action={useMarkdownSyntax('~')} title={t('Strike')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='link' action={useMarkdownSyntax('[]()')} title={t('Link')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='emoji' action={handleOpenEmojiPicker} title={t('Emoji')} />\n\t\t\t\t</Box>\n\t\t\t\t<TextEditor.Toolbox.TextButton text='Insert_Placeholder' action={openPlaceholderSelect} ref={ref} />\n\t\t\t\t<Backdrop\n\t\t\t\t\tdisplay={visible ? 'block' : 'none'}\n\t\t\t\t\tonClick={(): void => {\n\t\t\t\t\t\ttextAreaRef?.current && textAreaRef.current.focus();\n\t\t\t\t\t\tsetVisible(false);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<PositionAnimated visible={visible ? 'visible' : 'hidden'} anchor={ref}>\n\t\t\t\t\t<Tile elevation='1' w='224px'>\n\t\t\t\t\t\t<InsertPlaceholderDropdown onChange={onChange} textAreaRef={textAreaRef} setVisible={setVisible} />\n\t\t\t\t\t</Tile>\n\t\t\t\t</PositionAnimated>\n\t\t\t</TextEditor.Toolbox>\n\t\t\t<Divider w='full' mbe='16px' />\n\t\t\t<TextEditor.Textarea value={value} onChange={onChange} rows={10} ref={textAreaRef} />\n\t\t</TextEditor>\n\t);\n};\n\nexport default memo(MarkdownTextEditor);\n",null],"names":["Box","Divider","PositionAnimated","Tile","useUserPreference","useTranslation","React","memo","useCallback","useRef","useState","Backdrop","useEmojiPicker","TextEditor","InsertPlaceholderDropdown","module","link","v","default","exportDefault","_ref","onChange","value","t","useEmojisPreference","textAreaRef","ref","visible","setVisible","open","openEmojiPicker","useMarkdownSyntax","char","current","text","startPos","selectionStart","endPos","selectionEnd","concat","slice","focus","setSelectionRange","onClickEmoji","emoji","emojiValue","length","createElement","Toolbox","display","flexDirection","IconButton","name","action","title","Error","TextButton","onClick","anchor","elevation","w","mbe","Textarea","rows"],"mappings":"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"}