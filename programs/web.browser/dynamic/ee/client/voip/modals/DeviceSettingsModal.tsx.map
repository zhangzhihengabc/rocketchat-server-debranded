)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/voip/modals/DeviceSettingsModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { SelectOption } from '@rocket.chat/fuselage';\nimport { Modal, Field, FieldLabel, FieldRow, Select, Button, Box } from '@rocket.chat/fuselage';\nimport {\n\tuseTranslation,\n\tuseAvailableDevices,\n\tuseToastMessageDispatch,\n\tuseSetModal,\n\tuseSelectedDevices,\n\tuseIsDeviceManagementEnabled,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState } from 'react';\nimport type { SubmitHandler } from 'react-hook-form';\nimport { useForm, Controller } from 'react-hook-form';\n\nimport { useChangeAudioInputDevice, useChangeAudioOutputDevice } from '../../../../client/contexts/CallContext';\nimport { isSetSinkIdAvailable } from '../../../../client/providers/DeviceProvider/lib/isSetSinkIdAvailable';\n\ntype FieldValues = {\n\tinputDevice: string;\n\toutputDevice: string;\n};\n\nconst DeviceSettingsModal = (): ReactElement => {\n\tconst setModal = useSetModal();\n\tconst onCancel = (): void => setModal();\n\tconst isDeviceManagementEnabled = useIsDeviceManagementEnabled();\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst selectedAudioDevices = useSelectedDevices();\n\n\tconst { handleSubmit, control } = useForm<FieldValues>({\n\t\tdefaultValues: {\n\t\t\tinputDevice: selectedAudioDevices?.audioInput?.id || '',\n\t\t\toutputDevice: selectedAudioDevices?.audioOutput?.id || '',\n\t\t},\n\t});\n\tconst [setSinkIdAvailable] = useState(() => isSetSinkIdAvailable());\n\tconst availableDevices = useAvailableDevices();\n\tconst changeAudioInputDevice = useChangeAudioInputDevice();\n\tconst changeAudioOutputDevice = useChangeAudioOutputDevice();\n\n\tconst availableInputDevices: SelectOption[] = availableDevices?.audioInput?.map((device) => [device.id, device.label]) || [];\n\tconst availableOutputDevices: SelectOption[] = availableDevices?.audioOutput?.map((device) => [device.id, device.label]) || [];\n\n\tconst onSubmit: SubmitHandler<FieldValues> = async (data) => {\n\t\tconst selectedInputDevice = data.inputDevice && availableDevices?.audioInput?.find((device) => device.id === data.inputDevice);\n\t\tconst selectedOutputDevice = data.outputDevice && availableDevices?.audioOutput?.find((device) => device.id === data.outputDevice);\n\t\ttry {\n\t\t\tselectedInputDevice && changeAudioInputDevice(selectedInputDevice);\n\t\t\tselectedOutputDevice && changeAudioOutputDevice(selectedOutputDevice);\n\t\t\tsetModal();\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Devices_Set') });\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t};\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} />}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Device_settings')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t{!setSinkIdAvailable && (\n\t\t\t\t\t<Box color='status-font-on-danger' display='flex' flexDirection='column'>\n\t\t\t\t\t\t{t('Device_Changes_Not_Available')}\n\t\t\t\t\t\t<Box is='a' href='https://rocket.chat/download' target='_blank' rel='noopener noreferrer'>\n\t\t\t\t\t\t\t{t('Download_Destkop_App')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{!isDeviceManagementEnabled && (\n\t\t\t\t\t<Box color='status-font-on-danger' display='flex' flexDirection='column'>\n\t\t\t\t\t\t{t('Device_Changes_Not_Available_Insecure_Context')}\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Microphone')}</FieldLabel>\n\t\t\t\t\t<FieldRow w='full' display='flex' flexDirection='column' alignItems='stretch'>\n\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\tname='inputDevice'\n\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t<Select disabled={!setSinkIdAvailable} {...field} options={availableInputDevices || []} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Speakers')}</FieldLabel>\n\t\t\t\t\t<FieldRow w='full' display='flex' flexDirection='column' alignItems='stretch'>\n\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\tname='outputDevice'\n\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t<Select disabled={!setSinkIdAvailable} {...field} options={availableOutputDevices || []} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={(): void => setModal()}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!setSinkIdAvailable} primary onClick={handleSubmit(onSubmit)}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default DeviceSettingsModal;\n",null],"names":["_extends","Modal","Field","FieldLabel","FieldRow","Select","Button","Box","useTranslation","useAvailableDevices","useToastMessageDispatch","useSetModal","useSelectedDevices","useIsDeviceManagementEnabled","React","useState","useForm","Controller","useChangeAudioInputDevice","useChangeAudioOutputDevice","isSetSinkIdAvailable","module","link","default","v","exportDefault","_selectedAudioDevices","_selectedAudioDevices2","_availableDevices$aud","_availableDevices$aud2","setModal","isDeviceManagementEnabled","t","dispatchToastMessage","selectedAudioDevices","handleSubmit","control","defaultValues","inputDevice","audioInput","id","outputDevice","audioOutput","setSinkIdAvailable","availableDevices","changeAudioInputDevice","changeAudioOutputDevice","availableInputDevices","map","device","label","availableOutputDevices","onSubmit","data","_availableDevices$aud3","_availableDevices$aud4","selectedInputDevice","find","selectedOutputDevice","type","message","error","createElement","wrapperFunction","props","is","Header","Title","Close","onClick","Content","fontScale","color","display","flexDirection","href","target","rel","w","alignItems","name","render","_ref","field","disabled","options","_ref2","Footer","FooterControllers","primary"],"mappings":"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"}