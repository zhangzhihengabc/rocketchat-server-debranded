)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/polyfills/cssVars.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { withDebouncing } from '../../lib/utils/highOrderFunctions';\n\ntype Variables = {\n\t[name: string]: (variables: Variables) => string;\n};\n\nconst findDeclarations = (code: string): [string, Variables[keyof Variables]][] =>\n\t(code.match(/(--[^:; ]+:..*?;)/g) ?? []).map((declaration) => {\n\t\tconst matches = /(.*?):\\s*(.*?)\\s*;/.exec(declaration);\n\n\t\tif (matches === null) {\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tconst [, name, value] = matches;\n\t\treturn [\n\t\t\tname,\n\t\t\tvalue.indexOf('var(') >= 0\n\t\t\t\t? (variables: Variables): string => value.replace(/var\\((--.*?)\\)/gm, (_, name) => variables[name]?.call(null, variables))\n\t\t\t\t: (): string => value,\n\t\t];\n\t});\n\nconst replaceReferences = (code: string, variables: Variables): string =>\n\tcode.replace(/var\\((--.*?)\\)/gm, (_, name) => variables[name]?.call(null, variables));\n\nlet cssVariablesElement: HTMLElement;\nconst originalCodes = new Map();\n\nconst update = withDebouncing({ wait: 100 })(() => {\n\tconst declarations = ([] as [string, Variables[keyof Variables]][]).concat(\n\t\t...Array.from(originalCodes.values(), findDeclarations),\n\t\tfindDeclarations(cssVariablesElement.innerHTML),\n\t);\n\n\tconst variables = Object.fromEntries(declarations);\n\n\toriginalCodes.forEach((originalCode, element) => {\n\t\tconst patchedCode = replaceReferences(originalCode, variables);\n\n\t\tlet patchedElement = element.nextElementSibling;\n\t\tif (!patchedElement || !patchedElement.classList.contains('patched-css-variables')) {\n\t\t\tpatchedElement = document.createElement('style');\n\t\t\tpatchedElement.type = 'text/css';\n\t\t\tpatchedElement.classList.add('patched-css-variables');\n\t\t\telement.insertAdjacentElement('afterend', patchedElement);\n\t\t}\n\n\t\tconst { sheet } = patchedElement;\n\t\twhile (sheet.cssRules.length > 0) {\n\t\t\tsheet.deleteRule(0);\n\t\t}\n\t\tsheet.insertRule(`@media all {${patchedCode}}`, 0);\n\t});\n});\n\nconst findAndPatchFromLinkElements = (): void => {\n\tArray.from(document.querySelectorAll('link[type=\"text/css\"].__meteor-css__')).forEach(async (linkElement) => {\n\t\tconst url = linkElement.getAttribute('href');\n\n\t\tif (url === null) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url);\n\t\t\tconst code = await response.text();\n\t\t\toriginalCodes.set(linkElement, code);\n\t\t} catch (error) {\n\t\t\tconsole.warn(error);\n\t\t} finally {\n\t\t\tupdate();\n\t\t}\n\t});\n};\n\nconst waitAndInitialize = (): void => {\n\tif (document.readyState !== 'complete') {\n\t\trequestAnimationFrame(waitAndInitialize);\n\t\treturn;\n\t}\n\n\tconst element = document.getElementById('css-variables');\n\n\tif (element === null) {\n\t\trequestAnimationFrame(waitAndInitialize);\n\t\treturn;\n\t}\n\n\tcssVariablesElement = element;\n\n\tconst cssVariablesElementObserver = new MutationObserver(() => {\n\t\tupdate();\n\t});\n\n\tcssVariablesElementObserver.observe(cssVariablesElement, { childList: true });\n\n\tfindAndPatchFromLinkElements();\n};\n\n((): void => {\n\tif (window.CSS?.supports?.('(--foo: red)')) {\n\t\treturn;\n\t}\n\n\twaitAndInitialize();\n})();\n",null],"names":["_window$CSS","_window$CSS$supports","withDebouncing","cssVariablesElement","module","link","findDeclarations","code","_code$match","match","map","declaration","matches","exec","Error","name","value","indexOf","variables","replace","_","_variables$name","call","replaceReferences","_variables$name2","originalCodes","Map","update","wait","declarations","concat","Array","from","values","innerHTML","Object","fromEntries","forEach","originalCode","element","patchedCode","patchedElement","nextElementSibling","classList","contains","document","createElement","type","add","insertAdjacentElement","sheet","cssRules","length","deleteRule","insertRule","findAndPatchFromLinkElements","querySelectorAll","linkElement","url","getAttribute","response","fetch","text","set","error","console","warn","waitAndInitialize","readyState","requestAnimationFrame","getElementById","cssVariablesElementObserver","MutationObserver","observe","childList","window","CSS","supports"],"mappings":"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"}