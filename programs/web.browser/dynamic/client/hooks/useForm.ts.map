)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useForm.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { capitalize } from '@rocket.chat/string-helpers';\nimport type { ChangeEvent } from 'react';\nimport { useCallback, useReducer, useMemo } from 'react';\n\ntype Field = {\n\tname: string;\n\tcurrentValue: unknown;\n\tinitialValue: unknown;\n\tchanged: boolean;\n};\n\ntype FormState<Values extends Record<string, unknown>> = {\n\tfields: Field[];\n\tvalues: Values;\n\thasUnsavedChanges: boolean;\n};\n\ntype FormAction<Values extends Record<string, unknown>> = {\n\t(prevState: FormState<Values>): FormState<Values>;\n};\n\nconst reduceForm = <Values extends Record<string, unknown>>(state: FormState<Values>, action: FormAction<Values>): FormState<Values> =>\n\taction(state);\n\nconst initForm = <Values extends Record<string, unknown>>(initialValues: Values): FormState<Values> => {\n\tconst fields = [];\n\n\tfor (const [fieldName, initialValue] of Object.entries(initialValues)) {\n\t\tfields.push({\n\t\t\tname: fieldName,\n\t\t\tcurrentValue: initialValue,\n\t\t\tinitialValue,\n\t\t\tchanged: false,\n\t\t});\n\t}\n\n\treturn {\n\t\tfields,\n\t\tvalues: { ...initialValues },\n\t\thasUnsavedChanges: false,\n\t};\n};\n\nconst valueChanged =\n\t<Values extends Record<string, unknown>>(fieldName: string, newValue: unknown): FormAction<Values> =>\n\t(state: FormState<Values>): FormState<Values> => {\n\t\tlet { fields } = state;\n\t\tconst field = fields.find(({ name }) => name === fieldName);\n\n\t\tif (!field || field.currentValue === newValue) {\n\t\t\treturn state;\n\t\t}\n\n\t\tconst newField = {\n\t\t\t...field,\n\t\t\tcurrentValue: newValue,\n\t\t\tchanged: JSON.stringify(newValue) !== JSON.stringify(field.initialValue),\n\t\t};\n\n\t\tfields = state.fields.map((field) => {\n\t\t\tif (field.name === fieldName) {\n\t\t\t\treturn newField;\n\t\t\t}\n\n\t\t\treturn field;\n\t\t});\n\n\t\treturn {\n\t\t\t...state,\n\t\t\tfields,\n\t\t\tvalues: {\n\t\t\t\t...state.values,\n\t\t\t\t[newField.name]: newField.currentValue,\n\t\t\t},\n\t\t\thasUnsavedChanges: newField.changed || fields.some((field) => field.changed),\n\t\t};\n\t};\n\nconst formCommitted =\n\t<Values extends Record<string, unknown>>(): FormAction<Values> =>\n\t(state: FormState<Values>): FormState<Values> => ({\n\t\t...state,\n\t\tfields: state.fields.map((field) => ({\n\t\t\t...field,\n\t\t\tinitialValue: field.currentValue,\n\t\t\tchanged: false,\n\t\t})),\n\t\thasUnsavedChanges: false,\n\t});\n\nconst formReset =\n\t<Values extends Record<string, unknown>>(): FormAction<Values> =>\n\t(state: FormState<Values>): FormState<Values> => ({\n\t\t...state,\n\t\tfields: state.fields.map((field) => ({\n\t\t\t...field,\n\t\t\tcurrentValue: field.initialValue,\n\t\t\tchanged: false,\n\t\t})),\n\t\tvalues: state.fields.reduce(\n\t\t\t(values, field) => ({\n\t\t\t\t...values,\n\t\t\t\t[field.name]: field.initialValue,\n\t\t\t}),\n\t\t\t{} as Values,\n\t\t),\n\t\thasUnsavedChanges: false,\n\t});\n\nconst isChangeEvent = (x: any): x is ChangeEvent =>\n\t(typeof x === 'object' || typeof x === 'function') && typeof x?.currentTarget !== 'undefined';\n\nconst getValue = (eventOrValue: ChangeEvent | unknown): unknown => {\n\tif (!isChangeEvent(eventOrValue)) {\n\t\treturn eventOrValue;\n\t}\n\n\tconst target = eventOrValue.currentTarget;\n\n\tif (target instanceof HTMLTextAreaElement) {\n\t\treturn target.value;\n\t}\n\n\tif (target instanceof HTMLSelectElement) {\n\t\treturn target.value;\n\t}\n\n\tif (!(target instanceof HTMLInputElement)) {\n\t\treturn undefined;\n\t}\n\n\tif (target.type === 'checkbox' || target.type === 'radio') {\n\t\treturn target.checked;\n\t}\n\n\treturn target.value;\n};\n\n/**\n * @deprecated prefer react-hook-form's `useForm`\n */\nexport const useForm = <\n\tReducer extends (\n\t\tstate: FormState<Record<string, unknown>>,\n\t\taction: FormAction<Record<string, unknown>>,\n\t) => FormState<Record<string, unknown>>,\n>(\n\tinitialValues: Parameters<Reducer>[0]['values'],\n\tonChange: (...args: unknown[]) => void = (): void => undefined,\n): {\n\tvalues: Parameters<Reducer>[0]['values'];\n\thandlers: Record<string, (eventOrValue: ChangeEvent | unknown) => void>;\n\thasUnsavedChanges: boolean;\n\tcommit: () => void;\n\treset: () => void;\n} => {\n\tconst [state, dispatch] = useReducer(reduceForm, initialValues, initForm);\n\n\tconst commit = useCallback(() => {\n\t\tdispatch(formCommitted());\n\t}, []);\n\n\tconst reset = useCallback(() => {\n\t\tdispatch(formReset());\n\t}, []);\n\n\tconst handlers = useMemo<Record<string, (eventOrValue: ChangeEvent | unknown) => void>>(\n\t\t() =>\n\t\t\tstate.fields.reduce(\n\t\t\t\t(handlers, { name, initialValue }) => ({\n\t\t\t\t\t...handlers,\n\t\t\t\t\t[`handle${capitalize(name)}`]: (eventOrValue: ChangeEvent | unknown): void => {\n\t\t\t\t\t\tconst newValue = getValue(eventOrValue);\n\t\t\t\t\t\tdispatch(valueChanged(name, newValue));\n\t\t\t\t\t\tonChange({\n\t\t\t\t\t\t\tinitialValue,\n\t\t\t\t\t\t\tvalue: newValue,\n\t\t\t\t\t\t\tkey: name,\n\t\t\t\t\t\t\tvalues: state.values,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\t{},\n\t\t\t),\n\t\t[onChange, state.fields, state.values],\n\t);\n\n\treturn {\n\t\thandlers,\n\t\tvalues: state.values,\n\t\thasUnsavedChanges: state.hasUnsavedChanges,\n\t\tcommit,\n\t\treset,\n\t};\n};\n",null],"names":["_objectSpread","capitalize","useCallback","useReducer","useMemo","module","link","default","export","useForm","reduceForm","state","action","initForm","initialValues","fields","fieldName","initialValue","Object","entries","push","name","currentValue","changed","values","hasUnsavedChanges","valueChanged","newValue","field","find","_ref","newField","JSON","stringify","map","some","formCommitted","formReset","reduce","isChangeEvent","x","currentTarget","getValue","eventOrValue","target","HTMLTextAreaElement","HTMLSelectElement","value","HTMLInputElement","type","checked","onChange","undefined","dispatch","commit","reset","handlers","_ref2","concat","key"],"mappings":"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"}