)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useApplyButtonFilters.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUIActionButton } from '@rocket.chat/apps-engine/definition/ui';\nimport { RoomTypeFilter } from '@rocket.chat/apps-engine/definition/ui';\nimport type { IRoom } from '@rocket.chat/core-typings';\nimport {\n\tisDirectMessageRoom,\n\tisMultipleDirectMessageRoom,\n\tisOmnichannelRoom,\n\tisPrivateDiscussion,\n\tisPrivateTeamRoom,\n\tisPublicDiscussion,\n\tisPublicTeamRoom,\n} from '@rocket.chat/core-typings';\nimport { AuthorizationContext, useUserId } from '@rocket.chat/ui-contexts';\nimport { useCallback, useContext } from 'react';\n\nimport { useRoom } from '../views/room/contexts/RoomContext';\n\nconst enumToFilter: { [k in RoomTypeFilter]: (room: IRoom) => boolean } = {\n\t[RoomTypeFilter.PUBLIC_CHANNEL]: (room) => room.t === 'c',\n\t[RoomTypeFilter.PRIVATE_CHANNEL]: (room) => room.t === 'p',\n\t[RoomTypeFilter.PUBLIC_TEAM]: isPublicTeamRoom,\n\t[RoomTypeFilter.PRIVATE_TEAM]: isPrivateTeamRoom,\n\t[RoomTypeFilter.PUBLIC_DISCUSSION]: isPublicDiscussion,\n\t[RoomTypeFilter.PRIVATE_DISCUSSION]: isPrivateDiscussion,\n\t[RoomTypeFilter.DIRECT]: isDirectMessageRoom,\n\t[RoomTypeFilter.DIRECT_MULTIPLE]: isMultipleDirectMessageRoom,\n\t[RoomTypeFilter.LIVE_CHAT]: isOmnichannelRoom,\n};\n\nconst applyRoomFilter = (button: IUIActionButton, room: IRoom): boolean => {\n\tconst { roomTypes } = button.when || {};\n\treturn !roomTypes || roomTypes.some((filter): boolean => enumToFilter[filter]?.(room));\n};\n\nexport const useApplyButtonFilters = (): ((button: IUIActionButton) => boolean) => {\n\tconst room = useRoom();\n\tif (!room) {\n\t\tthrow new Error('useApplyButtonFilters must be used inside a room context');\n\t}\n\tconst applyAuthFilter = useApplyButtonAuthFilter();\n\treturn useCallback(\n\t\t(button: IUIActionButton) => applyAuthFilter(button) && (!room || applyRoomFilter(button, room)),\n\t\t[applyAuthFilter, room],\n\t);\n};\n\nexport const useApplyButtonAuthFilter = (): ((button: IUIActionButton) => boolean) => {\n\tconst uid = useUserId();\n\n\tconst { queryAllPermissions, queryAtLeastOnePermission, queryRole } = useContext(AuthorizationContext);\n\n\treturn useCallback(\n\t\t(button: IUIActionButton, room?: IRoom) => {\n\t\t\tconst { hasAllPermissions, hasOnePermission, hasAllRoles, hasOneRole } = button.when || {};\n\n\t\t\tconst hasAllPermissionsResult = hasAllPermissions ? queryAllPermissions(hasAllPermissions)[1]() : true;\n\t\t\tconst hasOnePermissionResult = hasOnePermission ? queryAtLeastOnePermission(hasOnePermission)[1]() : true;\n\t\t\tconst hasAllRolesResult = hasAllRoles ? !!uid && hasAllRoles.every((role) => queryRole(role, room?._id)) : true;\n\t\t\tconst hasOneRoleResult = hasOneRole ? !!uid && hasOneRole.some((role) => queryRole(role, room?._id)[1]()) : true;\n\n\t\t\treturn hasAllPermissionsResult && hasOnePermissionResult && hasAllRolesResult && hasOneRoleResult;\n\t\t},\n\t\t[queryAllPermissions, queryAtLeastOnePermission, queryRole, uid],\n\t);\n};\n",null],"names":["RoomTypeFilter","isDirectMessageRoom","isMultipleDirectMessageRoom","isOmnichannelRoom","isPrivateDiscussion","isPrivateTeamRoom","isPublicDiscussion","isPublicTeamRoom","AuthorizationContext","useUserId","useCallback","useContext","useRoom","module","export","useApplyButtonFilters","useApplyButtonAuthFilter","enumToFilter","PUBLIC_CHANNEL","room","t","PRIVATE_CHANNEL","PUBLIC_TEAM","PRIVATE_TEAM","PUBLIC_DISCUSSION","PRIVATE_DISCUSSION","DIRECT","DIRECT_MULTIPLE","LIVE_CHAT","applyRoomFilter","button","roomTypes","when","some","filter","_enumToFilter$filter","call","Error","applyAuthFilter","uid","queryAllPermissions","queryAtLeastOnePermission","queryRole","hasAllPermissions","hasOnePermission","hasAllRoles","hasOneRole","hasAllPermissionsResult","hasOnePermissionResult","hasAllRolesResult","every","role","_id","hasOneRoleResult"],"mappings":"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"}