)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useReactiveQuery.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { UseQueryOptions, QueryKey, UseQueryResult } from '@tanstack/react-query';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Tracker } from 'meteor/tracker';\n\nimport { queueMicrotask } from '../lib/utils/queueMicrotask';\n\nexport const useReactiveQuery = <TQueryFnData, TData = TQueryFnData, TQueryKey extends QueryKey = QueryKey>(\n\tqueryKey: TQueryKey,\n\treactiveQueryFn: () => TQueryFnData,\n\toptions?: UseQueryOptions<TQueryFnData, Error, TData, TQueryKey>,\n): UseQueryResult<TData, Error> => {\n\tconst queryClient = useQueryClient();\n\n\treturn useQuery(\n\t\tqueryKey,\n\t\t(): Promise<TQueryFnData> =>\n\t\t\tnew Promise((resolve, reject) => {\n\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\tTracker.autorun((c) => {\n\t\t\t\t\t\tconst data = reactiveQueryFn();\n\n\t\t\t\t\t\tif (c.firstRun) {\n\t\t\t\t\t\t\tif (data === undefined) {\n\t\t\t\t\t\t\t\treject(new Error('Reactive query returned undefined'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tqueryClient.invalidateQueries(queryKey, { exact: true });\n\t\t\t\t\t\tc.stop();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}),\n\t\t{ staleTime: Infinity, ...options },\n\t);\n};\n",null],"names":["_objectSpread","useQuery","useQueryClient","Tracker","queueMicrotask","module","link","default","export","useReactiveQuery","queryKey","reactiveQueryFn","options","queryClient","Promise","resolve","reject","autorun","c","data","firstRun","undefined","Error","invalidateQueries","exact","stop","staleTime","Infinity"],"mappings":"2BACAA,EAAyCC,EAAwBC,EAAAC,EAAAC,EAAhDC,EAAEC,IAAA,CAAA,uCAA8C,CAAAC,QAAAA,CAAAA,EAAAP,EAAAA,CAAA,CAAA,EAAA,GAAjEK,EAAOG,MAAE,CAAA,CAAAC,iBAAU,IAAgBA,CAAM,GAAwBJ,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAJ,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAF,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAD,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAK1D,IAAMK,EAAmB,CAC/BC,EACAC,EACAC,KAEA,IAAMC,EAAcX,IAEpB,OAAOD,EACNS,EACA,IACC,IAAII,QAAQ,CAACC,EAASC,KACrBZ,EAAe,KACdD,EAAQc,OAAO,CAAEC,IAChB,IAAMC,EAAOR,IAEb,GAAIO,EAAEE,QAAQ,CAAE,CACXD,AAASE,KAAAA,IAATF,EACHH,EAAO,AAAIM,MAAM,sCAEjBP,EAAQI,GAET,OAGDN,EAAYU,iBAAiB,CAACb,EAAU,CAAEc,MAAO,CAAA,CAAI,GACrDN,EAAEO,IAAI,EACP,EACD,EACD,GAAEzB,EAAA,CACD0B,UAAWC,GAAQ,EAAKf,GAE5B"}