)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useUpdateAvatar.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { AvatarObject, AvatarServiceObject, AvatarReset, AvatarUrlObj, IUser } from '@rocket.chat/core-typings';\nimport { useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useCallback } from 'react';\n\nimport { useEndpointAction } from './useEndpointAction';\nimport { useEndpointUpload } from './useEndpointUpload';\n\nconst isAvatarReset = (avatarObj: AvatarObject): avatarObj is AvatarReset => avatarObj === 'reset';\nconst isServiceObject = (avatarObj: AvatarObject): avatarObj is AvatarServiceObject =>\n\t!isAvatarReset(avatarObj) && typeof avatarObj === 'object' && 'service' in avatarObj;\nconst isAvatarUrl = (avatarObj: AvatarObject): avatarObj is AvatarUrlObj =>\n\t!isAvatarReset(avatarObj) && typeof avatarObj === 'object' && 'service' && 'avatarUrl' in avatarObj;\n\nexport const useUpdateAvatar = (\n\tavatarObj: AvatarObject,\n\tuserId: IUser['_id'],\n): (() => Promise<{ success: boolean } | null | undefined>) => {\n\tconst t = useTranslation();\n\tconst avatarUrl = isAvatarUrl(avatarObj) ? avatarObj.avatarUrl : '';\n\n\tconst successMessage = t('Avatar_changed_successfully');\n\tconst setAvatarFromService = useMethod('setAvatarFromService');\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst saveAvatarAction = useEndpointUpload('/v1/users.setAvatar', successMessage);\n\tconst saveAvatarUrlAction = useEndpointAction('POST', '/v1/users.setAvatar', { successMessage });\n\tconst resetAvatarAction = useEndpointAction('POST', '/v1/users.resetAvatar', { successMessage });\n\n\tconst updateAvatar = useCallback(async () => {\n\t\tif (isAvatarReset(avatarObj)) {\n\t\t\treturn resetAvatarAction({\n\t\t\t\tuserId,\n\t\t\t});\n\t\t}\n\t\tif (isAvatarUrl(avatarObj)) {\n\t\t\treturn saveAvatarUrlAction({\n\t\t\t\tuserId,\n\t\t\t\t...(avatarUrl && { avatarUrl }),\n\t\t\t});\n\t\t}\n\t\tif (isServiceObject(avatarObj)) {\n\t\t\tconst { blob, contentType, service } = avatarObj;\n\t\t\ttry {\n\t\t\t\tawait setAvatarFromService(blob, contentType, service);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: successMessage });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (avatarObj instanceof FormData) {\n\t\t\tavatarObj.set('userId', userId);\n\t\t\treturn saveAvatarAction(avatarObj);\n\t\t}\n\t}, [\n\t\tavatarObj,\n\t\tavatarUrl,\n\t\tdispatchToastMessage,\n\t\tresetAvatarAction,\n\t\tsaveAvatarAction,\n\t\tsaveAvatarUrlAction,\n\t\tsetAvatarFromService,\n\t\tsuccessMessage,\n\t\tuserId,\n\t]);\n\n\treturn updateAvatar;\n};\n",null],"names":["_objectSpread","useToastMessageDispatch","useMethod","useTranslation","useCallback","useEndpointAction","useEndpointUpload","module","default","v","export","useUpdateAvatar","isAvatarReset","avatarObj","isServiceObject","isAvatarUrl","userId","t","avatarUrl","successMessage","setAvatarFromService","dispatchToastMessage","saveAvatarAction","saveAvatarUrlAction","resetAvatarAction","updateAvatar","blob","contentType","service","type","message","error","FormData","set"],"mappings":"2BACAA,EAA6CC,EAAsBC,EAAAC,EAA2BC,EAAAC,EAAAC,EAArFC,EAAAA,IAAAA,CAAAA,uCAA0D,CAAAC,QAAAA,CAAAA,EAAAR,EAA2BS,CAAA,CAAA,EAAA,GAA9FF,EAAOG,MAAE,CAAA,CAAAC,gBAAAA,IAAyBA,CAAW,GAAiDJ,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAN,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,QAAAA,CAAAH,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAF,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAD,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAM9F,IAAMM,EAAiBC,GAAsDA,AAAc,UAAdA,EACvEC,EAAmBD,GACxB,CAACD,EAAcC,IAAc,AAAqB,UAArB,OAAOA,GAA0B,YAAaA,EACtEE,EAAeF,GACpB,CAACD,EAAcC,IAAc,AAAqB,UAArB,OAAOA,GAAuC,cAAeA,EAE9EF,EAAkB,CAC9BE,EACAG,KAEA,IAAMC,EAAId,IACJe,EAAYH,EAAYF,GAAaA,EAAUK,SAAS,CAAG,GAE3DC,EAAiBF,EAAE,+BACnBG,EAAuBlB,EAAU,wBAEjCmB,EAAuBpB,IAEvBqB,EAAmBhB,EAAkB,sBAAuBa,GAC5DI,EAAsBlB,EAAkB,OAAQ,sBAAuB,CAAEc,eAAAA,CAAc,GACvFK,EAAoBnB,EAAkB,OAAQ,wBAAyB,CAAEc,eAAAA,CAAc,GAEvFM,EAAerB,EAAY,UAChC,GAAIQ,EAAcC,GACjB,OAAOW,EAAkB,CACxBR,OAAAA,IAGF,GAAID,EAAYF,GACf,OAAOU,EAAmBvB,EAAA,CACzBgB,OAAAA,CAAM,EACFE,GAAa,CAAEA,UAAAA,CAAS,IAG9B,GAAIJ,EAAgBD,GAAY,CAC/B,GAAM,CAAEa,KAAAA,CAAI,CAAEC,YAAAA,CAAW,CAAEC,QAAAA,CAAAA,CAAS,CAAGf,EACvC,GAAI,CACH,MAAMO,EAAqBM,EAAMC,EAAaC,GAC9CP,EAAqB,CAAEQ,KAAM,UAAWC,QAASX,CAAc,GAC9D,MAAOY,EAAO,CACfV,EAAqB,CAAEQ,KAAM,QAASC,QAASC,CAAK,GAErD,OAED,GAAIlB,aAAqBmB,SAExB,OADAnB,EAAUoB,GAAG,CAAC,SAAUjB,GACjBM,EAAiBT,EAE1B,EAAG,CACFA,EACAK,EACAG,EACAG,EACAF,EACAC,EACAH,EACAD,EACAH,EACA,EAED,OAAOS,CACR"}