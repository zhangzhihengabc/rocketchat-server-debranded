)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/roomActions/useE2EERoomAction.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetting, usePermission, useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useCallback, useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { e2e } from '../../../app/e2e/client/rocketchat.e2e';\nimport { dispatchToastMessage } from '../../lib/toast';\nimport { useRoom, useRoomSubscription } from '../../views/room/contexts/RoomContext';\nimport type { RoomToolboxActionConfig } from '../../views/room/contexts/RoomToolboxContext';\nimport { useReactiveValue } from '../useReactiveValue';\n\nexport const useE2EERoomAction = () => {\n\tconst enabled = useSetting('E2E_Enable', false);\n\tconst room = useRoom();\n\tconst subscription = useRoomSubscription();\n\tconst readyToEncrypt = useReactiveValue(useCallback(() => e2e.isReady(), [])) || room.encrypted;\n\tconst permittedToToggleEncryption = usePermission('toggle-room-e2e-encryption', room._id);\n\tconst permittedToEditRoom = usePermission('edit-room', room._id);\n\tconst permitted = (room.t === 'd' || (permittedToEditRoom && permittedToToggleEncryption)) && readyToEncrypt;\n\tconst federated = isRoomFederated(room);\n\tconst { t } = useTranslation();\n\n\tconst toggleE2E = useEndpoint('POST', '/v1/rooms.saveRoomSettings');\n\n\tconst action = useMutableCallback(async () => {\n\t\tconst { success } = await toggleE2E({ rid: room._id, encrypted: !room.encrypted });\n\t\tif (!success) {\n\t\t\treturn;\n\t\t}\n\n\t\tdispatchToastMessage({\n\t\t\ttype: 'success',\n\t\t\tmessage: room.encrypted\n\t\t\t\t? t('E2E_Encryption_disabled_for_room', { roomName: room.name })\n\t\t\t\t: t('E2E_Encryption_enabled_for_room', { roomName: room.name }),\n\t\t});\n\n\t\tif (subscription?.autoTranslate) {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('AutoTranslate_Disabled_for_room', { roomName: room.name }) });\n\t\t}\n\t});\n\n\tconst enabledOnRoom = !!room.encrypted;\n\n\treturn useMemo((): RoomToolboxActionConfig | undefined => {\n\t\tif (!enabled || !permitted) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'e2e',\n\t\t\tgroups: ['direct', 'direct_multiple', 'group', 'team'],\n\t\t\ttitle: enabledOnRoom ? 'E2E_disable' : 'E2E_enable',\n\t\t\ticon: 'key',\n\t\t\torder: 13,\n\t\t\taction,\n\t\t\ttype: 'organization',\n\t\t\t...(federated && {\n\t\t\t\ttooltip: t('core.E2E_unavailable_for_federation'),\n\t\t\t\tdisabled: true,\n\t\t\t}),\n\t\t};\n\t}, [enabled, permitted, federated, t, enabledOnRoom, action]);\n};\n",null],"names":["_objectSpread","isRoomFederated","useMutableCallback","useSetting","usePermission","useEndpoint","useCallback","useMemo","useTranslation","e2e","dispatchToastMessage","useRoom","useRoomSubscription","useReactiveValue","module","link","default","export","useE2EERoomAction","enabled","room","subscription","readyToEncrypt","isReady","encrypted","permittedToToggleEncryption","_id","permittedToEditRoom","permitted","t","federated","toggleE2E","action","success","rid","type","message","roomName","name","autoTranslate","enabledOnRoom","id","groups","title","icon","order","tooltip","disabled"],"mappings":"2BAAAA,EAA4DC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAnDC,EAAeC,IAAE,CAAA,uCAAkC,CAAAC,QAAAA,CAAAA,EAAAhB,EAAAA,CAAA,CAAA,EAAA,GAA5Dc,EAAOG,MAAE,CAAA,CAAAC,kBAAuB,IAAAA,CAAA,GAA4BJ,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAb,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAZ,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAX,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,QAAAA,CAAAR,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAN,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,yCAAAA,CAAAL,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,kBAAAA,CAAAJ,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAH,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAD,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAYrD,IAAMK,EAAoB,KAChC,IAAMC,EAAUhB,EAAW,aAAc,CAAA,GACnCiB,EAAOT,IACPU,EAAeT,IACfU,EAAiBT,EAAiBP,EAAY,IAAMG,EAAIc,OAAO,GAAI,EAAE,IAAMH,EAAKI,SAAS,CACzFC,EAA8BrB,EAAc,6BAA8BgB,EAAKM,GAAG,EAClFC,EAAsBvB,EAAc,YAAagB,EAAKM,GAAG,EACzDE,EAAY,AAACR,CAAAA,AAAW,MAAXA,EAAKS,CAAC,EAAaF,GAAuBF,CAAAA,GAAiCH,EACxFQ,EAAY7B,EAAgBmB,GAC5B,CAAES,EAAAA,CAAAA,CAAG,CAAGrB,IAERuB,EAAY1B,EAAY,OAAQ,8BAEhC2B,EAAS9B,EAAmB,UACjC,GAAM,CAAE+B,QAAAA,CAAAA,CAAS,CAAG,MAAMF,EAAU,CAAEG,IAAKd,EAAKM,GAAG,CAAEF,UAAW,CAACJ,EAAKI,SAAAA,AAAS,GAC1ES,IAILvB,EAAqB,CACpByB,KAAM,UACNC,QAAShB,EAAKI,SAAS,CACpBK,EAAE,mCAAoC,CAAEQ,SAAUjB,EAAKkB,IAAAA,AAAI,GAC3DT,EAAE,kCAAmC,CAAEQ,SAAUjB,EAAKkB,IAAAA,AAAI,WAG1DjB,GAAAA,EAAckB,aAAa,EAC9B7B,EAAqB,CAAEyB,KAAM,UAAWC,QAASP,EAAE,kCAAmC,CAAEQ,SAAUjB,EAAKkB,IAAAA,AAAI,EAAG,GAEhH,GAEME,EAAgB,CAAC,CAACpB,EAAKI,SAAS,CAEtC,OAAOjB,EAAQ,KACd,GAAI,AAACY,GAAYS,EAIjB,OAAA5B,EAAA,CACCyC,GAAI,MACJC,OAAQ,CAAC,SAAU,kBAAmB,QAAS,OAAO,CACtDC,MAAOH,EAAgB,cAAgB,aACvCI,KAAM,MACNC,MAAO,GACPb,OAAAA,EACAG,KAAM,cAAc,EAChBL,GAAa,CAChBgB,QAASjB,EAAE,uCACXkB,SAAU,CAAA,GAGb,EAAG,CAAC5B,EAASS,EAAWE,EAAWD,EAAGW,EAAeR,EAAO,CAC7D"}