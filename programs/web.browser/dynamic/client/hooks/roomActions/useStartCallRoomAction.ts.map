)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/roomActions/useStartCallRoomAction.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useStableArray, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetting, useUser, usePermission } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { useVideoConfDispatchOutgoing, useVideoConfIsCalling, useVideoConfIsRinging } from '../../contexts/VideoConfContext';\nimport { VideoConfManager } from '../../lib/VideoConfManager';\nimport { useRoom } from '../../views/room/contexts/RoomContext';\nimport type { RoomToolboxActionConfig } from '../../views/room/contexts/RoomToolboxContext';\nimport { useVideoConfWarning } from '../../views/room/contextualBar/VideoConference/hooks/useVideoConfWarning';\n\nexport const useStartCallRoomAction = () => {\n\tconst room = useRoom();\n\tconst federated = isRoomFederated(room);\n\n\tconst ownUser = room.uids?.length === 1 ?? false;\n\tconst live = room?.streamingOptions?.type === 'call' ?? false;\n\n\tconst permittedToPostReadonly = usePermission('post-readonly', room._id);\n\tconst permittedToCallManagement = usePermission('call-management', room._id);\n\n\tconst dispatchWarning = useVideoConfWarning();\n\tconst dispatchPopup = useVideoConfDispatchOutgoing();\n\tconst isCalling = useVideoConfIsCalling();\n\tconst isRinging = useVideoConfIsRinging();\n\n\tconst { t } = useTranslation();\n\n\tconst enabledForDMs = useSetting('VideoConf_Enable_DMs', true);\n\tconst enabledForChannels = useSetting('VideoConf_Enable_Channels', true);\n\tconst enabledForTeams = useSetting('VideoConf_Enable_Teams', true);\n\tconst enabledForGroups = useSetting('VideoConf_Enable_Groups', true);\n\tconst enabledForLiveChat = useSetting('Omnichannel_call_provider', 'default-provider') === 'default-provider';\n\n\tconst groups = useStableArray(\n\t\t[\n\t\t\tenabledForDMs && 'direct',\n\t\t\tenabledForDMs && 'direct_multiple',\n\t\t\tenabledForGroups && 'group',\n\t\t\tenabledForLiveChat && 'live',\n\t\t\tenabledForTeams && 'team',\n\t\t\tenabledForChannels && 'channel',\n\t\t].filter((group): group is RoomToolboxActionConfig['groups'][number] => !!group),\n\t);\n\n\tconst enabled = groups.length > 0;\n\n\tconst user = useUser();\n\n\tconst allowed = enabled && permittedToCallManagement && (!user?.username || !room.muted?.includes(user.username)) && !ownUser;\n\n\tconst handleOpenVideoConf = useMutableCallback(async () => {\n\t\tif (isCalling || isRinging) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait VideoConfManager.loadCapabilities();\n\t\t\tdispatchPopup({ rid: room._id });\n\t\t} catch (error: any) {\n\t\t\tdispatchWarning(error.error);\n\t\t}\n\t});\n\n\tconst disabled = federated || (!!room.ro && !permittedToPostReadonly);\n\n\treturn useMemo((): RoomToolboxActionConfig | undefined => {\n\t\tif (!allowed) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'start-call',\n\t\t\tgroups,\n\t\t\ttitle: 'Call',\n\t\t\ticon: 'phone',\n\t\t\taction: () => void handleOpenVideoConf(),\n\t\t\t...(disabled && {\n\t\t\t\ttooltip: t('core.Video_Call_unavailable_for_this_type_of_room'),\n\t\t\t\tdisabled: true,\n\t\t\t}),\n\t\t\tfull: true,\n\t\t\torder: live ? -1 : 4,\n\t\t\tfeatured: true,\n\t\t};\n\t}, [allowed, disabled, groups, handleOpenVideoConf, live, t]);\n};\n",null],"names":["_objectSpread","isRoomFederated","useStableArray","useMutableCallback","useSetting","useUser","usePermission","useMemo","useTranslation","useVideoConfDispatchOutgoing","useVideoConfIsCalling","useVideoConfIsRinging","VideoConfManager","useRoom","useVideoConfWarning","module","link","default","export","useStartCallRoomAction","_ref","_room$uids","_ref2","_room$streamingOption","_room$muted","room","federated","ownUser","uids","length","live","streamingOptions","type","permittedToPostReadonly","_id","permittedToCallManagement","dispatchWarning","dispatchPopup","isCalling","isRinging","t","enabledForDMs","enabledForChannels","enabledForTeams","enabledForGroups","enabledForLiveChat","groups","filter","group","enabled","user","allowed","username","muted","includes","handleOpenVideoConf","loadCapabilities","rid","error","disabled","ro","id","title","icon","action","tooltip","full","order","featured"],"mappings":"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"}