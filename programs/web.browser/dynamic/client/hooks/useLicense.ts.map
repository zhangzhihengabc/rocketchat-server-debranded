)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useLicense.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { Serialized } from '@rocket.chat/core-typings';\nimport type { OperationResult } from '@rocket.chat/rest-typings';\nimport { useEndpoint, useSingleStream, useUserId } from '@rocket.chat/ui-contexts';\nimport type { QueryClient, UseQueryResult } from '@tanstack/react-query';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { useEffect } from 'react';\n\ntype LicenseDataType = Serialized<Awaited<OperationResult<'GET', '/v1/licenses.info'>>>;\n\ntype LicenseParams = {\n\tloadValues?: boolean;\n};\n\nconst invalidateQueryClientLicenses = (() => {\n\tlet timeout: ReturnType<typeof setTimeout> | undefined;\n\n\treturn (queryClient: QueryClient, milliseconds = 5000) => {\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(() => {\n\t\t\ttimeout = undefined;\n\t\t\tqueryClient.invalidateQueries(['licenses']);\n\t\t}, milliseconds);\n\t};\n})();\n\nexport const useLicenseBase = <TData = LicenseDataType>({\n\tparams,\n\tselect,\n}: {\n\tparams?: LicenseParams;\n\tselect: (data: LicenseDataType) => TData;\n}) => {\n\tconst uid = useUserId();\n\n\tconst getLicenses = useEndpoint('GET', '/v1/licenses.info');\n\n\tconst invalidateQueries = useInvalidateLicense();\n\n\tconst notify = useSingleStream('notify-all');\n\n\tuseEffect(() => notify('license', () => invalidateQueries()), [notify, invalidateQueries]);\n\n\treturn useQuery(['licenses', 'getLicenses', params], () => getLicenses({ ...params }), {\n\t\tstaleTime: Infinity,\n\t\tkeepPreviousData: true,\n\t\tselect,\n\t\tenabled: !!uid,\n\t});\n};\n\nexport const useLicense = (params?: LicenseParams) => {\n\treturn useLicenseBase({ params, select: (data) => data.license });\n};\n\nexport const useHasLicense = (): UseQueryResult<boolean> => {\n\treturn useLicenseBase({ select: (data) => Boolean(data.license) });\n};\n\nexport const useLicenseName = (params?: LicenseParams) => {\n\treturn useLicenseBase({ params, select: (data) => data?.license.tags?.map((tag) => tag.name).join(' ') || 'Community' });\n};\n\nexport const useInvalidateLicense = () => {\n\tconst queryClient = useQueryClient();\n\treturn (milliseconds?: number) => invalidateQueryClientLicenses(queryClient, milliseconds);\n};\n",null],"names":["_objectSpread","useEndpoint","useSingleStream","useUserId","useQuery","useQueryClient","useEffect","timeout","module","link","default","v","export","useLicenseBase","useLicense","useHasLicense","useLicenseName","useInvalidateLicense","invalidateQueryClientLicenses","queryClient","milliseconds","arguments","length","undefined","clearTimeout","setTimeout","invalidateQueries","_ref","params","select","uid","getLicenses","notify","staleTime","Infinity","keepPreviousData","enabled","data","license","Boolean","_data$license$tags","tags","map","tag","name","join"],"mappings":"2BAEAA,EAAmFC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAY9EC,EAZIC,EAAaC,IAAA,CAAA,uCAAkC,CAAAC,QAAAA,CAAAA,EAAAV,EAA2BW,CAAA,CAAA,EAAA,GAAnFH,EAAOI,MAAE,CAAA,CAAAC,eAAa,IAAAA,EAA0BC,WAAQ,IAAAA,EAAAC,cAA2B,IAAAA,EAAAC,eAAAA,IAAAA,EAAAC,qBAAAA,IAAAA,CAAA,GAAAT,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAP,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAJ,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,QAAAA,CAAAF,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAWnF,IAAMY,EAGE,SAACC,CAAwB,EAAyB,IAAvBC,EAAYC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAG,IAChDG,aAAajB,GACbA,EAAUkB,WAAW,KACpBlB,EAAUgB,KAAAA,EACVJ,EAAYO,iBAAiB,CAAC,CAAC,WAAW,CAC3C,EAAGN,EACJ,EAGYP,EAAiBc,IAMzB,GANmD,CACvDC,OAAAA,CAAM,CACNC,OAAAA,CAAAA,CAIA,CAAAF,EACMG,EAAM3B,IAEN4B,EAAc9B,EAAY,MAAO,qBAEjCyB,EAAoBT,IAEpBe,EAAS9B,EAAgB,cAI/B,OAFAI,EAAU,IAAM0B,EAAO,UAAW,IAAMN,KAAsB,CAACM,EAAQN,EAAkB,EAElFtB,EAAS,CAAC,WAAY,cAAewB,EAAO,CAAE,IAAMG,EAAW/B,EAAA,CAAA,EAAM4B,IAAW,CACtFK,UAAWC,IACXC,iBAAkB,CAAA,EAClBN,OAAAA,EACAO,QAAS,CAAC,CAACN,GAEb,EAEahB,EAAcc,GACnBf,EAAe,CAAEe,OAAAA,EAAQC,OAASQ,GAASA,EAAKC,OAAAA,AAAO,GAGlDvB,EAAgB,IACrBF,EAAe,CAAEgB,OAASQ,GAASE,CAAAA,CAAQF,EAAKC,OAAO,AAAC,GAGnDtB,EAAkBY,GACvBf,EAAe,CAAEe,OAAAA,EAAQC,OAASQ,IAAI,IAAAG,EAAA,MAAK,AAAAH,CAAAA,MAAAA,EAAI,KAAA,EAAA,AAAc,OAAdG,CAAAA,EAAJH,EAAMC,OAAO,CAACG,IAAI,AAAJA,GAAID,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAlBA,EAAoBE,GAAG,CAAEC,GAAQA,EAAIC,IAAI,EAAEC,IAAI,CAAC,IAAG,GAAK,WAAW,CAAA,GAGzG5B,EAAuB,KACnC,IAAME,EAAcd,IACpB,OAAQe,GAA0BF,EAA8BC,EAAaC,EAC9E"}