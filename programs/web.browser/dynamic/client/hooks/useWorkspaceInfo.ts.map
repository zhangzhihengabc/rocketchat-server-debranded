)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useWorkspaceInfo.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IStats, IWorkspaceInfo, Serialized } from '@rocket.chat/core-typings';\nimport type { IInstance } from '@rocket.chat/rest-typings';\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQueries, useQueryClient } from '@tanstack/react-query';\n\nexport const useWorkspaceInfo = ({ refreshStatistics }: { refreshStatistics?: boolean } = {}) => {\n\tconst getStatistics = useEndpoint('GET', '/v1/statistics');\n\tconst getInstances = useEndpoint('GET', '/v1/instances.get');\n\tconst getServerInfo = useEndpoint('GET', '/info');\n\n\treturn useQueries({\n\t\tqueries: [\n\t\t\t{\n\t\t\t\tqueryKey: ['info', 'serverInfo'],\n\t\t\t\tqueryFn: async () => {\n\t\t\t\t\tconst data = await getServerInfo();\n\n\t\t\t\t\tif (!('minimumClientVersions' in data)) {\n\t\t\t\t\t\tthrow new Error('Invalid server info');\n\t\t\t\t\t}\n\t\t\t\t\tif (!('info' in data)) {\n\t\t\t\t\t\tthrow new Error('Invalid server info');\n\t\t\t\t\t}\n\t\t\t\t\tif (!('version' in data)) {\n\t\t\t\t\t\tthrow new Error('Invalid server info');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn data as IWorkspaceInfo;\n\t\t\t\t},\n\t\t\t\tstaleTime: Infinity,\n\t\t\t\tkeepPreviousData: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tqueryKey: ['info', 'instances'],\n\t\t\t\tqueryFn: () => getInstances(),\n\t\t\t\tstaleTime: Infinity,\n\t\t\t\tkeepPreviousData: true,\n\t\t\t\tselect({ instances }: Serialized<{ instances: IInstance[] }>) {\n\t\t\t\t\treturn instances.map((instance) => ({\n\t\t\t\t\t\t...instance,\n\t\t\t\t\t\t...(instance.instanceRecord && {\n\t\t\t\t\t\t\tinstanceRecord: {\n\t\t\t\t\t\t\t\t...instance.instanceRecord,\n\t\t\t\t\t\t\t\t_createdAt: new Date(instance.instanceRecord._createdAt),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t})) as IInstance[];\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tqueryKey: ['info', 'statistics'],\n\t\t\t\tqueryFn: () => getStatistics({ refresh: refreshStatistics ? 'true' : 'false' }),\n\t\t\t\tstaleTime: Infinity,\n\t\t\t\tkeepPreviousData: true,\n\t\t\t\tselect: (data: Serialized<IStats>) => ({\n\t\t\t\t\t...data,\n\t\t\t\t\tlastMessageSentAt: data.lastMessageSentAt ? new Date(data.lastMessageSentAt) : undefined,\n\t\t\t\t}),\n\t\t\t},\n\t\t],\n\t});\n};\n\nexport const useRefreshStatistics = () => {\n\tconst queryClient = useQueryClient();\n\treturn useMutation({\n\t\tmutationFn: () => queryClient.invalidateQueries(['info', 'statistics']),\n\t});\n};\n",null],"names":["_objectSpread","useEndpoint","useMutation","useQueries","useQueryClient","module","link","default","export","useWorkspaceInfo","useRefreshStatistics","refreshStatistics","arguments","length","undefined","getStatistics","getInstances","getServerInfo","queries","queryKey","queryFn","data","Error","staleTime","Infinity","keepPreviousData","select","_ref","instances","map","instance","instanceRecord","_createdAt","Date","refresh","lastMessageSentAt","queryClient","mutationFn","invalidateQueries"],"mappings":"2BAEAA,EAAuDC,EAAAC,EAAAC,EAAAC,EAA9CC,EAAaC,IAAM,CAAA,uCAA2B,CAAAC,QAAAA,CAAAA,EAAAP,EAAAA,CAAA,CAAA,EAAA,GAAvDK,EAAOG,MAAE,CAAA,CAAAC,iBAAmB,IAAAA,EAAAC,qBAA2B,IAAAA,CAAA,GAAAL,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAJ,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAH,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAGhD,IAAMK,EAAmB,WAAgE,GAA/D,CAAEE,kBAAAA,CAAAA,CAAiB,CAAAC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAsC,CAAA,EACnFG,EAAgBd,EAAY,MAAO,kBACnCe,EAAef,EAAY,MAAO,qBAClCgB,EAAgBhB,EAAY,MAAO,SAEzC,OAAOE,EAAW,CACjBe,QAAS,CACR,CACCC,SAAU,CAAC,OAAQ,aAAa,CAChCC,QAAS,UACR,IAAMC,EAAO,MAAMJ,IAEnB,GAAI,CAAE,CAAA,0BAA2BI,CAAAA,GAG7B,CAAE,CAAA,SAAUA,CAAAA,GAGZ,CAAE,CAAA,YAAaA,CAAAA,EALlB,MAAM,AAAIC,MAAM,uBASjB,OAAOD,CACR,EACAE,UAAWC,IACXC,iBAAkB,CAAA,GAEnB,CACCN,SAAU,CAAC,OAAQ,YAAY,CAC/BC,QAAS,IAAMJ,IACfO,UAAWC,IACXC,iBAAkB,CAAA,EAClBC,OAAMC,CAAA,EAAsD,GAArD,CAAEC,UAAAA,CAAAA,CAAmD,CAAAD,EAC3D,OAAOC,EAAUC,GAAG,CAAEC,GAAQ9B,EAAAA,EAAA,CAAA,EAC1B8B,GACCA,EAASC,cAAc,EAAI,CAC9BA,eAAc/B,EAAAA,EAAA,CAAA,EACV8B,EAASC,cAAc,EAAA,CAAA,EAAA,CAC1BC,WAAY,IAAIC,KAAKH,EAASC,cAAc,CAACC,UAAU,CAAC,KAI5D,GAED,CACCb,SAAU,CAAC,OAAQ,aAAa,CAChCC,QAAS,IAAML,EAAc,CAAEmB,QAASvB,EAAoB,OAAS,OAAO,GAC5EY,UAAWC,IACXC,iBAAkB,CAAA,EAClBC,OAASL,GAAwBrB,EAAAA,EAAA,CAAA,EAC7BqB,GAAI,CAAA,EAAA,CACPc,kBAAmBd,EAAKc,iBAAiB,CAAG,IAAIF,KAAKZ,EAAKc,iBAAiB,EAAIrB,KAAAA,CAAS,IAEzF,EAGJ,EAEaJ,EAAuB,KACnC,IAAM0B,EAAchC,IACpB,OAAOF,EAAY,CAClBmC,WAAY,IAAMD,EAAYE,iBAAiB,CAAC,CAAC,OAAQ,aAAa,GAExE"}