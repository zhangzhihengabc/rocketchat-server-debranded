)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/meteorCallWrapper.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { DDPCommon } from 'meteor/ddp-common';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\n\nconst bypassMethods: string[] = ['setUserStatus', 'logout'];\n\nfunction shouldBypass({ method, params }: Meteor.IDDPMessage): boolean {\n\tif (method === 'login' && params[0]?.resume) {\n\t\treturn true;\n\t}\n\n\tif (method.startsWith('UserPresence:') || bypassMethods.includes(method)) {\n\t\treturn true;\n\t}\n\n\tif (method.startsWith('stream-')) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nfunction wrapMeteorDDPCalls(): void {\n\tconst { _send } = Meteor.connection;\n\n\tMeteor.connection._send = function _DDPSendOverREST(message): void {\n\t\tif (message.msg !== 'method' || shouldBypass(message)) {\n\t\t\treturn _send.call(Meteor.connection, message);\n\t\t}\n\n\t\tconst endpoint = Tracker.nonreactive(() => (!Meteor.userId() ? 'method.callAnon' : 'method.call'));\n\n\t\tconst restParams = {\n\t\t\tmessage: DDPCommon.stringifyDDP({ ...message }),\n\t\t};\n\n\t\tconst processResult = (_message: any): void => {\n\t\t\t// Prevent error on reconnections and method retry.\n\t\t\t// On those cases the API will be called 2 times but\n\t\t\t// the handler will be deleted after the first execution.\n\t\t\tif (!Meteor.connection._methodInvokers[message.id]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tMeteor.connection._livedata_data({\n\t\t\t\tmsg: 'updated',\n\t\t\t\tmethods: [message.id],\n\t\t\t});\n\t\t\tMeteor.connection.onMessage(_message);\n\t\t};\n\t\tconst method = encodeURIComponent(message.method.replace(/\\//g, ':'));\n\n\t\tsdk.rest\n\t\t\t.post(`/v1/${endpoint}/${method}`, restParams)\n\t\t\t.then(({ message: _message }) => {\n\t\t\t\tprocessResult(_message);\n\t\t\t\tif (message.method === 'login') {\n\t\t\t\t\tconst parsedMessage = DDPCommon.parseDDP(_message as any) as { result?: { token?: string } };\n\t\t\t\t\tif (parsedMessage.result?.token) {\n\t\t\t\t\t\tMeteor.loginWithToken(parsedMessage.result.token);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t};\n}\n\nwindow.USE_REST_FOR_DDP_CALLS && wrapMeteorDDPCalls();\n",null],"names":["_objectSpread","DDPCommon","Meteor","Tracker","sdk","module","link","default","bypassMethods","window","USE_REST_FOR_DDP_CALLS","wrapMeteorDDPCalls","_send","connection","_DDPSendOverREST","message","msg","shouldBypass","_ref","_params$","method","params","resume","startsWith","includes","call","endpoint","nonreactive","userId","restParams","stringifyDDP","processResult","_message","_methodInvokers","id","_livedata_data","methods","onMessage","encodeURIComponent","replace","rest","post","concat","then","_ref2","_parsedMessage$result","parsedMessage","parseDDP","result","token","loginWithToken","catch","error","console"],"mappings":"2BAAAA,EAAAC,EAA8CC,EAAAC,EAAAC,EAA5BC,EAAEC,IAAM,CAAA,uCAAoB,CAAAC,QAAAA,CAAAA,EAAAP,EAAAA,CAAA,CAAA,EAAA,GAArCK,EAAWC,IAAA,CAAM,oBAAoB,CAAAL,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAH,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAF,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAD,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAM9C,IAAMI,EAA0B,CAAC,gBAAiB,SAAS,AAgE3DC,CAAAA,OAAOC,sBAAsB,EAAIC,AA9CjC,WACC,GAAM,CAAEC,MAAAA,CAAAA,CAAO,CAAGV,EAAOW,UAAU,AAEnCX,CAAAA,EAAOW,UAAU,CAACD,KAAK,CAAG,SAASE,EAAiBC,CAAO,EAC1D,GAAIA,AAAgB,WAAhBA,EAAQC,GAAG,EAAiBC,AApBlC,SAAqBC,CAAA,EAAuC,IAAAC,EAAA,GAAtC,CAAEC,OAAAA,CAAM,CAAEC,OAAAA,CAAAA,CAA4B,CAAAH,WAC5C,UAAXE,GAAkB,AAAa,OAAbD,CAAAA,EAAIE,CAAM,CAAC,EAAE,AAAD,GAACF,AAAA,KAAA,IAAAA,GAATA,EAAWG,MAAM,EAIvCF,EAAOG,UAAU,CAAC,kBAAoBf,EAAcgB,QAAQ,CAACJ,IAI7DA,EAAOG,UAAU,CAAC,WAKvB,EAM+CR,GAC5C,OAAOH,EAAMa,IAAI,CAACvB,EAAOW,UAAU,CAAEE,GAGtC,IAAMW,EAAWvB,EAAQwB,WAAW,CAAC,IAAO,AAACzB,EAAO0B,MAAM,GAAyB,cAApB,mBAEzDC,EAAa,CAClBd,QAASd,EAAU6B,YAAY,CAAA9B,EAAA,CAAA,EAAMe,KAGhCgB,EAAiBC,IAIjB9B,EAAOW,UAAU,CAACoB,eAAe,CAAClB,EAAQmB,EAAE,CAAC,GAGlDhC,EAAOW,UAAU,CAACsB,cAAc,CAAC,CAChCnB,IAAK,UACLoB,QAAS,CAACrB,EAAQmB,EAAE,CAAA,GAErBhC,EAAOW,UAAU,CAACwB,SAAS,CAACL,GAC7B,EACMZ,EAASkB,mBAAmBvB,EAAQK,MAAM,CAACmB,OAAO,CAAC,MAAO,MAEhEnC,EAAIoC,IAAI,CACNC,IAAI,CAAA,OAAAC,MAAA,CAAQhB,EAAQ,KAAAgB,MAAA,CAAItB,GAAUS,GAClCc,IAAI,CAACC,IAA0B,GAAzB,CAAE7B,QAASiB,CAAAA,CAAU,CAAAY,EAE3B,GADAb,EAAcC,GACVjB,AAAmB,UAAnBA,EAAQK,MAAM,CAAc,CAAA,IAAAyB,EAC/B,IAAMC,EAAgB7C,EAAU8C,QAAQ,CAACf,EACjB,QAAxBa,CAAAA,EAAIC,EAAcE,MAAM,AAANA,GAAMH,AAAA,KAAA,IAAAA,GAApBA,EAAsBI,KAAK,EAC9B/C,EAAOgD,cAAc,CAACJ,EAAcE,MAAM,CAACC,KAAK,EAGnD,GACCE,KAAK,CAAEC,IACPC,QAAQD,KAAK,CAACA,EACf,EACF,CACD"}