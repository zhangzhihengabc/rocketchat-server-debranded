)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/minimongo/bson.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n",null],"names":["BSONType","module","export","getBSONType","compareBSONValues","v","Double","String","Boolean","Array","isArray","Null","RegExp","Regex","JavaScript","Date","Uint8Array","BinData","Object","getBSONTypeOrder","type","Int","Long","Symbol","ObjectId","Timestamp","JavaScriptWithScope","a","b","undefined","ta","oa","tb","ob","Error","localeCompare","prototype","concat","call","entries","i","length","s","Undefined","toHexString","Number","getTime"],"mappings":"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"}