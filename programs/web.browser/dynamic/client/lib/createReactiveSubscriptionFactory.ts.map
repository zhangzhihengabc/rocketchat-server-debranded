)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/createReactiveSubscriptionFactory.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Tracker } from 'meteor/tracker';\n\nimport { queueMicrotask } from './utils/queueMicrotask';\n\ninterface ISubscriptionFactory<T> {\n\t(...args: any[]): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => T];\n}\n\nexport const createReactiveSubscriptionFactory =\n\t<T>(computeCurrentValueWith: (...args: any[]) => T): ISubscriptionFactory<T> =>\n\t(...args: any[]): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => T] => {\n\t\tconst callbacks = new Set<() => void>();\n\n\t\tlet currentValue = computeCurrentValueWith(...args);\n\n\t\tconst reactiveFn = (): void => {\n\t\t\tcurrentValue = computeCurrentValueWith(...args);\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tcallbacks.forEach((callback) => {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\tlet computation: Tracker.Computation | undefined;\n\n\t\tqueueMicrotask(() => {\n\t\t\tcomputation = Tracker.autorun(reactiveFn);\n\t\t});\n\n\t\treturn [\n\t\t\t(callback): (() => void) => {\n\t\t\t\tcallbacks.add(callback);\n\n\t\t\t\treturn (): void => {\n\t\t\t\t\tcallbacks.delete(callback);\n\n\t\t\t\t\tif (callbacks.size === 0) {\n\t\t\t\t\t\tqueueMicrotask(() => computation?.stop());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\t\t(): T => currentValue,\n\t\t];\n\t};\n",null],"names":["Tracker","queueMicrotask","module","export","createReactiveSubscriptionFactory","computeCurrentValueWith","computation","_len","arguments","length","args","Array","_key","callbacks","Set","currentValue","reactiveFn","forEach","callback","autorun","add","delete","size","_computation","stop"],"mappings":"2BAAyCA,EAAAC,EAAzCC,EAAOC,MAAE,CAAA,CAAAC,kCAAgC,IAAAA,CAAA,GAAAF,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAF,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAD,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQlC,IAAMG,EACRC,GACJ,eAcKC,EAd4F,IAAA,IAAAC,EAAAC,UAAAC,MAAA,CAA7FC,EAAW,AAAAC,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAXF,CAAW,CAAAE,EAAA,CAAAJ,SAAA,CAAAI,EAAA,CACd,IAAMC,EAAY,IAAIC,IAElBC,EAAeV,KAA2BK,GAExCM,EAAa,KAClBD,EAAeV,KAA2BK,GAC1CT,EAAe,KACdY,EAAUI,OAAO,CAAEC,IAClBA,GACD,EACD,EACD,EAQA,OAJAjB,EAAe,KACdK,EAAcN,EAAQmB,OAAO,CAACH,EAC/B,GAEO,CACLE,IACAL,EAAUO,GAAG,CAACF,GAEP,KACNL,EAAUQ,MAAM,CAACH,GAEM,IAAnBL,EAAUS,IAAI,EACjBrB,EAAe,KAAA,IAAAsB,EAAA,OAAA,AAAiB,OAAjBA,CAAAA,EAAMjB,CAAAA,GAAWiB,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAXA,EAAaC,IAAI,EAAE,EAE1C,GAED,IAAST,EACT,AACF"}