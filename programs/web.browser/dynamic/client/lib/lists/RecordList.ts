function module(t,e,i){let s,r,h,a;i.link("@babel/runtime/helpers/classPrivateFieldLooseBase",{default(t){s=t}},0),i.link("@babel/runtime/helpers/classPrivateFieldLooseKey",{default(t){r=t}},1),i.export({RecordList:()=>c}),i.link("@rocket.chat/emitter",{Emitter(t){h=t}},0),i.link("../asyncState",{AsyncStatePhase(t){a=t}},1);var n=r("hasChanges"),l=r("index"),d=r("phase"),u=r("items"),o=r("itemCount"),m=r("pedingMutation");class c extends h{constructor(){super(...arguments),Object.defineProperty(this,n,{writable:!0,value:!1}),Object.defineProperty(this,l,{writable:!0,value:new Map}),Object.defineProperty(this,d,{writable:!0,value:a.LOADING}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:Promise.resolve()})}filter(t){return!0}compare(t,e){var i,s;let r="string"==typeof t._updatedAt?new Date(t._updatedAt):t._updatedAt,h="string"==typeof e._updatedAt?new Date(e._updatedAt):e._updatedAt;return(null!==(i=null==h?void 0:h.getTime())&&void 0!==i?i:-1)-(null!==(s=null==r?void 0:r.getTime())&&void 0!==s?s:-1)}get phase(){return s(this,d)[d]}get items(){return s(this,u)[u]||(s(this,u)[u]=Array.from(s(this,l)[l].values()).sort(this.compare)),s(this,u)[u]}get itemCount(){var t;return null!==(t=s(this,o)[o])&&void 0!==t?t:s(this,l)[l].size}insert(t){s(this,l)[l].set(t._id,t),this.emit("".concat(t._id,"/inserted"),t),"number"==typeof s(this,o)[o]&&s(this,o)[o]++,s(this,n)[n]=!0}update(t){s(this,l)[l].set(t._id,t),this.emit("".concat(t._id,"/updated"),t),s(this,n)[n]=!0}delete(t){s(this,l)[l].delete(t),this.emit("".concat(t,"/deleted")),"number"==typeof s(this,o)[o]&&s(this,o)[o]--,s(this,n)[n]=!0}push(t){let e=s(this,l)[l].has(t._id),i=this.filter(t);if(e&&!i){this.delete(t._id);return}if(e&&i){this.update(t);return}!e&&i&&this.insert(t)}async mutate(t){try{s(this,d)[d]===a.RESOLVED&&(s(this,d)[d]=a.UPDATING,this.emit("mutating")),s(this,m)[m]=s(this,m)[m].then(t),await s(this,m)[m]}catch(t){this.emit("errored",t)}finally{let t=s(this,n)[n];s(this,d)[d]=a.RESOLVED,t&&(s(this,u)[u]=void 0,s(this,n)[n]=!1),this.emit("mutated",t)}}batchHandle(t){return this.mutate(async()=>{let e=await t();if(e.items)for(let t of e.items)this.push(t);e.itemCount&&(s(this,o)[o]=e.itemCount,s(this,n)[n]=!0)})}prune(t){return this.mutate(()=>{for(let e of s(this,l)[l].values())t(e)&&this.delete(e._id)})}handle(t){return this.mutate(()=>{this.push(t)})}remove(t){return this.mutate(()=>{s(this,l)[l].has(t)&&this.delete(t)})}clear(){return this.mutate(()=>{0!==s(this,l)[l].size&&(s(this,l)[l].clear(),s(this,u)[u]=void 0,s(this,o)[o]=void 0,s(this,n)[n]=!0,this.emit("cleared"))})}}}
//# sourceMappingURL=/dynamic/client/lib/lists/83500d91e03af7d9b6586f912b0a160b11199108.map
