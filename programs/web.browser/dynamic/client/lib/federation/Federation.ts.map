)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/federation/Federation.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, ISubscription, IUser, ValueOf } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isPublicRoom } from '@rocket.chat/core-typings';\n\nimport { RoomRoles } from '../../../app/models/client';\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\n\nconst allowedUserActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\n\tRoomMemberActions.REMOVE_USER,\n\tRoomMemberActions.SET_AS_OWNER,\n\tRoomMemberActions.SET_AS_MODERATOR,\n];\n\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\n\nexport const actionAllowed = (\n\troom: Partial<IRoom>,\n\taction: ValueOf<typeof RoomMemberActions>,\n\tdisplayingUserId: IUser['_id'],\n\tuserSubscription?: ISubscription,\n): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\n\tconst subscribed = Boolean(userSubscription);\n\tconst defaultUser = !userSubscription?.roles;\n\tif (!subscribed || defaultUser) {\n\t\treturn false;\n\t}\n\n\tconst myself = userSubscription.u?._id === displayingUserId;\n\tconst removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\n\n\tif (removingMyself) {\n\t\treturn false;\n\t}\n\n\tconst displayingUserRoomRoles = RoomRoles.findOne({ 'rid': room._id, 'u._id': displayingUserId })?.roles || [];\n\tconst loggedInUserRoomRoles = userSubscription.roles || [];\n\n\tif (loggedInUserRoomRoles.includes('owner')) {\n\t\tif (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\treturn displayingUserRoomRoles.includes('owner') ? myself : true;\n\t\t}\n\n\t\tif (action === RoomMemberActions.REMOVE_USER) {\n\t\t\treturn !displayingUserRoomRoles.includes('owner');\n\t\t}\n\t\tconst allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\n\n\t\treturn allowedForOwnersOverDefaultUsers;\n\t}\n\n\tif (loggedInUserRoomRoles.includes('moderator')) {\n\t\tif (displayingUserRoomRoles.includes('owner')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (displayingUserRoomRoles.includes('moderator')) {\n\t\t\tif (action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\t\treturn myself;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconst allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\n\n\t\treturn allowedForModeratorsOverDefaultUsers;\n\t}\n\n\treturn false;\n};\n\nexport const isEditableByTheUser = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn isRoomFederated(room) && Boolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'));\n};\n\nexport const canCreateInviteLinks = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn (\n\t\tisRoomFederated(room) &&\n\t\tisPublicRoom(room) &&\n\t\tBoolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'))\n\t);\n};\n\nexport const isRoomSettingAllowed = (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n};\n",null],"names":["isRoomFederated","isDirectMessageRoom","isPublicRoom","RoomRoles","RoomMemberActions","RoomSettingsEnum","module","export","actionAllowed","isEditableByTheUser","canCreateInviteLinks","isRoomSettingAllowed","allowedUserActionsInFederatedRooms","REMOVE_USER","SET_AS_OWNER","SET_AS_MODERATOR","allowedRoomSettingsChangesInFederatedRooms","NAME","TOPIC","room","action","displayingUserId","userSubscription","_userSubscription$u","_RoomRoles$findOne","defaultUser","roles","Boolean","myself","u","_id","removingMyself","displayingUserRoomRoles","findOne","loggedInUserRoomRoles","includes","allowedForOwnersOverDefaultUsers","allowedForModeratorsOverDefaultUsers","user","subscription","_subscription$roles","_subscription$roles2","_subscription$roles3","_subscription$roles4","setting"],"mappings":"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"}