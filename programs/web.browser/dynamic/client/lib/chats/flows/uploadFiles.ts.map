)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/chats/flows/uploadFiles.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { isRoomFederated } from '@rocket.chat/core-typings';\n\nimport { fileUploadIsValidContentType } from '../../../../app/utils/client';\nimport FileUploadModal from '../../../views/room/modals/FileUploadModal';\nimport { imperativeModal } from '../../imperativeModal';\nimport { prependReplies } from '../../utils/prependReplies';\nimport type { ChatAPI } from '../ChatAPI';\n\nexport const uploadFiles = async (chat: ChatAPI, files: readonly File[], resetFileInput?: () => void): Promise<void> => {\n\tconst replies = chat.composer?.quotedMessages.get() ?? [];\n\n\tconst msg = await prependReplies('', replies);\n\n\tconst room = await chat.data.getRoom();\n\n\tconst queue = [...files];\n\n\tconst uploadNextFile = (): void => {\n\t\tconst file = queue.pop();\n\t\tif (!file) {\n\t\t\tchat.composer?.dismissAllQuotedMessages();\n\t\t\treturn;\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: FileUploadModal,\n\t\t\tprops: {\n\t\t\t\tfile,\n\t\t\t\tfileName: file.name,\n\t\t\t\tfileDescription: chat.composer?.text ?? '',\n\t\t\t\tshowDescription: room && !isRoomFederated(room),\n\t\t\t\tonClose: (): void => {\n\t\t\t\t\timperativeModal.close();\n\t\t\t\t\tuploadNextFile();\n\t\t\t\t},\n\t\t\t\tonSubmit: (fileName: string, description?: string): void => {\n\t\t\t\t\tObject.defineProperty(file, 'name', {\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tvalue: fileName,\n\t\t\t\t\t});\n\t\t\t\t\tchat.uploads.send(file, {\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tmsg,\n\t\t\t\t\t});\n\t\t\t\t\tchat.composer?.clear();\n\t\t\t\t\timperativeModal.close();\n\t\t\t\t\tuploadNextFile();\n\t\t\t\t},\n\t\t\t\tinvalidContentType: Boolean(file.type && !fileUploadIsValidContentType(file.type)),\n\t\t\t},\n\t\t});\n\t};\n\n\tuploadNextFile();\n\tresetFileInput?.();\n};\n",null],"names":["isRoomFederated","fileUploadIsValidContentType","FileUploadModal","imperativeModal","prependReplies","module","export","uploadFiles","default","chat","files","resetFileInput","_chat$composer$quoted","_chat$composer","replies","composer","quotedMessages","get","msg","room","data","getRoom","queue","uploadNextFile","_chat$composer$text","_chat$composer3","_chat$composer2","file","pop","dismissAllQuotedMessages","open","component","props","fileName","name","fileDescription","text","showDescription","onClose","close","onSubmit","description","_chat$composer4","Object","defineProperty","writable","value","uploads","send","clear","invalidContentType","Boolean","type"],"mappings":"2BAAgCA,EAA4BC,EAAAC,EAAAC,EAAAC,EAA5DC,EAAOC,MAAE,CAAA,CAAAC,YAAiB,IAAAA,CAAM,GAA4BF,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAL,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAJ,6BAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,6CAAAA,CAAAG,QAAAA,CAAAA,EAAAN,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAF,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAD,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQrD,IAAMG,EAAc,MAAOE,EAAeC,EAAwBC,KAA8C,IAAAC,EAAAC,EACtH,IAAMC,EAAO,AAAsC,OAAtCF,CAAAA,EAAA,AAAgB,OAAhBC,CAAAA,EAAGJ,EAAKM,QAAQ,AAARA,GAAQF,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeG,cAAc,CAACC,GAAG,EAAA,GAAEL,AAAA,KAAA,IAAAA,EAAAA,EAAI,EAAE,CAEnDM,EAAM,MAAMd,EAAe,GAAIU,GAE/BK,EAAO,MAAMV,EAAKW,IAAI,CAACC,OAAO,GAE9BC,EAAQ,IAAIZ,EAAM,CAElBa,EAAiB,SAAWC,EAAAC,EAEtBC,EADX,IAAMC,EAAOL,EAAMM,GAAG,GACtB,GAAI,CAACD,EAAM,CACV,AAAa,OAAbD,CAAAA,EAAAjB,EAAKM,QAAQ,AAARA,GAAQW,AAAA,KAAA,IAAAA,GAAbA,EAAeG,wBAAwB,GACvC,OAGD1B,EAAgB2B,IAAI,CAAC,CACpBC,UAAW7B,EACX8B,MAAO,CACNL,KAAAA,EACAM,SAAUN,EAAKO,IAAI,CACnBC,gBAAe,AAAqB,OAArBX,CAAAA,EAAA,AAAe,OAAfC,CAAAA,EAAEhB,EAAKM,QAAQ,AAARA,GAAQU,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeW,IAAI,AAAJA,GAAIZ,AAAA,KAAA,IAAAA,EAAAA,EAAI,GACxCa,gBAAiBlB,GAAQ,CAACnB,EAAgBmB,GAC1CmB,QAAS,KACRnC,EAAgBoC,KAAK,GACrBhB,GACD,EACAiB,SAAU,CAACP,EAAkBQ,KAA8B,IAAAC,EAC1DC,OAAOC,cAAc,CAACjB,EAAM,OAAQ,CACnCkB,SAAU,CAAA,EACVC,MAAOb,IAERxB,EAAKsC,OAAO,CAACC,IAAI,CAACrB,EAAM,CACvBc,YAAAA,EACAvB,IAAAA,IAED,AAAa,OAAbwB,CAAAA,EAAAjC,EAAKM,QAAQ,AAARA,GAAQ2B,AAAA,KAAA,IAAAA,GAAbA,EAAeO,KAAK,GACpB9C,EAAgBoC,KAAK,GACrBhB,GACD,EACA2B,mBAAoBC,CAAAA,CAAQxB,CAAAA,EAAKyB,IAAI,EAAI,CAACnD,EAA6B0B,EAAKyB,IAAI,CAAA,IAGnF,EAEA7B,IACAZ,MAAAA,GAAAA,GACD"}