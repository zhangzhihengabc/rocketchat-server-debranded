)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/chats/flows/sendMessage.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport { KonchatNotification } from '../../../../app/ui/client/lib/KonchatNotification';\nimport { sdk } from '../../../../app/utils/client/lib/SDKClient';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport { dispatchToastMessage } from '../../toast';\nimport type { ChatAPI } from '../ChatAPI';\nimport { processMessageEditing } from './processMessageEditing';\nimport { processSetReaction } from './processSetReaction';\nimport { processSlashCommand } from './processSlashCommand';\nimport { processTooLongMessage } from './processTooLongMessage';\n\nconst process = async (chat: ChatAPI, message: IMessage, previewUrls?: string[]): Promise<void> => {\n\tKonchatNotification.removeRoomNotification(message.rid);\n\n\tif (await processSetReaction(chat, message)) {\n\t\treturn;\n\t}\n\n\tif (await processTooLongMessage(chat, message)) {\n\t\treturn;\n\t}\n\n\tif (await processMessageEditing(chat, message, previewUrls)) {\n\t\treturn;\n\t}\n\n\tif (await processSlashCommand(chat, message)) {\n\t\treturn;\n\t}\n\n\tawait sdk.call('sendMessage', message, previewUrls);\n};\n\nexport const sendMessage = async (\n\tchat: ChatAPI,\n\t{ text, tshow, previewUrls }: { text: string; tshow?: boolean; previewUrls?: string[] },\n): Promise<boolean> => {\n\tif (!(await chat.data.isSubscribedToRoom())) {\n\t\ttry {\n\t\t\tawait chat.data.joinRoom();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tchat.readStateManager.clearUnreadMark();\n\tawait chat.readStateManager.debouncedMarkAsRead();\n\n\ttext = text.trim();\n\n\tif (!text && !chat.currentEditing) {\n\t\t// Nothing to do\n\t\treturn false;\n\t}\n\n\tif (text) {\n\t\tconst message = await chat.data.composeMessage(text, {\n\t\t\tsendToChannel: tshow,\n\t\t\tquotedMessages: chat.composer?.quotedMessages.get() ?? [],\n\t\t\toriginalMessage: chat.currentEditing ? await chat.data.findMessageByID(chat.currentEditing.mid) : null,\n\t\t});\n\n\t\ttry {\n\t\t\tawait process(chat, message, previewUrls);\n\t\t\tchat.composer?.dismissAllQuotedMessages();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t\treturn true;\n\t}\n\n\tif (chat.currentEditing) {\n\t\tconst originalMessage = await chat.data.findMessageByID(chat.currentEditing.mid);\n\n\t\tif (!originalMessage) {\n\t\t\tdispatchToastMessage({ type: 'warning', message: t('Message_not_found') });\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tif (await chat.flows.processMessageEditing({ ...originalMessage, msg: '' }, previewUrls)) {\n\t\t\t\tchat.currentEditing.stop();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tawait chat.currentEditing?.reset();\n\t\t\tawait chat.flows.requestMessageDeletion(originalMessage);\n\t\t\treturn false;\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}\n\n\treturn false;\n};\n",null],"names":["_objectSpread","KonchatNotification","sdk","t","dispatchToastMessage","processMessageEditing","processSetReaction","processSlashCommand","processTooLongMessage","module","default","v","export","sendMessage","process","chat","message","previewUrls","removeRoomNotification","rid","call","_ref","_chat$composer$quoted","_chat$composer","_chat$composer2","_chat$currentEditing","text","tshow","data","isSubscribedToRoom","joinRoom","error","type","readStateManager","clearUnreadMark","debouncedMarkAsRead","trim","currentEditing","composeMessage","sendToChannel","quotedMessages","composer","get","originalMessage","findMessageByID","mid","dismissAllQuotedMessages","flows","msg","stop","reset","requestMessageDeletion"],"mappings":"2BAEAA,EAAoCC,EAAoDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA/EC,EAAAA,IAAmB,CAAE,uCAAM,CAAAC,QAAAA,CAAAA,EAAAV,EAAoDW,CAAA,CAAA,EAAA,GAAxFF,EAAOG,MAAE,CAAA,CAAAC,YAAAA,IAAqBA,CAAM,GAAAJ,EAAAA,IAAAA,CAAAA,oDAAoD,CAAAR,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,6CAAAA,CAAAP,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAN,EAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,cAAAA,CAAAL,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAJ,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,uBAAAA,CAAAH,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAF,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAD,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAUxF,IAAMM,EAAU,MAAOC,EAAeC,EAAmBC,KACxDhB,EAAoBiB,sBAAsB,CAACF,EAAQG,GAAG,EAElD,MAAMb,EAAmBS,EAAMC,IAI/B,MAAMR,EAAsBO,EAAMC,IAIlC,MAAMX,EAAsBU,EAAMC,EAASC,IAI3C,MAAMV,EAAoBQ,EAAMC,IAIpC,MAAMd,EAAIkB,IAAI,CAAC,cAAeJ,EAASC,EACxC,EAEaJ,EAAc,MAC1BE,EAAaM,SAsBHC,EAAAC,EAOLC,EAiBAC,EA5CgB,GADrB,CAAEC,KAAAA,CAAI,CAAEC,MAAAA,CAAK,CAAEV,YAAAA,CAAAA,CAAwE,CAAAI,EAEvF,GAAI,CAAE,MAAMN,EAAKa,IAAI,CAACC,kBAAkB,GACvC,GAAI,CACH,MAAMd,EAAKa,IAAI,CAACE,QAAQ,GACvB,MAAOC,EAAO,CAEf,OADA3B,EAAqB,CAAE4B,KAAM,QAAShB,QAASe,CAAK,GAC7C,CAAA,EAST,GALAhB,EAAKkB,gBAAgB,CAACC,eAAe,GACrC,MAAMnB,EAAKkB,gBAAgB,CAACE,mBAAmB,GAI3C,CAFJT,CAAAA,EAAOA,EAAKU,IAAI,EAAA,GAEH,CAACrB,EAAKsB,cAAc,CAEhC,MAAO,CAAA,EAGR,GAAIX,EAAM,CACT,IAAMV,EAAU,MAAMD,EAAKa,IAAI,CAACU,cAAc,CAACZ,EAAM,CACpDa,cAAeZ,EACfa,eAAc,AAAqC,OAArClB,CAAAA,EAAA,AAAe,OAAfC,CAAAA,EAAER,EAAK0B,QAAQ,AAARA,GAAQlB,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeiB,cAAc,CAACE,GAAG,EAAA,GAAEpB,AAAA,KAAA,IAAAA,EAAAA,EAAI,EAAE,CACzDqB,gBAAiB5B,EAAKsB,cAAc,CAAG,MAAMtB,EAAKa,IAAI,CAACgB,eAAe,CAAC7B,EAAKsB,cAAc,CAACQ,GAAG,EAAI,OAGnG,GAAI,CACH,MAAM/B,EAAQC,EAAMC,EAASC,GAC7B,AAAa,OAAbO,CAAAA,EAAAT,EAAK0B,QAAQ,AAARA,GAAQjB,AAAA,KAAA,IAAAA,GAAbA,EAAesB,wBAAwB,GACtC,MAAOf,EAAO,CACf3B,EAAqB,CAAE4B,KAAM,QAAShB,QAASe,CAAK,GAErD,MAAO,CAAA,EAGR,GAAIhB,EAAKsB,cAAc,CAAE,CACxB,IAAMM,EAAkB,MAAM5B,EAAKa,IAAI,CAACgB,eAAe,CAAC7B,EAAKsB,cAAc,CAACQ,GAAG,EAE/E,GAAI,CAACF,EAEJ,OADAvC,EAAqB,CAAE4B,KAAM,UAAWhB,QAASb,EAAE,oBAAoB,GAChE,CAAA,EAGR,GAAI,CACH,GAAI,MAAMY,EAAKgC,KAAK,CAAC1C,qBAAqB,CAAAL,EAAAA,EAAA,CAAA,EAAM2C,GAAe,CAAA,EAAA,CAAEK,IAAK,EAAE,GAAI/B,GAE3E,OADAF,EAAKsB,cAAc,CAACY,IAAI,GACjB,CAAA,CAGR,OAAA,CAAA,AAAyB,OAAzBxB,CAAAA,EAAMV,EAAKsB,cAAc,AAAdA,GAAcZ,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAnBA,EAAqByB,KAAK,EAAA,EAChC,MAAMnC,EAAKgC,KAAK,CAACI,sBAAsB,CAACR,GAEvC,MAAOZ,EAAO,CACf3B,EAAqB,CAAE4B,KAAM,QAAShB,QAASe,CAAK,IAItD,MAAO,CAAA,CACR"}