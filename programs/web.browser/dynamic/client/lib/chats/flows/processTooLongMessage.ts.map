)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/chats/flows/processTooLongMessage.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport { settings } from '../../../../app/settings/client';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport GenericModal from '../../../components/GenericModal';\nimport { imperativeModal } from '../../imperativeModal';\nimport { dispatchToastMessage } from '../../toast';\nimport type { ChatAPI } from '../ChatAPI';\n\nexport const processTooLongMessage = async (chat: ChatAPI, { msg }: Pick<IMessage, 'msg'>): Promise<boolean> => {\n\tconst maxAllowedSize = settings.get('Message_MaxAllowedSize');\n\n\tif (msg.length <= maxAllowedSize) {\n\t\treturn false;\n\t}\n\tconst fileUploadsEnabled = settings.get('FileUpload_Enabled');\n\tconst convertLongMessagesToAttachment = settings.get('Message_AllowConvertLongMessagesToAttachment');\n\n\tif (chat.currentEditing || !fileUploadsEnabled || !convertLongMessagesToAttachment) {\n\t\tdispatchToastMessage({ type: 'error', message: new Error(t('Message_too_long')) });\n\t\tchat.composer?.setText(msg);\n\t\treturn true;\n\t}\n\n\tawait new Promise<void>((resolve) => {\n\t\tconst onConfirm = async (): Promise<void> => {\n\t\t\tconst contentType = 'text/plain';\n\t\t\tconst messageBlob = new Blob([msg], { type: contentType });\n\t\t\tconst fileName = `${Meteor.user()?.username ?? 'anonymous'} - ${new Date()}.txt`; // TODO: proper naming and formatting\n\t\t\tconst file = new File([messageBlob], fileName, {\n\t\t\t\ttype: contentType,\n\t\t\t\tlastModified: Date.now(),\n\t\t\t});\n\n\t\t\timperativeModal.close();\n\t\t\tawait chat.flows.uploadFiles([file]);\n\n\t\t\tresolve();\n\t\t};\n\n\t\tconst onClose = (): void => {\n\t\t\tchat.composer?.setText(msg);\n\n\t\t\timperativeModal.close();\n\t\t\tresolve();\n\t\t};\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle: t('Message_too_long'),\n\t\t\t\tchildren: t('Send_it_as_attachment_instead_question'),\n\t\t\t\tonConfirm,\n\t\t\t\tonClose,\n\t\t\t\tonCancel: onClose,\n\t\t\t\tvariant: 'warning',\n\t\t\t},\n\t\t});\n\t});\n\n\treturn true;\n};\n",null],"names":["settings","t","GenericModal","imperativeModal","dispatchToastMessage","module","export","processTooLongMessage","default","chat","_ref","msg","maxAllowedSize","get","length","fileUploadsEnabled","convertLongMessagesToAttachment","currentEditing","_chat$composer","type","message","Error","composer","setText","Promise","resolve","onConfirm","_Meteor$user$username","_Meteor$user","contentType","messageBlob","Blob","fileName","concat","Meteor","user","username","Date","file","File","lastModified","now","close","flows","uploadFiles","onClose","_chat$composer2","open","component","props","title","children","onCancel","variant"],"mappings":"2BAE2DA,EAAAC,EAAAC,EAAAC,EAAAC,EAA3DC,EAAOC,MAAE,CAAA,CAAAC,sBAAgB,IAAAA,CAAkC,GAAAF,EAAAA,IAAAA,CAAAA,kCAAAA,CAAAL,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAJ,EAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,mCAAAA,CAAAG,QAAAA,CAAAA,EAAAN,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAF,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,cAAAA,CAAAD,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAOpD,IAAMG,EAAwB,MAAOE,EAAaC,KAAsD,GAApD,CAAEC,IAAAA,CAAAA,CAA4B,CAAAD,EAClFE,EAAiBZ,EAASa,GAAG,CAAC,0BAEpC,GAAIF,EAAIG,MAAM,EAAIF,EACjB,MAAO,CAAA,EAER,IAAMG,EAAqBf,EAASa,GAAG,CAAC,sBAClCG,EAAkChB,EAASa,GAAG,CAAC,gDAErD,GAAIJ,EAAKQ,cAAc,EAAI,CAACF,GAAsB,CAACC,EAAiC,CAAA,IAAAE,EAGnF,OAFAd,EAAqB,CAAEe,KAAM,QAASC,QAAS,AAAIC,MAAMpB,EAAE,oBAAoB,GAC/E,AAAa,OAAbiB,CAAAA,EAAAT,EAAKa,QAAQ,AAARA,GAAQJ,AAAA,KAAA,IAAAA,GAAbA,EAAeK,OAAO,CAACZ,GAChB,CAAA,EAuCR,OApCA,MAAM,IAAIa,QAAeC,IACxB,IAAMC,EAAY,UAA0B,IAAAC,EAAAC,EAC3C,IAAMC,EAAc,aACdC,EAAc,IAAIC,KAAK,CAACpB,EAAI,CAAE,CAAEQ,KAAMU,CAAW,GACjDG,EAAQ,GAAAC,MAAA,CAAA,AAA6B,OAA7BN,CAAAA,EAAA,AAAmB,OAAnBC,CAAAA,EAAMM,OAAOC,IAAI,EAAA,GAAEP,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeQ,QAAQ,AAARA,GAAQT,AAAA,KAAA,IAAAA,EAAAA,EAAI,YAAW,OAAAM,MAAA,CAAM,IAAII,KAAM,QACpEC,EAAO,IAAIC,KAAK,CAACT,EAAY,CAAEE,EAAU,CAC9Cb,KAAMU,EACNW,aAAcH,KAAKI,GAAG,KAGvBtC,EAAgBuC,KAAK,GACrB,MAAMjC,EAAKkC,KAAK,CAACC,WAAW,CAAC,CAACN,EAAK,EAEnCb,GACD,EAEMoB,EAAU,KAAW,IAAAC,CAC1B,AAAa,QAAbA,CAAAA,EAAArC,EAAKa,QAAQ,AAARA,GAAQwB,AAAA,KAAA,IAAAA,GAAbA,EAAevB,OAAO,CAACZ,GAEvBR,EAAgBuC,KAAK,GACrBjB,GACD,EAEAtB,EAAgB4C,IAAI,CAAC,CACpBC,UAAW9C,EACX+C,MAAO,CACNC,MAAOjD,EAAE,oBACTkD,SAAUlD,EAAE,0CACZyB,UAAAA,EACAmB,QAAAA,EACAO,SAAUP,EACVQ,QAAS,YAGZ,GAEO,CAAA,CACR"}