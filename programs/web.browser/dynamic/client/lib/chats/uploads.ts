function module(e,r,t){let n,l,a,o,i,c,p;t.link("@babel/runtime/helpers/objectSpread2",{default(e){n=e}},0),t.export({createUploadsAPI:()=>E}),t.link("@rocket.chat/emitter",{Emitter(e){l=e}},0),t.link("@rocket.chat/random",{Random(e){a=e}},1),t.link("../../../app/ui/client/lib/UserAction",{UserAction(e){o=e},USER_ACTIVITIES(e){i=e}},2),t.link("../../../app/utils/client/lib/SDKClient",{sdk(e){c=e}},3),t.link("../errorHandling",{getErrorMessage(e){p=e}},4);let d=[],s=new l,m=e=>{d=e(d),s.emit("update")},u=()=>d,g=e=>s.on("update",e),k=e=>{s.emit("cancelling-".concat(e))},f=()=>{m(e=>e.filter(e=>!e.error))},h=async(e,r)=>{let{description:t,msg:l,rid:u,tmid:g}=r,k=a.id();m(r=>[...r,{id:k,name:e.name,percentage:0}]);try{await new Promise((r,a)=>{let p=c.rest.upload("/v1/rooms.upload/".concat(u),{msg:l,tmid:g,file:e,description:t},{load:e=>{r(e)},progress:e=>{if(!e.lengthComputable)return;let r=e.loaded/e.total*100;100!==r&&m(e=>e.map(e=>e.id!==k?e:n(n({},e),{},{percentage:Math.round(r)||0})))},error:e=>{m(e=>e.map(e=>e.id!==k?e:n(n({},e),{},{percentage:0,error:Error(p.responseText)}))),a(e)}});d.length&&o.performContinuously(u,i.USER_UPLOADING,{tmid:g}),s.once("cancelling-".concat(k),()=>{p.abort(),m(e=>e.filter(e=>e.id!==k))})}),m(e=>e.filter(e=>e.id!==k))}catch(e){m(r=>r.map(r=>r.id!==k?r:n(n({},r),{},{percentage:0,error:Error(p(e))})))}finally{d.length||o.stop(u,i.USER_UPLOADING,{tmid:g})}},E=e=>{let{rid:r,tmid:t}=e;return{get:u,subscribe:g,wipeFailedOnes:f,cancel:k,send:(e,n)=>{let{description:l,msg:a}=n;return h(e,{description:l,msg:a,rid:r,tmid:t})}}}}
//# sourceMappingURL=/dynamic/client/lib/chats/379267208a9071a5e26505c67e955536e294c18b.map
