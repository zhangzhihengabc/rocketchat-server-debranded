function module(e,t,n){let i,s,r,a,l,d,o,u,c,f,g,y,m;n.link("@babel/runtime/helpers/objectSpread2",{default(e){i=e}},0),n.export({createDataAPI:()=>p}),n.link("@rocket.chat/random",{Random(e){s=e}},0),n.link("moment",{default(e){r=e}},1),n.link("../../../app/authorization/client",{hasAtLeastOnePermission(e){a=e},hasPermission(e){l=e}},2),n.link("../../../app/models/client",{Messages(e){d=e},ChatRoom(e){o=e},ChatSubscription(e){u=e}},3),n.link("../../../app/settings/client",{settings(e){c=e}},4),n.link("../../../app/ui-utils/client",{MessageTypes(e){f=e}},5),n.link("../../../app/utils/client/lib/SDKClient",{sdk(e){g=e}},6),n.link("../onClientBeforeSendMessage",{onClientBeforeSendMessage(e){y=e}},7),n.link("../utils/prependReplies",{prependReplies(e){m=e}},8);let p=e=>{let{rid:t,tmid:n}=e,p=async(e,r)=>{var a,l;let{sendToChannel:d,quotedMessages:o,originalMessage:u}=r,c=await m(e,o),f=null!==(a=null==u?void 0:u.rid)&&void 0!==a?a:t,g=u?u.tmid:n;return await y(i(i({_id:null!==(l=null==u?void 0:u._id)&&void 0!==l?l:s.id(),rid:f},g&&i({tmid:g},d&&{tshow:d})),{},{msg:c}))},w=async e=>{var t;return null!==(t=d.findOne({_id:e,_hidden:{$ne:!0}},{reactive:!1}))&&void 0!==t?t:g.call("getSingleMessage",e)},M=async e=>{let t=await w(e);if(!t)throw Error("Message not found");return t},_=async()=>d.findOne({rid:t,tmid:null!=n?n:{$exists:!1},_hidden:{$ne:!0}},{sort:{ts:-1},reactive:!1}),v=async()=>{let e=await _();if(!e)throw Error("Message not found");return e},h=async()=>{let e=Meteor.userId();if(e)return d.findOne({rid:t,tmid:null!=n?n:{$exists:!1},"u._id":e,_hidden:{$ne:!0}},{sort:{ts:-1},reactive:!1})},k=async()=>{let e=await h();if(!e)throw Error("Message not found");return e},$=async e=>{var t;if(f.isSystemMessage(e))return!1;let n=a("edit-message",e.rid),i=null!==(t=c.get("Message_AllowEditing"))&&void 0!==t&&t,s=(null==e?void 0:e.u)&&e.u._id===Meteor.userId();if(!n&&(!i||!s))return!1;let d=c.get("Message_AllowEditing_BlockEditInMinutes"),o=l("bypass-time-limit-edit-and-delete"),u=r().diff(e.ts,"minutes");return!!o||!u||!d||!(u>d)},E=async e=>{let i=Meteor.userId();if(!i)return;let s=d.findOne({rid:t,tmid:null!=n?n:{$exists:!1},"u._id":i,_hidden:{$ne:!0},ts:{$lt:e.ts}},{sort:{ts:-1},reactive:!1});return s?await $(s)?s:E(s):void 0},O=async e=>{let t=await E(e);if(!t)throw Error("Message not found");return t},S=async e=>{let i=Meteor.userId();if(!i)return;let s=d.findOne({rid:t,tmid:null!=n?n:{$exists:!1},"u._id":i,_hidden:{$ne:!0},ts:{$gt:e.ts}},{sort:{ts:1},reactive:!1});return s?await $(s)?s:S(s):void 0},b=async e=>{let t=await S(e);if(!t)throw Error("Message not found");return t},I=async e=>{d.upsert({_id:e._id},{$set:i(i({},e),{},{rid:t},n&&{tmid:n})})},x=async(e,t)=>g.call("updateMessage",e,t),A=async e=>{let n=Meteor.userId();if(!n||f.isSystemMessage(e))return!1;let i=l("force-delete-message",e.rid);if(i)return!0;let s=c.get("Message_AllowDeleting");if(!s)return!1;let a=l("delete-message",t),d=l("delete-own-message"),o=a||d&&(null==e?void 0:e.u)&&e.u._id===Meteor.userId();if(!o)return!1;let u=c.get("Message_AllowDeleting_BlockDeleteInMinutes"),g=l("bypass-time-limit-edit-and-delete"),y=r().diff(e.ts,"minutes");return o&&(g||!u||!y||y<=u)},D=async e=>{await g.call("deleteMessage",{_id:e})},R=new Map,C=async e=>R.get(e),B=async e=>{R.delete(e)},P=async(e,t)=>{R.set(e,t)},j=async()=>o.findOne({_id:t},{reactive:!1}),z=async()=>{let e=await j();if(!e)throw Error("Room not found");return e},K=async()=>!!u.findOne({rid:t},{reactive:!1}),L=async()=>{await g.call("joinRoom",t)},T=async e=>o.findOne({_id:e,prid:{$exists:!0}},{reactive:!1}),q=async e=>{let t=await T(e);if(!t)throw Error("Discussion not found");return t},F=(e,t)=>async function(){let n=await e(...arguments);if(!n)throw Error(t);return n},G=async()=>u.findOne({rid:t},{reactive:!1}),H=F(G,"Subscription not found"),J=async e=>u.findOne({rid:e.rid},{reactive:!1}),N=F(J,"Subscription not found");return{composeMessage:p,findMessageByID:w,getMessageByID:M,findLastMessage:_,getLastMessage:v,findLastOwnMessage:h,getLastOwnMessage:k,findPreviousOwnMessage:E,getPreviousOwnMessage:O,findNextOwnMessage:S,getNextOwnMessage:b,pushEphemeralMessage:I,canUpdateMessage:$,updateMessage:x,canDeleteMessage:A,deleteMessage:D,getDraft:C,saveDraft:P,discardDraft:B,findRoom:j,getRoom:z,isSubscribedToRoom:K,joinRoom:L,findDiscussionByID:T,getDiscussionByID:q,findSubscription:G,getSubscription:H,findSubscriptionFromMessage:J,getSubscriptionFromMessage:N}}}
//# sourceMappingURL=/dynamic/client/lib/chats/a18ea60235430b5dcfa9952e487838a466766d6f.map
