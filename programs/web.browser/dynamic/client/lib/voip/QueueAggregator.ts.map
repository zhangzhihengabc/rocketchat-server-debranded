)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/voip/QueueAggregator.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["/**\n * Class representing the agent's queue information. This class stores the information\n * of all the queues that the agent is serving.\n *\n * @remarks\n * This class stores the necessary information of agent's queue stats.\n * It also maintains a history of agents queue operation history for current\n * login session. (Agent logging in to rocket-chat and logging off from rocket chat.)\n * Currently the data is stored locally but may sent back to server if such need exists.\n */\n\nimport type { IQueueMembershipSubscription, ICallerInfo, IQueueInfo } from '@rocket.chat/core-typings';\n\ninterface IQueueServingRecord {\n\tqueueInfo: IQueueInfo;\n\tcallStarted: Date | undefined;\n\tcallEnded: Date | undefined;\n\tcallerId: ICallerInfo;\n\tagentExtension: string;\n}\n/**\n * Currently this class depends on the external users to update this class.\n * But in theory, this class serves as\n */\nexport class QueueAggregator {\n\t// Maintains the history of the queue that the agent has served\n\tprivate sessionQueueCallServingHistory: IQueueServingRecord[];\n\n\tprivate currentlyServing: IQueueServingRecord;\n\n\tprivate currentQueueMembershipStatus: Record<string, IQueueInfo>;\n\n\tprivate extension: string;\n\n\tconstructor() {\n\t\tthis.sessionQueueCallServingHistory = [];\n\t\tthis.currentQueueMembershipStatus = {};\n\t}\n\n\tprivate updateQueueInfo(queueName: string, queuedCalls: number): void {\n\t\tif (!this.currentQueueMembershipStatus?.[queueName]) {\n\t\t\t// something is wrong. Queue is not found in the membership details.\n\t\t\treturn;\n\t\t}\n\t\tthis.currentQueueMembershipStatus[queueName].callsInQueue = queuedCalls;\n\t}\n\n\tsetMembership(subscription: IQueueMembershipSubscription): void {\n\t\tthis.extension = subscription.extension;\n\n\t\tsubscription.queues.forEach((queue) => {\n\t\t\tconst queueInfo: IQueueInfo = {\n\t\t\t\tqueueName: queue.name,\n\t\t\t\tcallsInQueue: 0,\n\t\t\t};\n\t\t\tthis.currentQueueMembershipStatus[queue.name] = queueInfo;\n\t\t});\n\t}\n\n\tqueueJoined(joiningDetails: { queuename: string; callerid: { id: string }; queuedcalls: string }): void {\n\t\tthis.updateQueueInfo(joiningDetails.queuename, Number(joiningDetails.queuedcalls));\n\t}\n\n\tcallPickedup(queue: { queuename: string; queuedcalls: string; waittimeinqueue: string }): void {\n\t\tthis.updateQueueInfo(queue.queuename, Number(queue.queuedcalls));\n\t}\n\n\tmemberAdded(queue: { queuename: string; queuedcalls: string }): void {\n\t\t// current user is added in the queue which has queue count |queuedcalls|\n\t\tconst queueInfo: IQueueInfo = {\n\t\t\tqueueName: queue.queuename,\n\t\t\tcallsInQueue: Number(queue.queuedcalls),\n\t\t};\n\t\tthis.currentQueueMembershipStatus[queue.queuename] = queueInfo;\n\t}\n\n\tmemberRemoved(queue: { queuename: string; queuedcalls: string }): void {\n\t\t// current user is removed from the queue which has queue count |queuedcalls|\n\t\tif (!this.currentQueueMembershipStatus?.[queue.queuename]) {\n\t\t\t// something is wrong. Queue is not found in the membership details.\n\t\t\treturn;\n\t\t}\n\t\tdelete this.currentQueueMembershipStatus[queue.queuename];\n\t}\n\n\tqueueAbandoned(queue: { queuename: string; queuedcallafterabandon: string }): void {\n\t\tthis.updateQueueInfo(queue.queuename, Number(queue.queuedcallafterabandon));\n\t}\n\n\tgetCallWaitingCount(): number {\n\t\treturn Object.entries(this.currentQueueMembershipStatus).reduce((acc, [_, value]) => acc + value.callsInQueue, 0);\n\t}\n\n\tgetCurrentQueueName(): string {\n\t\tif (this.currentlyServing?.queueInfo) {\n\t\t\treturn this.currentlyServing.queueInfo.queueName;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tcallRinging(queueInfo: { queuename: string; callerid: { id: string; name: string } }): void {\n\t\tif (!this.currentQueueMembershipStatus?.[queueInfo.queuename]) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst queueServing: IQueueServingRecord = {\n\t\t\tqueueInfo: this.currentQueueMembershipStatus[queueInfo.queuename],\n\t\t\tcallerId: {\n\t\t\t\tcallerId: queueInfo.callerid.id,\n\t\t\t\tcallerName: queueInfo.callerid.name,\n\t\t\t},\n\t\t\tcallStarted: undefined,\n\t\t\tcallEnded: undefined,\n\t\t\tagentExtension: this.extension,\n\t\t};\n\t\tthis.currentlyServing = queueServing;\n\t}\n\n\tcallStarted(): void {\n\t\tif (this.currentlyServing) {\n\t\t\tthis.currentlyServing.callStarted = new Date();\n\t\t}\n\t}\n\n\tcallEnded(): void {\n\t\t// Latest calls are at lower index\n\t\tif (this.currentlyServing) {\n\t\t\tthis.currentlyServing.callEnded = new Date();\n\t\t\tthis.sessionQueueCallServingHistory.unshift(this.currentlyServing);\n\t\t}\n\t}\n}\n",null],"names":["module","QueueAggregator","constructor","sessionQueueCallServingHistory","currentlyServing","currentQueueMembershipStatus","extension","updateQueueInfo","queueName","queuedCalls","_this$currentQueueMem","callsInQueue","setMembership","subscription","queues","forEach","queue","queueInfo","name","queueJoined","joiningDetails","queuename","Number","queuedcalls","callPickedup","memberAdded","memberRemoved","_this$currentQueueMem2","queueAbandoned","queuedcallafterabandon","getCallWaitingCount","Object","entries","reduce","acc","_ref","_","value","getCurrentQueueName","_this$currentlyServin","callRinging","_this$currentQueueMem3","queueServing","callerId","callerid","id","callerName","callStarted","undefined","callEnded","agentExtension","Date","unshift"],"mappings":"uBAAAA,EAAAA,MAAAA,CAAAA,CAAAC,gBAAAA,IAAAA,CAAA,EAwBM,OAAOA,EAUZC,aAAAA,CAAA,IAAA,CARQC,8BAA8B,CAAA,KAAA,EAAA,IAAA,CAE9BC,gBAAgB,CAAA,KAAA,EAAA,IAAA,CAEhBC,4BAA4B,CAAA,KAAA,EAAA,IAAA,CAE5BC,SAAS,CAAA,KAAA,EAGhB,IAAI,CAACH,8BAA8B,CAAG,EAAE,CACxC,IAAI,CAACE,4BAA4B,CAAG,CAAA,CACrC,CAEQE,gBAAgBC,CAAiB,CAAEC,CAAmB,CAAA,CAAA,IAAAC,CACvB,QAAlCA,CAAAA,EAAC,IAAI,CAACL,4BAA4B,AAA5BA,GAA4BK,AAAA,KAAA,IAAAA,GAAjCA,CAAA,CAAoCF,EAAU,EAInD,CAAA,IAAI,CAACH,4BAA4B,CAACG,EAAU,CAACG,YAAY,CAAGF,CAAAA,CAC7D,CAEAG,cAAcC,CAA0C,CAAA,CACvD,IAAI,CAACP,SAAS,CAAGO,EAAaP,SAAS,CAEvCO,EAAaC,MAAM,CAACC,OAAO,CAAEC,IAC5B,IAAMC,EAAwB,CAC7BT,UAAWQ,EAAME,IAAI,CACrBP,aAAc,EAEf,CAAA,IAAI,CAACN,4BAA4B,CAACW,EAAME,IAAI,CAAC,CAAGD,CACjD,EACD,CAEAE,YAAYC,CAAoF,CAAA,CAC/F,IAAI,CAACb,eAAe,CAACa,EAAeC,SAAS,CAAEC,OAAOF,EAAeG,WAAW,EACjF,CAEAC,aAAaR,CAA0E,CAAA,CACtF,IAAI,CAACT,eAAe,CAACS,EAAMK,SAAS,CAAEC,OAAON,EAAMO,WAAW,EAC/D,CAEAE,YAAYT,CAAiD,CAAA,CAE5D,IAAMC,EAAwB,CAC7BT,UAAWQ,EAAMK,SAAS,CAC1BV,aAAcW,OAAON,EAAMO,WAAW,EAEvC,CAAA,IAAI,CAAClB,4BAA4B,CAACW,EAAMK,SAAS,CAAC,CAAGJ,CACtD,CAEAS,cAAcV,CAAiD,CAAA,CAAA,IAAAW,CAExB,QAAlCA,CAAAA,EAAC,IAAI,CAACtB,4BAA4B,AAA5BA,GAA4BsB,AAAA,KAAA,IAAAA,GAAjCA,CAAA,CAAoCX,EAAMK,SAAS,CAAC,EAIzD,OAAO,IAAI,CAAChB,4BAA4B,CAACW,EAAMK,SAAS,CAAC,AAC1D,CAEAO,eAAeZ,CAA4D,CAAA,CAC1E,IAAI,CAACT,eAAe,CAACS,EAAMK,SAAS,CAAEC,OAAON,EAAMa,sBAAsB,EAC1E,CAEAC,qBAAmB,CAClB,OAAOC,OAAOC,OAAO,CAAC,IAAI,CAAC3B,4BAA4B,EAAE4B,MAAM,CAAC,CAACC,EAAGC,KAAA,GAAE,CAACC,EAAGC,EAAM,CAAAF,EAAA,OAAKD,EAAMG,EAAM1B,YAAY,EAAE,EAChH,CAEA2B,qBAAmB,CAAA,IAAAC,SAClB,AAAyB,OAAzBA,CAAAA,EAAI,IAAI,CAACnC,gBAAgB,AAAhBA,GAAgBmC,AAAA,KAAA,IAAAA,GAArBA,EAAuBtB,SAAS,CAC5B,IAAI,CAACb,gBAAgB,CAACa,SAAS,CAACT,SAAS,CAG1C,EACR,CAEAgC,YAAYvB,CAAwE,CAAA,CAAA,IAAAwB,EACnF,GAAI,CAAA,CAAA,AAAkC,OAAlCA,CAAAA,EAAC,IAAI,CAACpC,4BAA4B,AAA5BA,GAA4BoC,AAAA,KAAA,IAAAA,GAAjCA,CAAA,CAAoCxB,EAAUI,SAAS,CAAC,AAAD,EAC3D,OAGD,IAAMqB,EAAoC,CACzCzB,UAAW,IAAI,CAACZ,4BAA4B,CAACY,EAAUI,SAAS,CAAC,CACjEsB,SAAU,CACTA,SAAU1B,EAAU2B,QAAQ,CAACC,EAAE,CAC/BC,WAAY7B,EAAU2B,QAAQ,CAAC1B,IAAAA,EAEhC6B,YAAaC,KAAAA,EACbC,UAAWD,KAAAA,EACXE,eAAgB,IAAI,CAAC5C,SAAAA,CAEtB,CAAA,IAAI,CAACF,gBAAgB,CAAGsC,CACzB,CAEAK,aAAW,CACN,IAAI,CAAC3C,gBAAgB,EACxB,CAAA,IAAI,CAACA,gBAAgB,CAAC2C,WAAW,CAAG,IAAII,IAAI,CAE9C,CAEAF,WAAS,CAEJ,IAAI,CAAC7C,gBAAgB,GACxB,IAAI,CAACA,gBAAgB,CAAC6C,SAAS,CAAG,IAAIE,KACtC,IAAI,CAAChD,8BAA8B,CAACiD,OAAO,CAAC,IAAI,CAAChD,gBAAgB,EAEnE"}