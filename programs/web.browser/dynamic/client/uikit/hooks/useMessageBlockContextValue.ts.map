)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/uikit/hooks/useMessageBlockContextValue.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IMessage } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UiKitContext } from '@rocket.chat/fuselage-ui-kit';\nimport type { ContextType } from 'react';\n\nimport {\n\tuseVideoConfDispatchOutgoing,\n\tuseVideoConfIsCalling,\n\tuseVideoConfIsRinging,\n\tuseVideoConfJoinCall,\n\tuseVideoConfManager,\n\tuseVideoConfSetPreferences,\n} from '../../contexts/VideoConfContext';\nimport { useVideoConfWarning } from '../../views/room/contextualBar/VideoConference/hooks/useVideoConfWarning';\nimport { useUiKitActionManager } from './useUiKitActionManager';\n\nexport const useMessageBlockContextValue = (rid: IRoom['_id'], mid: IMessage['_id']): ContextType<typeof UiKitContext> => {\n\tconst joinCall = useVideoConfJoinCall();\n\tconst setPreferences = useVideoConfSetPreferences();\n\tconst isCalling = useVideoConfIsCalling();\n\tconst isRinging = useVideoConfIsRinging();\n\tconst dispatchWarning = useVideoConfWarning();\n\tconst dispatchPopup = useVideoConfDispatchOutgoing();\n\n\tconst videoConfManager = useVideoConfManager();\n\n\tconst handleOpenVideoConf = useMutableCallback(async (rid: IRoom['_id']) => {\n\t\tif (isCalling || isRinging) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait videoConfManager?.loadCapabilities();\n\t\t\tdispatchPopup({ rid });\n\t\t} catch (error: any) {\n\t\t\tdispatchWarning(error.error);\n\t\t}\n\t});\n\n\tconst actionManager = useUiKitActionManager();\n\n\treturn {\n\t\taction: ({ appId, actionId, blockId, value }, event) => {\n\t\t\tif (appId === 'videoconf-core') {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tsetPreferences({ mic: true, cam: false });\n\t\t\t\tif (actionId === 'join') {\n\t\t\t\t\treturn joinCall(blockId);\n\t\t\t\t}\n\n\t\t\t\tif (actionId === 'callBack') {\n\t\t\t\t\treturn handleOpenVideoConf(blockId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tactionManager.emitInteraction(appId, {\n\t\t\t\ttype: 'blockAction',\n\t\t\t\tactionId,\n\t\t\t\tpayload: {\n\t\t\t\t\tblockId,\n\t\t\t\t\tvalue,\n\t\t\t\t},\n\t\t\t\tcontainer: {\n\t\t\t\t\ttype: 'message',\n\t\t\t\t\tid: mid,\n\t\t\t\t},\n\t\t\t\trid,\n\t\t\t\tmid,\n\t\t\t});\n\t\t},\n\t\trid,\n\t\tvalues: {}, // TODO: this is a hack to make the context work, but it should be removed\n\t};\n};\n",null],"names":["useMutableCallback","useVideoConfDispatchOutgoing","useVideoConfIsCalling","useVideoConfIsRinging","useVideoConfJoinCall","useVideoConfManager","useVideoConfSetPreferences","useVideoConfWarning","useUiKitActionManager","module","export","useMessageBlockContextValue","rid","mid","joinCall","setPreferences","isCalling","isRinging","dispatchWarning","dispatchPopup","videoConfManager","handleOpenVideoConf","loadCapabilities","error","actionManager","action","_ref","event","appId","actionId","blockId","value","preventDefault","mic","cam","emitInteraction","type","payload","container","id","values"],"mappings":"2BACiEA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAjEC,EAAOC,MAAE,CAAA,CAAAC,4BAA0B,IAAAA,CAA8B,GAAAF,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAT,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,kCAAAA,CAAAR,6BAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,2BAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,2EAAAA,CAAAF,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAD,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAe1D,IAAMG,EAA8B,CAACC,EAAmBC,KAC9D,IAAMC,EAAWV,IACXW,EAAiBT,IACjBU,EAAYd,IACZe,EAAYd,IACZe,EAAkBX,IAClBY,EAAgBlB,IAEhBmB,EAAmBf,IAEnBgB,EAAsBrB,EAAmB,MAAOY,IACrD,GAAII,CAAAA,IAAaC,EAIjB,GAAI,CACH,MAAMG,CAAAA,MAAAA,EAAgB,KAAA,EAAhBA,EAAkBE,gBAAgB,EAAA,EACxCH,EAAc,CAAEP,IAAAA,CAAG,GAClB,MAAOW,EAAY,CACpBL,EAAgBK,EAAMA,KAAK,EAE7B,GAEMC,EAAgBhB,IAEtB,MAAO,CACNiB,OAAQ,CAAAC,EAAsCC,KAAS,GAA9C,CAAEC,MAAAA,CAAK,CAAEC,SAAAA,CAAQ,CAAEC,QAAAA,CAAO,CAAEC,MAAAA,CAAAA,CAAO,CAAAL,EAC3C,GAAIE,AAAU,mBAAVA,EAA4B,CAG/B,GAFAD,EAAMK,cAAc,GACpBjB,EAAe,CAAEkB,IAAK,CAAA,EAAMC,IAAK,CAAA,CAAK,GAClCL,AAAa,SAAbA,EACH,OAAOf,EAASgB,GAGjB,GAAID,AAAa,aAAbA,EACH,OAAOR,EAAoBS,GAI7BN,EAAcW,eAAe,CAACP,EAAO,CACpCQ,KAAM,cACNP,SAAAA,EACAQ,QAAS,CACRP,QAAAA,EACAC,MAAAA,GAEDO,UAAW,CACVF,KAAM,UACNG,GAAI1B,GAELD,IAAAA,EACAC,IAAAA,GAEF,EACAD,IAAAA,EACA4B,OAAQ,CAAA,EAEV"}