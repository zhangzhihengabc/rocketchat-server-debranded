function module(e,t,n){let i,s,r,a,o,d,l,u,c,y,g,p;n.link("meteor/meteor",{Meteor(e){i=e}},0),n.link("meteor/tracker",{Tracker(e){s=e}},1),n.link("../../app/e2e/client/rocketchat.e2e",{e2e(e){r=e}},2),n.link("../../app/models/client",{Subscriptions(e){a=e},ChatRoom(e){o=e}},3),n.link("../../app/notifications/client",{Notifications(e){d=e}},4),n.link("../../app/settings/client",{settings(e){l=e}},5),n.link("../lib/onClientBeforeSendMessage",{onClientBeforeSendMessage(e){u=e}},6),n.link("../lib/onClientMessageReceived",{onClientMessageReceived(e){c=e}},7),n.link("../lib/utils/isLayoutEmbedded",{isLayoutEmbedded(e){y=e}},8),n.link("../lib/utils/waitUntilFind",{waitUntilFind(e){g=e}},9),n.link("../providers/RouterProvider",{router(e){p=e}},10),i.startup(()=>{let e,t;s.autorun(()=>{if(!i.userId()||!window.crypto)return;let e=l.get("E2E_Enable"),t=y()&&p.getLocationPathname().startsWith("/admin");e&&!t?(r.startClient(),r.enabled.set(!0)):(r.enabled.set(!1),r.closeAlert())});let n=null;s.autorun(()=>{if(!r.isReady()){var i,s,l;null===(i=e)||void 0===i||i(),d.unUser("e2ekeyRequest"),null===(s=n)||void 0===s||s.stop(),null===(l=t)||void 0===l||l();return}d.onUser("e2ekeyRequest",async(e,t)=>{let n=await r.getInstanceByRoomId(e);n&&n.provideKeyToUser(t)}),n=a.find().observe({changed:async e=>{setTimeout(async()=>{if(!e.encrypted&&!e.E2EKey){r.removeInstanceByRoomId(e.rid);return}let t=await r.getInstanceByRoomId(e.rid);if(t){if(e.E2ESuggestedKey&&(await t.importGroupKey(e.E2ESuggestedKey)?r.acceptSuggestedKey(e.rid):(console.warn("Invalid E2ESuggestedKey, rejecting",e.E2ESuggestedKey),r.rejectSuggestedKey(e.rid))),e.encrypted?t.resume():t.pause(),!t.isSupportedRoomType(e.t)){t.disable();return}if(e.E2EKey&&t.isWaitingKeys()){t.keyReceived();return}t.isReady()&&t.decryptSubscription()}},0)},added:async e=>{setTimeout(async()=>{if(e.encrypted||e.E2EKey)return r.getInstanceByRoomId(e.rid)},0)},removed:e=>{r.removeInstanceByRoomId(e.rid)}}),e=c.use(async e=>{let t=await r.getInstanceByRoomId(e.rid);return null!=t&&t.shouldConvertReceivedMessages()?r.decryptMessage(e):e}),t=u.use(async e=>{let t=await r.getInstanceByRoomId(e.rid);if(!t)return e;let n=await g(()=>o.findOne({_id:e.rid}));n.encrypted?t.resume():t.pause();let i=await t.shouldConvertSentMessages(e);if(!i)return e;let s=await t.encrypt(e);return e.msg=s,e.t="e2e",e.e2e="pending",e})})})}
//# sourceMappingURL=/dynamic/client/startup/52067b7405816534b44969dc681a0aa136cbc614.map
