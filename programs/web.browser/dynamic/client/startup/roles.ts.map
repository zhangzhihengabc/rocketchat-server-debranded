)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/startup/roles.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRole } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { Roles } from '../../app/models/client';\nimport { CachedCollectionManager } from '../../app/ui-cached-collection/client';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\n\nMeteor.startup(() => {\n\tCachedCollectionManager.onLogin(async () => {\n\t\tconst { roles } = await sdk.rest.get('/v1/roles.list');\n\t\t// if a role is checked before this collection is populated, it will return undefined\n\t\tRoles._collection._docs._map = new Map(roles.map((record) => [Roles._collection._docs._idStringify(record._id), record]));\n\t\tObject.values(Roles._collection.queries).forEach((query) => Roles._collection._recomputeResults(query));\n\n\t\tRoles.ready.set(true);\n\t});\n\n\ttype ClientAction = 'inserted' | 'updated' | 'removed' | 'changed';\n\n\tconst events: Record<string, ((role: IRole & { type?: ClientAction }) => void) | undefined> = {\n\t\tchanged: (role) => {\n\t\t\tdelete role.type;\n\t\t\tRoles.upsert({ _id: role._id }, role);\n\t\t},\n\t\tremoved: (role) => {\n\t\t\tRoles.remove({ _id: role._id });\n\t\t},\n\t};\n\n\tTracker.autorun((c) => {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tTracker.afterFlush(() => {\n\t\t\tsdk.stream('roles', ['roles'], (role) => {\n\t\t\t\tevents[role.type]?.(role);\n\t\t\t});\n\t\t});\n\n\t\tc.stop();\n\t});\n});\n",null],"names":["Meteor","Tracker","Roles","CachedCollectionManager","sdk","module","link","startup","onLogin","roles","rest","get","_collection","_docs","_map","Map","map","record","_idStringify","_id","Object","values","queries","forEach","query","_recomputeResults","ready","set","events","changed","role","type","upsert","removed","remove","autorun","c","userId","afterFlush","stream","_events$role$type","call","stop"],"mappings":"2BACAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAN,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAJ,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAH,MAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAF,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAD,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAOvCJ,EAAOO,OAAO,CAAC,KACdJ,EAAwBK,OAAO,CAAC,UAC/B,GAAM,CAAEC,MAAAA,CAAAA,CAAO,CAAG,MAAML,EAAIM,IAAI,CAACC,GAAG,CAAC,iBAErCT,CAAAA,EAAMU,WAAW,CAACC,KAAK,CAACC,IAAI,CAAG,IAAIC,IAAIN,EAAMO,GAAG,CAAEC,GAAW,CAACf,EAAMU,WAAW,CAACC,KAAK,CAACK,YAAY,CAACD,EAAOE,GAAG,EAAGF,EAAO,GACvHG,OAAOC,MAAM,CAACnB,EAAMU,WAAW,CAACU,OAAO,EAAEC,OAAO,CAAEC,GAAUtB,EAAMU,WAAW,CAACa,iBAAiB,CAACD,IAEhGtB,EAAMwB,KAAK,CAACC,GAAG,CAAC,CAAA,EACjB,GAIA,IAAMC,EAAwF,CAC7FC,QAAUC,IACT,OAAOA,EAAKC,IAAI,CAChB7B,EAAM8B,MAAM,CAAC,CAAEb,IAAKW,EAAKX,GAAAA,AAAG,EAAIW,EACjC,EACAG,QAAUH,IACT5B,EAAMgC,MAAM,CAAC,CAAEf,IAAKW,EAAKX,GAAAA,AAAG,EAC7B,GAGDlB,EAAQkC,OAAO,CAAEC,IACXpC,EAAOqC,MAAM,KAIlBpC,EAAQqC,UAAU,CAAC,KAClBlC,EAAImC,MAAM,CAAC,QAAS,CAAC,QAAQ,CAAGT,IAAQ,IAAAU,CACvC,AAAiB,QAAjBA,CAAAA,EAAAZ,CAAM,CAACE,EAAKC,IAAI,CAAC,AAAD,GAACS,AAAA,KAAA,IAAAA,GAAjBA,EAAAC,IAAA,CAAAb,EAAoBE,EACrB,EACD,GAEAM,EAAEM,IAAI,GACP,EACD"}