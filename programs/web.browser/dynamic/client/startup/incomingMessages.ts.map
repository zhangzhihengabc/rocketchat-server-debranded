)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/startup/incomingMessages.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\n\nimport { ChatMessage } from '../../app/models/client';\nimport { Notifications } from '../../app/notifications/client';\nimport { CachedCollectionManager } from '../../app/ui-cached-collection/client';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tNotifications.onUser('message', (msg: IMessage) => {\n\t\t\tmsg.u = msg.u || { username: 'rocket.cat' };\n\t\t\tmsg.private = true;\n\n\t\t\treturn ChatMessage.upsert({ _id: msg._id }, msg);\n\t\t});\n\t});\n\n\tCachedCollectionManager.onLogin(() => {\n\t\tNotifications.onUser('subscriptions-changed', (_action, sub) => {\n\t\t\tChatMessage.update(\n\t\t\t\t{\n\t\t\t\t\trid: sub.rid,\n\t\t\t\t\t...('ignored' in sub && sub.ignored ? { 'u._id': { $nin: sub.ignored } } : { ignored: { $exists: true } }),\n\t\t\t\t},\n\t\t\t\t{ $unset: { ignored: true } },\n\t\t\t\t{ multi: true },\n\t\t\t);\n\t\t\tif ('ignored' in sub && sub.ignored) {\n\t\t\t\tChatMessage.update(\n\t\t\t\t\t{ 'rid': sub.rid, 't': { $ne: 'command' }, 'u._id': { $in: sub.ignored } },\n\t\t\t\t\t{ $set: { ignored: true } },\n\t\t\t\t\t{ multi: true },\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t});\n});\n",null],"names":["_objectSpread","Meteor","ChatMessage","Notifications","CachedCollectionManager","module","link","default","startup","Tracker","autorun","userId","onUser","msg","u","username","private","upsert","_id","onLogin","_action","sub","update","rid","ignored","$nin","$exists","$unset","multi","$ne","$in","$set"],"mappings":"2BACAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAtBC,EAAMC,IAAA,CAAA,uCAAgB,CAAAC,QAAAA,CAAAA,EAAAP,EAAAA,CAAA,CAAA,EAAA,GAA9BK,EAAQC,IAAA,CAAM,gBAAgB,CAAAL,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAH,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAF,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAD,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAMvCH,EAAOO,OAAO,CAAC,KACdC,QAAQC,OAAO,CAAC,KACVT,EAAOU,MAAM,IAIlBR,EAAcS,MAAM,CAAC,UAAYC,IAChCA,EAAIC,CAAC,CAAGD,EAAIC,CAAC,EAAI,CAAEC,SAAU,YAAY,EACzCF,EAAIG,OAAO,CAAG,CAAA,EAEPd,EAAYe,MAAM,CAAC,CAAEC,IAAKL,EAAIK,GAAAA,AAAG,EAAIL,IAE9C,GAEAT,EAAwBe,OAAO,CAAC,KAC/BhB,EAAcS,MAAM,CAAC,wBAAyB,CAACQ,EAASC,KACvDnB,EAAYoB,MAAM,CAAAtB,EAAA,CAEhBuB,IAAKF,EAAIE,GAAAA,AAAG,EACR,YAAaF,GAAOA,EAAIG,OAAO,CAAG,CAAE,QAAS,CAAEC,KAAMJ,EAAIG,OAAAA,AAAO,CAAE,EAAK,CAAEA,QAAS,CAAEE,QAAS,CAAA,CAAI,CAAE,GAExG,CAAEC,OAAQ,CAAEH,QAAS,CAAA,CAAI,CAAE,EAC3B,CAAEI,MAAO,CAAA,CAAI,GAEV,YAAaP,GAAOA,EAAIG,OAAO,EAClCtB,EAAYoB,MAAM,CACjB,CAAE,IAAOD,EAAIE,GAAG,CAAE,EAAK,CAAEM,IAAK,SAAS,EAAI,QAAS,CAAEC,IAAKT,EAAIG,OAAAA,AAAO,CAAE,EACxE,CAAEO,KAAM,CAAEP,QAAS,CAAA,CAAI,CAAE,EACzB,CAAEI,MAAO,CAAA,CAAI,EAGhB,EACD,EACD"}