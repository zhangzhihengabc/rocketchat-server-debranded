)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/startup/rootUrlChange.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { hasRole } from '../../app/authorization/client';\nimport { Roles } from '../../app/models/client';\nimport { settings } from '../../app/settings/client';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { t } from '../../app/utils/lib/i18n';\nimport FingerprintChangeModal from '../components/FingerprintChangeModal';\nimport FingerprintChangeModalConfirmation from '../components/FingerprintChangeModalConfirmation';\nimport UrlChangeModal from '../components/UrlChangeModal';\nimport { imperativeModal } from '../lib/imperativeModal';\nimport { dispatchToastMessage } from '../lib/toast';\nimport { isSyncReady } from '../lib/userData';\n\nMeteor.startup(() => {\n\tTracker.autorun((c) => {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Roles.ready.get() || !isSyncReady.get()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hasRole(userId, 'admin') === false) {\n\t\t\treturn c.stop();\n\t\t}\n\n\t\tconst siteUrl = settings.get('Site_Url');\n\t\tif (!siteUrl) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUrl = location.origin + window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t\tif (window.__meteor_runtime_config__.ROOT_URL.replace(/\\/$/, '') !== currentUrl) {\n\t\t\tconst confirm = (): void => {\n\t\t\t\timperativeModal.close();\n\t\t\t\tvoid sdk.call('saveSetting', 'Site_Url', currentUrl).then(() => {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\t\t});\n\t\t\t};\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: UrlChangeModal,\n\t\t\t\tprops: {\n\t\t\t\t\tonConfirm: confirm,\n\t\t\t\t\tsiteUrl,\n\t\t\t\t\tcurrentUrl,\n\t\t\t\t\tonClose: imperativeModal.close,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tconst documentDomain = settings.get('Document_Domain');\n\t\tif (documentDomain) {\n\t\t\twindow.document.domain = documentDomain;\n\t\t}\n\n\t\treturn c.stop();\n\t});\n});\n\nMeteor.startup(() => {\n\tTracker.autorun((c) => {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Roles.ready.get() || !isSyncReady.get()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (hasRole(userId, 'admin') === false) {\n\t\t\treturn c.stop();\n\t\t}\n\n\t\tconst deploymentFingerPrintVerified = settings.get('Deployment_FingerPrint_Verified');\n\t\tif (deploymentFingerPrintVerified == null || deploymentFingerPrintVerified === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst updateWorkspace = (): void => {\n\t\t\timperativeModal.close();\n\t\t\tvoid sdk.rest.post('/v1/fingerprint', { setDeploymentAs: 'updated-configuration' }).then(() => {\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Configuration_update_confirmed') });\n\t\t\t});\n\t\t};\n\n\t\tconst setNewWorkspace = (): void => {\n\t\t\timperativeModal.close();\n\t\t\tvoid sdk.rest.post('/v1/fingerprint', { setDeploymentAs: 'new-workspace' }).then(() => {\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('New_workspace_confirmed') });\n\t\t\t});\n\t\t};\n\n\t\tconst openModal = (): void => {\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: FingerprintChangeModal,\n\t\t\t\tprops: {\n\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\timperativeModal.open({\n\t\t\t\t\t\t\tcomponent: FingerprintChangeModalConfirmation,\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tonConfirm: setNewWorkspace,\n\t\t\t\t\t\t\t\tonCancel: openModal,\n\t\t\t\t\t\t\t\tnewWorkspace: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\timperativeModal.open({\n\t\t\t\t\t\t\tcomponent: FingerprintChangeModalConfirmation,\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tonConfirm: updateWorkspace,\n\t\t\t\t\t\t\t\tonCancel: openModal,\n\t\t\t\t\t\t\t\tnewWorkspace: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonClose: imperativeModal.close,\n\t\t\t\t},\n\t\t\t});\n\t\t};\n\n\t\topenModal();\n\n\t\treturn c.stop();\n\t});\n});\n",null],"names":["Meteor","Tracker","hasRole","Roles","settings","sdk","t","FingerprintChangeModal","FingerprintChangeModalConfirmation","UrlChangeModal","imperativeModal","dispatchToastMessage","isSyncReady","module","link","default","startup","autorun","c","userId","ready","get","stop","siteUrl","currentUrl","location","origin","window","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","ROOT_URL","replace","open","component","props","onConfirm","close","call","then","type","message","onClose","documentDomain","document","domain","deploymentFingerPrintVerified","updateWorkspace","rest","post","setDeploymentAs","setNewWorkspace","openModal","onCancel","newWorkspace"],"mappings":"2BAAAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAd,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAZ,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAX,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAV,MAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAU,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAT,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAR,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAP,EAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAE,QAAAA,CAAAA,EAAAR,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,mDAAAA,CAAAE,QAAAA,CAAAA,EAAAP,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAE,QAAAA,CAAAA,EAAAN,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAH,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAG,EAAAA,IAAAA,CAAAA,eAAAA,CAAAF,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAE,EAAAA,IAAAA,CAAAA,kBAAAA,CAAAD,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAevCZ,EAAOgB,OAAO,CAAC,KACdf,EAAQgB,OAAO,CAAEC,IAChB,IAAMC,EAASnB,EAAOmB,MAAM,GAC5B,GAAI,CAACA,GAID,CAAChB,EAAMiB,KAAK,CAACC,GAAG,IAAM,CAACT,EAAYS,GAAG,GAHzC,OAOD,GAAInB,AAA6B,CAAA,IAA7BA,EAAQiB,EAAQ,SACnB,OAAOD,EAAEI,IAAI,GAGd,IAAMC,EAAUnB,EAASiB,GAAG,CAAC,YAC7B,GAAI,CAACE,EACJ,OAGD,IAAMC,EAAaC,SAASC,MAAM,CAAGC,OAAOC,yBAAyB,CAACC,oBAAoB,CACtFF,OAAOC,yBAAyB,CAACE,QAAQ,CAACC,OAAO,CAAC,MAAO,MAAQP,GAOpEd,EAAgBsB,IAAI,CAAC,CACpBC,UAAWxB,EACXyB,MAAO,CACNC,UATc,KACfzB,EAAgB0B,KAAK,GAChB/B,EAAIgC,IAAI,CAAC,cAAe,WAAYb,GAAYc,IAAI,CAAC,KACzD3B,EAAqB,CAAE4B,KAAM,UAAWC,QAASlC,EAAE,QAAQ,EAC5D,EACD,EAKEiB,QAAAA,EACAC,WAAAA,EACAiB,QAAS/B,EAAgB0B,KAAAA,IAK5B,IAAMM,EAAiBtC,EAASiB,GAAG,CAAC,mBAKpC,OAJIqB,GACHf,CAAAA,OAAOgB,QAAQ,CAACC,MAAM,CAAGF,CAAAA,EAGnBxB,EAAEI,IAAI,EACd,EACD,GAEAtB,EAAOgB,OAAO,CAAC,KACdf,EAAQgB,OAAO,CAAEC,IAChB,IAAMC,EAASnB,EAAOmB,MAAM,GAC5B,GAAI,CAACA,GAID,CAAChB,EAAMiB,KAAK,CAACC,GAAG,IAAM,CAACT,EAAYS,GAAG,GAHzC,OAOD,GAAInB,AAA6B,CAAA,IAA7BA,EAAQiB,EAAQ,SACnB,OAAOD,EAAEI,IAAI,GAGd,IAAMuB,EAAgCzC,EAASiB,GAAG,CAAC,mCACnD,GAAIwB,AAAiC,MAAjCA,GAAyCA,AAAkC,CAAA,IAAlCA,EAC5C,OAGD,IAAMC,EAAkB,KACvBpC,EAAgB0B,KAAK,GAChB/B,EAAI0C,IAAI,CAACC,IAAI,CAAC,kBAAmB,CAAEC,gBAAiB,uBAAuB,GAAIX,IAAI,CAAC,KACxF3B,EAAqB,CAAE4B,KAAM,UAAWC,QAASlC,EAAE,iCAAiC,EACrF,EACD,EAEM4C,EAAkB,KACvBxC,EAAgB0B,KAAK,GAChB/B,EAAI0C,IAAI,CAACC,IAAI,CAAC,kBAAmB,CAAEC,gBAAiB,eAAe,GAAIX,IAAI,CAAC,KAChF3B,EAAqB,CAAE4B,KAAM,UAAWC,QAASlC,EAAE,0BAA0B,EAC9E,EACD,EAEM6C,EAAY,KACjBzC,EAAgBsB,IAAI,CAAC,CACpBC,UAAW1B,EACX2B,MAAO,CACNC,UAAW,KACVzB,EAAgBsB,IAAI,CAAC,CACpBC,UAAWzB,EACX0B,MAAO,CACNC,UAAWe,EACXE,SAAUD,EACVE,aAAc,CAAA,IAGjB,EACAD,SAAU,KACT1C,EAAgBsB,IAAI,CAAC,CACpBC,UAAWzB,EACX0B,MAAO,CACNC,UAAWW,EACXM,SAAUD,EACVE,aAAc,CAAA,IAGjB,EACAZ,QAAS/B,EAAgB0B,KAAAA,GAG5B,EAIA,OAFAe,IAEOjC,EAAEI,IAAI,EACd,EACD"}