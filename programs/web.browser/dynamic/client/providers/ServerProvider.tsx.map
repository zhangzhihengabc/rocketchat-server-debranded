)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/ServerProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { Serialized } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport type { Method, PathFor, OperationParams, OperationResult, UrlParams, PathPattern } from '@rocket.chat/rest-typings';\nimport type {\n\tServerMethodName,\n\tServerMethodParameters,\n\tServerMethodReturn,\n\tStreamerCallbackArgs,\n\tUploadResult,\n\tStreamNames,\n\tStreamKeys,\n} from '@rocket.chat/ui-contexts';\nimport { ServerContext } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport { compile } from 'path-to-regexp';\nimport type { FC } from 'react';\nimport React from 'react';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { Info as info } from '../../app/utils/rocketchat.info';\n\nconst absoluteUrl = (path: string): string => Meteor.absoluteUrl(path);\n\nconst callMethod = <MethodName extends ServerMethodName>(\n\tmethodName: MethodName,\n\t...args: ServerMethodParameters<MethodName>\n): Promise<ServerMethodReturn<MethodName>> => Meteor.callAsync(methodName, ...args);\n\nconst callEndpoint = <TMethod extends Method, TPathPattern extends PathPattern>({\n\tmethod,\n\tpathPattern,\n\tkeys,\n\tparams,\n}: {\n\tmethod: TMethod;\n\tpathPattern: TPathPattern;\n\tkeys: UrlParams<TPathPattern>;\n\tparams: OperationParams<TMethod, TPathPattern>;\n}): Promise<Serialized<OperationResult<TMethod, TPathPattern>>> => {\n\tconst compiledPath = compile(pathPattern, { encode: encodeURIComponent })(keys) as any;\n\n\tswitch (method) {\n\t\tcase 'GET':\n\t\t\treturn sdk.rest.get(compiledPath, params as any) as any;\n\n\t\tcase 'POST':\n\t\t\treturn sdk.rest.post(compiledPath, params as any) as any;\n\n\t\tcase 'PUT':\n\t\t\treturn sdk.rest.put(compiledPath, params as never) as never;\n\n\t\tcase 'DELETE':\n\t\t\treturn sdk.rest.delete(compiledPath, params as any) as any;\n\n\t\tdefault:\n\t\t\tthrow new Error('Invalid HTTP method');\n\t}\n};\n\nconst uploadToEndpoint = (endpoint: PathFor<'POST'>, formData: any): Promise<UploadResult> => sdk.rest.post(endpoint as any, formData);\n\nconst getStream = <N extends StreamNames, K extends StreamKeys<N>>(\n\tstreamName: N,\n\t_options?: {\n\t\tretransmit?: boolean | undefined;\n\t\tretransmitToSelf?: boolean | undefined;\n\t},\n): ((eventName: K, callback: (...args: StreamerCallbackArgs<N, K>) => void) => () => void) => {\n\treturn (eventName, callback): (() => void) => {\n\t\treturn sdk.stream(streamName, [eventName], callback as (...args: any[]) => void).stop;\n\t};\n};\n\nconst ee = new Emitter<Record<string, void>>();\n\nconst events = new Map<string, () => void>();\n\nconst getSingleStream = <N extends StreamNames, K extends StreamKeys<N>>(\n\tstreamName: N,\n\t_options?: {\n\t\tretransmit?: boolean | undefined;\n\t\tretransmitToSelf?: boolean | undefined;\n\t},\n): ((eventName: K, callback: (...args: StreamerCallbackArgs<N, K>) => void) => () => void) => {\n\tconst stream = getStream(streamName);\n\treturn (eventName, callback): (() => void) => {\n\t\tee.on(`${streamName}/${eventName}`, callback);\n\n\t\tconst handler = (...args: any[]): void => {\n\t\t\tee.emit(`${streamName}/${eventName}`, ...args);\n\t\t};\n\n\t\tconst stop = (): void => {\n\t\t\t// If someone is still listening, don't unsubscribe\n\t\t\tee.off(`${streamName}/${eventName}`, callback);\n\n\t\t\tif (ee.has(`${streamName}/${eventName}`)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst unsubscribe = events.get(`${streamName}/${eventName}`);\n\t\t\tif (unsubscribe) {\n\t\t\t\tunsubscribe();\n\t\t\t\tevents.delete(`${streamName}/${eventName}`);\n\t\t\t}\n\t\t};\n\n\t\tif (!events.has(`${streamName}/${eventName}`)) {\n\t\t\tevents.set(`${streamName}/${eventName}`, stream(eventName, handler));\n\t\t}\n\t\treturn stop;\n\t};\n};\n\nconst contextValue = {\n\tinfo,\n\tabsoluteUrl,\n\tcallMethod,\n\tcallEndpoint,\n\tuploadToEndpoint,\n\tgetStream,\n\tgetSingleStream,\n};\n\nconst ServerProvider: FC = ({ children }) => <ServerContext.Provider children={children} value={contextValue} />;\n\nexport default ServerProvider;\n",null],"names":["Emitter","ServerContext","Meteor","compile","React","sdk","info","module","link","default","Info","getStream","streamName","_options","eventName","callback","stream","stop","ee","events","Map","contextValue","absoluteUrl","path","callMethod","methodName","_len","arguments","length","args","Array","_key","callAsync","callEndpoint","_ref","method","pathPattern","keys","params","compiledPath","encode","encodeURIComponent","rest","get","post","put","delete","Error","uploadToEndpoint","endpoint","formData","getSingleStream","on","concat","has","set","_len2","_key2","emit","off","unsubscribe","exportDefault","_ref2","children","createElement","Provider","value"],"mappings":"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"}