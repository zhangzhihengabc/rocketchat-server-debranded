function module(e,a,t){let s,p,l,i,r,n,d,o,u,c,k,v,m,h;t.link("@babel/runtime/helpers/objectSpread2",{default(e){s=e}},0),t.link("@rocket.chat/fuselage-hooks",{useDebouncedCallback(e){p=e}},0),t.link("@rocket.chat/ui-contexts",{usePermission(e){l=e},useSingleStream(e){i=e}},1),t.link("@tanstack/react-query",{useQuery(e){r=e},useQueryClient(e){n=e}},2),t.link("react",{default(e){d=e},useEffect(e){o=e}},3),t.link("../../ee/client/apps/orchestrator",{AppClientOrchestratorInstance(e){u=e}},4),t.link("../contexts/AppsContext",{AppsContext(e){c=e}},5),t.link("../hooks/useIsEnterprise",{useIsEnterprise(e){k=e}},6),t.link("../hooks/useLicense",{useInvalidateLicense(e){v=e}},7),t.link("../lib/asyncState",{AsyncStatePhase(e){m=e}},8),t.link("../views/marketplace/hooks/useAppsCountQuery",{useInvalidateAppsCountQueryCallback(e){h=e}},9);let E=e=>e.sort((e,a)=>e.name.toLowerCase()>a.name.toLowerCase()?1:-1);t.exportDefault(e=>{var a,t,A;let{children:f}=e,b=l("manage-apps"),C=n(),{data:S}=k(),y=!!(null!=S&&S.isEnterprise),I=h(),Q=v(),g=i("apps"),D=p(()=>{C.invalidateQueries(["marketplace","apps-instance"]),I()},100,[]);o(()=>g("apps",e=>{let[a]=e;["app/added","app/removed","app/updated","app/statusUpdate","app/settingUpdated"].includes(a)&&D(),["app/added","app/removed"].includes(a)&&!y&&Q()}),[D,Q,y,g]);let L=r(["marketplace","apps-marketplace",b],()=>{let e=u.getAppsFromMarketplace(b);return C.invalidateQueries(["marketplace","apps-stored"]),e},{staleTime:1/0,keepPreviousData:!0,onSettled:()=>C.invalidateQueries(["marketplace","apps-stored"])}),w=r(["marketplace","apps-instance",b],async()=>{let e=await u.getInstalledApps().then(e=>e.map(e=>s(s({},e),{},{installed:!0})));return e},{staleTime:1/0,onSettled:()=>C.invalidateQueries(["marketplace","apps-stored"])}),x=r(["marketplace","apps-stored",w.data,L.data],()=>{if(!L.isFetched&&!w.isFetched)throw Error("Apps not loaded");let e=[],a=[],t=[],p=[...w.data||[]];return E(L.data||[]).forEach(t=>{let l=p.findIndex(e=>{let{id:a}=e;return a===t.id}),[i]=l>-1?p.splice(l,1):[],r=s(s(s({},t),i&&{private:i.private,installed:!0,status:i.status,version:i.version,licenseValidation:i.licenseValidation,migrated:i.migrated}),{},{bundledIn:t.bundledIn,marketplaceVersion:t.version});i&&a.push(r),e.push(r)}),E(p).forEach(e=>{e.private&&t.push(e)}),[e,a,t]},{enabled:L.isFetched&&w.isFetched,keepPreviousData:!0});return d.createElement(c.Provider,{children:f,value:{installedApps:{phase:m.RESOLVED,value:{apps:(null===(a=x.data)||void 0===a?void 0:a[1])||[]}},marketplaceApps:{phase:m.RESOLVED,value:{apps:(null===(t=x.data)||void 0===t?void 0:t[0])||[]}},privateApps:{phase:m.RESOLVED,value:{apps:(null===(A=x.data)||void 0===A?void 0:A[2])||[]}},reload:async()=>{await Promise.all([C.invalidateQueries(["marketplace"])])}}})})}
//# sourceMappingURL=/dynamic/client/providers/1fba15450a994f15baee4b2813a9760dbdf803ae.map
