function module(e,n,l){let t,o,i,r,a,u,d,s,c,v,C,p,m,g,f,k,E,b,w,h,A,q,N,_,I,M,y,S,R,V,D,O,B,L,P;l.export({CallProvider:()=>T}),l.link("@rocket.chat/core-typings",{VoipClientEvents(e){t=e},isVoipEventAgentCalled(e){o=e},isVoipEventAgentConnected(e){i=e},isVoipEventCallerJoined(e){r=e},isVoipEventQueueMemberAdded(e){a=e},isVoipEventQueueMemberRemoved(e){u=e},isVoipEventCallAbandoned(e){d=e},UserState(e){s=e}},0),l.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){c=e}},1),l.link("@rocket.chat/random",{Random(e){v=e}},2),l.link("@rocket.chat/ui-contexts",{useRouter(e){C=e},useUser(e){p=e},useSetting(e){m=e},useEndpoint(e){g=e},useStream(e){f=e},useSetOutputMediaDevice(e){k=e},useSetInputMediaDevice(e){E=e},useSetModal(e){b=e},useTranslation(e){w=e}},3),l.link("react",{default(e){h=e},useMemo(e){A=e},useRef(e){q=e},useCallback(e){N=e},useEffect(e){_=e},useState(e){I=e}},4),l.link("react-dom",{createPortal(e){M=e}},5),l.link("../../../ee/client/hooks/useVoipClient",{isOutboundClient(e){y=e},useVoipClient(e){S=e}},6),l.link("../../../ee/client/lib/voip/parseOutboundPhoneNumber",{parseOutboundPhoneNumber(e){R=e}},7),l.link("../../../ee/client/voip/components/modals/WrapUpCallModal",{WrapUpCallModal(e){V=e}},8),l.link("../../contexts/CallContext",{CallContext(e){D=e},useIsVoipEnterprise(e){O=e}},9),l.link("../../hooks/useDialModal",{useDialModal(e){B=e}},10),l.link("../../lib/rooms/roomCoordinator",{roomCoordinator(e){L=e}},11),l.link("./hooks/useVoipSounds",{useVoipSounds(e){P=e}},12);let T=e=>{let{children:n}=e,[l,T]=I("unregistered"),U=m("VoIP_Enabled"),x=f("notify-user"),Q=g("POST","/v1/voip/events"),W=g("POST","/v1/livechat/visitor"),F=g("GET","/v1/voip/room"),j=g("POST","/v1/voip/room.close"),H=g("GET","/v1/omnichannel/contact.search"),G=b(),J=w(),z=S(),K=p(),X=C(),Y=k(),Z=E(),$=O(),ee=q(null),[en,el]=I(0),[et,eo]=I(""),[ei,er]=I({v:{},rid:""}),{openDialModal:ea}=B(),eu=P(),ed=N(async function(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ei&&await j({rid:ei.rid,token:ei.v.token||"",options:{comment:null==n?void 0:n.comment,tags:null==n?void 0:n.tags}}),X.navigate("/home");let l=null===(e=z.voipClient)||void 0===e?void 0:e.getAggregator();l&&l.callEnded()},[X,null==z?void 0:z.voipClient,ei,j]),es=N(()=>{G(()=>h.createElement(V,{closeRoom:ed}))},[ed,G]),ec=c(e=>{(null==ee?void 0:ee.current)&&Y({outputDevice:e,HTMLAudioElement:ee.current})}),ev=c(e=>{if(!z.voipClient)return;let n={audio:{deviceId:{exact:e.id}}};z.voipClient.changeAudioInputDevice(n),Z(e)}),[eC,ep]=I(),[em,eg]=I("online");_(()=>{let{voipClient:e}=z||{};if(e)return ep(e.getAggregator()),()=>{if("registered"===l)return e.unregister()}},[z,l]);let ef=N(e=>{L.openRouteLink("v",{rid:e})},[]),ek=N(async e=>{let n=R(e.callerId),{contact:l}=await H({phone:n});if(l)return l;let{visitor:t}=await W({visitor:{token:v.id(),phone:n,name:e.callerName||n}});return t},[H,W]),eE=N(async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inbound";if(!K)return"";try{var l;let t=await ek(e),o=await F({token:t.token,agentId:K._id,direction:n});ef(o.room._id),o.room&&er({v:{token:o.room.v.token},rid:o.room._id});let i=null===(l=z.voipClient)||void 0===l?void 0:l.getAggregator();return i&&i.callStarted(),o.room._id}catch(e){return console.error("Error while creating a visitor ".concat(e)),""}},[ef,z.voipClient,K,F,ek]);_(()=>{if(!U||!K||!eC)return;let e=async e=>{if(o(e)){let{data:n}=e;eC.callRinging({queuename:n.queue,callerid:n.callerId}),eo(eC.getCurrentQueueName());return}if(i(e)){let{data:n}=e;eC.callPickedup({queuename:n.queue,queuedcalls:n.queuedCalls,waittimeinqueue:n.waitTimeInQueue}),eo(eC.getCurrentQueueName()),el(eC.getCallWaitingCount());return}if(r(e)){let{data:n}=e;eC.queueJoined({queuename:n.queue,callerid:n.callerId,queuedcalls:n.queuedCalls}),el(eC.getCallWaitingCount());return}if(a(e)){let{data:n}=e;eC.memberAdded({queuename:n.queue,queuedcalls:n.queuedCalls}),eo(eC.getCurrentQueueName()),el(eC.getCallWaitingCount());return}if(u(e)){let{data:n}=e;eC.memberRemoved({queuename:n.queue,queuedcalls:n.queuedCalls}),el(eC.getCallWaitingCount());return}if(d(e)){let{data:n}=e;eC.queueAbandoned({queuename:n.queue,queuedcallafterabandon:n.queuedCallAfterAbandon}),eo(eC.getCurrentQueueName()),el(eC.getCallWaitingCount());return}console.warn("Unknown event received")};return x("".concat(K._id,"/voip.events"),e)},[x,K,eC,U]),_(()=>{if(U&&K&&eC)return x("".concat(K._id,"/call.hangup"),e=>{if(eo(eC.getCurrentQueueName()),$){es();return}ed(),Q({event:t["VOIP-CALL-ENDED"],rid:e.roomId})})},[es,eC,x,K,U,Q,$,ed]),_(()=>{if(!z.voipClient)return;let e=z.voipClient.on("registered",()=>T("registered")),n=z.voipClient.on("unregistered",()=>T("unregistered"));return()=>{e(),n()}},[z.voipClient]),_(()=>{z.voipClient&&ee.current&&z.voipClient.switchMediaRenderer({remoteMediaElement:ee.current})},[z.voipClient]),_(()=>{if(!z.voipClient||!K)return;let e=async e=>{var n;if(!e.callInfo||(eu.stopAll(),e.userState!==s.UAC))return;let{callInfo:l}=e;ee.current&&(null===(n=z.voipClient)||void 0===n||n.switchMediaRenderer({remoteMediaElement:ee.current}));let o=await eE(l,"outbound");Q({event:t["VOIP-CALL-STARTED"],rid:o})},n=()=>{"offline"===em&&eg("online")},l=()=>{var e,n,l;if("online"===em)switch(eg("offline"),null===(l=z.voipClient)||void 0===l?void 0:l.callerInfo.state){case"IN_CALL":case"ON_HOLD":null===(e=z.voipClient)||void 0===e||e.endCall();break;case"OFFER_RECEIVED":case"ANSWER_SENT":null===(n=z.voipClient)||void 0===n||n.rejectCall()}},o=()=>{eu.play("outbound-call-ringing")},i=()=>{eu.play("telephone")},r=()=>{eu.play("call-ended",!1),eu.stopAll()},a=e=>{switch(e){case"Not Found":ea({errorMessage:J("Dialed_number_doesnt_exist")});break;case"Address Incomplete":ea({errorMessage:J("Dialed_number_is_incomplete")});break;case"Request Terminated":break;default:ea({errorMessage:J("Something_went_wrong_try_again_later")})}};return z.voipClient.onNetworkEvent("connected",n),z.voipClient.onNetworkEvent("disconnected",l),z.voipClient.onNetworkEvent("connectionerror",l),z.voipClient.onNetworkEvent("localnetworkonline",n),z.voipClient.onNetworkEvent("localnetworkoffline",l),z.voipClient.on("callestablished",e),z.voipClient.on("ringing",o),z.voipClient.on("incomingcall",i),z.voipClient.on("callterminated",r),y(z.voipClient)&&z.voipClient.on("callfailed",a),()=>{var t,u,d,s,c,v,C,p,m,g;null===(t=z.voipClient)||void 0===t||t.offNetworkEvent("connected",n),null===(u=z.voipClient)||void 0===u||u.offNetworkEvent("disconnected",l),null===(d=z.voipClient)||void 0===d||d.offNetworkEvent("connectionerror",l),null===(s=z.voipClient)||void 0===s||s.offNetworkEvent("localnetworkonline",n),null===(c=z.voipClient)||void 0===c||c.offNetworkEvent("localnetworkoffline",l),null===(v=z.voipClient)||void 0===v||v.off("incomingcall",i),null===(C=z.voipClient)||void 0===C||C.off("ringing",o),null===(p=z.voipClient)||void 0===p||p.off("callestablished",e),null===(m=z.voipClient)||void 0===m||m.off("callterminated",r),y(z.voipClient)&&(null===(g=z.voipClient)||void 0===g||g.off("callfailed",a))}},[eE,Q,em,ea,z.voipClient,eu,J,K]);let eb=A(()=>{if(!U||!(null!=K&&K.extension))return{enabled:!1,ready:!1,outBoundCallsAllowed:void 0,outBoundCallsEnabled:void 0,outBoundCallsEnabledForUser:void 0};if(z.error)return{enabled:!0,ready:!1,error:z.error,outBoundCallsAllowed:void 0,outBoundCallsEnabled:void 0,outBoundCallsEnabledForUser:void 0};if(!z.voipClient)return{enabled:!0,ready:!1,outBoundCallsAllowed:void 0,outBoundCallsEnabled:void 0,outBoundCallsEnabledForUser:void 0};let{registrationInfo:e,voipClient:n}=z;return{outBoundCallsAllowed:$,outBoundCallsEnabled:$,outBoundCallsEnabledForUser:$&&"registered"===l&&!["IN_CALL","ON_HOLD"].includes(n.callerInfo.state),enabled:!0,ready:!0,openedRoomInfo:ei,voipClient:n,registrationInfo:e,queueCounter:en,queueName:et,actions:{mute:()=>n.muteCall(!0),unmute:()=>n.muteCall(!1),pause:()=>n.holdCall(!0),resume:()=>n.holdCall(!1),end:()=>n.endCall(),pickUp:async()=>ee.current&&n.acceptCall({remoteMediaElement:ee.current}),reject:()=>n.rejectCall()},openRoom:ef,createRoom:eE,closeRoom:ed,networkStatus:em,openWrapUpModal:es,changeAudioOutputDevice:ec,changeAudioInputDevice:ev,register:()=>n.register(),unregister:()=>n.unregister()}},[U,null==K?void 0:K.extension,z,$,l,ei,en,et,ef,eE,ed,es,ec,ev,em]);return h.createElement(D.Provider,{value:eb},n,eb.enabled&&M(h.createElement("audio",{ref:ee}),document.body))}}
//# sourceMappingURL=/dynamic/client/providers/CallProvider/5ee73091d58abf460e626a7316f5808335af123a.map
