)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/EmojiPickerProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useDebouncedState, useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport type { ReactNode, ReactElement, ContextType } from 'react';\nimport React, { useState, useCallback, useMemo, useEffect } from 'react';\n\nimport type { EmojiByCategory } from '../../app/emoji/client';\nimport { emoji, getFrequentEmoji, updateRecent, createEmojiList, createPickerEmojis, CUSTOM_CATEGORY } from '../../app/emoji/client';\nimport { EmojiPickerContext } from '../contexts/EmojiPickerContext';\nimport EmojiPicker from '../views/composer/EmojiPicker/EmojiPicker';\n\nconst DEFAULT_ITEMS_LIMIT = 90;\n\nconst EmojiPickerProvider = ({ children }: { children: ReactNode }): ReactElement => {\n\tconst [emojiPicker, setEmojiPicker] = useState<ReactElement | null>(null);\n\tconst [emojiToPreview, setEmojiToPreview] = useDebouncedState<{ emoji: string; name: string } | null>(null, 100);\n\tconst [recentEmojis, setRecentEmojis] = useLocalStorage<string[]>('emoji.recent', []);\n\tconst [actualTone, setActualTone] = useLocalStorage('emoji.tone', 0);\n\tconst [currentCategory, setCurrentCategory] = useState('recent');\n\tconst [customItemsLimit, setCustomItemsLimit] = useState(DEFAULT_ITEMS_LIMIT);\n\n\tconst [frequentEmojis, setFrequentEmojis] = useLocalStorage<[string, number][]>('emoji.frequent', []);\n\n\tconst [quickReactions, setQuickReactions] = useState<{ emoji: string; image: string }[]>(() =>\n\t\tgetFrequentEmoji(frequentEmojis.map(([emoji]) => emoji)),\n\t);\n\n\tconst addFrequentEmojis = useCallback(\n\t\t(emoji: string) => {\n\t\t\tconst empty: [string, number][] = frequentEmojis.some(([emojiName]) => emojiName === emoji) ? [] : [[emoji, 0]];\n\n\t\t\tconst sortedFrequent = [...empty, ...frequentEmojis]\n\t\t\t\t.map(([emojiName, count]) => {\n\t\t\t\t\treturn (emojiName === emoji ? [emojiName, Math.min(count + 5, 100)] : [emojiName, Math.max(count - 1, 0)]) as [string, number];\n\t\t\t\t})\n\t\t\t\t.sort(([, frequentA], [, frequentB]) => frequentB - frequentA);\n\n\t\t\tsetFrequentEmojis(sortedFrequent);\n\t\t\tsetQuickReactions(getFrequentEmoji(sortedFrequent.map(([emoji]) => emoji)));\n\t\t},\n\t\t[frequentEmojis, setFrequentEmojis],\n\t);\n\n\tconst [getEmojiListsByCategory, setEmojiListsByCategoryGetter] = useState<() => EmojiByCategory[]>(() => () => []);\n\n\t// TODO: improve this update\n\tconst updateEmojiListByCategory = useCallback(\n\t\t(categoryKey: string, limit: number = DEFAULT_ITEMS_LIMIT) => {\n\t\t\tsetEmojiListsByCategoryGetter(\n\t\t\t\t(getEmojiListsByCategory) => () =>\n\t\t\t\t\tgetEmojiListsByCategory().map((category) =>\n\t\t\t\t\t\tcategoryKey === category.key\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t...category,\n\t\t\t\t\t\t\t\t\temojis: {\n\t\t\t\t\t\t\t\t\t\tlist: createEmojiList(category.key, null, recentEmojis, setRecentEmojis),\n\t\t\t\t\t\t\t\t\t\tlimit: category.key === CUSTOM_CATEGORY ? limit | customItemsLimit : null,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: category,\n\t\t\t\t\t),\n\t\t\t);\n\t\t},\n\t\t[customItemsLimit, recentEmojis, setRecentEmojis],\n\t);\n\n\tuseEffect(() => {\n\t\tif (recentEmojis?.length > 0) {\n\t\t\tupdateRecent(recentEmojis);\n\t\t}\n\n\t\tsetEmojiListsByCategoryGetter(() => () => createPickerEmojis(customItemsLimit, actualTone, recentEmojis, setRecentEmojis));\n\t}, [actualTone, recentEmojis, customItemsLimit, currentCategory, setRecentEmojis, frequentEmojis]);\n\n\tconst addRecentEmoji = useCallback(\n\t\t(_emoji: string) => {\n\t\t\taddFrequentEmojis(_emoji);\n\n\t\t\tconst recent = recentEmojis || [];\n\t\t\tconst pos = recent.indexOf(_emoji as never);\n\n\t\t\tif (pos !== -1) {\n\t\t\t\trecent.splice(pos, 1);\n\t\t\t}\n\n\t\t\trecent.unshift(_emoji);\n\n\t\t\t// limit recent emojis to 27 (3 rows of 9)\n\t\t\trecent.splice(27);\n\n\t\t\tsetRecentEmojis(recent);\n\t\t\temoji.packages.base.emojisByCategory.recent = recent;\n\t\t\tupdateEmojiListByCategory('recent');\n\t\t},\n\t\t[recentEmojis, setRecentEmojis, updateEmojiListByCategory, addFrequentEmojis],\n\t);\n\n\tconst open = useCallback((ref: Element, callback: (emoji: string) => void) => {\n\t\treturn setEmojiPicker(<EmojiPicker reference={ref} onClose={() => setEmojiPicker(null)} onPickEmoji={(emoji) => callback(emoji)} />);\n\t}, []);\n\n\tconst handlePreview = useCallback((emoji: string, name: string) => setEmojiToPreview({ emoji, name }), [setEmojiToPreview]);\n\n\tconst handleRemovePreview = useCallback(() => setEmojiToPreview(null), [setEmojiToPreview]);\n\n\tconst contextValue = useMemo(\n\t\t(): ContextType<typeof EmojiPickerContext> => ({\n\t\t\tisOpen: emojiPicker !== null,\n\t\t\tclose: () => setEmojiPicker(null),\n\t\t\topen,\n\t\t\temojiToPreview,\n\t\t\thandlePreview,\n\t\t\thandleRemovePreview,\n\t\t\taddRecentEmoji,\n\t\t\tgetEmojiListsByCategory,\n\t\t\trecentEmojis,\n\t\t\tsetRecentEmojis,\n\t\t\tactualTone,\n\t\t\tcurrentCategory,\n\t\t\tsetCurrentCategory,\n\t\t\tcustomItemsLimit,\n\t\t\tsetCustomItemsLimit,\n\t\t\tsetActualTone,\n\t\t\tquickReactions,\n\t\t}),\n\t\t[\n\t\t\temojiPicker,\n\t\t\topen,\n\t\t\temojiToPreview,\n\t\t\taddRecentEmoji,\n\t\t\tgetEmojiListsByCategory,\n\t\t\trecentEmojis,\n\t\t\tsetRecentEmojis,\n\t\t\tactualTone,\n\t\t\tcurrentCategory,\n\t\t\tsetCurrentCategory,\n\t\t\tcustomItemsLimit,\n\t\t\tsetActualTone,\n\t\t\tquickReactions,\n\t\t\thandlePreview,\n\t\t\thandleRemovePreview,\n\t\t],\n\t);\n\n\treturn (\n\t\t<EmojiPickerContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t{emojiPicker}\n\t\t</EmojiPickerContext.Provider>\n\t);\n};\n\nexport default EmojiPickerProvider;\n",null],"names":["_objectSpread","useDebouncedState","useLocalStorage","React","useState","useCallback","useMemo","useEffect","emoji","getFrequentEmoji","updateRecent","createEmojiList","createPickerEmojis","CUSTOM_CATEGORY","EmojiPickerContext","EmojiPicker","module","default","link","exportDefault","_ref","children","emojiPicker","setEmojiPicker","emojiToPreview","setEmojiToPreview","recentEmojis","setRecentEmojis","actualTone","setActualTone","currentCategory","setCurrentCategory","customItemsLimit","setCustomItemsLimit","frequentEmojis","setFrequentEmojis","quickReactions","setQuickReactions","map","_ref2","addFrequentEmojis","empty","some","_ref3","emojiName","sortedFrequent","_ref4","count","Math","min","max","sort","_ref5","_ref6","frequentA","frequentB","_ref7","getEmojiListsByCategory","setEmojiListsByCategoryGetter","updateEmojiListByCategory","categoryKey","limit","category","key","emojis","list","length","addRecentEmoji","_emoji","recent","pos","indexOf","splice","unshift","packages","base","emojisByCategory","open","ref","callback","createElement","reference","onClose","onPickEmoji","handlePreview","name","handleRemovePreview","contextValue","isOpen","close","Provider","value"],"mappings":"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"}