)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/TooltipProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useDebouncedState, useMediaQuery } from '@rocket.chat/fuselage-hooks';\nimport { TooltipComponent } from '@rocket.chat/ui-client';\nimport { TooltipContext } from '@rocket.chat/ui-contexts';\nimport type { FC, ReactNode } from 'react';\nimport React, { useEffect, useMemo, useRef, memo, useCallback, useState } from 'react';\n\nimport TooltipPortal from '../components/TooltipPortal';\n\nconst TooltipProvider: FC = ({ children }) => {\n\tconst lastAnchor = useRef<HTMLElement>();\n\tconst hasHover = !useMediaQuery('(hover: none)');\n\n\tconst [tooltip, setTooltip] = useDebouncedState<ReactNode>(null, 300);\n\n\tconst restoreTitle = useCallback((previousAnchor: HTMLElement | undefined): void => {\n\t\tsetTimeout(() => {\n\t\t\tif (previousAnchor && !previousAnchor.getAttribute('title')) {\n\t\t\t\tpreviousAnchor.setAttribute('title', previousAnchor.getAttribute('data-title') ?? '');\n\t\t\t\tpreviousAnchor.removeAttribute('data-title');\n\t\t\t}\n\t\t}, 0);\n\t}, []);\n\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\topen: (tooltip: ReactNode, anchor: HTMLElement): void => {\n\t\t\t\tconst previousAnchor = lastAnchor.current;\n\t\t\t\tsetTooltip(<TooltipComponent key={new Date().toISOString()} title={tooltip} anchor={anchor} />);\n\t\t\t\tlastAnchor.current = anchor;\n\t\t\t\tpreviousAnchor && restoreTitle(previousAnchor);\n\t\t\t},\n\t\t\tclose: (): void => {\n\t\t\t\tconst previousAnchor = lastAnchor.current;\n\t\t\t\tsetTooltip(null);\n\t\t\t\tsetTooltip.flush();\n\t\t\t\tlastAnchor.current = undefined;\n\t\t\t\tpreviousAnchor && restoreTitle(previousAnchor);\n\t\t\t},\n\t\t\tdismiss: (): void => {\n\t\t\t\tsetTooltip(null);\n\t\t\t\tsetTooltip.flush();\n\t\t\t},\n\t\t}),\n\t\t[setTooltip, restoreTitle],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!hasHover) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleMouseOver = (e: MouseEvent): void => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (lastAnchor.current === target) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst anchor = target.closest('[title], [data-tooltip]') as HTMLElement;\n\n\t\t\tif (lastAnchor.current === anchor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!anchor) {\n\t\t\t\tcontextValue.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst title = anchor.getAttribute('title') ?? anchor.getAttribute('data-tooltip') ?? '';\n\t\t\tif (!title) {\n\t\t\t\tcontextValue.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line react/no-multi-comp\n\t\t\tconst Handler = () => {\n\t\t\t\tconst [state, setState] = useState(title);\n\t\t\t\tuseEffect(() => {\n\t\t\t\t\tconst close = (): void => contextValue.close();\n\t\t\t\t\t// store the title in a data attribute\n\t\t\t\t\tanchor.setAttribute('data-title', title);\n\t\t\t\t\t// Removes the title attribute to prevent the browser's tooltip from showing\n\t\t\t\t\tanchor.setAttribute('title', '');\n\n\t\t\t\t\tanchor.addEventListener('mouseleave', close);\n\n\t\t\t\t\tconst observer = new MutationObserver(() => {\n\t\t\t\t\t\tconst title = anchor.getAttribute('title') ?? anchor.getAttribute('data-tooltip') ?? '';\n\n\t\t\t\t\t\tif (title === '') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// store the title in a data attribute\n\t\t\t\t\t\tanchor.setAttribute('data-title', title);\n\t\t\t\t\t\t// Removes the title attribute to prevent the browser's tooltip from showing\n\t\t\t\t\t\tanchor.setAttribute('title', '');\n\n\t\t\t\t\t\tsetState(title);\n\t\t\t\t\t});\n\n\t\t\t\t\tobserver.observe(anchor, {\n\t\t\t\t\t\tattributes: true,\n\t\t\t\t\t\tattributeFilter: ['title', 'data-tooltip'],\n\t\t\t\t\t});\n\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tanchor.removeEventListener('mouseleave', close);\n\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t};\n\t\t\t\t}, []);\n\t\t\t\treturn <>{state}</>;\n\t\t\t};\n\t\t\tcontextValue.open(<Handler />, anchor);\n\t\t};\n\n\t\tconst dismissOnClick = (): void => {\n\t\t\tcontextValue.dismiss();\n\t\t};\n\n\t\tdocument.body.addEventListener('mouseover', handleMouseOver, {\n\t\t\tpassive: true,\n\t\t});\n\t\tdocument.body.addEventListener('click', dismissOnClick, { capture: true });\n\n\t\treturn (): void => {\n\t\t\tcontextValue.close();\n\t\t\tdocument.body.removeEventListener('mouseover', handleMouseOver);\n\t\t\tdocument.body.removeEventListener('click', dismissOnClick);\n\t\t};\n\t}, [contextValue, setTooltip, hasHover]);\n\n\treturn (\n\t\t<TooltipContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t{tooltip && <TooltipPortal>{tooltip}</TooltipPortal>}\n\t\t</TooltipContext.Provider>\n\t);\n};\n\nexport default memo<typeof TooltipProvider>(TooltipProvider);\n",null],"names":["useDebouncedState","useMediaQuery","TooltipComponent","TooltipContext","React","useEffect","useMemo","useRef","memo","useCallback","useState","TooltipPortal","module","link","default","exportDefault","_ref","children","lastAnchor","hasHover","tooltip","setTooltip","restoreTitle","previousAnchor","setTimeout","getAttribute","_previousAnchor$getAt","setAttribute","removeAttribute","contextValue","open","anchor","current","createElement","key","Date","toISOString","title","close","flush","undefined","dismiss","handleMouseOver","e","_ref2","_anchor$getAttribute","target","closest","state","setState","addEventListener","observer","MutationObserver","_ref3","_anchor$getAttribute2","observe","attributes","attributeFilter","removeEventListener","disconnect","Fragment","dismissOnClick","document","body","passive","capture","Provider","value"],"mappings":"2BAAAA,EAASC,EAAsEC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAnDC,EAAeC,IAAAA,CAAAA,8BAAmC,CAACb,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAV,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAU,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAT,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAV,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,KAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAE,QAAAA,CAAAA,EAAAH,EAAAA,CAAA,CAAA,EAAA,GAA/EC,EAAOG,aAAE,CA4IMP,EApIaQ,IAAiB,GAAhB,CAAEC,SAAAA,CAAAA,CAAU,CAAAD,EAClCE,EAAaX,IACbY,EAAW,CAAClB,EAAc,iBAE1B,CAACmB,EAASC,EAAW,CAAGrB,EAA6B,KAAM,KAE3DsB,EAAeb,EAAac,IACjCC,WAAW,KACV,GAAID,GAAkB,CAACA,EAAeE,YAAY,CAAC,SAAU,CAAA,IAAAC,EAC5DH,EAAeI,YAAY,CAAC,QAAO,AAA2C,OAA3CD,CAAAA,EAAEH,EAAeE,YAAY,CAAC,aAAY,GAACC,AAAA,KAAA,IAAAA,EAAAA,EAAI,IAClFH,EAAeK,eAAe,CAAC,cAEjC,EAAG,EACJ,EAAG,EAAE,EAECC,EAAevB,EACpB,IAAO,CAAA,CACNwB,KAAM,CAACV,EAAoBW,KAC1B,IAAMR,EAAiBL,EAAWc,OAAO,CACzCX,EAAWjB,EAAA6B,aAAA,CAAC/B,EAAgB,CAACgC,IAAK,IAAIC,OAAOC,WAAW,GAAIC,MAAOjB,EAASW,OAAQA,CAAO,IAC3Fb,EAAWc,OAAO,CAAGD,EACrBR,GAAkBD,EAAaC,EAChC,EACAe,MAAO,KACN,IAAMf,EAAiBL,EAAWc,OAAO,CACzCX,EAAW,MACXA,EAAWkB,KAAK,GAChBrB,EAAWc,OAAO,CAAGQ,KAAAA,EACrBjB,GAAkBD,EAAaC,EAChC,EACAkB,QAAS,KACRpB,EAAW,MACXA,EAAWkB,KAAK,EACjB,IAED,CAAClB,EAAYC,EAAa,EAyF3B,OAtFAjB,EAAU,KACT,GAAI,CAACc,EACJ,OAGD,IAAMuB,EAAmBC,IAAuB,IAAAC,EAAAC,EAC/C,IAAMC,EAASH,EAAEG,MAAqB,CACtC,GAAI5B,EAAWc,OAAO,GAAKc,EAC1B,OAGD,IAAMf,EAASe,EAAOC,OAAO,CAAC,2BAE9B,GAAI7B,EAAWc,OAAO,GAAKD,EAC1B,OAGD,GAAI,CAACA,EAAQ,CACZF,EAAaS,KAAK,GAClB,OAGD,IAAMD,EAAK,AAAsE,OAAtEO,CAAAA,EAAA,AAA+B,OAA/BC,CAAAA,EAAGd,EAAON,YAAY,CAAC,QAAO,GAACoB,AAAA,KAAA,IAAAA,EAAAA,EAAId,EAAON,YAAY,CAAC,eAAc,GAACmB,AAAA,KAAA,IAAAA,EAAAA,EAAI,GACrF,GAAI,CAACP,EAAO,CACXR,EAAaS,KAAK,GAClB,OA0CDT,EAAaC,IAAI,CAAC1B,EAAA6B,aAAA,CAtCF,KACf,GAAM,CAACe,EAAOC,EAAS,CAAGvC,EAAS2B,GAmCnC,OAlCAhC,EAAU,KACT,IAAMiC,EAAQ,IAAYT,EAAaS,KAAK,GAE5CP,EAAOJ,YAAY,CAAC,aAAcU,GAElCN,EAAOJ,YAAY,CAAC,QAAS,IAE7BI,EAAOmB,gBAAgB,CAAC,aAAcZ,GAEtC,IAAMa,EAAW,IAAIC,iBAAiB,KAAK,IAAAC,EAAAC,EAC1C,IAAMjB,EAAK,AAAsE,OAAtEgB,CAAAA,EAAA,AAA+B,OAA/BC,CAAAA,EAAGvB,EAAON,YAAY,CAAC,QAAO,GAAC6B,AAAA,KAAA,IAAAA,EAAAA,EAAIvB,EAAON,YAAY,CAAC,eAAc,GAAC4B,AAAA,KAAA,IAAAA,EAAAA,EAAI,EAEvE,CAAA,KAAVhB,IAKJN,EAAOJ,YAAY,CAAC,aAAcU,GAElCN,EAAOJ,YAAY,CAAC,QAAS,IAE7BsB,EAASZ,GACV,GAOA,OALAc,EAASI,OAAO,CAACxB,EAAQ,CACxByB,WAAY,CAAA,EACZC,gBAAiB,CAAC,QAAS,eAAc,GAGnC,KACN1B,EAAO2B,mBAAmB,CAAC,aAAcpB,GACzCa,EAASQ,UAAU,EACpB,CACD,EAAG,EAAE,EACEvD,EAAA6B,aAAA,CAAA7B,EAAAwD,QAAA,CAAA,KAAGZ,EACX,EAC0B,MAAKjB,EAChC,EAEM8B,EAAiB,KACtBhC,EAAaY,OAAO,EACrB,EAOA,OALAqB,SAASC,IAAI,CAACb,gBAAgB,CAAC,YAAaR,EAAiB,CAC5DsB,QAAS,CAAA,IAEVF,SAASC,IAAI,CAACb,gBAAgB,CAAC,QAASW,EAAgB,CAAEI,QAAS,CAAA,CAAI,GAEhE,KACNpC,EAAaS,KAAK,GAClBwB,SAASC,IAAI,CAACL,mBAAmB,CAAC,YAAahB,GAC/CoB,SAASC,IAAI,CAACL,mBAAmB,CAAC,QAASG,EAC5C,CACD,EAAG,CAAChC,EAAcR,EAAYF,EAAS,EAGtCf,EAAA6B,aAAA,CAAC9B,EAAe+D,QAAQ,CAAA,CAACC,MAAOtC,CAAa,EAC3CZ,EACAG,GAAWhB,EAAA6B,aAAA,CAACtB,EAAa,KAAES,GAG/B"}