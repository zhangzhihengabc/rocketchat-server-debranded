)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/AuthorizationProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRole } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { AuthorizationContext } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport type { FC } from 'react';\nimport React, { useCallback, useEffect } from 'react';\n\nimport { hasPermission, hasAtLeastOnePermission, hasAllPermission, hasRole } from '../../app/authorization/client';\nimport { Roles } from '../../app/models/client/models/Roles';\nimport { useReactiveValue } from '../hooks/useReactiveValue';\nimport { createReactiveSubscriptionFactory } from '../lib/createReactiveSubscriptionFactory';\n\nclass RoleStore extends Emitter<{\n\tchange: { [_id: string]: IRole };\n}> {\n\troles: { [_id: string]: IRole } = {};\n}\n\nconst contextValue = {\n\tqueryPermission: createReactiveSubscriptionFactory((permission, scope, scopeRoles) => hasPermission(permission, scope, scopeRoles)),\n\tqueryAtLeastOnePermission: createReactiveSubscriptionFactory((permissions, scope) => hasAtLeastOnePermission(permissions, scope)),\n\tqueryAllPermissions: createReactiveSubscriptionFactory((permissions, scope) => hasAllPermission(permissions, scope)),\n\tqueryRole: createReactiveSubscriptionFactory(\n\t\t(role, scope?, ignoreSubscriptions = false) =>\n\t\t\t!!Meteor.userId() && hasRole(Meteor.userId() as string, role, scope, ignoreSubscriptions),\n\t),\n\troleStore: new RoleStore(),\n};\n\nconst AuthorizationProvider: FC = ({ children }) => {\n\tconst roles = useReactiveValue(\n\t\tuseCallback(\n\t\t\t() =>\n\t\t\t\tRoles.find()\n\t\t\t\t\t.fetch()\n\t\t\t\t\t.reduce((ret, obj) => {\n\t\t\t\t\t\tret[obj._id] = obj;\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}, {} as Record<string, IRole>),\n\t\t\t[],\n\t\t),\n\t);\n\n\tuseEffect(() => {\n\t\tcontextValue.roleStore.roles = roles;\n\t\tcontextValue.roleStore.emit('change', roles);\n\t}, [roles]);\n\n\treturn <AuthorizationContext.Provider children={children} value={contextValue} />;\n};\n\nexport default AuthorizationProvider;\n",null],"names":["Emitter","AuthorizationContext","Meteor","React","useCallback","useEffect","hasPermission","hasAtLeastOnePermission","hasAllPermission","hasRole","Roles","useReactiveValue","createReactiveSubscriptionFactory","module","link","default","contextValue","queryPermission","permission","scope","scopeRoles","queryAtLeastOnePermission","permissions","queryAllPermissions","queryRole","role","ignoreSubscriptions","arguments","length","undefined","userId","roleStore","RoleStore","constructor","roles","exportDefault","_ref","children","find","fetch","reduce","ret","obj","_id","emit","createElement","Provider","value"],"mappings":"2BACAA,EAA+CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAtCC,EAASC,IAAA,CAAM,uBAAuB,CAAAd,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAZ,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAX,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAZ,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAP,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAH,MAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAF,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,2CAAAA,CAAAD,kCAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAiB/C,IAAMI,EAAe,CACpBC,gBAAiBL,EAAkC,CAACM,EAAYC,EAAOC,IAAed,EAAcY,EAAYC,EAAOC,IACvHC,0BAA2BT,EAAkC,CAACU,EAAaH,IAAUZ,EAAwBe,EAAaH,IAC1HI,oBAAqBX,EAAkC,CAACU,EAAaH,IAAUX,EAAiBc,EAAaH,IAC7GK,UAAWZ,EACV,SAACa,CAAI,CAAEN,CAAM,EAAA,IAAEO,EAAmBC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,EAAAA,SAAA,CAAA,EAAA,CAAQ,MACzC,CAAC,CAACzB,EAAO4B,MAAM,IAAMrB,EAAQP,EAAO4B,MAAM,GAAcL,EAAMN,EAAOO,EAAoB,GAE3FK,UAAW,IAdZ,MAAMC,UAAkBhC,EAEtBiC,aAAA,CAAA,KAAA,IAAAN,WAAA,IAAA,CACDO,KAAK,CAA6B,CAAA,CAAE,IAdrCrB,EAAOsB,aAAW,CA4BgBC,IAAiB,GAAhB,CAAEC,SAAAA,CAAAA,CAAU,CAAAD,EACxCF,EAAQvB,EACbP,EACC,IACCM,EAAM4B,IAAI,GACRC,KAAK,GACLC,MAAM,CAAC,CAACC,EAAKC,KACbD,CAAG,CAACC,EAAIC,GAAG,CAAC,CAAGD,EACRD,GACL,CAAA,GACL,EAAE,GASJ,OALApC,EAAU,KACTW,EAAae,SAAS,CAACG,KAAK,CAAGA,EAC/BlB,EAAae,SAAS,CAACa,IAAI,CAAC,SAAUV,EACvC,EAAG,CAACA,EAAM,EAEH/B,EAAA0C,aAAA,CAAC5C,EAAqB6C,QAAQ,CAAA,CAACT,SAAUA,EAAUU,MAAO/B,CAAa,EAC/E"}