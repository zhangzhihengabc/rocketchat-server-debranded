)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/DeviceProvider/DeviceProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { Device, IExperimentalHTMLAudioElement, DeviceContextValue } from '@rocket.chat/ui-contexts';\nimport { DeviceContext } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ReactNode } from 'react';\nimport React, { useEffect, useState, useMemo } from 'react';\n\nimport { isSetSinkIdAvailable } from './lib/isSetSinkIdAvailable';\n\ntype DeviceProviderProps = {\n\tchildren?: ReactNode | undefined;\n};\n\nexport const DeviceProvider = ({ children }: DeviceProviderProps): ReactElement => {\n\tconst [enabled] = useState(typeof isSecureContext && isSecureContext);\n\tconst [availableAudioOutputDevices, setAvailableAudioOutputDevices] = useState<Device[]>([]);\n\tconst [availableAudioInputDevices, setAvailableAudioInputDevices] = useState<Device[]>([]);\n\tconst [selectedAudioOutputDevice, setSelectedAudioOutputDevice] = useState<Device>({\n\t\tid: 'default',\n\t\tlabel: '',\n\t\ttype: 'audio',\n\t});\n\tconst [selectedAudioInputDevice, setSelectedAudioInputDevice] = useState<Device>({\n\t\tid: 'default',\n\t\tlabel: '',\n\t\ttype: 'audio',\n\t});\n\n\tconst setAudioInputDevice = (device: Device): void => {\n\t\tif (!isSecureContext) {\n\t\t\tthrow new Error('Device Changes are not available on insecure contexts');\n\t\t}\n\t\tsetSelectedAudioInputDevice(device);\n\t};\n\n\tconst setAudioOutputDevice = useMutableCallback(\n\t\t({ outputDevice, HTMLAudioElement }: { outputDevice: Device; HTMLAudioElement: IExperimentalHTMLAudioElement }): void => {\n\t\t\tif (!isSetSinkIdAvailable()) {\n\t\t\t\tthrow new Error('setSinkId is not available in this browser');\n\t\t\t}\n\t\t\tif (!enabled) {\n\t\t\t\tthrow new Error('Device Changes are not available on insecure contexts');\n\t\t\t}\n\t\t\tsetSelectedAudioOutputDevice(outputDevice);\n\t\t\tHTMLAudioElement.setSinkId(outputDevice.id);\n\t\t},\n\t);\n\n\tuseEffect(() => {\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\t\tconst setMediaDevices = (): void => {\n\t\t\tnavigator.mediaDevices?.enumerateDevices().then((devices) => {\n\t\t\t\tconst audioInput: Device[] = [];\n\t\t\t\tconst audioOutput: Device[] = [];\n\t\t\t\tdevices.forEach((device) => {\n\t\t\t\t\tconst mediaDevice: Device = {\n\t\t\t\t\t\tid: device.deviceId,\n\t\t\t\t\t\tlabel: device.label,\n\t\t\t\t\t\ttype: device.kind,\n\t\t\t\t\t};\n\t\t\t\t\tif (device.kind === 'audioinput') {\n\t\t\t\t\t\taudioInput.push(mediaDevice);\n\t\t\t\t\t} else if (device.kind === 'audiooutput') {\n\t\t\t\t\t\taudioOutput.push(mediaDevice);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetAvailableAudioOutputDevices(audioOutput);\n\t\t\t\tsetAvailableAudioInputDevices(audioInput);\n\t\t\t});\n\t\t};\n\n\t\tnavigator.mediaDevices?.addEventListener('devicechange', setMediaDevices);\n\t\tsetMediaDevices();\n\n\t\treturn (): void => {\n\t\t\tnavigator.mediaDevices?.removeEventListener('devicechange', setMediaDevices);\n\t\t};\n\t}, [enabled]);\n\n\tconst contextValue = useMemo((): DeviceContextValue => {\n\t\tif (!enabled) {\n\t\t\treturn {\n\t\t\t\tenabled,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tenabled,\n\t\t\tavailableAudioOutputDevices,\n\t\t\tavailableAudioInputDevices,\n\t\t\tselectedAudioOutputDevice,\n\t\t\tselectedAudioInputDevice,\n\t\t\tsetAudioOutputDevice,\n\t\t\tsetAudioInputDevice,\n\t\t};\n\t}, [\n\t\tavailableAudioInputDevices,\n\t\tavailableAudioOutputDevices,\n\t\tenabled,\n\t\tselectedAudioInputDevice,\n\t\tselectedAudioOutputDevice,\n\t\tsetAudioOutputDevice,\n\t]);\n\treturn <DeviceContext.Provider value={contextValue}>{children}</DeviceContext.Provider>;\n};\n",null],"names":["useMutableCallback","DeviceContext","React","useEffect","useState","useMemo","isSetSinkIdAvailable","module","export","DeviceProvider","default","_ref","children","enabled","isSecureContext","availableAudioOutputDevices","setAvailableAudioOutputDevices","availableAudioInputDevices","setAvailableAudioInputDevices","selectedAudioOutputDevice","setSelectedAudioOutputDevice","id","label","type","selectedAudioInputDevice","setSelectedAudioInputDevice","setAudioInputDevice","device","Error","setAudioOutputDevice","_ref2","outputDevice","HTMLAudioElement","setSinkId","_navigator$mediaDevic2","setMediaDevices","_navigator$mediaDevic","navigator","mediaDevices","enumerateDevices","then","devices","audioInput","audioOutput","forEach","mediaDevice","deviceId","kind","push","addEventListener","_navigator$mediaDevic3","removeEventListener","contextValue","createElement","Provider","value"],"mappings":"2BAAmCA,EAA8BC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAjEC,EAAOC,MAAE,CAAA,CAAAC,eAAoB,IAAAA,CAAM,GAA8BF,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAP,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAN,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,QAAAA,CAAAG,QAAAA,CAAAA,EAAAR,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAD,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAY1D,IAAMG,EAAiBE,IAAoD,GAAnD,CAAEC,SAAAA,CAAAA,CAA+B,CAAAD,EACzD,CAACE,EAAQ,CAAGT,EAAS,OAAOU,iBAAmBA,iBAC/C,CAACC,EAA6BC,EAA+B,CAAGZ,EAAmB,EAAE,EACrF,CAACa,EAA4BC,EAA8B,CAAGd,EAAmB,EAAE,EACnF,CAACe,EAA2BC,EAA6B,CAAGhB,EAAiB,CAClFiB,GAAI,UACJC,MAAO,GACPC,KAAM,UAED,CAACC,EAA0BC,EAA4B,CAAGrB,EAAiB,CAChFiB,GAAI,UACJC,MAAO,GACPC,KAAM,UAGDG,EAAuBC,IAC5B,GAAI,CAACb,gBACJ,MAAM,AAAIc,MAAM,yDAEjBH,EAA4BE,EAC7B,EAEME,EAAuB7B,EAC5B8B,IAAwH,GAAvH,CAAEC,aAAAA,CAAY,CAAEC,iBAAAA,CAAAA,CAA6F,CAAAF,EAC7G,GAAI,CAACxB,IACJ,MAAM,AAAIsB,MAAM,8CAEjB,GAAI,CAACf,EACJ,MAAM,AAAIe,MAAM,yDAEjBR,EAA6BW,GAC7BC,EAAiBC,SAAS,CAACF,EAAaV,EAAE,CAC3C,GAGDlB,EAAU,KAAK,IAAA+B,EACd,GAAI,CAACrB,EACJ,OAED,IAAMsB,EAAkB,KAAW,IAAAC,CAClC,AAAsB,QAAtBA,CAAAA,EAAAC,UAAUC,YAAY,AAAZA,GAAYF,AAAA,KAAA,IAAAA,GAAtBA,EAAwBG,gBAAgB,GAAGC,IAAI,CAAEC,IAChD,IAAMC,EAAuB,EAAE,CACzBC,EAAwB,EAAE,CAChCF,EAAQG,OAAO,CAAEjB,IAChB,IAAMkB,EAAsB,CAC3BxB,GAAIM,EAAOmB,QAAQ,CACnBxB,MAAOK,EAAOL,KAAK,CACnBC,KAAMI,EAAOoB,IAAAA,CAEVpB,AAAgB,CAAA,eAAhBA,EAAOoB,IAAI,CACdL,EAAWM,IAAI,CAACH,GACU,gBAAhBlB,EAAOoB,IAAI,EACrBJ,EAAYK,IAAI,CAACH,EAEnB,GACA7B,EAA+B2B,GAC/BzB,EAA8BwB,EAC/B,EACD,EAKA,OAHA,AAAsB,OAAtBR,CAAAA,EAAAG,UAAUC,YAAY,AAAZA,GAAYJ,AAAA,KAAA,IAAAA,GAAtBA,EAAwBe,gBAAgB,CAAC,eAAgBd,GACzDA,IAEO,KAAW,IAAAe,CACjB,AAAsB,QAAtBA,CAAAA,EAAAb,UAAUC,YAAY,AAAZA,GAAYY,AAAA,KAAA,IAAAA,GAAtBA,EAAwBC,mBAAmB,CAAC,eAAgBhB,EAC7D,CACD,EAAG,CAACtB,EAAQ,EAEZ,IAAMuC,EAAe/C,EAAQ,IAC5B,AAAKQ,EAME,CACNA,QAAAA,EACAE,4BAAAA,EACAE,2BAAAA,EACAE,0BAAAA,EACAK,yBAAAA,EACAK,qBAAAA,EACAH,oBAAAA,GAZO,CACNb,QAAAA,GAaA,CACFI,EACAF,EACAF,EACAW,EACAL,EACAU,EACA,EACD,OAAO3B,EAAAmD,aAAA,CAACpD,EAAcqD,QAAQ,CAAA,CAACC,MAAOH,CAAa,EAAExC,EACtD"}