)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser, AvatarObject } from '@rocket.chat/core-typings';\nimport { Box, Button, TextInput, Margins, Avatar, IconButton } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useSetting, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ChangeEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\n\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { isValidImageFormat } from '../../../lib/utils/isValidImageFormat';\nimport UserAvatar from '../UserAvatar';\nimport UserAvatarSuggestions from './UserAvatarSuggestions';\n\nconst toDataURL = (file: File, callback: (result: FileReader['result']) => void): void => {\n\tconst reader = new FileReader();\n\treader.onloadend = function (e): void {\n\t\tcallback(e?.target?.result || null);\n\t};\n\treader.readAsDataURL(file);\n};\n\ntype UserAvatarEditorType = {\n\tcurrentUsername: IUser['username'];\n\tusername: IUser['username'];\n\tsetAvatarObj: (obj: AvatarObject) => void;\n\tdisabled?: boolean;\n\tetag: IUser['avatarETag'];\n};\n\nfunction UserAvatarEditor({ currentUsername, username, setAvatarObj, disabled, etag }: UserAvatarEditorType): ReactElement {\n\tconst t = useTranslation();\n\tconst rotateImages = useSetting('FileUpload_RotateImages');\n\tconst [avatarFromUrl, setAvatarFromUrl] = useState('');\n\tconst [newAvatarSource, setNewAvatarSource] = useState<string>();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst setUploadedPreview = useCallback(\n\t\tasync (file, avatarObj) => {\n\t\t\tsetAvatarObj(avatarObj);\n\t\t\ttoDataURL(file, async (dataURL) => {\n\t\t\t\tif (typeof dataURL === 'string' && (await isValidImageFormat(dataURL))) {\n\t\t\t\t\tsetNewAvatarSource(dataURL);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Avatar_format_invalid') });\n\t\t\t});\n\t\t},\n\t\t[setAvatarObj, t, dispatchToastMessage],\n\t);\n\n\tconst [clickUpload] = useFileInput(setUploadedPreview);\n\n\tconst clickUrl = (): void => {\n\t\tsetNewAvatarSource(avatarFromUrl);\n\t\tsetAvatarObj({ avatarUrl: avatarFromUrl });\n\t};\n\n\tconst clickReset = (): void => {\n\t\tsetNewAvatarSource(`/avatar/%40${username}`);\n\t\tsetAvatarObj('reset');\n\t};\n\n\tconst url = newAvatarSource;\n\n\tconst handleAvatarFromUrlChange = (event: ChangeEvent<HTMLInputElement>): void => {\n\t\tsetAvatarFromUrl(event.currentTarget.value);\n\t};\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' fontScale='p2m' color='default'>\n\t\t\t{t('Profile_picture')}\n\t\t\t<Box display='flex' flexDirection='row' mbs={4}>\n\t\t\t\t<UserAvatar\n\t\t\t\t\tsize='x124'\n\t\t\t\t\turl={url}\n\t\t\t\t\tusername={currentUsername || ''}\n\t\t\t\t\tetag={etag}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tobjectFit: 'contain',\n\t\t\t\t\t\timageOrientation: rotateImages ? 'from-image' : 'none',\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<Box display='flex' flexDirection='column' flexGrow='1' justifyContent='space-between' mis={4}>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t\t<Button square mis='none' onClick={clickReset} disabled={disabled} mie={4} title={t('Accounts_SetDefaultAvatar')}>\n\t\t\t\t\t\t\t\t<Avatar url={`/avatar/%40${username}`} />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<IconButton icon='upload' secondary onClick={clickUpload} disabled={disabled} title={t('Upload')} />\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorSetAvatarLink'\n\t\t\t\t\t\t\t\ticon='permalink'\n\t\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\t\tonClick={clickUrl}\n\t\t\t\t\t\t\t\tdisabled={disabled || !avatarFromUrl}\n\t\t\t\t\t\t\t\ttitle={t('Add_URL')}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UserAvatarSuggestions setAvatarObj={setAvatarObj} setNewAvatarSource={setNewAvatarSource} disabled={disabled} />\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Margins inlineStart={4}>\n\t\t\t\t\t\t<Box>{t('Use_url_for_avatar')}</Box>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorLink'\n\t\t\t\t\t\t\tflexGrow={0}\n\t\t\t\t\t\t\tplaceholder={t('Use_url_for_avatar')}\n\t\t\t\t\t\t\tvalue={avatarFromUrl}\n\t\t\t\t\t\t\tonChange={handleAvatarFromUrlChange}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n}\n\nexport default UserAvatarEditor;\n",null],"names":["Box","Button","TextInput","Margins","Avatar","IconButton","useToastMessageDispatch","useSetting","useTranslation","React","useState","useCallback","useFileInput","isValidImageFormat","UserAvatar","UserAvatarSuggestions","module","v","default","toDataURL","file","callback","reader","FileReader","onloadend","e","_e$target","target","result","readAsDataURL","exportDefault","_ref","currentUsername","username","setAvatarObj","disabled","etag","t","rotateImages","avatarFromUrl","setAvatarFromUrl","newAvatarSource","setNewAvatarSource","dispatchToastMessage","setUploadedPreview","avatarObj","dataURL","type","message","clickUpload","createElement","display","flexDirection","fontScale","color","mbs","size","url","style","objectFit","imageOrientation","flexGrow","justifyContent","mis","inline","square","onClick","concat","mie","title","icon","secondary","avatarUrl","inlineStart","placeholder","value","onChange","event","currentTarget"],"mappings":"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"}