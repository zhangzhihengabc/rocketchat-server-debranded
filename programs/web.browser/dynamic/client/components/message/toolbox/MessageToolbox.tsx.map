)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/message/toolbox/MessageToolbox.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, IRoom, ISubscription, ITranslatedMessage } from '@rocket.chat/core-typings';\nimport { isThreadMessage, isRoomFederated, isVideoConfMessage } from '@rocket.chat/core-typings';\nimport { MessageToolbox as FuselageMessageToolbox, MessageToolboxItem } from '@rocket.chat/fuselage';\nimport { useFeaturePreview } from '@rocket.chat/ui-client';\nimport { useUser, useSettings, useTranslation, useMethod } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport type { ReactElement } from 'react';\nimport React, { memo, useMemo } from 'react';\n\nimport type { MessageActionContext } from '../../../../app/ui-utils/client/lib/MessageAction';\nimport { MessageAction } from '../../../../app/ui-utils/client/lib/MessageAction';\nimport { useEmojiPickerData } from '../../../contexts/EmojiPickerContext';\nimport { useMessageActionAppsActionButtons } from '../../../hooks/useAppActionButtons';\nimport EmojiElement from '../../../views/composer/EmojiPicker/EmojiElement';\nimport { useIsSelecting } from '../../../views/room/MessageList/contexts/SelectedMessagesContext';\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\nimport { useChat } from '../../../views/room/contexts/ChatContext';\nimport { useRoomToolbox } from '../../../views/room/contexts/RoomToolboxContext';\nimport MessageActionMenu from './MessageActionMenu';\n\nconst getMessageContext = (message: IMessage, room: IRoom, context?: MessageActionContext): MessageActionContext => {\n\tif (context) {\n\t\treturn context;\n\t}\n\n\tif (isVideoConfMessage(message)) {\n\t\treturn 'videoconf';\n\t}\n\n\tif (isRoomFederated(room)) {\n\t\treturn 'federated';\n\t}\n\n\tif (isThreadMessage(message)) {\n\t\treturn 'threads';\n\t}\n\n\treturn 'message';\n};\n\ntype MessageToolboxProps = {\n\tmessage: IMessage & Partial<ITranslatedMessage>;\n\tmessageContext?: MessageActionContext;\n\troom: IRoom;\n\tsubscription?: ISubscription;\n\tonChangeMenuVisibility: (visible: boolean) => void;\n};\n\nconst MessageToolbox = ({\n\tmessage,\n\tmessageContext,\n\troom,\n\tsubscription,\n\tonChangeMenuVisibility,\n}: MessageToolboxProps): ReactElement | null => {\n\tconst t = useTranslation();\n\tconst user = useUser() ?? undefined;\n\tconst settings = useSettings();\n\n\tconst quickReactionsEnabled = useFeaturePreview('quickReactions');\n\n\tconst setReaction = useMethod('setReaction');\n\n\tconst context = getMessageContext(message, room, messageContext);\n\n\tconst mapSettings = useMemo(() => Object.fromEntries(settings.map((setting) => [setting._id, setting.value])), [settings]);\n\n\tconst chat = useChat();\n\tconst { quickReactions, addRecentEmoji } = useEmojiPickerData();\n\n\tconst actionButtonApps = useMessageActionAppsActionButtons(context);\n\n\tconst actionsQueryResult = useQuery(['rooms', room._id, 'messages', message._id, 'actions'] as const, async () => {\n\t\tconst props = { message, room, user, subscription, settings: mapSettings, chat };\n\n\t\tconst toolboxItems = await MessageAction.getAll(props, context, 'message');\n\t\tconst menuItems = await MessageAction.getAll(props, context, 'menu');\n\n\t\treturn { message: toolboxItems, menu: menuItems };\n\t});\n\n\tconst toolbox = useRoomToolbox();\n\n\tconst selecting = useIsSelecting();\n\n\tconst autoTranslateOptions = useAutoTranslate(subscription);\n\n\tif (selecting) {\n\t\treturn null;\n\t}\n\n\tconst isReactionAllowed = actionsQueryResult.data?.message.find(({ id }) => id === 'reaction-message');\n\n\tconst handleSetReaction = (emoji: string) => {\n\t\tsetReaction(`:${emoji}:`, message._id);\n\t\taddRecentEmoji(emoji);\n\t};\n\n\treturn (\n\t\t<FuselageMessageToolbox>\n\t\t\t{quickReactionsEnabled &&\n\t\t\t\tisReactionAllowed &&\n\t\t\t\tquickReactions.slice(0, 3).map(({ emoji, image }) => {\n\t\t\t\t\treturn <EmojiElement small key={emoji} title={emoji} emoji={emoji} image={image} onClick={() => handleSetReaction(emoji)} />;\n\t\t\t\t})}\n\t\t\t{actionsQueryResult.isSuccess &&\n\t\t\t\tactionsQueryResult.data.message.map((action) => (\n\t\t\t\t\t<MessageToolboxItem\n\t\t\t\t\t\tonClick={(e): void => action.action(e, { message, tabbar: toolbox, room, chat, autoTranslateOptions })}\n\t\t\t\t\t\tkey={action.id}\n\t\t\t\t\t\ticon={action.icon}\n\t\t\t\t\t\ttitle={t(action.label)}\n\t\t\t\t\t\tdata-qa-id={action.label}\n\t\t\t\t\t\tdata-qa-type='message-action-menu'\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t{actionsQueryResult.isSuccess && actionsQueryResult.data.menu.length > 0 && (\n\t\t\t\t<MessageActionMenu\n\t\t\t\t\tonChangeMenuVisibility={onChangeMenuVisibility}\n\t\t\t\t\toptions={[...actionsQueryResult.data?.menu, ...(actionButtonApps.data ?? [])].filter(Boolean).map((action) => ({\n\t\t\t\t\t\t...action,\n\t\t\t\t\t\taction: (e): void => action.action(e, { message, tabbar: toolbox, room, chat, autoTranslateOptions }),\n\t\t\t\t\t}))}\n\t\t\t\t\tdata-qa-type='message-action-menu-options'\n\t\t\t\t/>\n\t\t\t)}\n\t\t</FuselageMessageToolbox>\n\t);\n};\n\nexport default memo(MessageToolbox);\n",null],"names":["_objectSpread","isThreadMessage","isRoomFederated","isVideoConfMessage","FuselageMessageToolbox","MessageToolboxItem","useFeaturePreview","useUser","useSettings","useTranslation","useMethod","useQuery","React","memo","useMemo","MessageAction","useEmojiPickerData","useMessageActionAppsActionButtons","EmojiElement","useIsSelecting","useAutoTranslate","useChat","useRoomToolbox","MessageActionMenu","module","link","default","v","MessageToolbox","getMessageContext","message","room","context","exportDefault","_ref","_useUser","_actionsQueryResult$d","_actionsQueryResult$d2","_actionButtonApps$dat","messageContext","subscription","onChangeMenuVisibility","t","user","undefined","settings","quickReactionsEnabled","setReaction","mapSettings","Object","fromEntries","map","setting","_id","value","chat","quickReactions","addRecentEmoji","actionButtonApps","actionsQueryResult","props","toolboxItems","getAll","menuItems","menu","toolbox","selecting","autoTranslateOptions","isReactionAllowed","data","find","_ref2","id","handleSetReaction","emoji","concat","createElement","slice","_ref3","image","small","key","title","onClick","isSuccess","action","e","tabbar","icon","label","length","options","filter","Boolean"],"mappings":"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"}