)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/RoomIcon/OmnichannelRoomIcon/provider/OmnichannelRoomIconProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { FC } from 'react';\nimport React, { useCallback, useMemo } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\n\nimport type { AsyncState } from '../../../../lib/asyncState/AsyncState';\nimport { AsyncStatePhase } from '../../../../lib/asyncState/AsyncStatePhase';\nimport { OmnichannelRoomIconContext } from '../context/OmnichannelRoomIconContext';\nimport OmnichannelRoomIcon from '../lib/OmnichannelRoomIcon';\n\nlet icons = Array.from(OmnichannelRoomIcon.icons.values());\n\nexport const OmnichannelRoomIconProvider: FC = ({ children }) => {\n\tconst svgIcons = useSyncExternalStore(\n\t\tuseCallback(\n\t\t\t(callback): (() => void) =>\n\t\t\t\tOmnichannelRoomIcon.on('change', () => {\n\t\t\t\t\ticons = Array.from(OmnichannelRoomIcon.icons.values());\n\t\t\t\t\tcallback();\n\t\t\t\t}),\n\t\t\t[],\n\t\t),\n\t\t(): string[] => icons,\n\t);\n\n\treturn (\n\t\t<OmnichannelRoomIconContext.Provider\n\t\t\tvalue={useMemo(() => {\n\t\t\t\tconst extractSnapshot = (app: string, iconName: string): AsyncState<string> => {\n\t\t\t\t\tconst icon = OmnichannelRoomIcon.get(app, iconName);\n\n\t\t\t\t\tif (icon) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\t\t\t\tvalue: icon,\n\t\t\t\t\t\t\terror: undefined,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\terror: undefined,\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t// We cache all the icons here, so that we can use them in the OmnichannelRoomIcon component\n\t\t\t\tconst snapshots = new Map<string, AsyncState<string>>();\n\n\t\t\t\treturn {\n\t\t\t\t\tqueryIcon: (\n\t\t\t\t\t\tapp: string,\n\t\t\t\t\t\ticonName: string,\n\t\t\t\t\t): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => AsyncState<string>] => [\n\t\t\t\t\t\t(callback): (() => void) =>\n\t\t\t\t\t\t\tOmnichannelRoomIcon.on(`${app}-${iconName}`, () => {\n\t\t\t\t\t\t\t\tsnapshots.set(`${app}-${iconName}`, extractSnapshot(app, iconName));\n\n\t\t\t\t\t\t\t\t// Then we call the callback (onStoreChange), signaling React to re-render\n\t\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t\t}),\n\n\t\t\t\t\t\t// No problem here, because it's return value is a cached in the snapshots map on subsequent calls\n\t\t\t\t\t\t(): AsyncState<string> => {\n\t\t\t\t\t\t\tlet snapshot = snapshots.get(`${app}-${iconName}`);\n\n\t\t\t\t\t\t\tif (!snapshot) {\n\t\t\t\t\t\t\t\tsnapshot = extractSnapshot(app, iconName);\n\t\t\t\t\t\t\t\tsnapshots.set(`${app}-${iconName}`, snapshot);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn snapshot;\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t};\n\t\t\t}, [])}\n\t\t>\n\t\t\t{createPortal(\n\t\t\t\t<svg\n\t\t\t\t\txmlns='http://www.w3.org/2000/svg'\n\t\t\t\t\txmlnsXlink='http://www.w3.org/1999/xlink'\n\t\t\t\t\tstyle={{ display: 'none' }}\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: svgIcons.join('') }}\n\t\t\t\t/>,\n\t\t\t\tdocument.body,\n\t\t\t\t'custom-icons',\n\t\t\t)}\n\t\t\t{children}\n\t\t</OmnichannelRoomIconContext.Provider>\n\t);\n};\n",null],"names":["React","useCallback","useMemo","createPortal","useSyncExternalStore","AsyncStatePhase","OmnichannelRoomIconContext","OmnichannelRoomIcon","module","export","OmnichannelRoomIconProvider","default","icons","Array","from","values","_ref","children","svgIcons","callback","on","createElement","Provider","value","extractSnapshot","app","iconName","icon","get","phase","RESOLVED","error","undefined","LOADING","snapshots","Map","queryIcon","concat","set","snapshot","xmlns","xmlnsXlink","style","display","dangerouslySetInnerHTML","__html","join","document","body"],"mappings":"2BACoDA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAApDC,EAAOC,MAAK,CAAE,CAAAC,4BAAwB,IAAMA,CAAQ,GAAAF,EAAAA,IAAAA,CAAAA,QAAAA,CAAAG,QAAAA,CAAAA,EAAAX,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,YAAAA,CAAAL,aAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAJ,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,6CAAAA,CAAAH,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAF,2BAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAG,QAAAA,CAAAA,EAAAJ,EAAAA,CAAA,CAAA,EAAA,GASpD,IAAIK,EAAQC,MAAMC,IAAI,CAACP,EAAoBK,KAAK,CAACG,MAAM,IAE1CL,EAAkCM,IAAiB,GAAhB,CAAEC,SAAAA,CAAAA,CAAU,CAAAD,EACrDE,EAAWd,EAChBH,EACEkB,GACAZ,EAAoBa,EAAE,CAAC,SAAU,KAChCR,EAAQC,MAAMC,IAAI,CAACP,EAAoBK,KAAK,CAACG,MAAM,IACnDI,GACD,GACD,EAAE,EAEH,IAAgBP,GAGjB,OACCZ,EAAAqB,aAAA,CAACf,EAA2BgB,QAAQ,CAAA,CACnCC,MAAOrB,EAAQ,KACd,IAAMsB,EAAkB,CAACC,EAAaC,KACrC,IAAMC,EAAOpB,EAAoBqB,GAAG,CAACH,EAAKC,UAE1C,AAAIC,EACI,CACNE,MAAOxB,EAAgByB,QAAQ,CAC/BP,MAAOI,EACPI,MAAOC,KAAAA,GAIF,CACNH,MAAOxB,EAAgB4B,OAAO,CAC9BV,MAAOS,KAAAA,EACPD,MAAOC,KAAAA,EAET,EAGME,EAAY,IAAIC,IAEtB,MAAO,CACNC,UAAW,CACVX,EACAC,IACmG,CAClGP,GACAZ,EAAoBa,EAAE,CAAA,GAAAiB,MAAA,CAAIZ,EAAG,KAAAY,MAAA,CAAIX,GAAY,KAC5CQ,EAAUI,GAAG,CAAA,GAAAD,MAAA,CAAIZ,EAAG,KAAAY,MAAA,CAAIX,GAAYF,EAAgBC,EAAKC,IAGzDP,GACD,GAGD,KACC,IAAIoB,EAAWL,EAAUN,GAAG,CAAA,GAAAS,MAAA,CAAIZ,EAAG,KAAAY,MAAA,CAAIX,IAOvC,OALKa,IACJA,EAAWf,EAAgBC,EAAKC,GAChCQ,EAAUI,GAAG,CAAA,GAAAD,MAAA,CAAIZ,EAAG,KAAAY,MAAA,CAAIX,GAAYa,IAG9BA,CACR,EAAC,CAGJ,EAAG,EAAE,CAAE,EAENpC,EACAH,EAAAqB,aAAA,CAAA,MAAA,CACCmB,MAAM,6BACNC,WAAW,+BACXC,MAAO,CAAEC,QAAS,MAAM,EACxBC,wBAAyB,CAAEC,OAAQ3B,EAAS4B,IAAI,CAAC,GAAG,CAAG,GAExDC,SAASC,IAAI,CACb,gBAEA/B,EAGJ"}