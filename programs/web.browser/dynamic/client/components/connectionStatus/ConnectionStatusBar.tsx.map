)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/connectionStatus/ConnectionStatusBar.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Icon } from '@rocket.chat/fuselage';\nimport { useConnectionStatus, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { MouseEventHandler, FC } from 'react';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport './ConnectionStatusBar.styles.css';\n\n// TODO: frontend chapter day - fix unknown translation keys\n\nconst getReconnectCountdown = (retryTime: number): number => {\n\tconst timeDiff = retryTime - Date.now();\n\treturn (timeDiff > 0 && Math.round(timeDiff / 1000)) || 0;\n};\n\nconst useReconnectCountdown = (\n\tretryTime: number | undefined,\n\tstatus: 'connected' | 'connecting' | 'failed' | 'waiting' | 'offline',\n): number => {\n\tconst reconnectionTimerRef = useRef<ReturnType<typeof setInterval>>();\n\tconst [reconnectCountdown, setReconnectCountdown] = useState(() => (retryTime ? getReconnectCountdown(retryTime) : 0));\n\n\tuseEffect(() => {\n\t\tif (status === 'waiting') {\n\t\t\tif (reconnectionTimerRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treconnectionTimerRef.current = setInterval(() => {\n\t\t\t\tretryTime && setReconnectCountdown(getReconnectCountdown(retryTime));\n\t\t\t}, 500);\n\t\t\treturn;\n\t\t}\n\n\t\treconnectionTimerRef.current && clearInterval(reconnectionTimerRef.current);\n\t\treconnectionTimerRef.current = undefined;\n\t}, [retryTime, status]);\n\n\tuseEffect(\n\t\t() => (): void => {\n\t\t\treconnectionTimerRef.current && clearInterval(reconnectionTimerRef.current);\n\t\t},\n\t\t[],\n\t);\n\n\treturn reconnectCountdown;\n};\n\nconst ConnectionStatusBar: FC = function ConnectionStatusBar() {\n\tconst { connected, retryTime, status, reconnect } = useConnectionStatus();\n\tconst reconnectCountdown = useReconnectCountdown(retryTime, status);\n\tconst t = useTranslation();\n\n\tif (connected) {\n\t\treturn null;\n\t}\n\n\tconst handleRetryClick: MouseEventHandler<HTMLAnchorElement> = (event) => {\n\t\tevent.preventDefault();\n\t\treconnect?.();\n\t};\n\n\treturn (\n\t\t<div className='ConnectionStatusBar' role='alert'>\n\t\t\t<strong>\n\t\t\t\t<Icon name='warning' /> {t('meteor_status' as Parameters<typeof t>[0], { context: status })}\n\t\t\t</strong>\n\n\t\t\t{status === 'waiting' && <> {t('meteor_status_reconnect_in', { count: reconnectCountdown })}</>}\n\n\t\t\t{['waiting', 'offline'].includes(status) && (\n\t\t\t\t<>\n\t\t\t\t\t{' '}\n\t\t\t\t\t<a className='ConnectionStatusBar__retry-link' href='#' onClick={handleRetryClick}>\n\t\t\t\t\t\t{t('meteor_status_try_now' as Parameters<typeof t>[0], { context: status })}\n\t\t\t\t\t</a>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default ConnectionStatusBar;\n",null],"names":["Icon","useConnectionStatus","useTranslation","React","useEffect","useRef","useState","module","link","default","getReconnectCountdown","retryTime","timeDiff","Date","now","Math","round","useReconnectCountdown","status","reconnectionTimerRef","reconnectCountdown","setReconnectCountdown","current","setInterval","clearInterval","undefined","exportDefault","ConnectionStatusBar","connected","reconnect","t","createElement","className","role","name","context","Fragment","count","includes","href","onClick","event","preventDefault"],"mappings":"2BAAAA,EAA6CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAApCC,EAAMC,IAAA,CAAM,wBAAwB,CAAAR,KAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAN,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAN,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAC,EAAAA,IAAAA,CAAAA,oCAS7C,IAAMG,EAAyBC,IAC9B,IAAMC,EAAWD,EAAYE,KAAKC,GAAG,GACrC,OAAQF,EAAW,GAAKG,KAAKC,KAAK,CAACJ,EAAW,MAAU,CACzD,EAEMK,EAAwB,CAC7BN,EACAO,KAEA,IAAMC,EAAuBd,IACvB,CAACe,EAAoBC,EAAsB,CAAGf,EAAS,IAAOK,EAAYD,EAAsBC,GAAa,GAyBnH,OAvBAP,EAAU,KACT,GAAIc,AAAW,YAAXA,EAAsB,CACzB,GAAIC,EAAqBG,OAAO,CAC/B,MAGDH,CAAAA,EAAqBG,OAAO,CAAGC,YAAY,KAC1CZ,GAAaU,EAAsBX,EAAsBC,GAC1D,EAAG,KACH,OAGDQ,EAAqBG,OAAO,EAAIE,cAAcL,EAAqBG,OAAO,EAC1EH,EAAqBG,OAAO,CAAGG,KAAAA,CAChC,EAAG,CAACd,EAAWO,EAAO,EAEtBd,EACC,IAAM,KACLe,EAAqBG,OAAO,EAAIE,cAAcL,EAAqBG,OAAO,CAC3E,EACA,EAAE,EAGIF,CACR,EA7CAb,EAAOmB,aAAQ,CA+CiB,SAASC,IACxC,GAAM,CAAEC,UAAAA,CAAS,CAAEjB,UAAAA,CAAS,CAAEO,OAAAA,CAAM,CAAEW,UAAAA,CAAAA,CAAW,CAAG5B,IAC9CmB,EAAqBH,EAAsBN,EAAWO,GACtDY,EAAI5B,WAEV,AAAI0B,EACI,KASPzB,EAAA4B,aAAA,CAAA,MAAA,CAAKC,UAAU,sBAAsBC,KAAK,OAAO,EAChD9B,EAAA4B,aAAA,CAAA,SAAA,KACC5B,EAAA4B,aAAA,CAAC/B,EAAI,CAACkC,KAAK,SAAS,GAAI,IAACJ,EAAE,gBAA4C,CAAEK,QAASjB,CAAM,IAGxFA,AAAW,YAAXA,GAAwBf,EAAA4B,aAAA,CAAA5B,EAAAiC,QAAA,CAAA,KAAG,IAACN,EAAE,6BAA8B,CAAEO,MAAOjB,CAAkB,IAEvF,CAAC,UAAW,UAAU,CAACkB,QAAQ,CAACpB,IAChCf,EAAA4B,aAAA,CAAA5B,EAAAiC,QAAA,CAAA,KACE,IACDjC,EAAA4B,aAAA,CAAA,IAAA,CAAGC,UAAU,kCAAkCO,KAAK,IAAIC,QAhBIC,IAC/DA,EAAMC,cAAc,GACpBb,MAAAA,GAAAA,GACD,CAasF,EAChFC,EAAE,wBAAoD,CAAEK,QAASjB,CAAM,KAM9E"}