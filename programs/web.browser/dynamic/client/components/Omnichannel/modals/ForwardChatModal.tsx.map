)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/Omnichannel/modals/ForwardChatModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport {\n\tField,\n\tFieldGroup,\n\tButton,\n\tTextAreaInput,\n\tModal,\n\tBox,\n\tPaginatedSelectFiltered,\n\tDivider,\n\tFieldLabel,\n\tFieldRow,\n} from '@rocket.chat/fuselage';\nimport { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport { useEndpoint, useSetting, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { useRecordList } from '../../../hooks/lists/useRecordList';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport AutoCompleteAgent from '../../AutoCompleteAgent';\nimport { useDepartmentsList } from '../hooks/useDepartmentsList';\n\nconst ForwardChatModal = ({\n\tonForward,\n\tonCancel,\n\troom,\n\t...props\n}: {\n\tonForward: (departmentId?: string, userId?: string, comment?: string) => Promise<void>;\n\tonCancel: () => void;\n\troom: IOmnichannelRoom;\n}): ReactElement => {\n\tconst t = useTranslation();\n\tconst getUserData = useEndpoint('GET', '/v1/users.info');\n\tconst idleAgentsAllowedForForwarding = useSetting('Livechat_enabled_when_agent_idle') as boolean;\n\n\tconst { getValues, handleSubmit, register, setFocus, setValue, watch } = useForm();\n\n\tuseEffect(() => {\n\t\tsetFocus('comment');\n\t}, [setFocus]);\n\n\tconst department = watch('department');\n\tconst username = watch('username');\n\n\tconst [departmentsFilter, setDepartmentsFilter] = useState<string | number | undefined>('');\n\tconst debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n\tconst { itemsList: departmentsList, loadMoreItems: loadMoreDepartments } = useDepartmentsList(\n\t\tuseMemo(() => ({ filter: debouncedDepartmentsFilter as string, enabled: true }), [debouncedDepartmentsFilter]),\n\t);\n\tconst { phase: departmentsPhase, items: departments, itemCount: departmentsTotal } = useRecordList(departmentsList);\n\n\tconst endReached = useCallback(\n\t\t(start) => {\n\t\t\tif (departmentsPhase !== AsyncStatePhase.LOADING) {\n\t\t\t\tloadMoreDepartments(start, Math.min(50, departmentsTotal));\n\t\t\t}\n\t\t},\n\t\t[departmentsPhase, departmentsTotal, loadMoreDepartments],\n\t);\n\n\tconst onSubmit = useCallback(\n\t\tasync ({ department: departmentId, username, comment }) => {\n\t\t\tlet uid;\n\n\t\t\tif (username) {\n\t\t\t\tconst { user } = await getUserData({ username });\n\t\t\t\tuid = user?._id;\n\t\t\t}\n\n\t\t\tonForward(departmentId, uid, comment);\n\t\t},\n\t\t[getUserData, onForward],\n\t);\n\n\tuseEffect(() => {\n\t\tregister('department');\n\t\tregister('username');\n\t}, [register]);\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} />} {...props}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Icon name='baloon-arrow-top-right' />\n\t\t\t\t<Modal.Title>{t('Forward_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<FieldGroup>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel>{t('Forward_to_department')}</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<PaginatedSelectFiltered\n\t\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\t\tfilter={departmentsFilter as string}\n\t\t\t\t\t\t\t\tsetFilter={setDepartmentsFilter}\n\t\t\t\t\t\t\t\toptions={departments}\n\t\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\t\tonChange={(value: string): void => {\n\t\t\t\t\t\t\t\t\tsetValue('department', value);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\tendReached={endReached}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t</Field>\n\t\t\t\t\t<Divider p={0} children={t('or')} />\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel>{t('Forward_to_user')}</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<AutoCompleteAgent\n\t\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\t\tonlyAvailable\n\t\t\t\t\t\t\t\tvalue={getValues().username}\n\t\t\t\t\t\t\t\texcludeId={room.servedBy?._id}\n\t\t\t\t\t\t\t\tshowIdleAgents={idleAgentsAllowedForForwarding}\n\t\t\t\t\t\t\t\tplaceholder={t('Username_name_email')}\n\t\t\t\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\t\t\t\tsetValue('username', value);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t</Field>\n\t\t\t\t\t<Field marginBlock={15}>\n\t\t\t\t\t\t<FieldLabel>\n\t\t\t\t\t\t\t{t('Leave_a_comment')}{' '}\n\t\t\t\t\t\t\t<Box is='span' color='annotation'>\n\t\t\t\t\t\t\t\t({t('Optional')})\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<TextAreaInput data-qa-id='ForwardChatModalTextAreaInputComment' {...register('comment')} rows={8} flexGrow={1} />\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t</Field>\n\t\t\t\t</FieldGroup>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button type='submit' disabled={!username && !department} primary>\n\t\t\t\t\t\t{t('Forward')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default ForwardChatModal;\n",null],"names":["_extends","_objectWithoutProperties","Field","FieldGroup","Button","TextAreaInput","Modal","Box","PaginatedSelectFiltered","Divider","FieldLabel","FieldRow","useDebouncedValue","useEndpoint","useSetting","useTranslation","React","useCallback","useEffect","useMemo","useState","useForm","useRecordList","AsyncStatePhase","AutoCompleteAgent","useDepartmentsList","module","link","default","v","exportDefault","_ref","_room$servedBy","onForward","onCancel","room","props","_excluded","t","getUserData","idleAgentsAllowedForForwarding","getValues","handleSubmit","register","setFocus","setValue","watch","department","username","departmentsFilter","setDepartmentsFilter","debouncedDepartmentsFilter","itemsList","departmentsList","loadMoreItems","loadMoreDepartments","filter","enabled","phase","departmentsPhase","items","departments","itemCount","departmentsTotal","endReached","start","LOADING","Math","min","onSubmit","_ref2","uid","departmentId","comment","user","_id","createElement","wrapperFunction","is","Header","Icon","name","Title","Close","onClick","Content","fontScale","withTitle","setFilter","options","maxWidth","placeholder","onChange","value","flexGrow","p","children","onlyAvailable","excludeId","servedBy","showIdleAgents","marginBlock","color","rows","Footer","FooterControllers","type","disabled","primary"],"mappings":"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"}