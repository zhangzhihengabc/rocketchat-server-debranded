)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/Omnichannel/modals/TranscriptModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { Field, Button, TextInput, Modal, Box, FieldGroup, FieldLabel, FieldRow, FieldError } from '@rocket.chat/fuselage';\nimport { useTranslation } from '@rocket.chat/ui-contexts';\nimport type { FC } from 'react';\nimport React, { useCallback, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\n\ntype TranscriptModalProps = {\n\temail: string;\n\troom: IOmnichannelRoom;\n\tonRequest: (email: string, subject: string) => void;\n\tonSend?: (email: string, subject: string, token: string) => void;\n\tonCancel: () => void;\n\tonDiscard: () => void;\n};\n\nconst TranscriptModal: FC<TranscriptModalProps> = ({\n\temail: emailDefault = '',\n\troom,\n\tonRequest,\n\tonSend,\n\tonCancel,\n\tonDiscard,\n\t...props\n}) => {\n\tconst t = useTranslation();\n\n\tconst {\n\t\tregister,\n\t\thandleSubmit,\n\t\tsetValue,\n\t\tsetFocus,\n\t\twatch,\n\t\tformState: { errors, isValid, isSubmitting },\n\t} = useForm({\n\t\tdefaultValues: { email: emailDefault || '', subject: t('Transcript_of_your_livechat_conversation') },\n\t});\n\n\tuseEffect(() => {\n\t\tsetFocus('subject');\n\t}, [setFocus]);\n\n\tconst { transcriptRequest } = room;\n\tconst roomOpen = room?.open;\n\tconst token = room?.v?.token;\n\n\tconst handleDiscard = useCallback(() => onDiscard(), [onDiscard]);\n\n\tconst submit = useCallback(\n\t\t({ email, subject }: { email: string; subject: string }) => {\n\t\t\tif (roomOpen && !transcriptRequest) {\n\t\t\t\tonRequest(email, subject);\n\t\t\t}\n\t\t\tif (!roomOpen && onSend && token) {\n\t\t\t\tonSend(email, subject, token);\n\t\t\t}\n\t\t},\n\t\t[onRequest, onSend, roomOpen, token, transcriptRequest],\n\t);\n\n\tuseEffect(() => {\n\t\tif (transcriptRequest) {\n\t\t\tsetValue('email', transcriptRequest.email);\n\t\t\tsetValue('subject', transcriptRequest.subject);\n\t\t}\n\t}, [setValue, transcriptRequest]);\n\n\tconst canSubmit = isValid && Boolean(watch('subject'));\n\n\treturn (\n\t\t<Modal open wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(submit)} {...props} />} {...props}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Icon name='mail-arrow-top-right' />\n\t\t\t\t<Modal.Title>{t('Transcript')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t{!!transcriptRequest && <p>{t('Livechat_transcript_already_requested_warning')}</p>}\n\t\t\t\t<FieldGroup>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel>{t('Email')}*</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\tdisabled={!!emailDefault || !!transcriptRequest}\n\t\t\t\t\t\t\t\terror={errors.email?.message}\n\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t{...register('email', { required: t('The_field_is_required', t('Email')) })}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t<FieldError>{errors.email?.message}</FieldError>\n\t\t\t\t\t</Field>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel>{t('Subject')}*</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\tdisabled={!!transcriptRequest}\n\t\t\t\t\t\t\t\terror={errors.subject?.message}\n\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t{...register('subject', { required: t('The_field_is_required', t('Subject')) })}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t<FieldError>{errors.subject?.message}</FieldError>\n\t\t\t\t\t</Field>\n\t\t\t\t</FieldGroup>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t{roomOpen && transcriptRequest && (\n\t\t\t\t\t\t<Button danger onClick={handleDiscard}>\n\t\t\t\t\t\t\t{t('Undo_request')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t{roomOpen && !transcriptRequest && (\n\t\t\t\t\t\t<Button aria-label='request-button' disabled={!canSubmit} loading={isSubmitting} primary type='submit'>\n\t\t\t\t\t\t\t{t('Request')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t{!roomOpen && (\n\t\t\t\t\t\t<Button aria-label='send-button' disabled={!canSubmit} loading={isSubmitting} primary type='submit'>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default TranscriptModal;\n",null],"names":["_extends","_objectWithoutProperties","Field","Button","TextInput","Modal","Box","FieldGroup","FieldLabel","FieldRow","useTranslation","React","useCallback","useEffect","useForm","module","link","default","v","FieldError","exportDefault","_ref","_room$v","_errors$email","_errors$email2","_errors$subject","_errors$subject2","email","emailDefault","room","onRequest","onSend","onCancel","onDiscard","props","_excluded","t","register","handleSubmit","setValue","setFocus","watch","formState","errors","isValid","isSubmitting","defaultValues","subject","transcriptRequest","roomOpen","open","token","handleDiscard","submit","_ref2","canSubmit","Boolean","createElement","wrapperFunction","is","onSubmit","Header","Icon","name","Title","Close","onClick","Content","fontScale","disabled","error","message","flexGrow","required","Footer","FooterControllers","danger","loading","primary","type"],"mappings":"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"}