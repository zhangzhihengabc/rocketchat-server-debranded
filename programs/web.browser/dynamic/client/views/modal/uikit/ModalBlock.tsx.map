)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/modal/uikit/ModalBlock.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { UiKit } from '@rocket.chat/core-typings';\nimport { Modal, AnimatedVisibility, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UiKitComponent, UiKitModal, modalParser } from '@rocket.chat/fuselage-ui-kit';\nimport type { LayoutBlock } from '@rocket.chat/ui-kit';\nimport { BlockContext } from '@rocket.chat/ui-kit';\nimport type { FormEventHandler, ReactElement } from 'react';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { FocusScope } from 'react-aria';\n\nimport { getURL } from '../../../../app/utils/client/getURL';\nimport { getButtonStyle } from './getButtonStyle';\n\nconst focusableElementsString = `\n\ta[href]:not([tabindex=\"-1\"]),\n\tarea[href]:not([tabindex=\"-1\"]),\n\tinput:not([disabled]):not([tabindex=\"-1\"]),\n\tselect:not([disabled]):not([tabindex=\"-1\"]),\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]),\n\tbutton:not([disabled]):not([tabindex=\"-1\"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex=\"-1\"]),\n\t[contenteditable]`;\n\nconst focusableElementsStringInvalid = `\n\ta[href]:not([tabindex=\"-1\"]):invalid,\n\tarea[href]:not([tabindex=\"-1\"]):invalid,\n\tinput:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tselect:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tbutton:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex=\"-1\"]):invalid,\n\t[contenteditable]:invalid`;\n\ntype ModalBlockParams = {\n\tview: UiKit.ModalView;\n\terrors: any;\n\tappId: string;\n\tonSubmit: FormEventHandler<HTMLElement>;\n\tonClose: () => void;\n\tonCancel: FormEventHandler<HTMLElement>;\n};\n\nconst isFocusable = (element: Element | null): element is HTMLElement =>\n\telement !== null && 'focus' in element && typeof element.focus === 'function';\n\nconst KeyboardCode = new Map<string, number>([\n\t['ENTER', 13],\n\t['ESC', 27],\n\t['TAB', 9],\n]);\n\nconst ModalBlock = ({ view, errors, onSubmit, onClose, onCancel }: ModalBlockParams): ReactElement => {\n\tconst id = `modal_id_${useUniqueId()}`;\n\tconst ref = useRef<HTMLElement>(null);\n\n\tuseEffect(() => {\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (errors && Object.keys(errors).length) {\n\t\t\tconst element = ref.current.querySelector<HTMLElement>(focusableElementsStringInvalid);\n\t\t\telement?.focus();\n\t\t} else {\n\t\t\tconst element = ref.current.querySelector<HTMLElement>(focusableElementsString);\n\t\t\telement?.focus();\n\t\t}\n\t}, [errors]);\n\n\tconst previousFocus = useMemo(() => document.activeElement, []);\n\n\tuseEffect(\n\t\t() => () => {\n\t\t\tif (previousFocus && isFocusable(previousFocus)) {\n\t\t\t\treturn previousFocus.focus();\n\t\t\t}\n\t\t},\n\t\t[previousFocus],\n\t);\n\n\tconst handleKeyDown = useCallback(\n\t\t(event) => {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase KeyboardCode.get('ENTER'):\n\t\t\t\t\tif (event?.target?.nodeName !== 'TEXTAREA') {\n\t\t\t\t\t\treturn onSubmit(event);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\tcase KeyboardCode.get('ESC'):\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tonClose();\n\t\t\t\t\treturn;\n\t\t\t\tcase KeyboardCode.get('TAB'):\n\t\t\t\t\tif (!ref.current) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst elements = Array.from(ref.current.querySelectorAll(focusableElementsString)) as HTMLElement[];\n\t\t\t\t\tconst [first] = elements;\n\t\t\t\t\tconst last = elements.pop();\n\n\t\t\t\t\tif (!ref.current.contains(document.activeElement)) {\n\t\t\t\t\t\treturn first.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\t\tif (!first || first === document.activeElement) {\n\t\t\t\t\t\t\tlast?.focus();\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!last || last === document.activeElement) {\n\t\t\t\t\t\tfirst.focus();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[onClose, onSubmit],\n\t);\n\n\tuseEffect(() => {\n\t\tconst element = document.querySelector('#modal-root') as HTMLElement;\n\t\tconst container = element.querySelector('.rcx-modal__content') as HTMLElement;\n\t\tconst close = (e: Event) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tonClose();\n\t\t\treturn false;\n\t\t};\n\n\t\tconst ignoreIfNotContains = (e: Event) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!container.contains(e.target as HTMLElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleKeyDown(e);\n\t\t};\n\n\t\tdocument.addEventListener('keydown', ignoreIfNotContains);\n\t\telement.addEventListener('click', close);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', ignoreIfNotContains);\n\t\t\telement.removeEventListener('click', close);\n\t\t};\n\t}, [handleKeyDown, onClose]);\n\n\treturn (\n\t\t<AnimatedVisibility visibility={AnimatedVisibility.UNHIDING}>\n\t\t\t<FocusScope contain restoreFocus autoFocus>\n\t\t\t\t<Modal open id={id} ref={ref}>\n\t\t\t\t\t<Modal.Header>\n\t\t\t\t\t\t{view.showIcon ? <Modal.Thumb url={getURL(`/api/apps/${view.appId}/icon`)} /> : null}\n\t\t\t\t\t\t<Modal.Title>{modalParser.text(view.title, BlockContext.NONE, 0)}</Modal.Title>\n\t\t\t\t\t\t<Modal.Close tabIndex={-1} onClick={onClose} />\n\t\t\t\t\t</Modal.Header>\n\t\t\t\t\t<Modal.Content>\n\t\t\t\t\t\t<Box is='form' method='post' action='#' onSubmit={onSubmit}>\n\t\t\t\t\t\t\t<UiKitComponent render={UiKitModal} blocks={view.blocks as LayoutBlock[]} />\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Modal.Content>\n\t\t\t\t\t<Modal.Footer>\n\t\t\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t\t\t{view.close && (\n\t\t\t\t\t\t\t\t<Button danger={view.close.style === 'danger'} onClick={onCancel}>\n\t\t\t\t\t\t\t\t\t{modalParser.text(view.close.text, BlockContext.NONE, 0)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{view.submit && (\n\t\t\t\t\t\t\t\t<Button {...getButtonStyle(view.submit)} onClick={onSubmit}>\n\t\t\t\t\t\t\t\t\t{modalParser.text(view.submit.text, BlockContext.NONE, 1)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Modal.FooterControllers>\n\t\t\t\t\t</Modal.Footer>\n\t\t\t\t</Modal>\n\t\t\t</FocusScope>\n\t\t</AnimatedVisibility>\n\t);\n};\n\nexport default ModalBlock;\n",null],"names":["_extends","Modal","AnimatedVisibility","Button","Box","useUniqueId","UiKitComponent","UiKitModal","modalParser","BlockContext","React","useCallback","useEffect","useMemo","useRef","FocusScope","getURL","getButtonStyle","module","link","default","v","focusableElementsString","isFocusable","element","focus","KeyboardCode","Map","exportDefault","_ref","view","errors","onSubmit","onClose","onCancel","id","concat","ref","current","Object","keys","length","querySelector","previousFocus","document","activeElement","handleKeyDown","event","_event$target","keyCode","get","target","nodeName","stopPropagation","preventDefault","elements","Array","from","querySelectorAll","first","last","pop","contains","shiftKey","container","close","e","ignoreIfNotContains","addEventListener","removeEventListener","createElement","visibility","UNHIDING","contain","restoreFocus","autoFocus","open","Header","showIcon","Thumb","url","appId","Title","text","title","NONE","Close","tabIndex","onClick","Content","is","method","action","render","blocks","Footer","FooterControllers","danger","style","submit"],"mappings":"2BACAA,EAAAC,EAASC,EAAOC,EAAoBC,EAA2CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAtEC,EAAOC,IAAA,CAAA,iCAAuC,CAAAC,QAAAA,CAAAA,EAAApB,EAAwBqB,CAAA,CAAA,EAAA,GAA3CH,EAAWC,IAAE,CAAA,wBAAM,CAAAlB,MAAwBoB,CAAA,EAAApB,EAAAA,CAAA,EAAAC,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAc,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAb,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAZ,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAU,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAT,aAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAV,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,aAAAA,CAAAH,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAF,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,mBAAAA,CAAAD,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAY/E,IAAMK,EAAuB,uVAmCvBC,EAAeC,GACpBA,AAAY,OAAZA,GAAoB,UAAWA,GAAW,AAAyB,YAAzB,OAAOA,EAAQC,KAAK,CAEzDC,EAAe,IAAIC,IAAoB,CAC5C,CAAC,QAAS,GAAG,CACb,CAAC,MAAO,GAAG,CACX,CAAC,MAAO,EAAE,CACV,EAtDDT,EAAOU,aAAS,CAwDGC,IAAkF,GAAjF,CAAEC,KAAAA,CAAI,CAAEC,OAAAA,CAAM,CAAEC,SAAAA,CAAQ,CAAEC,QAAAA,CAAO,CAAEC,SAAAA,CAAAA,CAA4B,CAAAL,EAC5EM,EAAE,YAAAC,MAAA,CAAe/B,KACjBgC,EAAMvB,EAAoB,MAEhCF,EAAU,KACT,GAAKyB,EAAIC,OAAO,EAIhB,GAAIP,GAAUQ,OAAOC,IAAI,CAACT,GAAQU,MAAM,CAAE,CACzC,IAAMjB,EAAUa,EAAIC,OAAO,CAACI,aAAa,CAzCR,+aA0CjClB,OAAAA,GAAAA,EAASC,KAAK,OACR,CACN,IAAMD,EAAUa,EAAIC,OAAO,CAACI,aAAa,CAAcpB,EACvDE,OAAAA,GAAAA,EAASC,KAAK,IAEhB,EAAG,CAACM,EAAO,EAEX,IAAMY,EAAgB9B,EAAQ,IAAM+B,SAASC,aAAa,CAAE,EAAE,EAE9DjC,EACC,IAAM,KACL,GAAI+B,GAAiBpB,EAAYoB,GAChC,OAAOA,EAAclB,KAAK,EAE5B,EACA,CAACkB,EAAc,EAGhB,IAAMG,EAAgBnC,EACpBoC,IAAS,IAAAC,EACT,OAAQD,EAAME,OAAO,EACpB,KAAKvB,EAAawB,GAAG,CAAC,SACrB,GAAI,AAAAH,CAAAA,MAAAA,EAAK,KAAA,EAAA,AAAQ,OAARC,CAAAA,EAALD,EAAOI,MAAM,AAANA,GAAMH,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeI,QAAQ,AAARA,IAAa,WAC/B,OAAOpB,EAASe,GAEjB,MACD,MAAKrB,EAAawB,GAAG,CAAC,OACrBH,EAAMM,eAAe,GACrBN,EAAMO,cAAc,GACpBrB,IACA,MACD,MAAKP,EAAawB,GAAG,CAAC,OACrB,GAAI,CAACb,EAAIC,OAAO,CACf,OAED,IAAMiB,EAAWC,MAAMC,IAAI,CAACpB,EAAIC,OAAO,CAACoB,gBAAgB,CAACpC,IACnD,CAACqC,EAAM,CAAGJ,EACVK,EAAOL,EAASM,GAAG,GAEzB,GAAI,CAACxB,EAAIC,OAAO,CAACwB,QAAQ,CAAClB,SAASC,aAAa,EAC/C,OAAOc,EAAMlC,KAAK,GAGnB,GAAIsB,EAAMgB,QAAQ,CAAE,CACdJ,GAASA,IAAUf,SAASC,aAAa,GAC7Ce,MAAAA,GAAAA,EAAMnC,KAAK,GACXsB,EAAMM,eAAe,GACrBN,EAAMO,cAAc,IAErB,OAGIM,GAAQA,IAAShB,SAASC,aAAa,GAC3Cc,EAAMlC,KAAK,GACXsB,EAAMM,eAAe,GACrBN,EAAMO,cAAc,GACpB,CAEJ,EACA,CAACrB,EAASD,EAAS,EAmCpB,OAhCApB,EAAU,KACT,IAAMY,EAAUoB,SAASF,aAAa,CAAC,eACjCsB,EAAYxC,EAAQkB,aAAa,CAAC,uBAClCuB,EAASC,IACd,GAAIA,EAAEf,MAAM,GAAK3B,EAMjB,OAHA0C,EAAEZ,cAAc,GAChBY,EAAEb,eAAe,GACjBpB,IACO,CAAA,CACR,EAEMkC,EAAuBD,IAC5B,GAAIA,EAAEf,MAAM,GAAK3B,GAIZwC,EAAUF,QAAQ,CAACI,EAAEf,MAAqB,EAG/C,OAAOL,EAAcoB,EACtB,EAIA,OAFAtB,SAASwB,gBAAgB,CAAC,UAAWD,GACrC3C,EAAQ4C,gBAAgB,CAAC,QAASH,GAC3B,KACNrB,SAASyB,mBAAmB,CAAC,UAAWF,GACxC3C,EAAQ6C,mBAAmB,CAAC,QAASJ,EACtC,CACD,EAAG,CAACnB,EAAeb,EAAQ,EAG1BvB,EAAA4D,aAAA,CAACpE,EAAkB,CAACqE,WAAYrE,EAAmBsE,QAAAA,AAAS,EAC3D9D,EAAA4D,aAAA,CAACvD,EAAU,CAAC0D,QAAO,CAAA,EAACC,aAAY,CAAA,EAACC,UAAS,CAAA,CAAA,EACzCjE,EAAA4D,aAAA,CAACrE,EAAK,CAAC2E,KAAI,CAAA,EAACzC,GAAIA,EAAIE,IAAKA,CAAI,EAC5B3B,EAAA4D,aAAA,CAACrE,EAAM4E,MAAM,CAAA,KACX/C,EAAKgD,QAAQ,CAAGpE,EAAA4D,aAAA,CAACrE,EAAM8E,KAAK,CAAA,CAACC,IAAKhE,EAAM,aAAAoB,MAAA,CAAcN,EAAKmD,KAAK,CAAA,SAAS,GAAM,KAChFvE,EAAA4D,aAAA,CAACrE,EAAMiF,KAAK,CAAA,KAAE1E,EAAY2E,IAAI,CAACrD,EAAKsD,KAAK,CAAE3E,EAAa4E,IAAI,CAAE,IAC9D3E,EAAA4D,aAAA,CAACrE,EAAMqF,KAAK,CAAA,CAACC,SAAU,GAAIC,QAASvD,CAAQ,IAE7CvB,EAAA4D,aAAA,CAACrE,EAAMwF,OAAO,CAAA,KACb/E,EAAA4D,aAAA,CAAClE,EAAG,CAACsF,GAAG,OAAOC,OAAO,OAAOC,OAAO,IAAI5D,SAAUA,CAAS,EAC1DtB,EAAA4D,aAAA,CAAChE,EAAc,CAACuF,OAAQtF,EAAYuF,OAAQhE,EAAKgE,MAAAA,AAAwB,KAG3EpF,EAAA4D,aAAA,CAACrE,EAAM8F,MAAM,CAAA,KACZrF,EAAA4D,aAAA,CAACrE,EAAM+F,iBAAiB,CAAA,KACtBlE,EAAKmC,KAAK,EACVvD,EAAA4D,aAAA,CAACnE,EAAM,CAAC8F,OAAQnE,AAAqB,WAArBA,EAAKmC,KAAK,CAACiC,KAAK,CAAeV,QAAStD,CAAS,EAC/D1B,EAAY2E,IAAI,CAACrD,EAAKmC,KAAK,CAACkB,IAAI,CAAE1E,EAAa4E,IAAI,CAAE,IAGvDvD,EAAKqE,MAAM,EACXzF,EAAA4D,aAAA,CAACnE,EAAMH,EAAA,CAAA,EAAKiB,EAAea,EAAKqE,MAAM,EAAC,CAAEX,QAASxD,CAAS,GACzDxB,EAAY2E,IAAI,CAACrD,EAAKqE,MAAM,CAAChB,IAAI,CAAE1E,EAAa4E,IAAI,CAAE,QAShE"}