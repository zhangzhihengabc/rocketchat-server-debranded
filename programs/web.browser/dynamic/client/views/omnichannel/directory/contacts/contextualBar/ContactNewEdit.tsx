function module(e,t,l){let a,n,r,i,o,s,m,u,c,d,h,v,E,k,f,p,g,b,y,C,F,x,w,S,_,T,G;l.link("@babel/runtime/helpers/extends",{default(e){a=e}},0),l.link("@babel/runtime/helpers/objectSpread2",{default(e){n=e}},1),l.link("@rocket.chat/fuselage",{Field(e){r=e},FieldLabel(e){i=e},FieldRow(e){o=e},FieldError(e){s=e},TextInput(e){m=e},ButtonGroup(e){u=e},Button(e){c=e},ContextualbarContent(e){d=e}},0),l.link("@rocket.chat/ui-client",{CustomFieldsForm(e){h=e}},1),l.link("@rocket.chat/ui-contexts",{useToastMessageDispatch(e){v=e},useEndpoint(e){E=e},useTranslation(e){k=e}},2),l.link("@tanstack/react-query",{useQueryClient(e){f=e}},3),l.link("react",{default(e){p=e},useState(e){g=e},useEffect(e){b=e}},4),l.link("react-hook-form",{useForm(e){y=e}},5),l.link("../../../../../../app/authorization/client",{hasAtLeastOnePermission(e){C=e}},6),l.link("../../../../../../lib/emailValidator",{validateEmail(e){F=e}},7),l.link("../../../../../components/Contextualbar",{ContextualbarScrollableContent(e){x=e},ContextualbarFooter(e){w=e}},8),l.link("../../../../../lib/utils/createToken",{createToken(e){S=e}},9),l.link("../../../additionalForms",{ContactManager(e){_=e}},10),l.link("../../components/FormSkeleton",{FormSkeleton(e){T=e}},11),l.link("../../hooks/useCustomFieldsMetadata",{useCustomFieldsMetadata(e){G=e}},12);let M={token:"",name:"",email:"",phone:"",username:"",customFields:{}},D=e=>{var t,l;if(!e)return M;let{name:a,token:n,phone:r,visitorEmails:i,livechatData:o,contactManager:s}=null!==(t=e.contact)&&void 0!==t?t:{};return{token:null!=n?n:"",name:null!=a?a:"",email:i?i[0].address:"",phone:r?r[0].phoneNumber:"",customFields:null!=o?o:{},username:null!==(l=null==s?void 0:s.username)&&void 0!==l?l:""}};l.exportDefault(e=>{var t,l,M,N,P,q;let{id:L,data:V,close:B}=e,I=k(),O=v(),Q=f(),j=()=>C(["view-livechat-room-customfields","edit-livechat-room-customfields"]),[z,A]=g("no-agent-selected"),K=E("POST","/v1/omnichannel/contact"),R=E("GET","/v1/omnichannel/contact.search"),H=E("GET","/v1/users.info"),{data:J=[],isInitialLoading:U}=G({scope:"visitor",enabled:j()}),W=D(V),{username:X}=W,{register:Y,formState:{errors:Z,isValid:$,isDirty:ee,isSubmitting:et},control:el,setValue:ea,handleSubmit:en,setError:er}=y({mode:"onChange",reValidateMode:"onChange",defaultValues:W});b(()=>{X&&H({username:X}).then(e=>{let{user:t}=e;A(t._id)})},[H,X]);let ei=async function(e,t){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(l&&!t||t===W[e])return!0;let{contact:a}=await R({[e]:t});return!a||a._id===L},eo=async e=>{if(A(e),"no-agent-selected"===e){ea("username","",{shouldDirty:!0});return}let{user:t}=await H({userId:e});ea("username",t.username||"",{shouldDirty:!0})},es=async function(){let{phone:e="",email:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=await ei("email",t),a=await ei("phone",e);return l||er("email",{message:I("Email_already_exists")}),a||er("phone",{message:I("Phone_already_exists")}),l&&a},em=async e=>{if(!await es(e))return;let{name:t,phone:l,email:a,customFields:r,username:i,token:o}=e,s=n(n({name:t,phone:l,email:a,customFields:r,token:o||S()},i&&{contactManager:{username:i}}),L&&{_id:L});try{await K(s),O({type:"success",message:I("Saved")}),await Q.invalidateQueries({queryKey:["current-contacts"]}),B()}catch(e){O({type:"error",message:e})}};return U?p.createElement(d,null,p.createElement(T,null)):p.createElement(p.Fragment,null,p.createElement(x,{is:"form",onSubmit:en(em)},p.createElement(r,null,p.createElement(i,null,I("Name"),"*"),p.createElement(o,null,p.createElement(m,a({},Y("name",{validate:e=>!!e.trim()||I("The_field_is_required",I("Name"))}),{error:null===(t=Z.name)||void 0===t?void 0:t.message,flexGrow:1}))),p.createElement(s,null,null===(l=Z.name)||void 0===l?void 0:l.message)),p.createElement(r,null,p.createElement(i,null,I("Email")),p.createElement(o,null,p.createElement(m,a({},Y("email",{validate:e=>!e||e===W.email||!!F(e)||I("error-invalid-email-address")}),{error:null===(M=Z.email)||void 0===M?void 0:M.message,flexGrow:1}))),p.createElement(s,null,null===(N=Z.email)||void 0===N?void 0:N.message)),p.createElement(r,null,p.createElement(i,null,I("Phone")),p.createElement(o,null,p.createElement(m,a({},Y("phone"),{error:null===(P=Z.phone)||void 0===P?void 0:P.message,flexGrow:1}))),p.createElement(s,null,null===(q=Z.phone)||void 0===q?void 0:q.message)),j()&&p.createElement(h,{formName:"customFields",formControl:el,metadata:J}),p.createElement(_,{value:z,handler:eo})),p.createElement(w,null,p.createElement(u,{stretch:!0},p.createElement(c,{flexGrow:1,onClick:B},I("Cancel")),p.createElement(c,{mie:"none",type:"submit",onClick:en(em),flexGrow:1,loading:et,disabled:!$||!ee,primary:!0},I("Save")))))})}
//# sourceMappingURL=/dynamic/client/views/omnichannel/directory/contacts/contextualBar/27584e384b9278f75de081323bf9591133a16f60.map
