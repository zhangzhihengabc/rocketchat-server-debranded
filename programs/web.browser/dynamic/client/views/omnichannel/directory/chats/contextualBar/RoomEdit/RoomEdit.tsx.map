)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/directory/chats/contextualBar/RoomEdit/RoomEdit.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ILivechatVisitor, IOmnichannelRoom, Serialized } from '@rocket.chat/core-typings';\nimport { Field, FieldLabel, FieldRow, TextInput, ButtonGroup, Button } from '@rocket.chat/fuselage';\nimport { CustomFieldsForm } from '@rocket.chat/ui-client';\nimport { useToastMessageDispatch, useTranslation, useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useQueryClient } from '@tanstack/react-query';\nimport React, { useCallback } from 'react';\nimport { useController, useForm } from 'react-hook-form';\n\nimport { hasAtLeastOnePermission } from '../../../../../../../app/authorization/client';\nimport { useOmnichannelPriorities } from '../../../../../../../ee/client/omnichannel/hooks/useOmnichannelPriorities';\nimport { ContextualbarFooter, ContextualbarScrollableContent } from '../../../../../../components/Contextualbar';\nimport Tags from '../../../../../../components/Omnichannel/Tags';\nimport { SlaPoliciesSelect, PrioritiesSelect } from '../../../../additionalForms';\nimport { FormSkeleton } from '../../../components/FormSkeleton';\nimport { useCustomFieldsMetadata } from '../../../hooks/useCustomFieldsMetadata';\nimport { useSlaPolicies } from '../../../hooks/useSlaPolicies';\n\ntype RoomEditProps = {\n\troom: Serialized<IOmnichannelRoom>;\n\tvisitor: Serialized<ILivechatVisitor>;\n\treload?: () => void;\n\treloadInfo?: () => void;\n\tonClose: () => void;\n};\n\nconst ROOM_INTIAL_VALUE = {\n\ttopic: '',\n\ttags: [],\n\tlivechatData: {},\n\tslaId: '',\n};\n\nconst getInitialValuesRoom = (room: Serialized<IOmnichannelRoom>) => {\n\tconst { topic, tags, livechatData, slaId, priorityId } = room ?? ROOM_INTIAL_VALUE;\n\n\treturn {\n\t\ttopic: topic ?? '',\n\t\ttags: tags ?? [],\n\t\tlivechatData: livechatData ?? {},\n\t\tslaId: slaId ?? '',\n\t\tpriorityId: priorityId ?? '',\n\t};\n};\n\nfunction RoomEdit({ room, visitor, reload, reloadInfo, onClose }: RoomEditProps) {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst queryClient = useQueryClient();\n\tconst canViewCustomFields = hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields']);\n\n\tconst saveRoom = useEndpoint('POST', '/v1/livechat/room.saveInfo');\n\n\tconst { data: slaPolicies, isInitialLoading: isSlaPoliciesLoading } = useSlaPolicies();\n\tconst { data: customFieldsMetadata, isInitialLoading: isCustomFieldsLoading } = useCustomFieldsMetadata({\n\t\tscope: 'room',\n\t\tenabled: canViewCustomFields,\n\t});\n\tconst { data: priorities, isLoading: isPrioritiesLoading } = useOmnichannelPriorities();\n\n\tconst {\n\t\tregister,\n\t\tcontrol,\n\t\tformState: { isDirty: isFormDirty, isValid: isFormValid, isSubmitting },\n\t\thandleSubmit,\n\t} = useForm({\n\t\tmode: 'onChange',\n\t\tdefaultValues: getInitialValuesRoom(room),\n\t});\n\n\tconst { field: tagsField } = useController({ control, name: 'tags' });\n\tconst { field: slaIdField } = useController({ control, name: 'slaId' });\n\tconst { field: priorityIdField } = useController({ control, name: 'priorityId' });\n\n\tconst handleSave = useCallback(\n\t\tasync (data) => {\n\t\t\tif (!isFormValid) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { topic, tags, livechatData, slaId, priorityId } = data;\n\n\t\t\tconst guestData = {\n\t\t\t\t_id: visitor._id,\n\t\t\t};\n\n\t\t\tconst roomData = {\n\t\t\t\t_id: room._id,\n\t\t\t\ttopic,\n\t\t\t\ttags: tags.sort(),\n\t\t\t\tlivechatData,\n\t\t\t\tpriorityId,\n\t\t\t\t...(slaId && { slaId }),\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tawait saveRoom({ guestData, roomData });\n\t\t\t\tawait queryClient.invalidateQueries(['/v1/rooms.info', room._id]);\n\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\t\treload?.();\n\t\t\t\treloadInfo?.();\n\t\t\t\tonClose();\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t},\n\t\t[dispatchToastMessage, isFormValid, onClose, queryClient, reload, reloadInfo, room._id, saveRoom, t, visitor._id],\n\t);\n\n\tif (isCustomFieldsLoading || isSlaPoliciesLoading || isPrioritiesLoading) {\n\t\treturn (\n\t\t\t<ContextualbarScrollableContent>\n\t\t\t\t<FormSkeleton />\n\t\t\t</ContextualbarScrollableContent>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent is='form' onSubmit={handleSubmit(handleSave)}>\n\t\t\t\t{canViewCustomFields && customFieldsMetadata && (\n\t\t\t\t\t<CustomFieldsForm formName='livechatData' formControl={control} metadata={customFieldsMetadata} />\n\t\t\t\t)}\n\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Topic')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput {...register('topic')} flexGrow={1} />\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\n\t\t\t\t<Field>\n\t\t\t\t\t<Tags tags={tagsField.value} handler={tagsField.onChange} department={room.departmentId} />\n\t\t\t\t</Field>\n\n\t\t\t\t{SlaPoliciesSelect && !!slaPolicies?.length && (\n\t\t\t\t\t<SlaPoliciesSelect label={t('SLA_Policy')} value={slaIdField.value} options={slaPolicies} onChange={slaIdField.onChange} />\n\t\t\t\t)}\n\n\t\t\t\t{PrioritiesSelect && !!priorities?.length && (\n\t\t\t\t\t<PrioritiesSelect label={t('Priority')} value={priorityIdField.value} options={priorities} onChange={priorityIdField.onChange} />\n\t\t\t\t)}\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button flexGrow={1} onClick={onClose}>\n\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t<Button\n\t\t\t\t\t\tmie='none'\n\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\tonClick={handleSubmit(handleSave)}\n\t\t\t\t\t\tloading={isSubmitting}\n\t\t\t\t\t\tdisabled={!isFormValid || !isFormDirty}\n\t\t\t\t\t\tprimary\n\t\t\t\t\t>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n}\n\nexport default RoomEdit;\n",null],"names":["_extends","_objectSpread","Field","FieldLabel","FieldRow","TextInput","ButtonGroup","Button","CustomFieldsForm","useToastMessageDispatch","useTranslation","useEndpoint","useQueryClient","React","useCallback","useController","useForm","hasAtLeastOnePermission","useOmnichannelPriorities","ContextualbarFooter","ContextualbarScrollableContent","Tags","SlaPoliciesSelect","PrioritiesSelect","FormSkeleton","useCustomFieldsMetadata","useSlaPolicies","module","link","default","v","ROOM_INTIAL_VALUE","topic","tags","livechatData","slaId","getInitialValuesRoom","room","priorityId","exportDefault","_ref","visitor","reload","reloadInfo","onClose","t","dispatchToastMessage","queryClient","canViewCustomFields","saveRoom","data","slaPolicies","isInitialLoading","isSlaPoliciesLoading","customFieldsMetadata","isCustomFieldsLoading","scope","enabled","priorities","isLoading","isPrioritiesLoading","register","control","formState","isDirty","isFormDirty","isValid","isFormValid","isSubmitting","handleSubmit","mode","defaultValues","field","tagsField","name","slaIdField","priorityIdField","handleSave","guestData","_id","roomData","sort","invalidateQueries","type","message","error","createElement","Fragment","is","onSubmit","formName","formControl","metadata","flexGrow","value","handler","onChange","department","departmentId","length","label","options","stretch","onClick","mie","loading","disabled","primary"],"mappings":"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"}