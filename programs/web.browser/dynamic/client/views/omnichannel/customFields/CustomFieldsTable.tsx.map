)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/customFields/CustomFieldsTable.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Pagination } from '@rocket.chat/fuselage';\nimport { useDebouncedValue, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useEndpoint, useRouter } from '@rocket.chat/ui-contexts';\nimport { useQuery, hashQueryKey } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport React, { useMemo, useState, useEffect } from 'react';\n\nimport FilterByText from '../../../components/FilterByText';\nimport GenericNoResults from '../../../components/GenericNoResults';\nimport {\n\tGenericTable,\n\tGenericTableHeader,\n\tGenericTableHeaderCell,\n\tGenericTableRow,\n\tGenericTableCell,\n\tGenericTableBody,\n\tGenericTableLoadingTable,\n} from '../../../components/GenericTable';\nimport { usePagination } from '../../../components/GenericTable/hooks/usePagination';\nimport { useSort } from '../../../components/GenericTable/hooks/useSort';\nimport RemoveCustomFieldButton from './RemoveCustomFieldButton';\n\nconst CustomFieldsTable = ({ reload }: { reload: MutableRefObject<() => void> }) => {\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\tconst [filter, setFilter] = useState('');\n\tconst debouncedFilter = useDebouncedValue(filter, 500);\n\n\tconst { current, itemsPerPage, setItemsPerPage: onSetItemsPerPage, setCurrent: onSetCurrent, ...paginationProps } = usePagination();\n\tconst { sortBy, sortDirection, setSort } = useSort<'_id' | 'label' | 'scope' | 'visibility'>('_id');\n\n\tconst handleAddNew = useMutableCallback(() => router.navigate('/omnichannel/customfields/new'));\n\tconst onRowClick = useMutableCallback((id) => () => router.navigate(`/omnichannel/customfields/edit/${id}`));\n\n\tconst query = useMemo(\n\t\t() => ({\n\t\t\ttext: debouncedFilter,\n\t\t\tsort: `{ \"${sortBy}\": ${sortDirection === 'asc' ? 1 : -1} }`,\n\t\t\t...(itemsPerPage && { count: itemsPerPage }),\n\t\t\t...(current && { offset: current }),\n\t\t}),\n\t\t[debouncedFilter, itemsPerPage, current, sortBy, sortDirection],\n\t);\n\n\tconst getCustomFields = useEndpoint('GET', '/v1/livechat/custom-fields');\n\tconst { data, isSuccess, isLoading, refetch } = useQuery(['livechat-customFields', query, debouncedFilter], async () =>\n\t\tgetCustomFields(query),\n\t);\n\n\tconst [defaultQuery] = useState(hashQueryKey([query]));\n\tconst queryHasChanged = defaultQuery !== hashQueryKey([query]);\n\n\tuseEffect(() => {\n\t\treload.current = refetch;\n\t}, [reload, refetch]);\n\treload.current = refetch;\n\n\tconst headers = (\n\t\t<>\n\t\t\t<GenericTableHeaderCell key='field' direction={sortDirection} active={sortBy === '_id'} onClick={setSort} sort='_id'>\n\t\t\t\t{t('Field')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell key='label' direction={sortDirection} active={sortBy === 'label'} onClick={setSort} sort='label'>\n\t\t\t\t{t('Label')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell key='scope' direction={sortDirection} active={sortBy === 'scope'} onClick={setSort} sort='scope'>\n\t\t\t\t{t('Scope')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tkey='visibility'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'visibility'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='visibility'\n\t\t\t>\n\t\t\t\t{t('Visibility')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell key='remove' w='x60'>\n\t\t\t\t{t('Remove')}\n\t\t\t</GenericTableHeaderCell>\n\t\t</>\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{((isSuccess && data?.customFields.length > 0) || queryHasChanged) && <FilterByText onChange={({ text }) => setFilter(text)} />}\n\t\t\t{isLoading && (\n\t\t\t\t<GenericTable>\n\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t<GenericTableLoadingTable headerCells={5} />\n\t\t\t\t\t</GenericTableBody>\n\t\t\t\t</GenericTable>\n\t\t\t)}\n\t\t\t{isSuccess && data.customFields.length === 0 && queryHasChanged && <GenericNoResults />}\n\t\t\t{isSuccess && data.customFields.length === 0 && !queryHasChanged && (\n\t\t\t\t<GenericNoResults\n\t\t\t\t\ticon='file-sheets'\n\t\t\t\t\ttitle={t('No_custom_fields_yet')}\n\t\t\t\t\tdescription={t('No_custom_fields_yet_description')}\n\t\t\t\t\tbuttonAction={handleAddNew}\n\t\t\t\t\tbuttonTitle={t('Create_custom_field')}\n\t\t\t\t\tlinkHref='https://go.rocket.chat/omnichannel-docs'\n\t\t\t\t\tlinkText={t('Learn_more_about_custom_fields')}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{isSuccess && data.customFields.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t<GenericTable data-qa='GenericTableCustomFieldsInfoBody' aria-busy={filter !== debouncedFilter} aria-live='assertive'>\n\t\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t\t{data.customFields.map(({ label, _id, scope, visibility }) => (\n\t\t\t\t\t\t\t\t<GenericTableRow key={_id} tabIndex={0} role='link' onClick={onRowClick(_id)} action qa-user-id={_id}>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{_id}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{label}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{scope === 'visitor' ? t('Visitor') : t('Room')}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{visibility === 'visible' ? t('Visible') : t('Hidden')}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<RemoveCustomFieldButton _id={_id} reload={refetch} />\n\t\t\t\t\t\t\t\t</GenericTableRow>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</GenericTableBody>\n\t\t\t\t\t</GenericTable>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tdivider\n\t\t\t\t\t\tcurrent={current}\n\t\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\t\tcount={data.total || 0}\n\t\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t\t\t{...paginationProps}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</>\n\t);\n};\n\nexport default CustomFieldsTable;\n",null],"names":["_extends","_objectSpread","_objectWithoutProperties","Pagination","useDebouncedValue","useMutableCallback","useTranslation","useEndpoint","useRouter","useQuery","hashQueryKey","React","useMemo","useState","useEffect","FilterByText","GenericNoResults","GenericTable","GenericTableHeader","GenericTableHeaderCell","GenericTableRow","GenericTableCell","GenericTableBody","GenericTableLoadingTable","usePagination","useSort","RemoveCustomFieldButton","module","link","default","exportDefault","_ref","reload","t","router","filter","setFilter","debouncedFilter","_usePagination","current","itemsPerPage","setItemsPerPage","onSetItemsPerPage","setCurrent","onSetCurrent","paginationProps","_excluded","sortBy","sortDirection","setSort","handleAddNew","navigate","onRowClick","id","concat","query","text","sort","count","offset","getCustomFields","data","isSuccess","isLoading","refetch","defaultQuery","queryHasChanged","headers","createElement","Fragment","key","direction","active","onClick","w","customFields","length","onChange","_ref2","headerCells","icon","title","description","buttonAction","buttonTitle","linkHref","linkText","map","_ref3","label","_id","scope","visibility","tabIndex","role","action","withTruncatedText","divider","total"],"mappings":"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"}