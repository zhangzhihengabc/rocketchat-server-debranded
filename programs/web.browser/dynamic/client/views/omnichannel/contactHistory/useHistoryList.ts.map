)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/contactHistory/useHistoryList.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { VisitorSearchChatsResult } from '@rocket.chat/rest-typings';\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useCallback, useState } from 'react';\n\nimport { useScrollableRecordList } from '../../../hooks/lists/useScrollableRecordList';\nimport { useComponentDidUpdate } from '../../../hooks/useComponentDidUpdate';\nimport { RecordList } from '../../../lib/lists/RecordList';\nimport { mapMessageFromApi } from '../../../lib/utils/mapMessageFromApi';\n\ntype HistoryListOptions = {\n\tfilter: string;\n\troomId: string;\n\tvisitorId: string;\n};\n\nexport const useHistoryList = (\n\toptions: HistoryListOptions,\n): {\n\titemsList: RecordList<VisitorSearchChatsResult & { _updatedAt: Date }>;\n\tinitialItemCount: number;\n\tloadMoreItems: (start: number, end: number) => void;\n} => {\n\tconst [itemsList, setItemsList] = useState(() => new RecordList<VisitorSearchChatsResult & { _updatedAt: Date }>());\n\tconst reload = useCallback(() => setItemsList(new RecordList<VisitorSearchChatsResult & { _updatedAt: Date }>()), []);\n\n\tconst getHistory = useEndpoint('GET', '/v1/livechat/visitors.searchChats/room/:roomId/visitor/:visitorId', {\n\t\troomId: options.roomId,\n\t\tvisitorId: options.visitorId,\n\t});\n\n\tuseComponentDidUpdate(() => {\n\t\toptions && reload();\n\t}, [options, reload]);\n\n\tconst fetchData = useCallback(\n\t\tasync (start, end) => {\n\t\t\tconst { history, total } = await getHistory({\n\t\t\t\t...(options.filter && { searchText: options.filter }),\n\t\t\t\tclosedChatsOnly: 'true',\n\t\t\t\tservedChatsOnly: 'true',\n\t\t\t\toffset: start,\n\t\t\t\tcount: end + start,\n\t\t\t});\n\t\t\treturn {\n\t\t\t\titems: history.map((history) => ({\n\t\t\t\t\t...history,\n\t\t\t\t\tts: new Date(history.ts),\n\t\t\t\t\t_updatedAt: new Date(history.ts),\n\t\t\t\t\tclosedAt: history.closedAt ? new Date(history.closedAt) : undefined,\n\t\t\t\t\tservedBy: history.servedBy ? { ...history.servedBy, ts: new Date(history.servedBy.ts) } : undefined,\n\t\t\t\t\tclosingMessage: history.closingMessage ? mapMessageFromApi(history.closingMessage) : undefined,\n\t\t\t\t})),\n\t\t\t\titemCount: total,\n\t\t\t};\n\t\t},\n\t\t[getHistory, options],\n\t);\n\n\tconst { loadMoreItems, initialItemCount } = useScrollableRecordList(itemsList, fetchData, 25);\n\n\treturn {\n\t\titemsList,\n\t\tloadMoreItems,\n\t\tinitialItemCount,\n\t};\n};\n",null],"names":["_objectSpread","useEndpoint","useCallback","useState","useScrollableRecordList","useComponentDidUpdate","RecordList","mapMessageFromApi","module","link","default","export","useHistoryList","options","itemsList","setItemsList","reload","getHistory","roomId","visitorId","fetchData","start","end","history","total","filter","searchText","closedChatsOnly","servedChatsOnly","offset","count","items","map","ts","Date","_updatedAt","closedAt","undefined","servedBy","closingMessage","itemCount","loadMoreItems","initialItemCount"],"mappings":"2BACAA,EAAuDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9CC,EAAaC,IAAM,CAAA,uCAA2B,CAAAC,QAAAA,CAAAA,EAAAV,EAAAA,CAAA,CAAA,EAAA,GAAvDQ,EAAOG,MAAE,CAAA,CAAAC,eAAmB,IAAAA,CAAA,GAA2BJ,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAP,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,QAAAA,CAAAN,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,+CAAAA,CAAAJ,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAH,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAF,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAD,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAchD,IAAMK,EACZC,IAMA,GAAM,CAACC,EAAWC,EAAa,CAAGZ,EAAS,IAAM,IAAIG,GAC/CU,EAASd,EAAY,IAAMa,EAAa,IAAIT,GAAgE,EAAE,EAE9GW,EAAahB,EAAY,MAAO,oEAAqE,CAC1GiB,OAAQL,EAAQK,MAAM,CACtBC,UAAWN,EAAQM,SAAAA,GAGpBd,EAAsB,KACrBQ,GAAWG,GACZ,EAAG,CAACH,EAASG,EAAO,EAEpB,IAAMI,EAAYlB,EACjB,MAAOmB,EAAOC,KACb,GAAM,CAAEC,QAAAA,CAAO,CAAEC,MAAAA,CAAAA,CAAO,CAAG,MAAMP,EAAUjB,EAAAA,EAAA,CAAA,EACtCa,EAAQY,MAAM,EAAI,CAAEC,WAAYb,EAAQY,MAAAA,AAAM,GAAE,CAAA,EAAA,CACpDE,gBAAiB,OACjBC,gBAAiB,OACjBC,OAAQR,EACRS,MAAOR,EAAMD,CAAK,IAEnB,MAAO,CACNU,MAAOR,EAAQS,GAAG,CAAET,GAAOvB,EAAAA,EAAA,CAAA,EACvBuB,GAAO,CAAA,EAAA,CACVU,GAAI,IAAIC,KAAKX,EAAQU,EAAE,EACvBE,WAAY,IAAID,KAAKX,EAAQU,EAAE,EAC/BG,SAAUb,EAAQa,QAAQ,CAAG,IAAIF,KAAKX,EAAQa,QAAQ,EAAIC,KAAAA,EAC1DC,SAAUf,EAAQe,QAAQ,CAAAtC,EAAAA,EAAA,CAAA,EAAQuB,EAAQe,QAAQ,EAAA,CAAA,EAAA,CAAEL,GAAI,IAAIC,KAAKX,EAAQe,QAAQ,CAACL,EAAE,CAAC,GAAKI,KAAAA,EAC1FE,eAAgBhB,EAAQgB,cAAc,CAAGhC,EAAkBgB,EAAQgB,cAAc,EAAIF,KAAAA,CAAS,IAE/FG,UAAWhB,EAEb,EACA,CAACP,EAAYJ,EAAQ,EAGhB,CAAE4B,cAAAA,CAAa,CAAEC,iBAAAA,CAAAA,CAAkB,CAAGtC,EAAwBU,EAAWM,EAAW,IAE1F,MAAO,CACNN,UAAAA,EACA2B,cAAAA,EACAC,iBAAAA,EAEF"}