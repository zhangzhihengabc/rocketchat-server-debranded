)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/analytics/InterchangeableChart.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { Chart as ChartType, TooltipItem } from 'chart.js';\nimport React, { useRef, useEffect } from 'react';\n\nimport { drawLineChart } from '../../../../app/livechat/client/lib/chartHandler';\nimport { secondsToHHMMSS } from '../../../../lib/utils/secondsToHHMMSS';\nimport Chart from '../realTimeMonitoring/charts/Chart';\n\nconst getChartTooltips = (chartName: string) => {\n\tswitch (chartName) {\n\t\tcase 'Avg_chat_duration':\n\t\tcase 'Avg_first_response_time':\n\t\tcase 'Best_first_response_time':\n\t\tcase 'Avg_response_time':\n\t\tcase 'Avg_reaction_time':\n\t\t\treturn {\n\t\t\t\tcallbacks: {\n\t\t\t\t\ttitle([ctx]: TooltipItem<'line'>[]) {\n\t\t\t\t\t\tconst { dataset } = ctx;\n\t\t\t\t\t\treturn dataset.label;\n\t\t\t\t\t},\n\t\t\t\t\tlabel(ctx: TooltipItem<'line'>) {\n\t\t\t\t\t\tconst { dataset, dataIndex } = ctx;\n\t\t\t\t\t\tconst item = dataset.data[dataIndex];\n\t\t\t\t\t\treturn secondsToHHMMSS(typeof item === 'number' ? item : 0);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {};\n\t}\n};\n\nconst InterchangeableChart = ({\n\tdepartmentId,\n\tdateRange,\n\tchartName,\n\t...props\n}: {\n\tdepartmentId: string;\n\tdateRange: { start: string; end: string };\n\tchartName: string;\n\tflexShrink: number;\n\th: string;\n\tw: string;\n\talignSelf: string;\n}) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst canvas = useRef<HTMLCanvasElement | null>(null);\n\tconst context = useRef<ChartType<'line', number, string> | void>();\n\n\tconst { start, end } = dateRange;\n\n\tconst loadData = useMethod('livechat:getAnalyticsChartData');\n\n\tconst draw = useMutableCallback(async (params) => {\n\t\ttry {\n\t\t\tconst tooltipCallbacks = getChartTooltips(chartName);\n\t\t\tif (!params?.daterange?.from || !params?.daterange?.to) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst result = await loadData(params);\n\t\t\tif (!result?.chartLabel || !result?.dataLabels || !result?.dataPoints) {\n\t\t\t\tthrow new Error('Error! fetching chart data. Details: livechat:getAnalyticsChartData => Missing Data');\n\t\t\t}\n\t\t\t(context.current || typeof context.current === 'undefined') &&\n\t\t\t\tcanvas.current &&\n\t\t\t\t(context.current = await drawLineChart(\n\t\t\t\t\tcanvas.current,\n\t\t\t\t\tcontext.current,\n\t\t\t\t\t[result.chartLabel],\n\t\t\t\t\tresult.dataLabels,\n\t\t\t\t\t[result.dataPoints as unknown as number], // TODO fix this\n\t\t\t\t\t{\n\t\t\t\t\t\ttooltipCallbacks,\n\t\t\t\t\t},\n\t\t\t\t));\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tuseEffect(() => {\n\t\tdraw({\n\t\t\tdaterange: {\n\t\t\t\tfrom: start,\n\t\t\t\tto: end,\n\t\t\t},\n\t\t\tchartOptions: { name: chartName },\n\t\t\t...(departmentId && { departmentId }),\n\t\t});\n\t}, [chartName, departmentId, draw, end, start, t, loadData]);\n\n\treturn <Chart ref={canvas} {...props} />;\n};\n\nexport default InterchangeableChart;\n",null],"names":["_extends","_objectSpread","_objectWithoutProperties","useMutableCallback","useToastMessageDispatch","useMethod","useTranslation","React","useRef","useEffect","drawLineChart","secondsToHHMMSS","Chart","module","default","v","link","getChartTooltips","chartName","callbacks","title","_ref","ctx","dataset","label","dataIndex","item","data","exportDefault","_ref2","departmentId","dateRange","props","_excluded","t","dispatchToastMessage","canvas","context","start","end","loadData","draw","params","_params$daterange","_params$daterange2","tooltipCallbacks","daterange","from","to","result","chartLabel","dataLabels","dataPoints","Error","current","error","type","message","chartOptions","name","createElement","ref"],"mappings":"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"}