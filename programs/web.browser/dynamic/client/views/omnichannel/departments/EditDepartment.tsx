function module(e,t,l){let n,a,r,o,i,s,m,u,d,c,g,E,h,f,p,v,_,b,w,C,T,x,D,k,q,S,I,M,y,F,L,R,O,N,A,B,G,H,P,Q,W,V,z;function U(e,t){return e||t}l.link("@babel/runtime/helpers/extends",{default(e){n=e}},0),l.link("@rocket.chat/fuselage",{FieldGroup(e){a=e},Field(e){r=e},FieldLabel(e){o=e},FieldRow(e){i=e},FieldError(e){s=e},TextInput(e){m=e},Box(e){u=e},Icon(e){d=e},Divider(e){c=e},ToggleSwitch(e){g=e},TextAreaInput(e){E=e},ButtonGroup(e){h=e},Button(e){f=e},PaginatedSelectFiltered(e){p=e}},0),l.link("@rocket.chat/fuselage-hooks",{useDebouncedValue(e){v=e},useMutableCallback(e){_=e},useUniqueId(e){b=e}},1),l.link("@rocket.chat/ui-contexts",{useToastMessageDispatch(e){w=e},useRoute(e){C=e},useMethod(e){T=e},useEndpoint(e){x=e},useTranslation(e){D=e}},2),l.link("@tanstack/react-query",{useQueryClient(e){k=e}},3),l.link("react",{default(e){q=e},useMemo(e){S=e},useState(e){I=e}},4),l.link("react-hook-form",{Controller(e){M=e},useForm(e){y=e}},5),l.link("../../../../ee/client/hooks/useHasLicenseModule",{useHasLicenseModule(e){F=e}},6),l.link("../../../../lib/emailValidator",{validateEmail(e){L=e}},7),l.link("../../../components/AutoCompleteDepartment",{default(e){R=e}},8),l.link("../../../components/Page",{default(e){O=e}},9),l.link("../../../hooks/lists/useRecordList",{useRecordList(e){N=e}},10),l.link("../../../hooks/useRoomsList",{useRoomsList(e){A=e}},11),l.link("../../../lib/asyncState",{AsyncStatePhase(e){B=e}},12),l.link("../additionalForms",{EeTextInput(e){G=e},EeTextAreaInput(e){H=e},EeNumberInput(e){P=e},DepartmentForwarding(e){Q=e},DepartmentBusinessHours(e){W=e}},13),l.link("./DepartmentAgentsTable/DepartmentAgentsTable",{default(e){V=e}},14),l.link("./DepartmentTags",{DepartmentTags(e){z=e}},15);let j=e=>{var t,l;let{department:n,agents:a,allowedToForwardData:r}=e;return{name:(null==n?void 0:n.name)||"",email:(null==n?void 0:n.email)||"",description:(null==n?void 0:n.description)||"",enabled:!!(null!=n&&n.enabled),maxNumberSimultaneousChat:null==n?void 0:n.maxNumberSimultaneousChat,showOnRegistration:!!(null!=n&&n.showOnRegistration),showOnOfflineForm:!!(null!=n&&n.showOnOfflineForm),abandonedRoomsCloseCustomMessage:(null==n?void 0:n.abandonedRoomsCloseCustomMessage)||"",requestTagBeforeClosingChat:!!(null!=n&&n.requestTagBeforeClosingChat),offlineMessageChannelName:(null==n?void 0:n.offlineMessageChannelName)||"",visitorInactivityTimeoutInSeconds:null==n?void 0:n.visitorInactivityTimeoutInSeconds,waitingQueueMessage:(null==n?void 0:n.waitingQueueMessage)||"",departmentsAllowedToForward:(null==r?void 0:null===(t=r.departments)||void 0===t?void 0:t.map(e=>({label:e.name,value:e._id})))||[],fallbackForwardDepartment:(null==n?void 0:n.fallbackForwardDepartment)||"",chatClosingTags:null!==(l=null==n?void 0:n.chatClosingTags)&&void 0!==l?l:[],agentList:a||[]}};l.exportDefault(function(e){var t,l,U,J,K;let{data:X,id:Y,title:Z,allowedToForwardData:$}=e,ee=D(),et=C("omnichannel-departments"),el=k(),{department:en,agents:ea=[]}=X||{},er=F("livechat-enterprise"),eo=j({department:en,agents:ea,allowedToForwardData:$}),{register:ei,control:es,handleSubmit:em,watch:eu,formState:{errors:ed,isValid:ec,isDirty:eg,isSubmitting:eE}}=y({mode:"onChange",defaultValues:eo}),eh=eu("requestTagBeforeClosingChat"),[ef,ep]=I(""),ev=v(ef,500),{itemsList:e_,loadMoreItems:eb}=A(S(()=>({text:ev}),[ev])),{phase:ew,items:eC,itemCount:eT}=N(e_),ex=T("livechat:saveDepartment"),eD=x("POST","/v1/livechat/department/:_id/agents",{_id:Y||""}),ek=w(),eq=_(async e=>{let{agentList:t,enabled:l,name:n,description:a,showOnRegistration:r,showOnOfflineForm:o,email:i,chatClosingTags:s,offlineMessageChannelName:m,maxNumberSimultaneousChat:u,visitorInactivityTimeoutInSeconds:d,abandonedRoomsCloseCustomMessage:c,waitingQueueMessage:g,departmentsAllowedToForward:E,fallbackForwardDepartment:h}=e,f={enabled:l,name:n,description:a,showOnRegistration:r,showOnOfflineForm:o,requestTagBeforeClosingChat:eh,email:i,chatClosingTags:s,offlineMessageChannelName:m,maxNumberSimultaneousChat:u,visitorInactivityTimeoutInSeconds:d,abandonedRoomsCloseCustomMessage:c,waitingQueueMessage:g,departmentsAllowedToForward:null==E?void 0:E.map(e=>e.value),fallbackForwardDepartment:h};try{if(Y){let{agentList:e}=eo,l={upsert:t.filter(t=>!e.some(e=>e._id===t._id&&t.count===e.count&&t.order===e.order)),remove:e.filter(e=>!t.some(t=>e._id===t._id))};await ex(Y,f,[]),(l.upsert.length>0||l.remove.length>0)&&await eD(l)}else await ex(null!=Y?Y:null,f,t);el.invalidateQueries(["/v1/livechat/department/:_id",Y]),ek({type:"success",message:ee("Saved")}),et.push({})}catch(e){ek({type:"error",message:e})}}),eS=_(()=>{et.push({})}),eI=b();return q.createElement(O,{flexDirection:"row"},q.createElement(O,null,q.createElement(O.Header,{title:Z},q.createElement(h,null,q.createElement(f,{icon:"back",onClick:eS},ee("Back")),q.createElement(f,{type:"submit",form:eI,primary:!0,disabled:!(ec&&eg),loading:eE},ee("Save")))),q.createElement(O.ScrollableContentWithShadow,null,q.createElement(a,{w:"full",alignSelf:"center",maxWidth:"x600",id:eI,is:"form",autoComplete:"off",onSubmit:em(eq)},q.createElement(r,null,q.createElement(u,{display:"flex","data-qa":"DepartmentEditToggle-Enabled",flexDirection:"row"},q.createElement(o,null,ee("Enabled")),q.createElement(i,null,q.createElement(g,n({flexGrow:1},ei("enabled")))))),q.createElement(r,null,q.createElement(o,null,ee("Name"),"*"),q.createElement(i,null,q.createElement(m,n({"data-qa":"DepartmentEditTextInput-Name",flexGrow:1,error:null===(t=ed.name)||void 0===t?void 0:t.message,placeholder:ee("Name")},ei("name",{required:ee("The_field_is_required","name")})))),ed.name&&q.createElement(s,null,null===(l=ed.name)||void 0===l?void 0:l.message)),q.createElement(r,null,q.createElement(o,null,ee("Description")),q.createElement(i,null,q.createElement(E,n({"data-qa":"DepartmentEditTextInput-Description",flexGrow:1,placeholder:ee("Description")},ei("description"))))),q.createElement(r,null,q.createElement(u,{"data-qa":"DepartmentEditToggle-ShowOnRegistrationPage",display:"flex",flexDirection:"row"},q.createElement(o,null,ee("Show_on_registration_page")),q.createElement(i,null,q.createElement(g,n({flexGrow:1},ei("showOnRegistration")))))),q.createElement(r,null,q.createElement(o,null,ee("Email"),"*"),q.createElement(i,null,q.createElement(m,n({"data-qa":"DepartmentEditTextInput-Email",flexGrow:1,error:null===(U=ed.email)||void 0===U?void 0:U.message,addon:q.createElement(d,{name:"mail",size:"x20"}),placeholder:ee("Email")},ei("email",{required:ee("The_field_is_required","email"),validate:e=>L(e)||ee("error-invalid-email-address")})))),ed.email&&q.createElement(s,null,null===(J=ed.email)||void 0===J?void 0:J.message)),q.createElement(r,null,q.createElement(u,{display:"flex","data-qa":"DepartmentEditToggle-ShowOnOfflinePage",flexDirection:"row"},q.createElement(o,null,ee("Show_on_offline_page")),q.createElement(i,null,q.createElement(g,n({flexGrow:1},ei("showOnOfflineForm")))))),q.createElement(r,null,q.createElement(o,null,ee("Livechat_DepartmentOfflineMessageToChannel")),q.createElement(i,null,q.createElement(M,{control:es,name:"offlineMessageChannelName",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(p,{"data-qa":"DepartmentSelect-LivechatDepartmentOfflineMessageToChannel",value:t,onChange:l,flexShrink:0,filter:ef,setFilter:ep,options:eC,placeholder:ee("Channel_name"),endReached:ew===B.LOADING?()=>void 0:e=>eb(e,Math.min(50,eT)),"aria-busy":ef!==ev})}}))),q.createElement(r,null,q.createElement(M,{control:es,name:"maxNumberSimultaneousChat",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(P,{value:t,handler:l,label:"Max_number_of_chats_per_agent",placeholder:"Max_number_of_chats_per_agent_description"})}})),q.createElement(r,null,q.createElement(M,{control:es,name:"visitorInactivityTimeoutInSeconds",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(P,{value:t,handler:l,label:"How_long_to_wait_to_consider_visitor_abandonment_in_seconds",placeholder:"Number_in_seconds"})}})),q.createElement(r,null,q.createElement(M,{control:es,name:"abandonedRoomsCloseCustomMessage",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(G,{value:t,handler:l,label:"Livechat_abandoned_rooms_closed_custom_message",placeholder:"Enter_a_custom_message"})}})),q.createElement(r,null,q.createElement(M,{control:es,name:"waitingQueueMessage",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(H,{value:t,handler:l,label:"Waiting_queue_message",placeholder:"Waiting_queue_message"})}})),Q&&q.createElement(r,null,q.createElement(M,{control:es,name:"departmentsAllowedToForward",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(Q,{departmentId:null!=Y?Y:"",value:t,handler:l,label:"List_of_departments_for_forward"})}})),er&&q.createElement(r,null,q.createElement(o,null,ee("Fallback_forward_department")),q.createElement(M,{control:es,name:"fallbackForwardDepartment",render:e=>{let{field:{value:t,onChange:l}}=e;return q.createElement(R,{haveNone:!0,excludeDepartmentId:null==en?void 0:en._id,value:t,onChange:l,onlyMyDepartments:!0,showArchived:!0})}})),q.createElement(r,null,q.createElement(u,{display:"flex","data-qa":"DiscussionToggle-RequestTagBeforeCLosingChat",flexDirection:"row"},q.createElement(o,null,ee("Request_tag_before_closing_chat")),q.createElement(i,null,q.createElement(g,n({"data-qa":"DiscussionToggle-RequestTagBeforeCLosingChat",flexGrow:1},ei("requestTagBeforeClosingChat")))))),eh&&q.createElement(r,null,q.createElement(o,{alignSelf:"stretch"},ee("Conversation_closing_tags"),"*"),q.createElement(M,{control:es,name:"chatClosingTags",rules:{required:ee("The_field_is_required","tags")},render:e=>{var t;let{field:{value:l,onChange:n}}=e;return q.createElement(z,{value:l,onChange:n,error:null===(t=ed.chatClosingTags)||void 0===t?void 0:t.message})}}),ed.chatClosingTags&&q.createElement(s,null,null===(K=ed.chatClosingTags)||void 0===K?void 0:K.message)),q.createElement(r,null,q.createElement(W,{bhId:null==en?void 0:en.businessHourId})),q.createElement(c,{mb:16}),q.createElement(r,null,q.createElement(o,{mb:4},ee("Agents"),":"),q.createElement(u,{display:"flex",flexDirection:"column",height:"50vh"},q.createElement(V,{control:es,register:ei})))))))})}
//# sourceMappingURL=/dynamic/client/views/omnichannel/departments/b0587fcd70f064f242ea92ab08dc8eab4c754ce4.map
