)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/setupWizard/steps/RegisterServerStep.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { RegisterServerPage, RegisterOfflinePage } from '@rocket.chat/onboarding-ui';\nimport { useEndpoint, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport type { ReactElement, ComponentProps } from 'react';\nimport React, { useState } from 'react';\n\nimport { useInvalidateLicense } from '../../../hooks/useLicense';\nimport { dispatchToastMessage } from '../../../lib/toast';\nimport { useSetupWizardContext } from '../contexts/SetupWizardContext';\n\nconst SERVER_OPTIONS = {\n\tREGISTERED: 'REGISTERED',\n\tOFFLINE: 'OFFLINE',\n};\n\nconst RegisterServerStep = (): ReactElement => {\n\tconst t = useTranslation();\n\tconst { currentStep, goToNextStep, setSetupWizardData, registerServer, maxSteps, completeSetupWizard, saveAgreementData } =\n\t\tuseSetupWizardContext();\n\tconst [serverOption, setServerOption] = useState(SERVER_OPTIONS.REGISTERED);\n\tconst invalidateLicenseQuery = useInvalidateLicense();\n\n\tconst handleRegister: ComponentProps<typeof RegisterServerPage>['onSubmit'] = async (data: {\n\t\temail: string;\n\t\tagreement: boolean;\n\t\tupdates: boolean;\n\t\tresend?: boolean;\n\t}) => {\n\t\tgoToNextStep();\n\t\tsetSetupWizardData((prevState) => ({ ...prevState, serverData: data }));\n\t\tawait registerServer(data);\n\t};\n\n\tconst registerManually = useEndpoint('POST', '/v1/cloud.manualRegister');\n\tconst registerPreIntent = useEndpoint('POST', '/v1/cloud.registerPreIntent');\n\tconst getWorkspaceRegisterData = useMethod('cloud:getWorkspaceRegisterData');\n\n\tconst { data: clientKey } = useQuery(['setupWizard/clientKey'], async () => getWorkspaceRegisterData(), {\n\t\tstaleTime: Infinity,\n\t});\n\n\tconst {\n\t\tdata: offline,\n\t\tisLoading,\n\t\tisError,\n\t} = useQuery(['setupWizard/registerIntent'], async () => registerPreIntent(), {\n\t\tstaleTime: Infinity,\n\t\tselect: (data) => data.offline,\n\t});\n\n\tconst { mutate } = useMutation<null, unknown, string>(\n\t\t['setupWizard/confirmOfflineRegistration'],\n\t\tasync (token) => registerManually({ cloudBlob: token }),\n\t\t{\n\t\t\tonSuccess: () => {\n\t\t\t\tinvalidateLicenseQuery(100);\n\t\t\t\tcompleteSetupWizard();\n\t\t\t},\n\t\t\tonError: () => {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Cloud_register_error') });\n\t\t\t},\n\t\t},\n\t);\n\n\tconst handleConfirmOffline: ComponentProps<typeof RegisterOfflinePage>['onSubmit'] = async ({ token, agreement }) => {\n\t\tawait saveAgreementData(agreement);\n\t\tmutate(token);\n\t};\n\n\tif (serverOption === SERVER_OPTIONS.OFFLINE) {\n\t\treturn (\n\t\t\t<RegisterOfflinePage\n\t\t\t\ttermsHref='https://rocket.chat/terms'\n\t\t\t\tpolicyHref='https://rocket.chat/privacy'\n\t\t\t\tclientKey={clientKey || ''}\n\t\t\t\tonCopySecurityCode={(): void => dispatchToastMessage({ type: 'success', message: t('Copied') })}\n\t\t\t\tonBackButtonClick={(): void => setServerOption(SERVER_OPTIONS.REGISTERED)}\n\t\t\t\tonSubmit={handleConfirmOffline}\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<RegisterServerPage\n\t\t\tonClickRegisterOffline={(): void => setServerOption(SERVER_OPTIONS.OFFLINE)}\n\t\t\tstepCount={maxSteps}\n\t\t\tonSubmit={handleRegister}\n\t\t\tcurrentStep={currentStep}\n\t\t\toffline={isError || (!isLoading && offline)}\n\t\t/>\n\t);\n};\n\nexport default RegisterServerStep;\n",null],"names":["_objectSpread","RegisterServerPage","RegisterOfflinePage","useEndpoint","useMethod","useTranslation","useMutation","useQuery","React","useState","useInvalidateLicense","dispatchToastMessage","useSetupWizardContext","module","default","v","link","SERVER_OPTIONS","REGISTERED","OFFLINE","exportDefault","t","currentStep","goToNextStep","setSetupWizardData","registerServer","maxSteps","completeSetupWizard","saveAgreementData","serverOption","setServerOption","invalidateLicenseQuery","handleRegister","data","prevState","serverData","registerManually","registerPreIntent","getWorkspaceRegisterData","clientKey","staleTime","Infinity","offline","isLoading","isError","select","mutate","token","cloudBlob","onSuccess","onError","type","message","handleConfirmOffline","_ref","agreement","createElement","termsHref","policyHref","onCopySecurityCode","onBackButtonClick","onSubmit","onClickRegisterOffline","stepCount"],"mappings":"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"}