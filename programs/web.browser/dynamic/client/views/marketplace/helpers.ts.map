)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/helpers.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport type { App } from '@rocket.chat/core-typings';\nimport semver from 'semver';\n\n// import { t } from '../../../app/utils/client';\nimport { t } from '../../../app/utils/lib/i18n';\nimport { appErroredStatuses } from './helpers/appErroredStatuses';\n\nexport const appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\n\nexport type Actions = 'update' | 'install' | 'purchase' | 'request';\n\ntype appButtonResponseProps = {\n\taction: Actions;\n\ticon?: 'reload' | 'warning';\n\tlabel: 'Update' | 'Install' | 'Subscribe' | 'See Pricing' | 'Try now' | 'Buy' | 'Request' | 'Requested';\n};\n\nexport type appStatusSpanResponseProps = {\n\ttype?: 'failed' | 'warning';\n\ticon?: 'warning' | 'checkmark-circled' | 'check';\n\tlabel:\n\t\t| 'Config Needed'\n\t\t| 'Failed'\n\t\t| 'Disabled'\n\t\t| 'Disabled*'\n\t\t| 'Trial period'\n\t\t| 'Enabled'\n\t\t| 'Enabled*'\n\t\t| 'Incompatible'\n\t\t| 'request'\n\t\t| 'requests'\n\t\t| 'Requested';\n\ttooltipText?: string;\n};\n\ntype appButtonPropsType = App & { isAdminUser: boolean; endUserRequested: boolean };\n\nexport const appButtonProps = ({\n\tinstalled,\n\tversion,\n\tmarketplaceVersion,\n\tisPurchased,\n\tprice,\n\tpurchaseType,\n\tsubscriptionInfo,\n\tpricingPlans,\n\tisEnterpriseOnly,\n\tversionIncompatible,\n\tisAdminUser,\n\t// TODO: Unify this two variables\n\trequestedEndUser,\n\tendUserRequested,\n}: appButtonPropsType): appButtonResponseProps | undefined => {\n\tif (!isAdminUser) {\n\t\tif (requestedEndUser || endUserRequested) {\n\t\t\treturn {\n\t\t\t\taction: 'request',\n\t\t\t\tlabel: 'Requested',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'request',\n\t\t\tlabel: 'Request',\n\t\t};\n\t}\n\n\tconst canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\tif (canUpdate) {\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'update',\n\t\t\t\ticon: 'warning',\n\t\t\t\tlabel: 'Update',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'update',\n\t\t\ticon: 'reload',\n\t\t\tlabel: 'Update',\n\t\t};\n\t}\n\n\tif (installed) {\n\t\treturn;\n\t}\n\n\tconst canDownload = isPurchased;\n\tif (canDownload) {\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'install',\n\t\t\t\ticon: 'warning',\n\t\t\t\tlabel: 'Install',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'install',\n\t\t\tlabel: 'Install',\n\t\t};\n\t}\n\n\tconst canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\tif (canSubscribe) {\n\t\tconst cannotTry = pricingPlans.every((currentPricingPlan) => currentPricingPlan.trialDays === 0);\n\t\tconst isTierBased = pricingPlans.every((currentPricingPlan) => currentPricingPlan.tiers && currentPricingPlan.tiers.length > 0);\n\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t\ticon: 'warning',\n\t\t\t};\n\t\t}\n\n\t\tif (cannotTry || isEnterpriseOnly) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t};\n\t\t}\n\n\t\tif (isTierBased) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'See Pricing',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Try now',\n\t\t};\n\t}\n\n\tconst canBuy = price > 0;\n\tif (canBuy) {\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Buy',\n\t\t\t\ticon: 'warning',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Buy',\n\t\t};\n\t}\n\n\tif (versionIncompatible) {\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Install',\n\t\t\ticon: 'warning',\n\t\t};\n\t}\n\n\treturn {\n\t\taction: 'purchase',\n\t\tlabel: 'Install',\n\t};\n};\n\nexport const appIncompatibleStatusProps = (): appStatusSpanResponseProps => ({\n\ticon: 'check',\n\tlabel: 'Incompatible',\n\ttooltipText: t('App_version_incompatible_tooltip'),\n});\n\nexport const appStatusSpanProps = (\n\t{ installed, status, subscriptionInfo, appRequestStats, migrated }: App,\n\tisEnterprise?: boolean,\n\tcontext?: string,\n\tisAppDetailsPage?: boolean,\n): appStatusSpanResponseProps | undefined => {\n\tconst isEnabled = status && appEnabledStatuses.includes(status);\n\n\tif (installed) {\n\t\tif (isEnabled) {\n\t\t\treturn migrated && !isEnterprise\n\t\t\t\t? {\n\t\t\t\t\t\tlabel: 'Enabled*',\n\t\t\t\t\t\ttooltipText: t('Grandfathered_app'),\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\tlabel: 'Enabled',\n\t\t\t\t  };\n\t\t}\n\n\t\treturn migrated && !isEnterprise\n\t\t\t? {\n\t\t\t\t\tlabel: 'Disabled*',\n\t\t\t\t\ttooltipText: t('Grandfathered_app'),\n\t\t\t  }\n\t\t\t: {\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\tlabel: 'Disabled',\n\t\t\t  };\n\t}\n\n\tconst isFailed = status && appErroredStatuses.includes(status);\n\tif (isFailed) {\n\t\treturn {\n\t\t\ttype: 'failed',\n\t\t\ticon: 'warning',\n\t\t\tlabel: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed',\n\t\t};\n\t}\n\n\tconst isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\tif (isOnTrialPeriod) {\n\t\treturn {\n\t\t\ticon: 'checkmark-circled',\n\t\t\tlabel: 'Trial period',\n\t\t};\n\t}\n\n\tif (context === 'requested' && appRequestStats) {\n\t\tif (isAppDetailsPage) {\n\t\t\treturn {\n\t\t\t\tlabel: 'Requested',\n\t\t\t};\n\t\t}\n\n\t\tif (appRequestStats.totalUnseen) {\n\t\t\treturn {\n\t\t\t\tlabel: appRequestStats.totalUnseen > 1 ? 'requests' : 'request',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tlabel: appRequestStats.totalSeen > 1 ? 'requests' : 'request',\n\t\t};\n\t}\n};\n\nexport const appMultiStatusProps = (\n\tapp: App,\n\tisAppDetailsPage: boolean,\n\tcontext: string,\n\tisEnterprise: boolean,\n): appStatusSpanResponseProps[] => {\n\tconst status = appStatusSpanProps(app, isEnterprise, context, isAppDetailsPage);\n\tconst statuses = [];\n\n\tif (app?.versionIncompatible !== undefined && !isAppDetailsPage) {\n\t\tstatuses.push(appIncompatibleStatusProps());\n\t}\n\n\tif (status) {\n\t\tstatuses.push(status);\n\t}\n\n\treturn statuses;\n};\n",null],"names":["AppStatus","semver","t","appErroredStatuses","module","export","appEnabledStatuses","appButtonProps","appIncompatibleStatusProps","appStatusSpanProps","appMultiStatusProps","default","AUTO_ENABLED","MANUALLY_ENABLED","_ref","installed","version","marketplaceVersion","isPurchased","price","purchaseType","subscriptionInfo","pricingPlans","isEnterpriseOnly","versionIncompatible","isAdminUser","requestedEndUser","endUserRequested","action","label","canUpdate","lt","icon","canSubscribe","status","cannotTry","every","currentPricingPlan","trialDays","isTierBased","tiers","length","tooltipText","_ref2","isEnterprise","context","isAppDetailsPage","appRequestStats","migrated","isEnabled","includes","type","isFailed","INVALID_SETTINGS_DISABLED","isOnTrialPeriod","totalUnseen","totalSeen","app","statuses","undefined","push"],"mappings":"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"}