)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/hooks/useFilteredApps.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { PaginatedResult } from '@rocket.chat/rest-typings';\nimport type { ContextType } from 'react';\nimport { useMemo } from 'react';\n\nimport type { AppsContext } from '../../../contexts/AppsContext';\nimport type { AsyncState } from '../../../lib/asyncState';\nimport { AsyncStatePhase } from '../../../lib/asyncState';\nimport { filterAppsByCategories } from '../helpers/filterAppsByCategories';\nimport { filterAppsByDisabled } from '../helpers/filterAppsByDisabled';\nimport { filterAppsByEnabled } from '../helpers/filterAppsByEnabled';\nimport { filterAppsByEnterprise } from '../helpers/filterAppsByEnterprise';\nimport { filterAppsByFree } from '../helpers/filterAppsByFree';\nimport { filterAppsByPaid } from '../helpers/filterAppsByPaid';\nimport { filterAppsByText } from '../helpers/filterAppsByText';\nimport { sortAppsByAlphabeticalOrInverseOrder } from '../helpers/sortAppsByAlphabeticalOrInverseOrder';\nimport { sortAppsByClosestOrFarthestModificationDate } from '../helpers/sortAppsByClosestOrFarthestModificationDate';\nimport type { App } from '../types';\n\nexport type appsDataType = ContextType<typeof AppsContext>['installedApps'] | ContextType<typeof AppsContext>['marketplaceApps'];\n\nexport const useFilteredApps = ({\n\tappsData,\n\ttext,\n\tcurrent,\n\titemsPerPage,\n\tcategories = [],\n\tpurchaseType,\n\tsortingMethod,\n\tstatus,\n\tcontext,\n}: {\n\tappsData: appsDataType;\n\ttext: string;\n\tcurrent: number;\n\titemsPerPage: number;\n\tcategories: string[];\n\tpurchaseType: string;\n\tisEnterpriseOnly?: boolean;\n\tsortingMethod: string;\n\tstatus: string;\n\tcontext?: string;\n}): AsyncState<\n\t{ items: App[] } & { shouldShowSearchText: boolean } & PaginatedResult & { allApps: App[] } & { totalAppsLength: number }\n> => {\n\tconst value = useMemo(() => {\n\t\tif (appsData.value === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { apps } = appsData.value;\n\t\tconst fallback = (apps: App[]) => apps;\n\n\t\tconst sortingMethods: Record<string, (apps: App[]) => App[]> = {\n\t\t\turf: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => (secondApp?.appRequestStats?.totalUnseen || 0) - (firstApp?.appRequestStats?.totalUnseen || 0)),\n\t\t\turl: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => (firstApp?.appRequestStats?.totalUnseen || 0) - (secondApp?.appRequestStats?.totalUnseen || 0)),\n\t\t\taz: (apps: App[]) => apps.sort((firstApp, secondApp) => sortAppsByAlphabeticalOrInverseOrder(firstApp.name, secondApp.name)),\n\t\t\tza: (apps: App[]) => apps.sort((firstApp, secondApp) => sortAppsByAlphabeticalOrInverseOrder(secondApp.name, firstApp.name)),\n\t\t\tmru: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => sortAppsByClosestOrFarthestModificationDate(firstApp.modifiedAt, secondApp.modifiedAt)),\n\t\t\tlru: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => sortAppsByClosestOrFarthestModificationDate(secondApp.modifiedAt, firstApp.modifiedAt)),\n\t\t};\n\n\t\tconst filterByPurchaseType: Record<string, (apps: App[]) => App[]> = {\n\t\t\tall: fallback,\n\t\t\tpaid: (apps: App[]) => apps.filter(filterAppsByPaid),\n\t\t\tpremium: (apps: App[]) => apps.filter(filterAppsByEnterprise),\n\t\t\tfree: (apps: App[]) => apps.filter(filterAppsByFree),\n\t\t};\n\n\t\tconst filterByStatus: Record<string, (apps: App[]) => App[]> = {\n\t\t\tall: fallback,\n\t\t\tenabled: (apps: App[]) => apps.filter(filterAppsByEnabled),\n\t\t\tdisabled: (apps: App[]) => apps.filter(filterAppsByDisabled),\n\t\t};\n\n\t\tconst filterByContext: Record<string, (apps: App[]) => App[]> = {\n\t\t\texplore: fallback,\n\t\t\tinstalled: fallback,\n\t\t\tprivate: fallback,\n\t\t\tpremium: (apps: App[]) => apps.filter(({ categories }) => categories.includes('Premium')),\n\t\t\trequested: (apps: App[]) => apps.filter(({ appRequestStats, installed }) => Boolean(appRequestStats) && !installed),\n\t\t};\n\n\t\ttype appsFilterFunction = (apps: App[]) => App[];\n\t\tconst pipeAppsFilter =\n\t\t\t(...functions: appsFilterFunction[]) =>\n\t\t\t(initialValue: App[]) =>\n\t\t\t\tfunctions.reduce((currentAppsList, currentFilterFunction) => currentFilterFunction(currentAppsList), initialValue);\n\n\t\tconst filtered = pipeAppsFilter(\n\t\t\tcontext ? filterByContext[context] : fallback,\n\t\t\tfilterByPurchaseType[purchaseType],\n\t\t\tfilterByStatus[status],\n\t\t\tcategories.length ? (apps: App[]) => apps.filter((app) => filterAppsByCategories(app, categories)) : fallback,\n\t\t\ttext ? (apps: App[]) => apps.filter(({ name }) => filterAppsByText(name, text)) : fallback,\n\t\t\tsortingMethods[sortingMethod],\n\t\t)(apps);\n\n\t\tconst shouldShowSearchText = !!text;\n\t\tconst total = filtered.length;\n\t\tconst offset = current > total ? 0 : current;\n\t\tconst end = current + itemsPerPage;\n\t\tconst slice = filtered.slice(offset, end);\n\n\t\treturn {\n\t\t\titems: slice,\n\t\t\toffset,\n\t\t\ttotal: filtered.length,\n\t\t\ttotalAppsLength: apps.length,\n\t\t\tcount: slice.length,\n\t\t\tshouldShowSearchText,\n\t\t\tallApps: filtered,\n\t\t};\n\t}, [appsData.value, sortingMethod, purchaseType, status, categories, text, context, current, itemsPerPage]);\n\n\tif (appsData.phase === AsyncStatePhase.RESOLVED) {\n\t\tif (!value) {\n\t\t\tthrow new Error('useFilteredApps - Unexpected state');\n\t\t}\n\t\treturn {\n\t\t\t...appsData,\n\t\t\tvalue,\n\t\t};\n\t}\n\n\tif (appsData.phase === AsyncStatePhase.UPDATING) {\n\t\tthrow new Error('useFilteredApps - Unexpected state');\n\t}\n\n\treturn {\n\t\t...appsData,\n\t\tvalue: undefined,\n\t};\n};\n",null],"names":["_objectSpread","useMemo","AsyncStatePhase","filterAppsByCategories","filterAppsByDisabled","filterAppsByEnabled","filterAppsByEnterprise","filterAppsByFree","filterAppsByPaid","filterAppsByText","sortAppsByAlphabeticalOrInverseOrder","sortAppsByClosestOrFarthestModificationDate","module","link","default","export","useFilteredApps","_ref","appsData","text","current","itemsPerPage","categories","purchaseType","sortingMethod","status","context","value","undefined","apps","fallback","filtered","pipeAppsFilter","_len","arguments","length","functions","Array","_key","initialValue","reduce","currentAppsList","currentFilterFunction","filterByContext","explore","installed","private","premium","filter","_ref2","includes","requested","_ref3","appRequestStats","Boolean","filterByPurchaseType","all","paid","free","filterByStatus","enabled","disabled","app","_ref4","name","sortingMethods","urf","sort","firstApp","secondApp","_secondApp$appRequest","_firstApp$appRequestS","totalUnseen","url","_firstApp$appRequestS2","_secondApp$appRequest2","az","za","mru","modifiedAt","lru","shouldShowSearchText","total","offset","end","slice","items","totalAppsLength","count","allApps","phase","RESOLVED","Error","UPDATING"],"mappings":"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"}