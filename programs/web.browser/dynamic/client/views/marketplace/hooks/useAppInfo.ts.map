)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/hooks/useAppInfo.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useState, useEffect, useContext } from 'react';\n\nimport type { ISettings } from '../../../../ee/client/apps/@types/IOrchestrator';\nimport { AppClientOrchestratorInstance } from '../../../../ee/client/apps/orchestrator';\nimport { AppsContext } from '../../../contexts/AppsContext';\nimport type { AppInfo } from '../definitions/AppInfo';\n\nconst getBundledInApp = async (app: App): Promise<App['bundledIn']> => {\n\tconst { bundledIn = [] } = app;\n\n\treturn Promise.all(\n\t\tbundledIn.map(async (bundle) => {\n\t\t\tconst apps = await AppClientOrchestratorInstance.getAppsOnBundle(bundle.bundleId);\n\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\treturn bundle;\n\t\t}),\n\t);\n};\n\nexport const useAppInfo = (appId: string, context: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps, privateApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tconst getSettings = useEndpoint('GET', '/apps/:id/settings', { id: appId });\n\tconst getScreenshots = useEndpoint('GET', '/apps/:id/screenshots', { id: appId });\n\tconst getApis = useEndpoint('GET', '/apps/:id/apis', { id: appId });\n\tconst getBundledIn = useEndpoint('GET', '/apps/:id', { id: appId });\n\n\tuseEffect(() => {\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif ((!marketplaceApps.value?.apps?.length && !installedApps.value?.apps.length && !privateApps.value?.apps.length) || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet appResult: App | undefined;\n\t\t\tconst marketplaceAppsContexts = ['explore', 'premium', 'requested'];\n\n\t\t\tif (marketplaceAppsContexts.includes(context)) appResult = marketplaceApps.value?.apps.find((app) => app.id === appId);\n\n\t\t\tif (context === 'private') appResult = privateApps.value?.apps.find((app) => app.id === appId);\n\n\t\t\tif (context === 'installed') appResult = installedApps.value?.apps.find((app) => app.id === appId);\n\n\t\t\tif (!appResult) return;\n\n\t\t\tconst [settings, apis, screenshots, bundledIn] = await Promise.all([\n\t\t\t\tgetSettings().catch(() => ({\n\t\t\t\t\tsettings: {},\n\t\t\t\t})),\n\t\t\t\tgetApis().catch(() => ({\n\t\t\t\t\tapis: [],\n\t\t\t\t})),\n\t\t\t\tgetScreenshots().catch(() => ({\n\t\t\t\t\tscreenshots: [],\n\t\t\t\t})),\n\t\t\t\tappResult.marketplace === false\n\t\t\t\t\t? []\n\t\t\t\t\t: getBundledIn({\n\t\t\t\t\t\t\tmarketplace: 'true',\n\t\t\t\t\t\t\tupdate: 'true',\n\t\t\t\t\t\t\tappVersion: appId,\n\t\t\t\t\t  })\n\t\t\t\t\t\t\t.then(({ app }: any) => {\n\t\t\t\t\t\t\t\t(appResult as App).tosLink = app.tosLink;\n\t\t\t\t\t\t\t\t(appResult as App).privacyLink = app.privacyLink;\n\t\t\t\t\t\t\t\treturn getBundledInApp(app);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => ({\n\t\t\t\t\t\t\t\tsettings: {},\n\t\t\t\t\t\t\t})),\n\t\t\t]);\n\n\t\t\tsetAppData({\n\t\t\t\t...appResult,\n\t\t\t\tbundledIn: bundledIn as App['bundledIn'],\n\t\t\t\tsettings: settings.settings as ISettings,\n\t\t\t\tapis: apis ? apis.apis : [],\n\t\t\t\tscreenshots: screenshots ? screenshots.screenshots : [],\n\t\t\t});\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, context, getApis, getBundledIn, getScreenshots, getSettings, installedApps, marketplaceApps, privateApps.value?.apps]);\n\n\treturn appData;\n};\n",null],"names":["_objectSpread","useEndpoint","useState","useEffect","useContext","AppClientOrchestratorInstance","AppsContext","module","link","default","export","useAppInfo","getBundledInApp","app","bundledIn","Promise","all","map","bundle","apps","getAppsOnBundle","bundleId","slice","appId","context","_privateApps$value3","installedApps","marketplaceApps","privateApps","appData","setAppData","getSettings","id","getScreenshots","getApis","getBundledIn","fetchAppInfo","_marketplaceApps$valu","_marketplaceApps$valu2","_installedApps$value","_privateApps$value","_marketplaceApps$valu3","_privateApps$value2","_installedApps$value2","appResult","value","length","marketplaceAppsContexts","includes","find","settings","apis","screenshots","catch","marketplace","update","appVersion","then","_ref","tosLink","privacyLink"],"mappings":"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"}