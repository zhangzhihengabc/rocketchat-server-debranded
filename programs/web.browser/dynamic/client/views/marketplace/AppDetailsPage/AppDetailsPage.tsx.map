)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/AppDetailsPage/AppDetailsPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ISetting } from '@rocket.chat/apps-engine/definition/settings';\nimport type { App } from '@rocket.chat/core-typings';\nimport { Button, ButtonGroup, Box } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useRouteParameter, useToastMessageDispatch, usePermission, useRouter } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useCallback, useRef } from 'react';\n\nimport type { ISettings } from '../../../../ee/client/apps/@types/IOrchestrator';\nimport { AppClientOrchestratorInstance } from '../../../../ee/client/apps/orchestrator';\nimport Page from '../../../components/Page';\nimport { handleAPIError } from '../helpers/handleAPIError';\nimport { useAppInfo } from '../hooks/useAppInfo';\nimport AppDetailsPageHeader from './AppDetailsPageHeader';\nimport AppDetailsPageLoading from './AppDetailsPageLoading';\nimport AppDetailsPageTabs from './AppDetailsPageTabs';\nimport AppDetails from './tabs/AppDetails';\nimport AppLogs from './tabs/AppLogs';\nimport AppReleases from './tabs/AppReleases';\nimport AppRequests from './tabs/AppRequests/AppRequests';\nimport AppSecurity from './tabs/AppSecurity/AppSecurity';\nimport AppSettings from './tabs/AppSettings';\n\nconst AppDetailsPage = ({ id }: { id: App['id'] }): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst router = useRouter();\n\n\tconst [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n\tconst [isSaving, setIsSaving] = useState(false);\n\n\tconst settingsRef = useRef<Record<string, ISetting['value']>>({});\n\tconst isAdminUser = usePermission('manage-apps');\n\n\tconst tab = useRouteParameter('tab');\n\tconst context = useRouteParameter('context');\n\n\tconst appData = useAppInfo(id, context || '');\n\n\tconst handleReturn = useMutableCallback((): void => {\n\t\tif (!context) {\n\t\t\treturn;\n\t\t}\n\n\t\trouter.navigate({\n\t\t\tname: 'marketplace',\n\t\t\tparams: { context, page: 'list' },\n\t\t});\n\t});\n\n\tconst { installed, settings, privacyPolicySummary, permissions, tosLink, privacyLink, name } = appData || {};\n\n\tconst isSecurityVisible = Boolean(privacyPolicySummary || permissions || tosLink || privacyLink);\n\n\tconst saveAppSettings = useCallback(async () => {\n\t\tconst { current } = settingsRef;\n\t\tsetIsSaving(true);\n\t\ttry {\n\t\t\tawait AppClientOrchestratorInstance.setAppSettings(\n\t\t\t\tid,\n\t\t\t\t(Object.values(settings || {}) as ISetting[]).map((value) => ({\n\t\t\t\t\t...value,\n\t\t\t\t\tvalue: current?.[value.id],\n\t\t\t\t})),\n\t\t\t);\n\n\t\t\tdispatchToastMessage({ type: 'success', message: `${name} settings saved succesfully` });\n\t\t} catch (e: any) {\n\t\t\thandleAPIError(e);\n\t\t}\n\t\tsetIsSaving(false);\n\t}, [dispatchToastMessage, id, name, settings]);\n\n\treturn (\n\t\t<Page flexDirection='column' h='full'>\n\t\t\t<Page.Header title={t('App_Info')} onClickBack={handleReturn}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t{installed && isAdminUser && (\n\t\t\t\t\t\t<Button primary disabled={!hasUnsavedChanges} loading={isSaving} onClick={saveAppSettings}>\n\t\t\t\t\t\t\t{t('Save_changes')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow pi={24} pbs={24} pbe={0} h='full'>\n\t\t\t\t<Box w='full' alignSelf='center' h='full' display='flex' flexDirection='column'>\n\t\t\t\t\t{!appData && <AppDetailsPageLoading />}\n\t\t\t\t\t{appData && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<AppDetailsPageHeader app={appData} />\n\t\t\t\t\t\t\t<AppDetailsPageTabs\n\t\t\t\t\t\t\t\tcontext={context || ''}\n\t\t\t\t\t\t\t\tinstalled={installed}\n\t\t\t\t\t\t\t\tisSecurityVisible={isSecurityVisible}\n\t\t\t\t\t\t\t\tsettings={settings}\n\t\t\t\t\t\t\t\ttab={tab}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{Boolean(!tab || tab === 'details') && <AppDetails app={appData} />}\n\t\t\t\t\t\t\t{tab === 'requests' && <AppRequests id={id} isAdminUser={isAdminUser} />}\n\t\t\t\t\t\t\t{tab === 'security' && isSecurityVisible && (\n\t\t\t\t\t\t\t\t<AppSecurity\n\t\t\t\t\t\t\t\t\tprivacyPolicySummary={privacyPolicySummary}\n\t\t\t\t\t\t\t\t\tappPermissions={permissions}\n\t\t\t\t\t\t\t\t\ttosLink={tosLink}\n\t\t\t\t\t\t\t\t\tprivacyLink={privacyLink}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{tab === 'releases' && <AppReleases id={id} />}\n\t\t\t\t\t\t\t{Boolean(tab === 'settings' && settings && Object.values(settings).length) && (\n\t\t\t\t\t\t\t\t<AppSettings\n\t\t\t\t\t\t\t\t\tsettings={settings || ({} as ISettings)}\n\t\t\t\t\t\t\t\t\tsetHasUnsavedChanges={setHasUnsavedChanges}\n\t\t\t\t\t\t\t\t\tsettingsRef={settingsRef}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{tab === 'logs' && <AppLogs id={id} />}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Box>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n};\n\nexport default AppDetailsPage;\n",null],"names":["_objectSpread","Button","ButtonGroup","Box","useMutableCallback","useTranslation","useRouteParameter","useToastMessageDispatch","usePermission","useRouter","React","useState","useCallback","useRef","AppClientOrchestratorInstance","Page","handleAPIError","useAppInfo","AppDetailsPageHeader","AppDetailsPageLoading","AppDetailsPageTabs","AppDetails","AppLogs","AppReleases","AppRequests","AppSecurity","AppSettings","module","default","link","v","exportDefault","_ref","id","t","dispatchToastMessage","router","hasUnsavedChanges","setHasUnsavedChanges","isSaving","setIsSaving","settingsRef","isAdminUser","tab","context","appData","handleReturn","navigate","name","params","page","installed","settings","privacyPolicySummary","permissions","tosLink","privacyLink","isSecurityVisible","Boolean","saveAppSettings","current","setAppSettings","Object","values","map","value","type","message","concat","e","createElement","flexDirection","h","Header","title","onClickBack","primary","disabled","loading","onClick","ScrollableContentWithShadow","pi","pbs","pbe","w","alignSelf","display","Fragment","app","appPermissions","length"],"mappings":"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"}