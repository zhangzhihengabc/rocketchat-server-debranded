)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/AppDetailsPage/tabs/AppStatus/AppStatus.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { Box, Button, Throbber, Tag, Margins } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport { useRouteParameter, usePermission, useSetModal, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useState, memo } from 'react';\nimport semver from 'semver';\n\nimport { useIsEnterprise } from '../../../../../hooks/useIsEnterprise';\nimport type { appStatusSpanResponseProps } from '../../../helpers';\nimport { appButtonProps, appMultiStatusProps } from '../../../helpers';\nimport { marketplaceActions } from '../../../helpers/marketplaceActions';\nimport type { AppInstallationHandlerParams } from '../../../hooks/useAppInstallationHandler';\nimport { useAppInstallationHandler } from '../../../hooks/useAppInstallationHandler';\nimport AppStatusPriceDisplay from './AppStatusPriceDisplay';\n\ntype AppStatusProps = {\n\tapp: App;\n\tshowStatus?: boolean;\n\tisAppDetailsPage: boolean;\n\tinstalled?: boolean;\n};\n\nconst AppStatus = ({ app, showStatus = true, isAppDetailsPage, installed, ...props }: AppStatusProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst [endUserRequested, setEndUserRequested] = useState(false);\n\tconst [loading, setLoading] = useSafely(useState(false));\n\tconst [isAppPurchased, setPurchased] = useSafely(useState(!!app?.isPurchased));\n\tconst setModal = useSetModal();\n\tconst isAdminUser = usePermission('manage-apps');\n\tconst context = useRouteParameter('context');\n\n\tconst { price, purchaseType, pricingPlans } = app;\n\n\tconst button = appButtonProps({ ...app, isAdminUser, endUserRequested });\n\tconst isAppRequestsPage = context === 'requested';\n\tconst shouldShowPriceDisplay = isAppDetailsPage && button && !app.isEnterpriseOnly;\n\tconst canUpdate = installed && app?.version && app?.marketplaceVersion && semver.lt(app?.version, app?.marketplaceVersion);\n\n\tconst { data } = useIsEnterprise();\n\tconst isEnterprise = data?.isEnterprise ?? false;\n\n\tconst statuses = appMultiStatusProps(app, isAppDetailsPage, context || '', isEnterprise);\n\n\tconst totalSeenRequests = app?.appRequestStats?.totalSeen;\n\tconst totalUnseenRequests = app?.appRequestStats?.totalUnseen;\n\n\tconst action = button?.action;\n\n\tconst confirmAction = useCallback<AppInstallationHandlerParams['onSuccess']>(\n\t\tasync (action, permissionsGranted) => {\n\t\t\tif (action !== 'request') {\n\t\t\t\tsetPurchased(true);\n\t\t\t\tawait marketplaceActions[action]({ ...app, permissionsGranted });\n\t\t\t} else {\n\t\t\t\tsetEndUserRequested(true);\n\t\t\t}\n\n\t\t\tsetLoading(false);\n\t\t},\n\t\t[app, setLoading, setPurchased],\n\t);\n\n\tconst cancelAction = useCallback(() => {\n\t\tsetLoading(false);\n\t\tsetModal(null);\n\t}, [setLoading, setModal]);\n\n\tconst appInstallationHandler = useAppInstallationHandler({\n\t\tapp,\n\t\taction: action || 'purchase',\n\t\tisAppPurchased,\n\t\tonDismiss: cancelAction,\n\t\tonSuccess: confirmAction,\n\t});\n\n\tconst handleAcquireApp = useCallback(() => {\n\t\tsetLoading(true);\n\t\tappInstallationHandler();\n\t}, [appInstallationHandler, setLoading]);\n\n\t// @TODO we should refactor this to not use the label to determine the variant\n\tconst getStatusVariant = (status: appStatusSpanResponseProps) => {\n\t\tif (isAppRequestsPage && totalUnseenRequests && (status.label === 'request' || status.label === 'requests')) {\n\t\t\treturn 'primary';\n\t\t}\n\n\t\tif (isAppRequestsPage && status.label === 'Requested') {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// includes() here because the label can be 'Disabled' or 'Disabled*'\n\t\tif (status.label.includes('Disabled')) {\n\t\t\treturn 'secondary-danger';\n\t\t}\n\n\t\treturn undefined;\n\t};\n\n\tconst handleAppRequestsNumber = (status: appStatusSpanResponseProps) => {\n\t\tif ((status.label === 'request' || status.label === 'requests') && !installed && isAppRequestsPage) {\n\t\t\tlet numberOfRequests = 0;\n\n\t\t\tif (totalUnseenRequests >= 0) {\n\t\t\t\tnumberOfRequests += totalUnseenRequests;\n\t\t\t}\n\n\t\t\tif (totalSeenRequests >= 0) {\n\t\t\t\tnumberOfRequests += totalSeenRequests;\n\t\t\t}\n\n\t\t\treturn numberOfRequests;\n\t\t}\n\n\t\treturn null;\n\t};\n\n\treturn (\n\t\t<Box {...props} display='flex' alignItems='center' mie={8}>\n\t\t\t{button && isAppDetailsPage && (!installed || canUpdate) && (\n\t\t\t\t<Box\n\t\t\t\t\tdisplay='flex'\n\t\t\t\t\tflexDirection='row'\n\t\t\t\t\talignItems='center'\n\t\t\t\t\tjustifyContent='center'\n\t\t\t\t\tborderRadius='x4'\n\t\t\t\t\tinvisible={!showStatus && !loading}\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={!loading && button.icon ? button.icon : undefined}\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\tsmall\n\t\t\t\t\t\tdisabled={loading || (action === 'request' && (app?.requestedEndUser || endUserRequested))}\n\t\t\t\t\t\tonClick={handleAcquireApp}\n\t\t\t\t\t\tmie={8}\n\t\t\t\t\t>\n\t\t\t\t\t\t{loading && <Throbber inheritColor />}\n\t\t\t\t\t\t{!loading && t(button.label.replace(' ', '_') as TranslationKey)}\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t{shouldShowPriceDisplay && !installed && (\n\t\t\t\t\t\t<AppStatusPriceDisplay purchaseType={purchaseType} pricingPlans={pricingPlans} price={price} showType={false} />\n\t\t\t\t\t)}\n\t\t\t\t</Box>\n\t\t\t)}\n\n\t\t\t{statuses?.map((status, index) => (\n\t\t\t\t<Margins inlineEnd={8} key={index}>\n\t\t\t\t\t<Tag variant={getStatusVariant(status)} title={status.tooltipText ? status.tooltipText : ''}>\n\t\t\t\t\t\t{handleAppRequestsNumber(status)} {t(`${status.label}` as TranslationKey)}\n\t\t\t\t\t</Tag>\n\t\t\t\t</Margins>\n\t\t\t))}\n\t\t</Box>\n\t);\n};\n\nexport default memo(AppStatus);\n",null],"names":["_extends","_objectSpread","_objectWithoutProperties","Box","Button","Throbber","Tag","Margins","useSafely","useRouteParameter","usePermission","useSetModal","useTranslation","React","useCallback","useState","memo","semver","useIsEnterprise","appButtonProps","appMultiStatusProps","marketplaceActions","useAppInstallationHandler","AppStatusPriceDisplay","module","link","default","v","exportDefault","_ref","_data$isEnterprise","_app$appRequestStats","_app$appRequestStats2","app","showStatus","isAppDetailsPage","installed","props","_excluded","t","endUserRequested","setEndUserRequested","loading","setLoading","isAppPurchased","setPurchased","isPurchased","setModal","isAdminUser","context","price","purchaseType","pricingPlans","button","isAppRequestsPage","shouldShowPriceDisplay","isEnterpriseOnly","canUpdate","version","marketplaceVersion","lt","data","isEnterprise","statuses","totalSeenRequests","appRequestStats","totalSeen","totalUnseenRequests","totalUnseen","action","confirmAction","permissionsGranted","cancelAction","appInstallationHandler","onDismiss","onSuccess","handleAcquireApp","getStatusVariant","status","label","includes","handleAppRequestsNumber","numberOfRequests","createElement","display","alignItems","mie","flexDirection","justifyContent","borderRadius","invisible","icon","undefined","primary","small","disabled","requestedEndUser","onClick","inheritColor","replace","showType","map","index","inlineEnd","key","variant","title","tooltipText","concat"],"mappings":"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"}