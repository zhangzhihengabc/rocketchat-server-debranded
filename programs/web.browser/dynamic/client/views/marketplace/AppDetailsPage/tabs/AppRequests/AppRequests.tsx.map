)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/AppDetailsPage/tabs/AppRequests/AppRequests.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { Box, Pagination, States, StatesSubtitle, StatesTitle } from '@rocket.chat/fuselage';\nimport { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation } from '@tanstack/react-query';\nimport type { ReactElement, SetStateAction } from 'react';\nimport React, { useState, useEffect } from 'react';\n\nimport { useAppsReload } from '../../../../../contexts/hooks/useAppsReload';\nimport { queryClient } from '../../../../../lib/queryClient';\nimport { useAppRequests } from '../../../hooks/useAppRequests';\nimport AppRequestItem from './AppRequestItem';\nimport AppRequestsLoading from './AppRequestsLoading';\n\ntype itemsPerPage = 25 | 50 | 100;\n\nconst AppRequests = ({ id, isAdminUser }: { id: App['id']; isAdminUser: boolean }): ReactElement => {\n\tconst [limit, setLimit] = useState<itemsPerPage>(25);\n\tconst [offset, setOffset] = useState<number>(0);\n\n\tconst paginatedAppRequests = useAppRequests(id, limit, offset);\n\tconst t = useTranslation();\n\n\tconst onSetItemsPerPage = (itemsPerPageOption: SetStateAction<itemsPerPage>) => setLimit(itemsPerPageOption);\n\tconst onSetCurrent = (currentItemsOption: SetStateAction<number>) => setOffset(currentItemsOption);\n\n\tconst reloadApps = useAppsReload();\n\tconst markSeen = useEndpoint('POST', '/apps/app-request/markAsSeen');\n\tconst markAppRequestsAsSeen = useMutation({\n\t\tmutationKey: ['mark-app-requests-as-seen'],\n\t\tmutationFn: (unseenRequests: Array<string>) => markSeen({ unseenRequests }),\n\t\tretry: false,\n\t});\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tif (isAdminUser && paginatedAppRequests.isSuccess) {\n\t\t\t\tconst unseenRequests = paginatedAppRequests.data.data.filter(({ seen }) => !seen).map(({ id }) => id);\n\n\t\t\t\tif (unseenRequests.length) {\n\t\t\t\t\tmarkAppRequestsAsSeen.mutate(unseenRequests, {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tqueryClient.refetchQueries({ queryKey: ['app-requests-stats'] });\n\t\t\t\t\t\t\treloadApps();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [isAdminUser, paginatedAppRequests.isSuccess, paginatedAppRequests?.data, reloadApps]);\n\n\tif (paginatedAppRequests.isLoading) {\n\t\treturn (\n\t\t\t<Box w='full' maxWidth='x608' marginInline='auto' pbs={36}>\n\t\t\t\t<AppRequestsLoading />\n\t\t\t</Box>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Box h='full' display='flex' flexDirection='column'>\n\t\t\t<Box w='full' maxWidth='x608' marginInline='auto' pbs={36} flexGrow='1'>\n\t\t\t\t{paginatedAppRequests.isSuccess && paginatedAppRequests.data.data?.length ? (\n\t\t\t\t\tpaginatedAppRequests.data.data.map((request) => (\n\t\t\t\t\t\t<AppRequestItem\n\t\t\t\t\t\t\tkey={request.id}\n\t\t\t\t\t\t\tseen={request.seen}\n\t\t\t\t\t\t\tname={request.requester.name}\n\t\t\t\t\t\t\tcreatedDate={request.createdDate}\n\t\t\t\t\t\t\tmessage={request.message}\n\t\t\t\t\t\t\tusername={request.requester.username}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))\n\t\t\t\t) : (\n\t\t\t\t\t<States>\n\t\t\t\t\t\t<StatesTitle>{t('No_requests')}</StatesTitle>\n\t\t\t\t\t\t<StatesSubtitle>{t('App_requests_by_workspace')}</StatesSubtitle>\n\t\t\t\t\t</States>\n\t\t\t\t)}\n\t\t\t</Box>\n\t\t\t{paginatedAppRequests.isSuccess && paginatedAppRequests.data.data?.length && (\n\t\t\t\t<Pagination\n\t\t\t\t\tdivider\n\t\t\t\t\tcount={paginatedAppRequests.data.meta.total}\n\t\t\t\t\titemsPerPage={paginatedAppRequests.data.meta.limit}\n\t\t\t\t\tcurrent={paginatedAppRequests.data.meta.offset}\n\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AppRequests;\n",null],"names":["Box","Pagination","States","StatesSubtitle","StatesTitle","useEndpoint","useTranslation","useMutation","React","useState","useEffect","useAppsReload","queryClient","useAppRequests","AppRequestItem","AppRequestsLoading","module","v","default","exportDefault","_ref","_paginatedAppRequests","_paginatedAppRequests2","id","isAdminUser","limit","setLimit","offset","setOffset","paginatedAppRequests","t","reloadApps","markSeen","markAppRequestsAsSeen","mutationKey","mutationFn","unseenRequests","retry","isSuccess","data","filter","_ref2","seen","map","_ref3","length","mutate","onSuccess","refetchQueries","queryKey","isLoading","createElement","w","maxWidth","marginInline","pbs","h","display","flexDirection","flexGrow","request","key","name","requester","createdDate","message","username","divider","count","meta","total","itemsPerPage","current","onSetItemsPerPage","itemsPerPageOption","onSetCurrent","currentItemsOption"],"mappings":"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"}