)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/MessageSearchTab/components/MessageSearch.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, MessageDivider } from '@rocket.chat/fuselage';\nimport { useSetting, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { Fragment, memo, useState } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\n\nimport { MessageTypes } from '../../../../../../app/ui-utils/client';\nimport { ContextualbarEmptyContent } from '../../../../../components/Contextualbar';\nimport ScrollableContentWrapper from '../../../../../components/ScrollableContentWrapper';\nimport RoomMessage from '../../../../../components/message/variants/RoomMessage';\nimport SystemMessage from '../../../../../components/message/variants/SystemMessage';\nimport { useFormatDate } from '../../../../../hooks/useFormatDate';\nimport MessageListErrorBoundary from '../../../MessageList/MessageListErrorBoundary';\nimport { isMessageNewDay } from '../../../MessageList/lib/isMessageNewDay';\nimport MessageListProvider from '../../../MessageList/providers/MessageListProvider';\nimport LoadingMessagesIndicator from '../../../body/LoadingMessagesIndicator';\nimport { useRoomSubscription } from '../../../contexts/RoomContext';\nimport { useMessageSearchQuery } from '../hooks/useMessageSearchQuery';\n\ntype MessageSearchProps = {\n\tsearchText: string;\n\tglobalSearch: boolean;\n};\n\nconst MessageSearch = ({ searchText, globalSearch }: MessageSearchProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst formatDate = useFormatDate();\n\tconst pageSize = useSetting<number>('PageSize') ?? 10;\n\tconst [limit, setLimit] = useState(pageSize);\n\tconst showUserAvatar = !!useUserPreference<boolean>('displayAvatars');\n\n\tconst subscription = useRoomSubscription();\n\tconst messageSearchQuery = useMessageSearchQuery({ searchText, limit, globalSearch });\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' flexGrow={1} flexShrink={1} flexBasis={0}>\n\t\t\t{messageSearchQuery.data && (\n\t\t\t\t<>\n\t\t\t\t\t{messageSearchQuery.data.length === 0 && <ContextualbarEmptyContent title={t('No_results_found')} />}\n\t\t\t\t\t{messageSearchQuery.data.length > 0 && (\n\t\t\t\t\t\t<MessageListErrorBoundary>\n\t\t\t\t\t\t\t<MessageListProvider>\n\t\t\t\t\t\t\t\t<Box is='section' display='flex' flexDirection='column' flexGrow={1} flexShrink={1} flexBasis='auto' height='full'>\n\t\t\t\t\t\t\t\t\t<Virtuoso\n\t\t\t\t\t\t\t\t\t\ttotalCount={messageSearchQuery.data.length}\n\t\t\t\t\t\t\t\t\t\toverscan={25}\n\t\t\t\t\t\t\t\t\t\tdata={messageSearchQuery.data}\n\t\t\t\t\t\t\t\t\t\tcomponents={{ Scroller: ScrollableContentWrapper }}\n\t\t\t\t\t\t\t\t\t\titemContent={(index, message) => {\n\t\t\t\t\t\t\t\t\t\t\tconst previous = messageSearchQuery.data[index - 1];\n\n\t\t\t\t\t\t\t\t\t\t\tconst newDay = isMessageNewDay(message, previous);\n\n\t\t\t\t\t\t\t\t\t\t\tconst system = MessageTypes.isSystemMessage(message);\n\n\t\t\t\t\t\t\t\t\t\t\tconst unread = subscription?.tunread?.includes(message._id) ?? false;\n\t\t\t\t\t\t\t\t\t\t\tconst mention = subscription?.tunreadUser?.includes(message._id) ?? false;\n\t\t\t\t\t\t\t\t\t\t\tconst all = subscription?.tunreadGroup?.includes(message._id) ?? false;\n\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Fragment key={message._id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{newDay && <MessageDivider>{formatDate(message.ts)}</MessageDivider>}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{system ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<SystemMessage message={message} showUserAvatar={showUserAvatar} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<RoomMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage={message}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsequential={false}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunread={unread}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmention={mention}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tall={all}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext='search'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsearchText={searchText}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowUserAvatar={showUserAvatar}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tendReached={() => {\n\t\t\t\t\t\t\t\t\t\t\tsetLimit((limit) => limit + pageSize);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t\t</MessageListProvider>\n\t\t\t\t\t\t</MessageListErrorBoundary>\n\t\t\t\t\t)}\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{searchText && messageSearchQuery.isLoading && <LoadingMessagesIndicator />}\n\t\t</Box>\n\t);\n};\n\nexport default memo(MessageSearch);\n",null],"names":["Box","MessageDivider","useSetting","useTranslation","useUserPreference","React","Fragment","memo","useState","Virtuoso","MessageTypes","ContextualbarEmptyContent","ScrollableContentWrapper","RoomMessage","SystemMessage","useFormatDate","MessageListErrorBoundary","isMessageNewDay","MessageListProvider","LoadingMessagesIndicator","useRoomSubscription","useMessageSearchQuery","module","link","default","exportDefault","_ref","_useSetting","searchText","globalSearch","t","formatDate","pageSize","limit","setLimit","showUserAvatar","subscription","messageSearchQuery","createElement","display","flexDirection","flexGrow","flexShrink","flexBasis","data","length","title","is","height","totalCount","overscan","components","Scroller","itemContent","index","message","_subscription$tunread","_subscription$tunread2","_subscription$tunread3","_subscription$tunread4","_subscription$tunread5","_subscription$tunread6","previous","newDay","system","isSystemMessage","unread","tunread","includes","_id","mention","tunreadUser","all","tunreadGroup","key","ts","sequential","context","endReached","isLoading"],"mappings":"2BAAAA,EAAOC,EAAqDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9CC,EAAgBC,IAAAA,CAAAA,wBAA6B,CAACvB,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAqB,EAAAA,IAAAA,CAAAA,2BAAAA,CAAApB,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAkB,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAnB,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,KAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAc,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAb,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAZ,aAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,0CAAAA,CAAAX,0BAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,qDAAAA,CAAAE,QAAAA,CAAAA,EAAAZ,EAAAA,CAAA,CAAA,EAAA,GAAAU,EAAAA,IAAAA,CAAAA,yDAAAA,CAAAE,QAAAA,CAAAA,EAAAX,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,2DAAAA,CAAAE,QAAAA,CAAAA,EAAAV,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,qCAAAA,CAAAP,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,gDAAAA,CAAAE,QAAAA,CAAAA,EAAAR,EAAAA,CAAA,CAAA,EAAA,IAAAM,EAAAA,IAAAA,CAAAA,2CAAAA,CAAAL,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAK,EAAAA,IAAAA,CAAAA,qDAAAA,CAAAE,QAAAA,CAAAA,EAAAN,EAAAA,CAAA,CAAA,EAAA,IAAAI,EAAAA,IAAAA,CAAAA,yCAAAA,CAAAE,QAAAA,CAAAA,EAAAL,EAAAA,CAAA,CAAA,EAAA,IAAAG,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAF,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAE,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAD,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAA5DC,EAAOG,aAAO,CA+FClB,EAvEOmB,IAAmE,IAAAC,EAAA,GAAlE,CAAEC,WAAAA,CAAU,CAAEC,aAAAA,CAAAA,CAAkC,CAAAH,EAChEI,EAAI3B,IACJ4B,EAAahB,IACbiB,EAAQ,AAAiC,OAAjCL,CAAAA,EAAGzB,EAAmB,WAAU,GAACyB,AAAA,KAAA,IAAAA,EAAAA,EAAI,GAC7C,CAACM,EAAOC,EAAS,CAAG1B,EAASwB,GAC7BG,EAAiB,CAAC,CAAC/B,EAA2B,kBAE9CgC,EAAehB,IACfiB,EAAqBhB,EAAsB,CAAEO,WAAAA,EAAYK,MAAAA,EAAOJ,aAAAA,CAAY,GAElF,OACCxB,EAAAiC,aAAA,CAACtC,EAAG,CAACuC,QAAQ,OAAOC,cAAc,SAASC,SAAU,EAAGC,WAAY,EAAGC,UAAW,CAAE,EAClFN,EAAmBO,IAAI,EACvBvC,EAAAiC,aAAA,CAAAjC,EAAAC,QAAA,CAAA,KACE+B,AAAmC,IAAnCA,EAAmBO,IAAI,CAACC,MAAM,EAAUxC,EAAAiC,aAAA,CAAC3B,EAAyB,CAACmC,MAAOhB,EAAE,mBAAoB,GAChGO,EAAmBO,IAAI,CAACC,MAAM,CAAG,GACjCxC,EAAAiC,aAAA,CAACtB,EAAwB,KACxBX,EAAAiC,aAAA,CAACpB,EAAmB,KACnBb,EAAAiC,aAAA,CAACtC,EAAG,CAAC+C,GAAG,UAAUR,QAAQ,OAAOC,cAAc,SAASC,SAAU,EAAGC,WAAY,EAAGC,UAAU,OAAOK,OAAO,MAAM,EACjH3C,EAAAiC,aAAA,CAAC7B,EAAQ,CACRwC,WAAYZ,EAAmBO,IAAI,CAACC,MAAO,CAC3CK,SAAU,GACVN,KAAMP,EAAmBO,IAAK,CAC9BO,WAAY,CAAEC,SAAUxC,CAAwB,EAChDyC,YAAa,CAACC,EAAOC,KAAW,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAC/B,IAAMC,EAAWzB,EAAmBO,IAAI,CAACU,EAAQ,EAAE,CAE7CS,EAAS9C,EAAgBsC,EAASO,GAElCE,EAAStD,EAAauD,eAAe,CAACV,GAEtCW,EAAM,AAA+C,OAA/CV,CAAAA,EAAGpB,MAAAA,EAAY,KAAA,EAAA,AAAS,OAATqB,CAAAA,EAAZrB,EAAc+B,OAAO,AAAPA,GAAOV,AAAA,KAAA,IAAAA,EAAA,KAAA,EAArBA,EAAuBW,QAAQ,CAACb,EAAQc,GAAG,CAAA,GAACb,AAAA,KAAA,IAAAA,GAAAA,EACrDc,EAAO,AAAmD,OAAnDZ,CAAAA,EAAGtB,MAAAA,EAAY,KAAA,EAAA,AAAa,OAAbuB,CAAAA,EAAZvB,EAAcmC,WAAW,AAAXA,GAAWZ,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAzBA,EAA2BS,QAAQ,CAACb,EAAQc,GAAG,CAAA,GAACX,AAAA,KAAA,IAAAA,GAAAA,EAC1Dc,EAAG,AAAoD,OAApDZ,CAAAA,EAAGxB,MAAAA,EAAY,KAAA,EAAA,AAAc,OAAdyB,CAAAA,EAAZzB,EAAcqC,YAAY,AAAZA,GAAYZ,AAAA,KAAA,IAAAA,EAAA,KAAA,EAA1BA,EAA4BO,QAAQ,CAACb,EAAQc,GAAG,CAAA,GAACT,AAAA,KAAA,IAAAA,GAAAA,EAE7D,OACCvD,EAAAiC,aAAA,CAAChC,EAAQ,CAACoE,IAAKnB,EAAQc,GAAAA,AAAI,EACzBN,GAAU1D,EAAAiC,aAAA,CAACrC,EAAc,KAAE8B,EAAWwB,EAAQoB,EAAE,GAEhDX,EACA3D,EAAAiC,aAAA,CAACxB,EAAa,CAACyC,QAASA,EAASpB,eAAgBA,CAAe,GAEhE9B,EAAAiC,aAAA,CAACzB,EAAW,CACX0C,QAASA,EACTqB,WAAY,CAAA,EACZV,OAAQA,EACRI,QAASA,EACTE,IAAKA,EACLK,QAAQ,SACRjD,WAAYA,EACZO,eAAgBA,CAAe,GAKpC,EACA2C,WAAY,KACX5C,EAAUD,GAAUA,EAAQD,EAC7B,CAAE,OAQRJ,GAAcS,EAAmB0C,SAAS,EAAI1E,EAAAiC,aAAA,CAACnB,EAAwB,MAG3E"}