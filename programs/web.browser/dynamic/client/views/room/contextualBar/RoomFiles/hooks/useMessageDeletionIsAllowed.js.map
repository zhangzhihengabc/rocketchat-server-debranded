)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/RoomFiles/hooks/useMessageDeletionIsAllowed.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useSetting, usePermission } from '@rocket.chat/ui-contexts';\nimport { useCallback } from 'react';\n\nimport { getDifference, MINUTES } from '../lib/getDifference';\n\nexport const useMessageDeletionIsAllowed = (rid, uid) => {\n\tconst canForceDelete = usePermission('force-delete-message', rid);\n\tconst deletionIsEnabled = useSetting('Message_AllowDeleting');\n\tconst userHasPermissonToDeleteAny = usePermission('delete-message', rid);\n\tconst userHasPermissonToDeleteOwn = usePermission('delete-own-message');\n\tconst bypassBlockTimeLimit = usePermission('bypass-time-limit-edit-and-delete');\n\tconst blockDeleteInMinutes = useSetting('Message_AllowDeleting_BlockDeleteInMinutes');\n\n\tconst isDeletionAllowed = (() => {\n\t\tif (canForceDelete) {\n\t\t\treturn () => true;\n\t\t}\n\n\t\tif (!deletionIsEnabled) {\n\t\t\treturn () => false;\n\t\t}\n\n\t\tif (!userHasPermissonToDeleteAny && !userHasPermissonToDeleteOwn) {\n\t\t\treturn () => false;\n\t\t}\n\n\t\tconst checkTimeframe =\n\t\t\t!bypassBlockTimeLimit && blockDeleteInMinutes !== 0\n\t\t\t\t? ({ ts }) => {\n\t\t\t\t\t\tif (!ts) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentTsDiff = getDifference(new Date(), new Date(ts), MINUTES);\n\n\t\t\t\t\t\treturn currentTsDiff < blockDeleteInMinutes;\n\t\t\t\t  }\n\t\t\t\t: () => true;\n\n\t\tif (userHasPermissonToDeleteAny) {\n\t\t\treturn checkTimeframe;\n\t\t}\n\n\t\tconst isOwn = ({ uid: owner }) => owner === uid;\n\n\t\treturn (msg) => isOwn(msg) && checkTimeframe(msg);\n\t})();\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\treturn useCallback(isDeletionAllowed, [\n\t\tcanForceDelete,\n\t\tdeletionIsEnabled,\n\t\tuserHasPermissonToDeleteAny,\n\t\tuserHasPermissonToDeleteOwn,\n\t\tblockDeleteInMinutes,\n\t]);\n};\n",null],"names":["useSetting","usePermission","useCallback","getDifference","MINUTES","module","export","useMessageDeletionIsAllowed","link","v","rid","uid","canForceDelete","deletionIsEnabled","userHasPermissonToDeleteAny","userHasPermissonToDeleteOwn","bypassBlockTimeLimit","blockDeleteInMinutes","isDeletionAllowed","checkTimeframe","_ref","ts","currentTsDiff","Date","isOwn","_ref2","owner","msg"],"mappings":"2BAAiFA,EAAWC,EAA4HC,EAAuEC,EAAcC,EAA7SC,EAAOC,MAAM,CAAC,CAACC,4BAA4B,IAAIA,CAA2B,GAAgCF,EAAOG,IAAI,CAAC,2BAA2B,CAACR,WAAWS,CAAC,EAAET,EAAWS,CAAC,EAAER,cAAcQ,CAAC,EAAER,EAAcQ,CAAC,CAAC,EAAE,GAAmBJ,EAAOG,IAAI,CAAC,QAAQ,CAACN,YAAYO,CAAC,EAAEP,EAAYO,CAAC,CAAC,EAAE,GAA6BJ,EAAOG,IAAI,CAAC,uBAAuB,CAACL,cAAcM,CAAC,EAAEN,EAAcM,CAAC,EAAEL,QAAQK,CAAC,EAAEL,EAAQK,CAAC,CAAC,EAAE,GAK3Y,IAAMF,EAA8B,CAACG,EAAKC,KAChD,IAAMC,EAAiBX,EAAc,uBAAwBS,GACvDG,EAAoBb,EAAW,yBAC/Bc,EAA8Bb,EAAc,iBAAkBS,GAC9DK,EAA8Bd,EAAc,sBAC5Ce,EAAuBf,EAAc,qCACrCgB,EAAuBjB,EAAW,8CAElCkB,EAAoB,AAAC,CAAA,KAC1B,GAAIN,EACH,MAAO,IAAM,CAAA,EAGd,GAAI,CAACC,GAID,CAACC,GAA+B,CAACC,EAHpC,MAAO,IAAM,CAAA,EAOd,IAAMI,EACL,AAACH,GAAwBC,AAAyB,IAAzBA,EAUtB,IAAM,CAAA,EATNG,IAAY,GAAX,CAAEC,GAAAA,CAAAA,CAAI,CAAAD,EACP,GAAI,CAACC,EACJ,MAAO,CAAA,EAGR,IAAMC,EAAgBnB,EAAc,IAAIoB,KAAQ,IAAIA,KAAKF,GAAKjB,GAE9D,OAAOkB,EAAgBL,CACvB,EAGJ,GAAIH,EACH,OAAOK,EAGR,IAAMK,EAAQC,IAAA,GAAC,CAAEd,IAAKe,CAAAA,CAAO,CAAAD,EAAA,OAAKC,IAAUf,CAAG,EAE/C,OAAQgB,GAAQH,EAAMG,IAAQR,EAAeQ,EAC9C,CAAA,IAGA,OAAOzB,EAAYgB,EAAmB,CACrCN,EACAC,EACAC,EACAC,EACAE,EACA,CACF"}