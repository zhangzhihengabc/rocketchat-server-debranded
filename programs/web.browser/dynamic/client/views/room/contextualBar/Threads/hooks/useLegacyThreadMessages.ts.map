)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Threads/hooks/useLegacyThreadMessages.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IThreadMessage, IThreadMainMessage } from '@rocket.chat/core-typings';\nimport { isThreadMessage } from '@rocket.chat/core-typings';\nimport { useMethod } from '@rocket.chat/ui-contexts';\nimport { useEffect, useState, useCallback } from 'react';\n\nimport { Messages } from '../../../../../../app/models/client';\nimport { upsertMessageBulk } from '../../../../../../app/ui-utils/client/lib/RoomHistoryManager';\nimport { useReactiveValue } from '../../../../../hooks/useReactiveValue';\n\nexport const useLegacyThreadMessages = (\n\ttmid: IThreadMainMessage['_id'],\n): {\n\tmessages: Array<IThreadMessage | IThreadMainMessage>;\n\tloading: boolean;\n} => {\n\tconst messages = useReactiveValue(\n\t\tuseCallback(() => {\n\t\t\treturn Messages.find(\n\t\t\t\t{\n\t\t\t\t\t$or: [{ tmid }, { _id: tmid }],\n\t\t\t\t\t_hidden: { $ne: true },\n\t\t\t\t\ttmid,\n\t\t\t\t\t_id: { $ne: tmid },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tcollapsed: 0,\n\t\t\t\t\t\tthreadMsg: 0,\n\t\t\t\t\t\trepliesCount: 0,\n\t\t\t\t\t},\n\t\t\t\t\tsort: { ts: 1 },\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.fetch()\n\t\t\t\t.filter(isThreadMessage);\n\t\t}, [tmid]),\n\t);\n\n\tconst [loading, setLoading] = useState(false);\n\n\tconst getThreadMessages = useMethod('getThreadMessages');\n\n\tuseEffect(() => {\n\t\tsetLoading(true);\n\t\tgetThreadMessages({ tmid }).then((messages) => {\n\t\t\tupsertMessageBulk({ msgs: messages }, Messages);\n\t\t\tsetLoading(false);\n\t\t});\n\t}, [getThreadMessages, tmid]);\n\n\treturn { messages, loading };\n};\n",null],"names":["isThreadMessage","useMethod","useEffect","useState","useCallback","Messages","upsertMessageBulk","useReactiveValue","module","export","useLegacyThreadMessages","tmid","messages","find","$or","_id","_hidden","$ne","fields","collapsed","threadMsg","repliesCount","sort","ts","fetch","filter","loading","setLoading","getThreadMessages","then","msgs"],"mappings":"2BAC4DA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5DC,EAAOC,MAAE,CAAA,CAAAC,wBAAuB,IAAAA,CAA4B,GAAAF,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAR,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAP,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,QAAAA,CAAAN,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAH,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,+DAAAA,CAAAF,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAD,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQrD,IAAMG,EACZC,IAKA,IAAMC,EAAWL,EAChBH,EAAY,IACJC,EAASQ,IAAI,CACnB,CACCC,IAAK,CAAC,CAAEH,KAAAA,CAAI,EAAI,CAAEI,IAAKJ,CAAI,EAAG,CAC9BK,QAAS,CAAEC,IAAK,CAAA,CAAI,EACpBN,KAAAA,EACAI,IAAK,CAAEE,IAAKN,CAAI,GAEjB,CACCO,OAAQ,CACPC,UAAW,EACXC,UAAW,EACXC,aAAc,GAEfC,KAAM,CAAEC,GAAI,CAAC,IAGbC,KAAK,GACLC,MAAM,CAACzB,GACP,CAACW,EAAK,GAGJ,CAACe,EAASC,EAAW,CAAGxB,EAAS,CAAA,GAEjCyB,EAAoB3B,EAAU,qBAUpC,OARAC,EAAU,KACTyB,EAAW,CAAA,GACXC,EAAkB,CAAEjB,KAAAA,CAAI,GAAIkB,IAAI,CAAEjB,IACjCN,EAAkB,CAAEwB,KAAMlB,CAAQ,EAAIP,GACtCsB,EAAW,CAAA,EACZ,EACD,EAAG,CAACC,EAAmBjB,EAAK,EAErB,CAAEC,SAAAA,EAAUc,QAAAA,CAAO,CAC3B"}