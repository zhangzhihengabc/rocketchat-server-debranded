)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Threads/hooks/useLegacyThreadMessageListScrolling.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { isEditedMessage } from '@rocket.chat/core-typings';\nimport { useUser } from '@rocket.chat/ui-contexts';\nimport type { ScrollValues } from 'rc-scrollbars';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { callbacks } from '../../../../../../lib/callbacks';\nimport { useRoom } from '../../../contexts/RoomContext';\n\nexport const useLegacyThreadMessageListScrolling = (mainMessage: IMessage) => {\n\tconst listWrapperRef = useRef<HTMLDivElement>(null);\n\tconst listRef = useRef<HTMLElement>(null);\n\n\tconst atBottomRef = useRef(true);\n\n\tconst onScroll = useCallback(({ scrollHeight, scrollTop, clientHeight }: ScrollValues) => {\n\t\tatBottomRef.current = scrollTop >= scrollHeight - clientHeight;\n\t}, []);\n\n\tconst sendToBottomIfNecessary = useCallback(() => {\n\t\tif (atBottomRef.current === true) {\n\t\t\tconst listWrapper = listWrapperRef.current;\n\n\t\t\tlistWrapper?.scrollTo(30, listWrapper.scrollHeight);\n\t\t}\n\t}, []);\n\n\tconst room = useRoom();\n\tconst user = useUser();\n\n\tuseEffect(() => {\n\t\tcallbacks.add(\n\t\t\t'streamNewMessage',\n\t\t\t(msg: IMessage) => {\n\t\t\t\tif (room._id !== msg.rid || isEditedMessage(msg) || msg.tmid !== mainMessage._id) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (msg.u._id === user?._id) {\n\t\t\t\t\tatBottomRef.current = true;\n\t\t\t\t\tsendToBottomIfNecessary();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcallbacks.priority.MEDIUM,\n\t\t\t`thread-scroll-${room._id}`,\n\t\t);\n\n\t\treturn () => {\n\t\t\tcallbacks.remove('streamNewMessage', `thread-scroll-${room._id}`);\n\t\t};\n\t}, [room._id, sendToBottomIfNecessary, user?._id, mainMessage._id]);\n\n\tuseEffect(() => {\n\t\tconst observer = new ResizeObserver(() => {\n\t\t\tsendToBottomIfNecessary();\n\t\t});\n\n\t\tif (listWrapperRef.current) observer.observe(listWrapperRef.current);\n\t\tif (listRef.current) observer.observe(listRef.current);\n\n\t\treturn () => {\n\t\t\tobserver.disconnect();\n\t\t};\n\t}, [sendToBottomIfNecessary]);\n\n\treturn { listWrapperRef, listRef, requestScrollToBottom: sendToBottomIfNecessary, onScroll };\n};\n",null],"names":["isEditedMessage","useUser","useCallback","useEffect","useRef","callbacks","useRoom","module","export","useLegacyThreadMessageListScrolling","mainMessage","listWrapperRef","listRef","atBottomRef","onScroll","_ref","scrollHeight","scrollTop","clientHeight","current","sendToBottomIfNecessary","listWrapper","scrollTo","room","user","add","msg","_id","rid","tmid","u","priority","MEDIUM","concat","remove","observer","ResizeObserver","observe","disconnect","requestScrollToBottom"],"mappings":"2BAC4DA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5DC,EAAOC,MAAE,CAAA,CAAAC,oCAAuB,IAAAA,CAA4B,GAAAF,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAP,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAN,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,QAAAA,CAAAL,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,kCAAAA,CAAAF,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAD,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQrD,IAAMG,EAAuCC,IACnD,IAAMC,EAAiBP,EAAuB,MACxCQ,EAAUR,EAAoB,MAE9BS,EAAcT,EAAO,CAAA,GAErBU,EAAWZ,EAAYa,IAA4D,GAA3D,CAAEC,aAAAA,CAAY,CAAEC,UAAAA,CAAS,CAAEC,aAAAA,CAAAA,CAA4B,CAAAH,CACpFF,CAAAA,EAAYM,OAAO,CAAGF,GAAaD,EAAeE,CACnD,EAAG,EAAE,EAECE,EAA0BlB,EAAY,KAC3C,GAAIW,AAAwB,CAAA,IAAxBA,EAAYM,OAAO,CAAW,CACjC,IAAME,EAAcV,EAAeQ,OAAO,AAE1CE,OAAAA,GAAAA,EAAaC,QAAQ,CAAC,GAAID,EAAYL,YAAY,EAEpD,EAAG,EAAE,EAECO,EAAOjB,IACPkB,EAAOvB,IAqCb,OAnCAE,EAAU,KACTE,EAAUoB,GAAG,CACZ,mBACCC,IACIH,EAAKI,GAAG,GAAKD,EAAIE,GAAG,EAAI5B,EAAgB0B,IAAQA,EAAIG,IAAI,GAAKnB,EAAYiB,GAAG,EAI5ED,EAAII,CAAC,CAACH,GAAG,GAAKH,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,AAAHA,IACvBd,EAAYM,OAAO,CAAG,CAAA,EACtBC,IAEF,EACAf,EAAU0B,QAAQ,CAACC,MAAM,CAAA,iBAAAC,MAAA,CACRV,EAAKI,GAAG,GAGnB,KACNtB,EAAU6B,MAAM,CAAC,mBAAkB,iBAAAD,MAAA,CAAmBV,EAAKI,GAAG,EAC/D,GACE,CAACJ,EAAKI,GAAG,CAAEP,EAAyBI,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,CAAEjB,EAAYiB,GAAG,CAAC,EAElExB,EAAU,KACT,IAAMgC,EAAW,IAAIC,eAAe,KACnChB,GACD,GAKA,OAHIT,EAAeQ,OAAO,EAAEgB,EAASE,OAAO,CAAC1B,EAAeQ,OAAO,EAC/DP,EAAQO,OAAO,EAAEgB,EAASE,OAAO,CAACzB,EAAQO,OAAO,EAE9C,KACNgB,EAASG,UAAU,EACpB,CACD,EAAG,CAAClB,EAAwB,EAErB,CAAET,eAAAA,EAAgBC,QAAAA,EAAS2B,sBAAuBnB,EAAyBN,SAAAA,CAAQ,CAC3F"}