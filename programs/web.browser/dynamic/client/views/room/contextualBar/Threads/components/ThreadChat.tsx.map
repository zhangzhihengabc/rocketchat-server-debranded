)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Threads/components/ThreadChat.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, IThreadMainMessage } from '@rocket.chat/core-typings';\nimport { isEditedMessage } from '@rocket.chat/core-typings';\nimport { Box, CheckBox, Field, FieldLabel, FieldRow } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport React, { useState, useEffect, useCallback } from 'react';\n\nimport { callbacks } from '../../../../../../lib/callbacks';\nimport { ContextualbarContent } from '../../../../../components/Contextualbar';\nimport MessageListErrorBoundary from '../../../MessageList/MessageListErrorBoundary';\nimport DropTargetOverlay from '../../../body/DropTargetOverlay';\nimport { useFileUploadDropTarget } from '../../../body/hooks/useFileUploadDropTarget';\nimport ComposerContainer from '../../../composer/ComposerContainer';\nimport RoomComposer from '../../../composer/RoomComposer/RoomComposer';\nimport { useChat } from '../../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../../contexts/RoomContext';\nimport { useRoomToolbox } from '../../../contexts/RoomToolboxContext';\nimport ThreadMessageList from './ThreadMessageList';\n\ntype ThreadChatProps = {\n\tmainMessage: IThreadMainMessage;\n};\n\nconst ThreadChat = ({ mainMessage }: ThreadChatProps) => {\n\tconst [fileUploadTriggerProps, fileUploadOverlayProps] = useFileUploadDropTarget();\n\n\tconst sendToChannelPreference = useUserPreference<'always' | 'never' | 'default'>('alsoSendThreadToChannel');\n\n\tconst [sendToChannel, setSendToChannel] = useState(() => {\n\t\tswitch (sendToChannelPreference) {\n\t\t\tcase 'always':\n\t\t\t\treturn true;\n\t\t\tcase 'never':\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn !mainMessage.tcount;\n\t\t}\n\t});\n\n\tconst handleSend = useCallback((): void => {\n\t\tif (sendToChannelPreference === 'default') {\n\t\t\tsetSendToChannel(false);\n\t\t}\n\t}, [sendToChannelPreference]);\n\n\tconst { closeTab } = useRoomToolbox();\n\n\tconst handleComposerEscape = useCallback((): void => {\n\t\tcloseTab();\n\t}, [closeTab]);\n\n\tconst chat = useChat();\n\n\tconst handleNavigateToPreviousMessage = useCallback((): void => {\n\t\tchat?.messageEditing.toPreviousMessage();\n\t}, [chat?.messageEditing]);\n\n\tconst handleNavigateToNextMessage = useCallback((): void => {\n\t\tchat?.messageEditing.toNextMessage();\n\t}, [chat?.messageEditing]);\n\n\tconst handleUploadFiles = useCallback(\n\t\t(files: readonly File[]): void => {\n\t\t\tchat?.flows.uploadFiles(files);\n\t\t},\n\t\t[chat?.flows],\n\t);\n\n\tconst room = useRoom();\n\tconst readThreads = useMethod('readThreads');\n\tuseEffect(() => {\n\t\tcallbacks.add(\n\t\t\t'streamNewMessage',\n\t\t\t(msg: IMessage) => {\n\t\t\t\tif (room._id !== msg.rid || isEditedMessage(msg) || msg.tmid !== mainMessage._id) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treadThreads(mainMessage._id);\n\t\t\t},\n\t\t\tcallbacks.priority.MEDIUM,\n\t\t\t`thread-${room._id}`,\n\t\t);\n\n\t\treturn () => {\n\t\t\tcallbacks.remove('streamNewMessage', `thread-${room._id}`);\n\t\t};\n\t}, [mainMessage._id, readThreads, room._id]);\n\n\tconst subscription = useRoomSubscription();\n\tconst sendToChannelID = useUniqueId();\n\tconst t = useTranslation();\n\n\treturn (\n\t\t<ContextualbarContent flexShrink={1} flexGrow={1} paddingInline={0} {...fileUploadTriggerProps}>\n\t\t\t<DropTargetOverlay {...fileUploadOverlayProps} />\n\t\t\t<Box is='section' display='flex' flexDirection='column' flexGrow={1} flexShrink={1} flexBasis='auto' height='full'>\n\t\t\t\t<MessageListErrorBoundary>\n\t\t\t\t\t<ThreadMessageList mainMessage={mainMessage} />\n\t\t\t\t</MessageListErrorBoundary>\n\n\t\t\t\t<RoomComposer>\n\t\t\t\t\t<ComposerContainer\n\t\t\t\t\t\ttmid={mainMessage._id}\n\t\t\t\t\t\tsubscription={subscription}\n\t\t\t\t\t\tonSend={handleSend}\n\t\t\t\t\t\tonEscape={handleComposerEscape}\n\t\t\t\t\t\tonNavigateToPreviousMessage={handleNavigateToPreviousMessage}\n\t\t\t\t\t\tonNavigateToNextMessage={handleNavigateToNextMessage}\n\t\t\t\t\t\tonUploadFiles={handleUploadFiles}\n\t\t\t\t\t\ttshow={sendToChannel}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldRow marginBlock={8}>\n\t\t\t\t\t\t\t\t<CheckBox\n\t\t\t\t\t\t\t\t\tid={sendToChannelID}\n\t\t\t\t\t\t\t\t\tchecked={sendToChannel}\n\t\t\t\t\t\t\t\t\tonChange={() => setSendToChannel((checked) => !checked)}\n\t\t\t\t\t\t\t\t\tname='alsoSendThreadToChannel'\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<FieldLabel htmlFor={sendToChannelID} color='annotation' fontScale='p2'>\n\t\t\t\t\t\t\t\t\t{t('Also_send_to_channel')}\n\t\t\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</ComposerContainer>\n\t\t\t\t</RoomComposer>\n\t\t\t</Box>\n\t\t</ContextualbarContent>\n\t);\n};\n\nexport default ThreadChat;\n",null],"names":["_extends","isEditedMessage","Box","CheckBox","Field","FieldLabel","FieldRow","useUniqueId","useMethod","useTranslation","useUserPreference","React","useState","useEffect","useCallback","callbacks","ContextualbarContent","MessageListErrorBoundary","DropTargetOverlay","useFileUploadDropTarget","ComposerContainer","RoomComposer","useChat","useRoom","useRoomSubscription","useRoomToolbox","ThreadMessageList","module","default","v","link","exportDefault","_ref","mainMessage","fileUploadTriggerProps","fileUploadOverlayProps","sendToChannelPreference","sendToChannel","setSendToChannel","tcount","handleSend","closeTab","handleComposerEscape","chat","handleNavigateToPreviousMessage","messageEditing","toPreviousMessage","handleNavigateToNextMessage","toNextMessage","handleUploadFiles","files","flows","uploadFiles","room","readThreads","add","msg","_id","rid","tmid","priority","MEDIUM","concat","remove","subscription","sendToChannelID","t","createElement","flexShrink","flexGrow","paddingInline","is","display","flexDirection","flexBasis","height","onSend","onEscape","onNavigateToPreviousMessage","onNavigateToNextMessage","onUploadFiles","tshow","marginBlock","id","checked","onChange","name","htmlFor","color","fontScale"],"mappings":"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"}