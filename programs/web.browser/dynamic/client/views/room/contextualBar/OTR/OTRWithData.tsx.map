)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/OTR/OTRWithData.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useUserId } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useEffect, useMemo } from 'react';\n\nimport OTR from '../../../../../app/otr/client/OTR';\nimport { OtrRoomState } from '../../../../../app/otr/lib/OtrRoomState';\nimport { usePresence } from '../../../../hooks/usePresence';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport { useRoom } from '../../contexts/RoomContext';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport OTRComponent from './OTR';\n\nconst OTRWithData = (): ReactElement => {\n\tconst uid = useUserId();\n\tconst room = useRoom();\n\tconst { closeTab } = useRoomToolbox();\n\tconst otr = useMemo(() => {\n\t\tif (!uid) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn OTR.getInstanceByRoomId(uid, room._id);\n\t}, [uid, room._id]);\n\tconst otrState = useReactiveValue(useCallback(() => (otr ? otr.getState() : OtrRoomState.ERROR), [otr]));\n\tconst peerUserPresence = usePresence(otr?.getPeerId());\n\tconst userStatus = peerUserPresence?.status;\n\tconst peerUsername = peerUserPresence?.username;\n\tconst isOnline = !['offline', 'loading'].includes(userStatus || '');\n\n\tconst handleStart = (): void => {\n\t\totr?.handshake();\n\t};\n\n\tconst handleEnd = (): void => {\n\t\totr?.end();\n\t};\n\n\tconst handleReset = (): void => {\n\t\totr?.reset();\n\t\totr?.handshake(true);\n\t};\n\n\tuseEffect(() => {\n\t\tif (otrState !== OtrRoomState.ESTABLISHING) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\totr?.setState(OtrRoomState.TIMEOUT);\n\t\t}, 10000);\n\n\t\treturn (): void => {\n\t\t\tclearTimeout(timeout);\n\t\t};\n\t}, [otr, otrState]);\n\n\treturn (\n\t\t<OTRComponent\n\t\t\tisOnline={isOnline}\n\t\t\tonClickClose={closeTab}\n\t\t\tonClickStart={handleStart}\n\t\t\tonClickEnd={handleEnd}\n\t\t\tonClickRefresh={handleReset}\n\t\t\totrState={otrState}\n\t\t\tpeerUsername={peerUsername}\n\t\t/>\n\t);\n};\n\nexport default OTRWithData;\n",null],"names":["useUserId","React","useCallback","useEffect","useMemo","OTR","OtrRoomState","usePresence","useReactiveValue","useRoom","useRoomToolbox","OTRComponent","module","link","default","exportDefault","uid","room","closeTab","otr","getInstanceByRoomId","_id","otrState","getState","ERROR","peerUserPresence","getPeerId","userStatus","status","peerUsername","username","isOnline","includes","ESTABLISHING","timeout","setTimeout","setState","TIMEOUT","clearTimeout","createElement","onClickClose","onClickStart","handshake","onClickEnd","end","onClickRefresh","reset"],"mappings":"2BAAAA,EAAqDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5CC,EAAWC,IAAA,CAAM,2BAA2B,CAAAb,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAb,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,oCAAAA,CAAAE,QAAAA,CAAAA,EAAAT,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,0CAAAA,CAAAN,aAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAL,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,qCAAAA,CAAAJ,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAH,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,oCAAAA,CAAAF,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAH,EAAAA,CAAA,CAAA,EAAA,GAArDC,EAAOG,aAAa,CAYA,KACnB,IAAMC,EAAMhB,IACNiB,EAAOR,IACP,CAAES,SAAAA,CAAAA,CAAU,CAAGR,IACfS,EAAMf,EAAQ,KACnB,GAAKY,EAIL,OAAOX,EAAIe,mBAAmB,CAACJ,EAAKC,EAAKI,GAAG,CAC7C,EAAG,CAACL,EAAKC,EAAKI,GAAG,CAAC,EACZC,EAAWd,EAAiBN,EAAY,IAAOiB,EAAMA,EAAII,QAAQ,GAAKjB,EAAakB,KAAM,CAAE,CAACL,EAAI,GAChGM,EAAmBlB,EAAYY,MAAAA,EAAG,KAAA,EAAHA,EAAKO,SAAS,IAC7CC,EAAaF,MAAAA,EAAgB,KAAA,EAAhBA,EAAkBG,MAAM,CACrCC,EAAeJ,MAAAA,EAAgB,KAAA,EAAhBA,EAAkBK,QAAQ,CACzCC,EAAW,CAAC,CAAC,UAAW,UAAU,CAACC,QAAQ,CAACL,GAAc,IA6BhE,OAdAxB,EAAU,KACT,GAAImB,IAAahB,EAAa2B,YAAY,CACzC,OAGD,IAAMC,EAAUC,WAAW,KAC1BhB,MAAAA,GAAAA,EAAKiB,QAAQ,CAAC9B,EAAa+B,OAAO,CACnC,EAAG,KAEH,MAAO,KACNC,aAAaJ,EACd,CACD,EAAG,CAACf,EAAKG,EAAS,EAGjBrB,EAAAsC,aAAA,CAAC5B,EAAY,CACZoB,SAAUA,EACVS,aAActB,EACduB,aA/BkB,KACnBtB,MAAAA,GAAAA,EAAKuB,SAAS,EACf,EA8BEC,WA5BgB,KACjBxB,MAAAA,GAAAA,EAAKyB,GAAG,EACT,EA2BEC,eAzBkB,KACnB1B,MAAAA,GAAAA,EAAK2B,KAAK,GACV3B,MAAAA,GAAAA,EAAKuB,SAAS,CAAC,CAAA,EAChB,EAuBEpB,SAAUA,EACVO,aAAcA,CAAa,EAG9B"}