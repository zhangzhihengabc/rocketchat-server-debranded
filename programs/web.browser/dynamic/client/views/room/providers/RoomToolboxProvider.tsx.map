)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/providers/RoomToolboxProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { RoomType, IRoom } from '@rocket.chat/core-typings';\nimport { useMutableCallback, useStableArray } from '@rocket.chat/fuselage-hooks';\nimport { useUserId, useSetting, useRouter, useRouteParameter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo } from 'react';\n\nimport { useRoom } from '../contexts/RoomContext';\nimport { RoomToolboxContext } from '../contexts/RoomToolboxContext';\nimport type { RoomToolboxContextValue, RoomToolboxActionConfig } from '../contexts/RoomToolboxContext';\nimport { useAppsRoomActions } from './hooks/useAppsRoomActions';\nimport { useCoreRoomActions } from './hooks/useCoreRoomActions';\n\nconst groupsDict = {\n\tl: 'live',\n\tv: 'voip',\n\td: 'direct',\n\tp: 'group',\n\tc: 'channel',\n} as const satisfies Record<RoomType, RoomToolboxActionConfig['groups'][number]>;\n\nconst getGroup = (room: IRoom) => {\n\tif (room.teamMain) {\n\t\treturn 'team';\n\t}\n\n\tif (room.t === 'd' && (room.uids?.length ?? 0) > 2) {\n\t\treturn 'direct_multiple';\n\t}\n\n\treturn groupsDict[room.t];\n};\n\ntype RoomToolboxProviderProps = { children: ReactNode };\n\nconst RoomToolboxProvider = ({ children }: RoomToolboxProviderProps) => {\n\tconst room = useRoom();\n\n\tconst router = useRouter();\n\n\tconst openTab = useMutableCallback((actionId: string, context?: string) => {\n\t\tif (actionId === tab?.id && context === undefined) {\n\t\t\treturn closeTab();\n\t\t}\n\n\t\tconst routeName = router.getRouteName();\n\n\t\tif (!routeName) {\n\t\t\tthrow new Error('Route name is not defined');\n\t\t}\n\n\t\tconst { layout } = router.getSearchParameters();\n\n\t\trouter.navigate({\n\t\t\tname: routeName,\n\t\t\tparams: {\n\t\t\t\t...router.getRouteParameters(),\n\t\t\t\ttab: actionId,\n\t\t\t\tcontext: context ?? '',\n\t\t\t},\n\t\t\tsearch: layout ? { layout } : undefined,\n\t\t});\n\t});\n\n\tconst closeTab = useMutableCallback(() => {\n\t\tconst routeName = router.getRouteName();\n\n\t\tif (!routeName) {\n\t\t\tthrow new Error('Route name is not defined');\n\t\t}\n\n\t\trouter.navigate({\n\t\t\tname: routeName,\n\t\t\tparams: {\n\t\t\t\t...router.getRouteParameters(),\n\t\t\t\ttab: '',\n\t\t\t\tcontext: '',\n\t\t\t},\n\t\t\tsearch: router.getSearchParameters(),\n\t\t});\n\t});\n\n\tconst context = useRouteParameter('context');\n\n\tconst coreRoomActions = useCoreRoomActions();\n\tconst appsRoomActions = useAppsRoomActions();\n\n\tconst allowAnonymousRead = useSetting<boolean>('Accounts_AllowAnonymousRead', false);\n\tconst uid = useUserId();\n\n\tconst actions = useStableArray(\n\t\t[...coreRoomActions, ...appsRoomActions]\n\t\t\t.filter((action) => uid || (allowAnonymousRead && 'anonymous' in action && action.anonymous))\n\t\t\t.filter((action) => !action.groups || action.groups.includes(getGroup(room)))\n\t\t\t.sort((a, b) => (a.order ?? 0) - (b.order ?? 0)),\n\t);\n\n\tconst tabActionId = useRouteParameter('tab');\n\tconst tab = useMemo(() => {\n\t\tif (!tabActionId) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn actions.find((action) => action.id === tabActionId);\n\t}, [actions, tabActionId]);\n\n\tconst contextValue = useMemo(\n\t\t(): RoomToolboxContextValue => ({\n\t\t\tactions,\n\t\t\ttab,\n\t\t\tcontext,\n\t\t\topenTab,\n\t\t\tcloseTab,\n\t\t}),\n\t\t[actions, tab, context, openTab, closeTab],\n\t);\n\n\treturn <RoomToolboxContext.Provider value={contextValue}>{children}</RoomToolboxContext.Provider>;\n};\n\nexport default RoomToolboxProvider;\n",null],"names":["_objectSpread","useMutableCallback","useStableArray","useUserId","useSetting","useRouter","useRouteParameter","React","useMemo","useRoom","RoomToolboxContext","useAppsRoomActions","useCoreRoomActions","module","default","link","groupsDict","l","v","d","p","c","getGroup","room","_room$uids$length","_room$uids","teamMain","t","uids","length","exportDefault","_ref","children","router","openTab","actionId","context","tab","id","undefined","closeTab","routeName","getRouteName","Error","layout","getSearchParameters","navigate","name","params","getRouteParameters","search","coreRoomActions","appsRoomActions","allowAnonymousRead","uid","actions","filter","action","anonymous","groups","includes","sort","a","b","_a$order","_b$order","order","tabActionId","find","contextValue","createElement","Provider","value"],"mappings":"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"}