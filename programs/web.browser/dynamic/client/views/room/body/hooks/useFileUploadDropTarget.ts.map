)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/body/hooks/useFileUploadDropTarget.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetting, useTranslation, useUser } from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport type React from 'react';\nimport { useCallback, useMemo } from 'react';\n\nimport { useIsRoomOverMacLimit } from '../../../../hooks/omnichannel/useIsRoomOverMacLimit';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport { roomCoordinator } from '../../../../lib/rooms/roomCoordinator';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom } from '../../contexts/RoomContext';\nimport { useDropTarget } from './useDropTarget';\n\nexport const useFileUploadDropTarget = (): readonly [\n\tfileUploadTriggerProps: {\n\t\tonDragEnter: (event: React.DragEvent<Element>) => void;\n\t},\n\tfileUploadOverlayProps: {\n\t\tvisible: boolean;\n\t\tonDismiss: () => void;\n\t\tenabled: boolean;\n\t\treason?: ReactNode;\n\t},\n] => {\n\tconst room = useRoom();\n\tconst { triggerProps, overlayProps } = useDropTarget();\n\n\tconst isRoomOverMacLimit = useIsRoomOverMacLimit(room);\n\n\tconst t = useTranslation();\n\n\tconst fileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\n\tconst user = useUser();\n\tconst fileUploadAllowedForUser = useReactiveValue(\n\t\tuseCallback(() => !roomCoordinator.readOnly(room._id, { username: user?.username }), [room._id, user?.username]),\n\t);\n\n\tconst chat = useChat();\n\n\tconst onFileDrop = useMutableCallback(async (files: File[]) => {\n\t\tconst { mime } = await import('../../../../../app/utils/lib/mimeTypes');\n\n\t\tconst uploads = Array.from(files).map((file) => {\n\t\t\tObject.defineProperty(file, 'type', { value: mime.lookup(file.name) });\n\t\t\treturn file;\n\t\t});\n\n\t\tchat?.flows.uploadFiles(uploads);\n\t});\n\n\tconst allOverlayProps = useMemo(() => {\n\t\tif (!fileUploadEnabled || isRoomOverMacLimit) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\treason: t('FileUpload_Disabled'),\n\t\t\t\t...overlayProps,\n\t\t\t} as const;\n\t\t}\n\n\t\tif (!fileUploadAllowedForUser) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\treason: t('error-not-allowed'),\n\t\t\t\t...overlayProps,\n\t\t\t} as const;\n\t\t}\n\n\t\treturn {\n\t\t\tenabled: true,\n\t\t\tonFileDrop,\n\t\t\t...overlayProps,\n\t\t} as const;\n\t}, [fileUploadAllowedForUser, fileUploadEnabled, isRoomOverMacLimit, onFileDrop, overlayProps, t]);\n\n\treturn [triggerProps, allOverlayProps] as const;\n};\n",null],"names":["_objectSpread","useMutableCallback","useSetting","useTranslation","useUser","useCallback","useMemo","useIsRoomOverMacLimit","useReactiveValue","roomCoordinator","useChat","useRoom","useDropTarget","module","default","export","useFileUploadDropTarget","room","triggerProps","overlayProps","isRoomOverMacLimit","t","fileUploadEnabled","user","fileUploadAllowedForUser","readOnly","_id","username","chat","onFileDrop","files","mime","dynamicImport","uploads","Array","from","map","file","Object","defineProperty","value","lookup","name","flows","uploadFiles","allOverlayProps","enabled","reason"],"mappings":"2BAAAA,EAAiEC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAxDC,EAAAA,IAAoB,CAAA,uCAAoC,CAAAC,QAAAA,CAAAA,EAAAd,EAAAA,CAAA,CAAA,EAAA,GAAjEa,EAAOE,MAAE,CAAA,CAAAC,wBAA0B,IAAAA,CAA8B,GAAAH,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAZ,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAX,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,QAAAA,CAAAR,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,sDAAAA,CAAAN,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,qCAAAA,CAAAL,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAJ,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAH,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAF,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,kBAAAA,CAAAD,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAa1D,IAAMI,EAA0B,KAWtC,IAAMC,EAAON,IACP,CAAEO,aAAAA,CAAY,CAAEC,aAAAA,CAAAA,CAAc,CAAGP,IAEjCQ,EAAqBb,EAAsBU,GAE3CI,EAAIlB,IAEJmB,EAAoBpB,EAAW,sBAC/BqB,EAAOnB,IACPoB,EAA2BhB,EAChCH,EAAY,IAAM,CAACI,EAAgBgB,QAAQ,CAACR,EAAKS,GAAG,CAAE,CAAEC,SAAUJ,MAAAA,EAAI,KAAA,EAAJA,EAAMI,QAAAA,AAAQ,GAAK,CAACV,EAAKS,GAAG,CAAEH,MAAAA,EAAI,KAAA,EAAJA,EAAMI,QAAQ,CAAC,GAG1GC,EAAOlB,IAEPmB,EAAa5B,EAAmB,MAAO6B,IAC5C,GAAM,CAAEC,KAAAA,CAAAA,CAAM,CAAG,MAAMlB,EAAAmB,aAAA,CAAO,0CAExBC,EAAUC,MAAMC,IAAI,CAACL,GAAOM,GAAG,CAAEC,IACtCC,OAAOC,cAAc,CAACF,EAAM,OAAQ,CAAEG,MAAOT,EAAKU,MAAM,CAACJ,EAAKK,IAAI,CAAC,GAC5DL,GAGRT,OAAAA,GAAAA,EAAMe,KAAK,CAACC,WAAW,CAACX,EACzB,GAEMY,EAAkBvC,EAAQ,IAC/B,AAAI,CAACgB,GAAqBF,EACzBpB,EAAA,CACC8C,QAAS,CAAA,EACTC,OAAQ1B,EAAE,sBAAsB,EAC7BF,GAIAK,EAQLxB,EAAA,CACC8C,QAAS,CAAA,EACTjB,WAAAA,CAAU,EACPV,GAVHnB,EAAA,CACC8C,QAAS,CAAA,EACTC,OAAQ1B,EAAE,oBAAoB,EAC3BF,GASH,CAACK,EAA0BF,EAAmBF,EAAoBS,EAAYV,EAAcE,EAAE,EAEjG,MAAO,CAACH,EAAc2B,EAAyB,AAChD"}