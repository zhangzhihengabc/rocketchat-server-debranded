function module(e,t,n){let l,o,r,s,a,i,u,c,d,m,g,v,p,k,E,f,h,_,M,R,b,w,L,C,y,T,x,N,S,F,P,A,U,B,O,D,H,I,j,G,J,q,Q,W,$,z,Y,K,X,V,Z,ee,et,en,el,eo,er,es;n.link("@babel/runtime/helpers/extends",{default(e){l=e}},0),n.link("@babel/runtime/helpers/objectSpread2",{default(e){o=e}},1),n.link("@rocket.chat/core-typings",{isEditedMessage(e){r=e}},0),n.link("@rocket.chat/ui-contexts",{usePermission(e){s=e},useRole(e){a=e},useRouter(e){i=e},useSearchParameter(e){u=e},useSetting(e){c=e},useTranslation(e){d=e},useUser(e){m=e},useUserPreference(e){g=e}},1),n.link("react",{default(e){v=e},memo(e){p=e},useCallback(e){k=e},useEffect(e){E=e},useMemo(e){f=e},useRef(e){h=e},useState(e){_=e}},2),n.link("use-sync-external-store/shim",{useSyncExternalStore(e){M=e}},3),n.link("../../../../app/models/client",{ChatMessage(e){R=e},RoomRoles(e){b=e}},4),n.link("../../../../app/ui-utils/client",{RoomHistoryManager(e){w=e}},5),n.link("../../../../app/ui/client/views/app/lib/scrolling",{isAtBottom(e){L=e}},6),n.link("../../../../lib/callbacks",{callbacks(e){C=e}},7),n.link("../../../../lib/isTruthy",{isTruthy(e){y=e}},8),n.link("../../../../lib/utils/highOrderFunctions",{withDebouncing(e){T=e},withThrottling(e){x=e}},9),n.link("../../../components/ScrollableContentWrapper",{default(e){N=e}},10),n.link("../../../hooks/useEmbeddedLayout",{useEmbeddedLayout(e){S=e}},11),n.link("../../../hooks/useReactiveQuery",{useReactiveQuery(e){F=e}},12),n.link("../../../lib/RoomManager",{RoomManager(e){P=e}},13),n.link("../../../lib/rooms/roomCoordinator",{roomCoordinator(e){A=e}},14),n.link("../../../lib/utils/setMessageJumpQueryStringParameter",{setMessageJumpQueryStringParameter(e){U=e}},15),n.link("../Announcement",{default(e){B=e}},16),n.link("../MessageList/MessageList",{MessageList(e){O=e}},17),n.link("../MessageList/MessageListErrorBoundary",{default(e){D=e}},18),n.link("../composer/ComposerContainer",{default(e){H=e}},19),n.link("../composer/RoomComposer/RoomComposer",{default(e){I=e}},20),n.link("../contexts/ChatContext",{useChat(e){j=e}},21),n.link("../contexts/RoomContext",{useRoom(e){G=e},useRoomSubscription(e){J=e},useRoomMessages(e){q=e}},22),n.link("../contexts/RoomToolboxContext",{useRoomToolbox(e){Q=e}},23),n.link("../hooks/useScrollMessageList",{useScrollMessageList(e){W=e}},24),n.link("./DropTargetOverlay",{default(e){$=e}},25),n.link("./JumpToRecentMessageButton",{default(e){z=e}},26),n.link("./LeaderBar",{default(e){Y=e}},27),n.link("./LoadingMessagesIndicator",{default(e){K=e}},28),n.link("./RetentionPolicyWarning",{default(e){X=e}},29),n.link("./RoomForeword/RoomForeword",{default(e){V=e}},30),n.link("./UnreadMessagesIndicator",{default(e){Z=e}},31),n.link("./UploadProgressIndicator",{default(e){ee=e}},32),n.link("./hooks/useFileUploadDropTarget",{useFileUploadDropTarget(e){et=e}},33),n.link("./hooks/useGoToHomeOnRemoved",{useGoToHomeOnRemoved(e){en=e}},34),n.link("./hooks/useReadMessageWindowEvents",{useReadMessageWindowEvents(e){el=e}},35),n.link("./hooks/useRestoreScrollPosition",{useRestoreScrollPosition(e){eo=e}},36),n.link("./hooks/useRetentionPolicy",{useRetentionPolicy(e){er=e}},37),n.link("./hooks/useUnreadMessages",{useUnreadMessages(e){es=e}},38),n.exportDefault(p(()=>{let e=d(),t=S(),n=G(),p=m(),ea=Q(),ei=a("admin"),eu=J(),[ec,ed]=_(),[em,eg]=_(!1),[ev,ep]=_(!1),ek=g("hideFlexTab")||void 0,eE=g("hideUsernames"),ef=g("displayAvatars"),eh=h(null),e_=h(null),eM=h(!0),eR=h(0),eb=j();if(!eb)throw Error("No ChatContext provided");let[ew,eL]=et(),eC=k(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=eh.current;return!!t&&!!L(t,e)&&(ep(!1),!0)},[]),ey=W(eh),eT=k(()=>{ey(e=>({left:30,top:null==e?void 0:e.scrollHeight})),ep(!1)},[ey]),ex=k(()=>{!0===eM.current&&eT()},[eT]),eN=k(()=>{eM.current=eC(100)},[eC]),eS=k(()=>{var e;eM.current=!0,ex(),null===(e=eb.composer)||void 0===e||e.focus()},[eb,ex]),eF=k(()=>{eM.current=!0,w.clear(n._id),w.getMoreIfIsEmpty(n._id)},[n._id]),[eP,eA]=es(n),eU=M(eb.uploads.subscribe,eb.uploads.get),{hasMorePreviousMessages:eB,hasMoreNextMessages:eO,isLoadingMoreMessages:eD}=q(),eH=c("Accounts_AllowAnonymousRead"),eI=s("preview-c-room"),ej=!!eu,eG=f(()=>!!n&&"c"!==n.t||!0===eH||!!eI||ej,[eH,eI,n,ej]),eJ=c("UI_Use_Real_Name"),{data:eq}=F(["rooms",n._id,"leader",{not:null==p?void 0:p._id}],()=>{let e=b.findOne({rid:n._id,roles:"leader","u._id":{$ne:null==p?void 0:p._id}});return e?o(o({},e.u),{},{name:eJ&&e.u.name||e.u.username}):null}),eQ=k((e,t)=>{t&&(null==eb||eb.userCard.open(t)(e))},[null==eb?void 0:eb.userCard]),eW=k(()=>{var e;let t=n._id,{firstUnread:l}=w.getRoom(t),o=null==l?void 0:l.get();o||(o=R.findOne({rid:t,ts:{$gt:null==eP?void 0:eP.since}},{sort:{ts:1},limit:1})),o&&(U(null===(e=o)||void 0===e?void 0:e._id),eA(0))},[n._id,null==eP?void 0:eP.since,eA]),e$=k(()=>{eb.readStateManager.markAsRead(),eA(0)},[eb.readStateManager,eA]),ez=k(e=>{eb.uploads.cancel(e)},[eb]),eY=er(n);en(n,null==p?void 0:p._id),E(()=>(C.add("streamNewMessage",e=>{if(!(n._id!==e.rid||r(e))&&!e.tmid){if(e.u._id===(null==p?void 0:p._id)){eT();return}eC()||ep(!0)}},C.priority.MEDIUM,n._id),()=>{C.remove("streamNewMessage",n._id)}),[eC,n._id,eT,null==p?void 0:p._id]),E(()=>{var e;let t=null===(e=eh.current)||void 0===e?void 0:e.querySelector("ul");if(!t)return;let n=new ResizeObserver(()=>{ex()});return n.observe(t),()=>{null==n||n.disconnect()}},[ex]);let eK=i(),eX=f(()=>T({wait:500})(()=>{eb.readStateManager.attemptMarkAsRead()}),[eb.readStateManager]);E(()=>eK.subscribeToRouteChange(()=>{let e=eK.getRouteName();e&&A.isRouteNameKnown(e)&&eX()}),[eX,n._id,eK,ej,null==eu?void 0:eu.alert,null==eu?void 0:eu.unread]),E(()=>{if(!ej){eA(0);return}let e=R.find({rid:n._id,ts:{$lte:ec,$gt:null==eu?void 0:eu.ls}}).count();eA(e)},[ec,n._id,eA,ej,null==eu?void 0:eu.ls]),E(()=>{if(!(null!=eP&&eP.count))return eX()},[eX,n._id,null==eP?void 0:eP.count]),E(()=>{let e=eh.current;if(!e)return;let t=function(){var e;let t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=e_.current;if(!l)return;let o=l.getBoundingClientRect().left+window.pageXOffset,r=l.getBoundingClientRect().top+window.pageYOffset,s=parseFloat(getComputedStyle(l).width);if(null!==(e=t="rtl"===document.dir?document.elementFromPoint(o+s-1,r+n+1):document.elementFromPoint(o+1,r+n+1))&&void 0!==e&&e.classList.contains("rcx-message")||null!=t&&t.classList.contains("rcx-message--sequential"))return t},l=x({wait:300})(()=>{Tracker.afterFlush(()=>{let e=t(0)||t(20)||t(40);if(!e){eA(0);return}let n=R.findOne(e.id);if(!n){eA(0);return}ed(n.ts)})}),o=x({wait:100})(e=>{var t;let l=null===(t=e_.current)||void 0===t?void 0:t.querySelector(".room-leader");l&&(e.target.scrollTop<eR.current?eg(!1):!1===eC(100)&&e.target.scrollTop>parseFloat(getComputedStyle(l).height)&&eg(!0)),eR.current=e.target.scrollTop;let o=e.target.clientHeight,r=w.isLoading(n._id),s=w.hasMore(n._id),a=w.hasMoreNext(n._id);(!1===r&&!0===s||!0===a)&&(!0===s&&eR.current<=o/3?w.getMore(n._id):!0===a&&Math.ceil(eR.current)>=e.target.scrollHeight-o&&w.getMoreNext(n._id,eM))});return e.addEventListener("scroll",l),e.addEventListener("scroll",o),()=>{e.removeEventListener("scroll",l),e.removeEventListener("scroll",o)}},[eC,n._id,eA]),E(()=>{let e=eh.current;if(!e)return;let t=P.getStore(n._id),l=x({wait:30})(()=>{null==t||t.update({scroll:e.scrollTop,atBottom:L(e,50)})}),o=()=>{null!=t&&t.scroll&&!t.atBottom?e.scrollTop=t.scroll:eT(),e.removeEventListener("MessageGroup",o)};return e.addEventListener("scroll",l),e.addEventListener("MessageGroup",o),()=>{e.removeEventListener("MessageGroup",o),e.removeEventListener("scroll",l)}},[n._id,eT]),eo(n._id,ey,eT),E(()=>{let e,t;let n=eh.current;if(!n)return;let l=x({wait:100})(()=>{eN()}),o=()=>{eM.current=!1},r=()=>{eN(),e=setTimeout(()=>eN(),1e3),t=setTimeout(()=>eN(),2e3)};return n.addEventListener("scroll",l),()=>{e&&clearTimeout(e),t&&clearTimeout(t),n.removeEventListener("mousewheel",l),n.removeEventListener("wheel",l),n.removeEventListener("scroll",l),n.removeEventListener("touchstart",o),n.removeEventListener("touchend",r)}},[eN]);let eV=k(()=>{ex()},[ex]),eZ=k(()=>{eb.messageEditing.toPreviousMessage()},[eb.messageEditing]),e0=k(()=>{eb.messageEditing.toNextMessage()},[eb.messageEditing]),e1=k(e=>{eb.flows.uploadFiles(e)},[eb]),e3=u("reply");E(()=>{e3&&eb.data.getMessageByID(e3).then(e=>{var t;e&&(null===(t=eb.composer)||void 0===t||t.quoteMessage(e))})},[eb.data,eb.composer,e3]),E(()=>{eb.uploads.wipeFailedOnes()},[eb]);let e2=k(e=>{let t=e=>!!e&&(!!(e instanceof HTMLButtonElement||"button"===e.getAttribute("role")||e instanceof HTMLAnchorElement||"link"===e.getAttribute("role"))||t(e.parentElement));t(e.target)||ea.closeTab()},[ea]);return el(),v.createElement(v.Fragment,null,!t&&n.announcement&&v.createElement(B,{announcement:n.announcement,announcementDetails:void 0}),v.createElement("div",{className:"main-content-flex"},v.createElement("section",{className:"messages-container flex-tab-main-content ".concat(ei?"admin":""),id:"chat-window-".concat(n._id),"aria-label":e("Channel"),onClick:ek&&e2},v.createElement("div",{className:"messages-container-wrapper"},v.createElement("div",l({className:"messages-container-main"},ew),v.createElement($,eL),v.createElement("div",{className:["container-bars",(eP||eU.length)&&"show"].filter(y).join(" ")},eP&&v.createElement(Z,{count:eP.count,since:eP.since,onJumpButtonClick:eW,onMarkAsReadButtonClick:e$}),eU.map(e=>v.createElement(ee,{key:e.id,id:e.id,name:e.name,percentage:e.percentage,error:e.error instanceof Error?e.error.message:void 0,onClose:ez}))),v.createElement("div",{ref:e_,className:["messages-box",eq&&!em&&"has-leader"].filter(y).join(" ")},v.createElement(z,{visible:ev,onClick:eS,text:e("New_messages")}),v.createElement(z,{visible:eO,onClick:eF,text:e("Jump_to_recent_messages")}),eG?null:v.createElement("div",{className:"content room-not-found error-color"},v.createElement("div",null,e("You_must_join_to_view_messages_in_this_channel"))),eq?v.createElement(Y,{_id:eq._id,username:eq.username,name:eq.name,visible:!em,onAvatarClick:eQ}):null,v.createElement("div",{className:["wrapper",eO&&"has-more-next",eE&&"hide-usernames",!ef&&"hide-avatar"].filter(y).join(" ")},v.createElement(D,null,v.createElement(N,{ref:eh},v.createElement("ul",{className:"messages-list","aria-live":"polite","aria-busy":eD},eG?v.createElement(v.Fragment,null,eB?v.createElement("li",{className:"load-more"},eD?v.createElement(K,null):null):v.createElement("li",{className:"start color-info-font-color"},eY?v.createElement(X,eY):null,v.createElement(V,{user:p,room:n}))):null,v.createElement(O,{rid:n._id,scrollMessageList:ey}),eO?v.createElement("li",{className:"load-more"},eD?v.createElement(K,null):null):null))))),v.createElement(I,null,v.createElement(H,{subscription:eu,onResize:eV,onNavigateToPreviousMessage:eZ,onNavigateToNextMessage:e0,onUploadFiles:e1})))))))}))}
//# sourceMappingURL=/dynamic/client/views/room/body/011260168a911214ae4ec9c853483e3f80298a32.map
