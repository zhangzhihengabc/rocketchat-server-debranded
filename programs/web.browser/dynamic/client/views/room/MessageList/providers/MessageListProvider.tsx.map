)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/MessageList/providers/MessageListProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { isMessageReactionsNormalized, isThreadMainMessage } from '@rocket.chat/core-typings';\nimport { useLayout, useUser, useUserPreference, useSetting, useEndpoint, useSearchParameter } from '@rocket.chat/ui-contexts';\nimport type { VFC, ReactNode } from 'react';\nimport React, { useMemo, memo } from 'react';\n\nimport { getRegexHighlight, getRegexHighlightUrl } from '../../../../../app/highlight-words/client/helper';\nimport type { MessageListContextValue } from '../../../../components/message/list/MessageListContext';\nimport { MessageListContext } from '../../../../components/message/list/MessageListContext';\nimport AttachmentProvider from '../../../../providers/AttachmentProvider';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../contexts/RoomContext';\nimport { useAutoTranslate } from '../hooks/useAutoTranslate';\nimport { useKatex } from '../hooks/useKatex';\nimport { useLoadSurroundingMessages } from '../hooks/useLoadSurroundingMessages';\n\ntype MessageListProviderProps = {\n\tchildren: ReactNode;\n\tscrollMessageList?: MessageListContextValue['scrollMessageList'];\n\tattachmentDimension?: {\n\t\twidth?: number;\n\t\theight?: number;\n\t};\n};\n\nconst MessageListProvider: VFC<MessageListProviderProps> = ({ children, scrollMessageList, attachmentDimension }) => {\n\tconst room = useRoom();\n\n\tif (!room) {\n\t\tthrow new Error('Room not found');\n\t}\n\n\tconst reactToMessage = useEndpoint('POST', '/v1/chat.react');\n\tconst user = useUser();\n\tconst uid = user?._id;\n\tconst username = user?.username;\n\tconst subscription = useRoomSubscription();\n\n\tconst { isMobile } = useLayout();\n\n\tconst showRealName = Boolean(useSetting('UI_Use_Real_Name'));\n\tconst showColors = useSetting('HexColorPreview_Enabled') as boolean;\n\n\tconst displayRolesGlobal = Boolean(useSetting('UI_DisplayRoles'));\n\tconst hideRolesPreference = Boolean(!useUserPreference<boolean>('hideRoles') && !isMobile);\n\tconst showRoles = displayRolesGlobal && hideRolesPreference;\n\tconst showUsername = Boolean(!useUserPreference<boolean>('hideUsernames') && !isMobile);\n\tconst highlights = useUserPreference<string[]>('highlights');\n\n\tconst { showAutoTranslate, autoTranslateLanguage } = useAutoTranslate(subscription);\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\n\tconst hasSubscription = Boolean(subscription);\n\tconst msgParameter = useSearchParameter('msg');\n\n\tuseLoadSurroundingMessages(msgParameter);\n\n\tconst chat = useChat();\n\n\tconst context: MessageListContextValue = useMemo(\n\t\t() => ({\n\t\t\tshowColors,\n\t\t\tuseReactionsFilter: (message: IMessage): ((reaction: string) => string[]) => {\n\t\t\t\tconst { reactions } = message;\n\t\t\t\treturn !showRealName\n\t\t\t\t\t? (reaction: string): string[] =>\n\t\t\t\t\t\t\treactions?.[reaction]?.usernames.filter((user) => user !== username).map((username) => `@${username}`) || []\n\t\t\t\t\t: (reaction: string): string[] => {\n\t\t\t\t\t\t\tif (!reactions?.[reaction]) {\n\t\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!isMessageReactionsNormalized(message)) {\n\t\t\t\t\t\t\t\treturn message.reactions?.[reaction]?.usernames.filter((user) => user !== username).map((username) => `@${username}`) || [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!username) {\n\t\t\t\t\t\t\t\treturn message.reactions[reaction].names;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst index = message.reactions[reaction].usernames.indexOf(username);\n\t\t\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t\t\treturn message.reactions[reaction].names;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn message.reactions[reaction].names.splice(index, 1);\n\t\t\t\t\t  };\n\t\t\t},\n\t\t\tuseUserHasReacted: username\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(reaction): boolean =>\n\t\t\t\t\t\t\tBoolean(message.reactions?.[reaction].usernames.includes(username))\n\t\t\t\t: () => (): boolean => false,\n\t\t\tuseShowFollowing: uid\n\t\t\t\t? ({ message }): boolean => Boolean(message.replies && message.replies.indexOf(uid) > -1 && !isThreadMainMessage(message))\n\t\t\t\t: (): boolean => false,\n\t\t\tautoTranslateLanguage,\n\t\t\tuseShowTranslated: showAutoTranslate,\n\t\t\tuseShowStarred: hasSubscription\n\t\t\t\t? ({ message }): boolean => Boolean(Array.isArray(message.starred) && message.starred.find((star) => star._id === uid))\n\t\t\t\t: (): boolean => false,\n\t\t\tuseMessageDateFormatter:\n\t\t\t\t() =>\n\t\t\t\t(date: Date): string =>\n\t\t\t\t\tdate.toLocaleString(),\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tscrollMessageList,\n\t\t\tjumpToMessageParam: msgParameter,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntaxEnabled: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntaxEnabled: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t\thighlights: highlights\n\t\t\t\t?.map((str) => str.trim())\n\t\t\t\t.map((highlight) => ({\n\t\t\t\t\thighlight,\n\t\t\t\t\tregex: getRegexHighlight(highlight),\n\t\t\t\t\turlRegex: getRegexHighlightUrl(highlight),\n\t\t\t\t})),\n\n\t\t\tuseOpenEmojiPicker: uid\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(e): void => {\n\t\t\t\t\t\t\te.nativeEvent.stopImmediatePropagation();\n\t\t\t\t\t\t\tchat?.emojiPicker.open(e.currentTarget, (emoji: string) => reactToMessage({ messageId: message._id, reaction: emoji }));\n\t\t\t\t\t\t}\n\t\t\t\t: () => (): void => undefined,\n\t\t}),\n\t\t[\n\t\t\tusername,\n\t\t\tuid,\n\t\t\tshowAutoTranslate,\n\t\t\thasSubscription,\n\t\t\tautoTranslateLanguage,\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tkatexEnabled,\n\t\t\tkatexDollarSyntaxEnabled,\n\t\t\tkatexParenthesisSyntaxEnabled,\n\t\t\thighlights,\n\t\t\treactToMessage,\n\t\t\tshowColors,\n\t\t\tmsgParameter,\n\t\t\tscrollMessageList,\n\t\t\tchat?.emojiPicker,\n\t\t],\n\t);\n\n\treturn (\n\t\t<AttachmentProvider width={attachmentDimension?.width} height={attachmentDimension?.height}>\n\t\t\t<MessageListContext.Provider value={context}>{children}</MessageListContext.Provider>\n\t\t</AttachmentProvider>\n\t);\n};\n\nexport default memo(MessageListProvider);\n",null],"names":["_objectSpread","isMessageReactionsNormalized","isThreadMainMessage","useLayout","useUser","useUserPreference","useSetting","useEndpoint","useSearchParameter","React","useMemo","memo","getRegexHighlight","getRegexHighlightUrl","MessageListContext","AttachmentProvider","useChat","useRoom","useRoomSubscription","useAutoTranslate","useKatex","useLoadSurroundingMessages","module","default","v","link","exportDefault","_ref","children","scrollMessageList","attachmentDimension","room","Error","reactToMessage","user","uid","_id","username","subscription","isMobile","showRealName","Boolean","showColors","displayRolesGlobal","hideRolesPreference","showRoles","showUsername","highlights","showAutoTranslate","autoTranslateLanguage","katexEnabled","katexDollarSyntaxEnabled","katexParenthesisSyntaxEnabled","hasSubscription","msgParameter","chat","context","useReactionsFilter","message","reactions","reaction","_message$reactions","_message$reactions$re","usernames","filter","map","concat","names","index","indexOf","splice","_reactions$reaction","useUserHasReacted","_message$reactions2","includes","useShowFollowing","_ref2","replies","useShowTranslated","useShowStarred","_ref3","Array","isArray","starred","find","star","useMessageDateFormatter","date","toLocaleString","jumpToMessageParam","katex","dollarSyntaxEnabled","parenthesisSyntaxEnabled","str","trim","highlight","regex","urlRegex","useOpenEmojiPicker","e","nativeEvent","stopImmediatePropagation","emojiPicker","open","currentTarget","emoji","messageId","undefined","createElement","width","height","Provider","value"],"mappings":"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"}