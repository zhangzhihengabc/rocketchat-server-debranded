)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/hooks/useUserInfoActions/actions/useChangeLeaderAction.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\n\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\n\n// TODO: Remove endpoint concatenation\nexport const useChangeLeaderAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\n\tconst t = useTranslation();\n\tconst room = useUserRoom(rid);\n\tconst { _id: uid } = user;\n\tconst userCanSetLeader = usePermission('set-leader', rid);\n\tconst userSubscription = useUserSubscription(rid);\n\n\tif (!room) {\n\t\tthrow Error('Room not provided');\n\t}\n\n\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\n\tconst { roomCanSetLeader } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\n\tconst isLeader = useUserHasRoomRole(uid, rid, 'leader');\n\n\tconst changeLeaderEndpoint = isLeader ? 'removeLeader' : 'addLeader';\n\tconst changeLeaderMessage = isLeader ? 'removed__username__as__role_' : 'set__username__as__role_';\n\tconst changeLeader = useEndpointAction('POST', `${endpointPrefix}.${changeLeaderEndpoint}`, {\n\t\tsuccessMessage: t(changeLeaderMessage, { username: user.username, role: 'leader' }),\n\t});\n\tconst changeLeaderAction = useMutableCallback(() => changeLeader({ roomId: rid, userId: uid }));\n\tconst changeLeaderOption = useMemo(\n\t\t() =>\n\t\t\troomCanSetLeader && userCanSetLeader\n\t\t\t\t? {\n\t\t\t\t\t\tcontent: t(isLeader ? 'Remove_as_leader' : 'Set_as_leader'),\n\t\t\t\t\t\ticon: 'shield-alt' as const,\n\t\t\t\t\t\tonClick: changeLeaderAction,\n\t\t\t\t\t\ttype: 'privileges' as UserInfoActionType,\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\t[isLeader, roomCanSetLeader, t, userCanSetLeader, changeLeaderAction],\n\t);\n\n\treturn changeLeaderOption;\n};\n",null],"names":["useMutableCallback","useTranslation","usePermission","useUserRoom","useUserSubscription","useMemo","useEndpointAction","getRoomDirectives","useUserHasRoomRole","module","export","useChangeLeaderAction","user","rid","t","room","_id","uid","userCanSetLeader","userSubscription","Error","endpointPrefix","roomCanSetLeader","showingUserId","isLeader","changeLeaderEndpoint","changeLeaderMessage","changeLeader","concat","successMessage","username","role","changeLeaderAction","roomId","userId","changeLeaderOption","content","icon","onClick","type","undefined"],"mappings":"2BACiEA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAjEC,EAAOC,MAAE,CAAA,CAAAC,sBAA0B,IAAAA,CAAA,GAA8BF,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAT,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAR,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,QAAAA,CAAAJ,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,yCAAAA,CAAAH,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAF,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAD,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAU1D,IAAMG,EAAwB,CAACC,EAAuCC,KAC5E,IAAMC,EAAIb,IACJc,EAAOZ,EAAYU,GACnB,CAAEG,IAAKC,CAAAA,CAAK,CAAGL,EACfM,EAAmBhB,EAAc,aAAcW,GAC/CM,EAAmBf,EAAoBS,GAE7C,GAAI,CAACE,EACJ,MAAMK,MAAM,qBAGb,IAAMC,EAAiBN,AAAW,MAAXA,EAAKD,CAAC,CAAW,aAAe,eACjD,CAAEQ,iBAAAA,CAAAA,CAAkB,CAAGf,EAAkB,CAAEQ,KAAAA,EAAMQ,cAAeN,EAAKE,iBAAAA,CAAgB,GACrFK,EAAWhB,EAAmBS,EAAKJ,EAAK,UAExCY,EAAuBD,EAAW,eAAiB,YACnDE,EAAsBF,EAAW,+BAAiC,2BAClEG,EAAerB,EAAkB,OAAM,GAAAsB,MAAA,CAAKP,EAAc,KAAAO,MAAA,CAAIH,GAAwB,CAC3FI,eAAgBf,EAAEY,EAAqB,CAAEI,SAAUlB,EAAKkB,QAAQ,CAAEC,KAAM,QAAQ,KAE3EC,EAAqBhC,EAAmB,IAAM2B,EAAa,CAAEM,OAAQpB,EAAKqB,OAAQjB,CAAG,IACrFkB,EAAqB9B,EAC1B,IACCiB,GAAoBJ,EACjB,CACAkB,QAAStB,EAAEU,EAAW,mBAAqB,iBAC3Ca,KAAM,aACNC,QAASN,EACTO,KAAM,cAENC,KAAAA,EACJ,CAAChB,EAAUF,EAAkBR,EAAGI,EAAkBc,EAAmB,EAGtE,OAAOG,CACR"}