)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/hooks/useUserInfoActions/actions/useChangeOwnerAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription, useSetModal, useUser } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useMemo } from 'react';\n\nimport GenericModal from '../../../../../components/GenericModal';\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\n\nconst getWarningModalForFederatedRooms = (\n\tcloseModalFn: () => void,\n\thandleConfirmFn: () => void,\n\ttitle: string,\n\tconfirmText: string,\n\tbodyText: string,\n): ReactElement => (\n\t<GenericModal\n\t\tvariant='warning'\n\t\tonClose={closeModalFn}\n\t\tonConfirm={handleConfirmFn}\n\t\tonCancel={closeModalFn}\n\t\ttitle={title}\n\t\tconfirmText={confirmText}\n\t>\n\t\t{bodyText}\n\t</GenericModal>\n);\n\n// TODO: Remove endpoint concatenation\nexport const useChangeOwnerAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\n\tconst t = useTranslation();\n\tconst room = useUserRoom(rid);\n\tconst { _id: uid } = user;\n\tconst userCanSetOwner = usePermission('set-owner', rid);\n\tconst isOwner = useUserHasRoomRole(uid, rid, 'owner');\n\tconst userSubscription = useUserSubscription(rid);\n\tconst setModal = useSetModal();\n\tconst { _id: loggedUserId = '' } = useUser() || {};\n\tconst loggedUserIsOwner = useUserHasRoomRole(loggedUserId, rid, 'owner');\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tif (!room) {\n\t\tthrow Error('Room not provided');\n\t}\n\n\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\n\tconst { roomCanSetOwner } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\n\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\n\n\tconst changeOwnerEndpoint = isOwner ? 'removeOwner' : 'addOwner';\n\tconst changeOwnerMessage = isOwner ? 'User__username__removed_from__room_name__owners' : 'User__username__is_now_an_owner_of__room_name_';\n\n\tconst changeOwner = useEndpointAction('POST', `${endpointPrefix}.${changeOwnerEndpoint}` as const, {\n\t\tsuccessMessage: t(changeOwnerMessage, { username: user.username, room_name: roomName }),\n\t});\n\n\tconst handleConfirm = useCallback(() => {\n\t\tchangeOwner({ roomId: rid, userId: uid });\n\t\tcloseModal();\n\t}, [changeOwner, rid, uid, closeModal]);\n\n\tconst handleChangeOwner = useCallback(\n\t\t({ userId }) => {\n\t\t\tif (!isRoomFederated(room)) {\n\t\t\t\treturn changeOwner({ roomId: rid, userId: uid });\n\t\t\t}\n\t\t\tconst changingOwnRole = userId === loggedUserId;\n\n\t\t\tif (changingOwnRole && loggedUserIsOwner) {\n\t\t\t\treturn setModal(() =>\n\t\t\t\t\tgetWarningModalForFederatedRooms(\n\t\t\t\t\t\tcloseModal,\n\t\t\t\t\t\thandleConfirm,\n\t\t\t\t\t\tt('Federation_Matrix_losing_privileges'),\n\t\t\t\t\t\tt('Yes_continue'),\n\t\t\t\t\t\tt('Federation_Matrix_losing_privileges_warning'),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!changingOwnRole && loggedUserIsOwner) {\n\t\t\t\treturn setModal(() =>\n\t\t\t\t\tgetWarningModalForFederatedRooms(\n\t\t\t\t\t\tcloseModal,\n\t\t\t\t\t\thandleConfirm,\n\t\t\t\t\t\tt('Warning'),\n\t\t\t\t\t\tt('Yes_continue'),\n\t\t\t\t\t\tt('Federation_Matrix_giving_same_permission_warning'),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tchangeOwner({ roomId: rid, userId: uid });\n\t\t},\n\t\t[setModal, loggedUserId, loggedUserIsOwner, t, rid, uid, changeOwner, closeModal, handleConfirm, room],\n\t);\n\n\tconst changeOwnerAction = useMutableCallback(async () => handleChangeOwner({ roomId: rid, userId: uid }));\n\tconst changeOwnerOption = useMemo(\n\t\t() =>\n\t\t\t(isRoomFederated(room) && roomCanSetOwner) || (!isRoomFederated(room) && roomCanSetOwner && userCanSetOwner)\n\t\t\t\t? {\n\t\t\t\t\t\tcontent: t(isOwner ? 'Remove_as_owner' : 'Set_as_owner'),\n\t\t\t\t\t\ticon: 'shield-check' as const,\n\t\t\t\t\t\tonClick: changeOwnerAction,\n\t\t\t\t\t\ttype: 'privileges' as UserInfoActionType,\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\t[changeOwnerAction, roomCanSetOwner, userCanSetOwner, isOwner, t, room],\n\t);\n\n\treturn changeOwnerOption;\n};\n",null],"names":["isRoomFederated","useMutableCallback","escapeHTML","useTranslation","usePermission","useUserRoom","useUserSubscription","useSetModal","useUser","React","useCallback","useMemo","GenericModal","useEndpointAction","roomCoordinator","getRoomDirectives","useUserHasRoomRole","module","export","useChangeOwnerAction","default","getWarningModalForFederatedRooms","closeModalFn","handleConfirmFn","title","confirmText","bodyText","createElement","variant","onClose","onConfirm","onCancel","user","rid","t","room","_id","uid","userCanSetOwner","isOwner","userSubscription","setModal","loggedUserId","loggedUserIsOwner","closeModal","Error","endpointPrefix","roomCanSetOwner","showingUserId","roomName","getRoomName","changeOwnerEndpoint","changeOwnerMessage","changeOwner","concat","successMessage","username","room_name","handleConfirm","roomId","userId","handleChangeOwner","_ref","changingOwnRole","changeOwnerAction","changeOwnerOption","content","icon","onClick","type","undefined"],"mappings":"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"}