)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/composer/ComposerMessage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, ISubscription } from '@rocket.chat/core-typings';\nimport { useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ReactNode } from 'react';\nimport React, { memo, useCallback, useMemo } from 'react';\n\nimport { LegacyRoomManager } from '../../../../app/ui-utils/client';\nimport { useReactiveValue } from '../../../hooks/useReactiveValue';\nimport { useChat } from '../contexts/ChatContext';\nimport { useRoom } from '../contexts/RoomContext';\nimport ComposerSkeleton from './ComposerSkeleton';\nimport MessageBox from './messageBox/MessageBox';\n\nexport type ComposerMessageProps = {\n\ttmid?: IMessage['_id'];\n\tchildren?: ReactNode;\n\tsubscription?: ISubscription;\n\treadOnly?: boolean;\n\ttshow?: boolean;\n\tpreviewUrls?: string[];\n\tonResize?: () => void;\n\tonEscape?: () => void;\n\tonSend?: () => void;\n\tonNavigateToNextMessage?: () => void;\n\tonNavigateToPreviousMessage?: () => void;\n\tonUploadFiles?: (files: readonly File[]) => void;\n};\n\nconst ComposerMessage = ({ tmid, readOnly, onSend, ...props }: ComposerMessageProps): ReactElement => {\n\tconst chat = useChat();\n\tconst room = useRoom();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst composerProps = useMemo(\n\t\t() => ({\n\t\t\tonJoin: async (): Promise<void> => {\n\t\t\t\ttry {\n\t\t\t\t\tawait chat?.data?.joinRoom();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonSend: async ({ value: text, tshow, previewUrls }: { value: string; tshow?: boolean; previewUrls?: string[] }): Promise<void> => {\n\t\t\t\ttry {\n\t\t\t\t\tawait chat?.action.stop('typing');\n\t\t\t\t\tconst newMessageSent = await chat?.flows.sendMessage({\n\t\t\t\t\t\ttext,\n\t\t\t\t\t\ttshow,\n\t\t\t\t\t\tpreviewUrls,\n\t\t\t\t\t});\n\t\t\t\t\tif (newMessageSent) onSend?.();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonTyping: async (): Promise<void> => {\n\t\t\t\tif (chat?.composer?.text?.trim() === '') {\n\t\t\t\t\tawait chat?.action.stop('typing');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tawait chat?.action.start('typing');\n\t\t\t},\n\t\t\tonNavigateToPreviousMessage: () => chat?.messageEditing.toPreviousMessage(),\n\t\t\tonNavigateToNextMessage: () => chat?.messageEditing.toNextMessage(),\n\t\t\tonUploadFiles: (files: readonly File[]) => {\n\t\t\t\treturn chat?.flows.uploadFiles(files);\n\t\t\t},\n\t\t}),\n\t\t[chat?.data, chat?.flows, chat?.action, chat?.composer?.text, chat?.messageEditing, dispatchToastMessage, onSend],\n\t);\n\n\tconst publicationReady = useReactiveValue(\n\t\tuseCallback(() => LegacyRoomManager.getOpenedRoomByRid(room._id)?.streamActive ?? false, [room._id]),\n\t);\n\n\tif (!publicationReady) {\n\t\treturn <ComposerSkeleton />;\n\t}\n\n\treturn <MessageBox readOnly={readOnly ?? false} key={room._id} tmid={tmid} {...composerProps} showFormattingTips={true} {...props} />;\n};\n\nexport default memo(ComposerMessage);\n",null],"names":["_extends","_objectWithoutProperties","useToastMessageDispatch","React","memo","useCallback","useMemo","LegacyRoomManager","useReactiveValue","useChat","useRoom","ComposerSkeleton","MessageBox","module","default","v","link","exportDefault","_ref","_chat$composer2","tmid","readOnly","onSend","props","_excluded","chat","room","dispatchToastMessage","composerProps","onJoin","_chat$data","data","joinRoom","error","type","message","_ref2","value","text","tshow","previewUrls","action","stop","newMessageSent","flows","sendMessage","onTyping","_chat$composer","_chat$composer$text","composer","trim","start","onNavigateToPreviousMessage","messageEditing","toPreviousMessage","onNavigateToNextMessage","toNextMessage","onUploadFiles","files","uploadFiles","publicationReady","_LegacyRoomManager$ge","_LegacyRoomManager$ge2","getOpenedRoomByRid","_id","streamActive","createElement","key","showFormattingTips"],"mappings":"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"}