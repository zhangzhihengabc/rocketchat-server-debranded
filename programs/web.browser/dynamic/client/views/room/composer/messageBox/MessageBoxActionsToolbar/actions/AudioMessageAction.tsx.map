)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/composer/messageBox/MessageBoxActionsToolbar/actions/AudioMessageAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport { useSetting } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes } from 'react';\nimport React, { useEffect, useMemo } from 'react';\n\nimport { AudioRecorder } from '../../../../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../../../../lib/chats/ChatAPI';\nimport { useChat } from '../../../../contexts/ChatContext';\nimport { useMediaActionTitle } from '../../hooks/useMediaActionTitle';\nimport { useMediaPermissions } from '../../hooks/useMediaPermissions';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageActionProps = {\n\tchatContext?: ChatAPI;\n\tisMicrophoneDenied?: boolean;\n} & Omit<AllHTMLAttributes<HTMLButtonElement>, 'is'>;\n\nconst AudioMessageAction = ({ chatContext, disabled, isMicrophoneDenied, ...props }: AudioMessageActionProps) => {\n\tconst isFileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\n\tconst isAudioRecorderEnabled = useSetting('Message_AudioRecorderEnabled') as boolean;\n\tconst fileUploadMediaTypeBlackList = useSetting('FileUpload_MediaTypeBlackList') as string;\n\tconst fileUploadMediaTypeWhiteList = useSetting('FileUpload_MediaTypeWhiteList') as string;\n\tconst [isPermissionDenied] = useMediaPermissions('microphone');\n\n\tconst isAllowed = useMemo(\n\t\t() =>\n\t\t\tBoolean(\n\t\t\t\taudioRecorder.isSupported() &&\n\t\t\t\t\t!isMicrophoneDenied &&\n\t\t\t\t\tisFileUploadEnabled &&\n\t\t\t\t\tisAudioRecorderEnabled &&\n\t\t\t\t\t!fileUploadMediaTypeBlackList?.match(/audio\\/mp3|audio\\/\\*/i) &&\n\t\t\t\t\t(!fileUploadMediaTypeWhiteList || fileUploadMediaTypeWhiteList.match(/audio\\/mp3|audio\\/\\*/i)),\n\t\t\t),\n\t\t[fileUploadMediaTypeBlackList, fileUploadMediaTypeWhiteList, isAudioRecorderEnabled, isFileUploadEnabled, isMicrophoneDenied],\n\t);\n\n\tconst getMediaActionTitle = useMediaActionTitle('audio', isPermissionDenied, isFileUploadEnabled, isAudioRecorderEnabled, isAllowed);\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopRecording = useMutableCallback(() => {\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\t});\n\n\tconst setMicrophoneDenied = useMutableCallback((isDenied) => {\n\t\tif (isDenied) {\n\t\t\tstopRecording();\n\t\t}\n\n\t\tchat?.composer?.setIsMicrophoneDenied(isDenied);\n\t});\n\n\tuseEffect(() => {\n\t\tsetMicrophoneDenied(isPermissionDenied);\n\t}, [setMicrophoneDenied, isPermissionDenied]);\n\n\tconst handleRecordButtonClick = () => chat?.composer?.setRecordingMode(true);\n\n\treturn (\n\t\t<MessageComposerAction\n\t\t\ttitle={getMediaActionTitle}\n\t\t\ticon='mic'\n\t\t\tdisabled={disabled || !isAllowed}\n\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-mic'\n\t\t\tdata-qa-id='audio-record'\n\t\t\tonClick={handleRecordButtonClick}\n\t\t\t{...props}\n\t\t/>\n\t);\n};\n\nexport default AudioMessageAction;\n",null],"names":["_extends","_objectWithoutProperties","useMutableCallback","MessageComposerAction","useSetting","React","useEffect","useMemo","AudioRecorder","useChat","useMediaActionTitle","useMediaPermissions","module","default","v","link","audioRecorder","exportDefault","_ref","_useChat","chatContext","disabled","isMicrophoneDenied","props","_excluded","isFileUploadEnabled","isAudioRecorderEnabled","fileUploadMediaTypeBlackList","fileUploadMediaTypeWhiteList","isPermissionDenied","isAllowed","Boolean","isSupported","match","getMediaActionTitle","chat","stopRecording","_chat$composer","action","stop","composer","setRecordingMode","setMicrophoneDenied","isDenied","_chat$composer2","setIsMicrophoneDenied","createElement","title","icon","className","onClick","_chat$composer3"],"mappings":"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"}