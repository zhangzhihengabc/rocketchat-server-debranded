)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/composer/messageBox/MessageBoxActionsToolbar/actions/FileUploadAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Option, OptionContent, OptionIcon } from '@rocket.chat/fuselage';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport { useTranslation, useSetting } from '@rocket.chat/ui-contexts';\nimport type { ChangeEvent, AllHTMLAttributes } from 'react';\nimport React, { useRef } from 'react';\n\nimport type { ChatAPI } from '../../../../../../lib/chats/ChatAPI';\nimport { useChat } from '../../../../contexts/ChatContext';\n\ntype FileUploadActionProps = {\n\tcollapsed?: boolean;\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n} & Omit<AllHTMLAttributes<HTMLButtonElement>, 'is'>;\n\nconst FileUploadAction = ({ collapsed, chatContext, disabled, ...props }: FileUploadActionProps) => {\n\tconst t = useTranslation();\n\tconst fileUploadEnabled = useSetting('FileUpload_Enabled');\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\tconst chat = useChat() ?? chatContext;\n\n\tconst resetFileInput = () => {\n\t\tif (!fileInputRef.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tfileInputRef.current.value = '';\n\t};\n\n\tconst handleUploadChange = async (e: ChangeEvent<HTMLInputElement>) => {\n\t\tconst { mime } = await import('../../../../../../../app/utils/lib/mimeTypes');\n\t\tconst filesToUpload = Array.from(e.target.files ?? []).map((file) => {\n\t\t\tObject.defineProperty(file, 'type', {\n\t\t\t\tvalue: mime.lookup(file.name),\n\t\t\t});\n\t\t\treturn file;\n\t\t});\n\t\tchat?.flows.uploadFiles(filesToUpload, resetFileInput);\n\t};\n\n\tconst handleUpload = () => {\n\t\tfileInputRef.current?.click();\n\t};\n\n\tif (collapsed) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Option\n\t\t\t\t\t{...((!fileUploadEnabled || disabled) && { title: t('Not_Available') })}\n\t\t\t\t\tdisabled={!fileUploadEnabled || disabled}\n\t\t\t\t\tonClick={handleUpload}\n\t\t\t\t>\n\t\t\t\t\t<OptionIcon name='clip' />\n\t\t\t\t\t<OptionContent>{t('File')}</OptionContent>\n\t\t\t\t</Option>\n\t\t\t\t<input ref={fileInputRef} type='file' onChange={handleUploadChange} multiple style={{ display: 'none' }} />\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<MessageComposerAction\n\t\t\t\tdata-qa-id='file-upload'\n\t\t\t\ticon='clip'\n\t\t\t\tdisabled={!fileUploadEnabled || disabled}\n\t\t\t\tonClick={handleUpload}\n\t\t\t\ttitle={t('File')}\n\t\t\t\t{...props}\n\t\t\t/>\n\t\t\t<input ref={fileInputRef} type='file' onChange={handleUploadChange} multiple style={{ display: 'none' }} />\n\t\t</>\n\t);\n};\n\nexport default FileUploadAction;\n",null],"names":["_extends","_objectWithoutProperties","Option","OptionContent","OptionIcon","MessageComposerAction","useTranslation","useSetting","React","useRef","useChat","module","link","default","v","exportDefault","_ref","_useChat","collapsed","chatContext","disabled","props","_excluded","t","fileUploadEnabled","fileInputRef","chat","resetFileInput","current","value","handleUploadChange","e","_e$target$files","mime","dynamicImport","filesToUpload","Array","from","target","files","map","file","Object","defineProperty","lookup","name","flows","uploadFiles","handleUpload","_fileInputRef$current","click","createElement","Fragment","title","onClick","ref","type","onChange","multiple","style","display","icon"],"mappings":"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"}