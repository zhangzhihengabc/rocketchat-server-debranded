)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/composer/messageBox/MessageBoxActionsToolbar/actions/VideoMessageAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Option, OptionIcon, OptionContent } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport { useTranslation, useSetting } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes } from 'react';\nimport React, { useEffect, useMemo } from 'react';\n\nimport { VideoRecorder } from '../../../../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../../../../lib/chats/ChatAPI';\nimport { useChat } from '../../../../contexts/ChatContext';\nimport { useMediaActionTitle } from '../../hooks/useMediaActionTitle';\nimport { useMediaPermissions } from '../../hooks/useMediaPermissions';\n\ntype VideoMessageActionProps = {\n\tcollapsed?: boolean;\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n} & Omit<AllHTMLAttributes<HTMLButtonElement>, 'is'>;\n\nconst VideoMessageAction = ({ collapsed, chatContext, disabled, ...props }: VideoMessageActionProps) => {\n\tconst t = useTranslation();\n\tconst isFileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\n\tconst isVideoRecorderEnabled = useSetting('Message_VideoRecorderEnabled') as boolean;\n\tconst fileUploadMediaTypeBlackList = useSetting('FileUpload_MediaTypeBlackList') as string;\n\tconst fileUploadMediaTypeWhiteList = useSetting('FileUpload_MediaTypeWhiteList') as string;\n\tconst [isPermissionDenied, setIsPermissionDenied] = useMediaPermissions('camera');\n\n\tconst isAllowed = useMemo(\n\t\t() =>\n\t\t\tBoolean(\n\t\t\t\t!isPermissionDenied &&\n\t\t\t\t\tnavigator.mediaDevices &&\n\t\t\t\t\twindow.MediaRecorder &&\n\t\t\t\t\tisFileUploadEnabled &&\n\t\t\t\t\tisVideoRecorderEnabled &&\n\t\t\t\t\t!fileUploadMediaTypeBlackList?.match(/video\\/webm|video\\/\\*/i) &&\n\t\t\t\t\t(!fileUploadMediaTypeWhiteList || fileUploadMediaTypeWhiteList.match(/video\\/webm|video\\/\\*/i)) &&\n\t\t\t\t\tBoolean(VideoRecorder.getSupportedMimeTypes()),\n\t\t\t),\n\t\t[fileUploadMediaTypeBlackList, fileUploadMediaTypeWhiteList, isFileUploadEnabled, isPermissionDenied, isVideoRecorderEnabled],\n\t);\n\n\tconst getMediaActionTitle = useMediaActionTitle('video', isPermissionDenied, isFileUploadEnabled, isVideoRecorderEnabled, isAllowed);\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleOpenVideoMessage = () => {\n\t\tif (!chat?.composer?.recordingVideo.get()) {\n\t\t\tchat?.composer?.setRecordingVideo(true);\n\t\t}\n\t};\n\n\tconst handleDenyVideo = useMutableCallback((isDenied) => {\n\t\tif (isDenied) {\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t}\n\n\t\tsetIsPermissionDenied(isDenied);\n\t});\n\n\tuseEffect(() => {\n\t\thandleDenyVideo(isPermissionDenied);\n\t}, [handleDenyVideo, isPermissionDenied]);\n\n\tif (collapsed) {\n\t\treturn (\n\t\t\t<Option title={getMediaActionTitle} disabled={!isAllowed || disabled} onClick={handleOpenVideoMessage}>\n\t\t\t\t<OptionIcon name='video' />\n\t\t\t\t<OptionContent>{t('Video_message')}</OptionContent>\n\t\t\t</Option>\n\t\t);\n\t}\n\n\treturn (\n\t\t<MessageComposerAction\n\t\t\tdata-qa-id='video-message'\n\t\t\ticon='video'\n\t\t\tdisabled={!isAllowed || disabled}\n\t\t\tonClick={handleOpenVideoMessage}\n\t\t\ttitle={getMediaActionTitle}\n\t\t\t{...props}\n\t\t/>\n\t);\n};\n\nexport default VideoMessageAction;\n",null],"names":["_extends","_objectWithoutProperties","Option","OptionIcon","OptionContent","useMutableCallback","MessageComposerAction","useTranslation","useSetting","React","useEffect","useMemo","VideoRecorder","useChat","useMediaActionTitle","useMediaPermissions","module","link","default","v","exportDefault","_ref","_useChat","collapsed","chatContext","disabled","props","_excluded","t","isFileUploadEnabled","isVideoRecorderEnabled","fileUploadMediaTypeBlackList","fileUploadMediaTypeWhiteList","isPermissionDenied","setIsPermissionDenied","isAllowed","Boolean","navigator","mediaDevices","window","MediaRecorder","match","getSupportedMimeTypes","getMediaActionTitle","chat","handleOpenVideoMessage","_chat$composer","_chat$composer2","composer","recordingVideo","get","setRecordingVideo","handleDenyVideo","isDenied","_chat$composer3","createElement","title","onClick","name","icon"],"mappings":"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"}