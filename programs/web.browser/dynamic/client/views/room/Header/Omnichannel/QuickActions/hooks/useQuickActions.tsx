function module(e,t,a){let n,s,r,o,l,i,c,u,d,m,h,p,v,k,C,_,y,g,f,M,T,E,O,w,b,S,L,R,I,P,H,q;a.link("@babel/runtime/helpers/objectSpread2",{default(e){n=e}},0),a.export({useQuickActions:()=>Q}),a.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){s=e}},0),a.link("@rocket.chat/ui-contexts",{useSetModal(e){r=e},useToastMessageDispatch(e){o=e},useUserId(e){l=e},useSetting(e){i=e},usePermission(e){c=e},useRole(e){u=e},useEndpoint(e){d=e},useMethod(e){m=e},useTranslation(e){h=e},useRouter(e){p=e}},1),a.link("react",{default(e){v=e},useCallback(e){k=e},useState(e){C=e},useEffect(e){_=e}},2),a.link("../../../../../../../app/livechat/client/collections/LivechatInquiry",{LivechatInquiry(e){y=e}},3),a.link("../../../../../../../app/ui-utils/client",{LegacyRoomManager(e){g=e}},4),a.link("../../../../../../../ee/app/livechat-enterprise/client/components/modals/PlaceChatOnHoldModal",{default(e){f=e}},5),a.link("../../../../../../../ee/client/hooks/useHasLicenseModule",{useHasLicenseModule(e){M=e}},6),a.link("../../../../../../components/Omnichannel/modals/CloseChatModal",{default(e){T=e}},7),a.link("../../../../../../components/Omnichannel/modals/CloseChatModalData",{default(e){E=e}},8),a.link("../../../../../../components/Omnichannel/modals/ForwardChatModal",{default(e){O=e}},9),a.link("../../../../../../components/Omnichannel/modals/ReturnChatQueueModal",{default(e){w=e}},10),a.link("../../../../../../components/Omnichannel/modals/TranscriptModal",{default(e){b=e}},11),a.link("../../../../../../hooks/omnichannel/useIsRoomOverMacLimit",{useIsRoomOverMacLimit(e){S=e}},12),a.link("../../../../../../hooks/omnichannel/useOmnichannelRouteConfig",{useOmnichannelRouteConfig(e){L=e}},13),a.link("../../../../../../ui",{quickActionHooks(e){R=e}},14),a.link("../../../../contexts/RoomContext",{useOmnichannelRoom(e){I=e}},15),a.link("../../../../lib/quickActions",{QuickActionsEnum(e){P=e}},16),a.link("./usePutChatOnHoldMutation",{usePutChatOnHoldMutation(e){H=e}},17),a.link("./useReturnChatToQueueMutation",{useReturnChatToQueueMutation(e){q=e}},18);let Q=()=>{var e,t,a;let Q=I(),D=r(),F=p(),A=h(),x=o(),[U,V]=C(!1),j=Q.v._id,B=Q._id,G=l(),z=Q.lastMessage,J=d("GET","/v1/livechat/visitors.info"),K=s(async()=>{if(!j)return;let{visitor:{visitorEmails:e}}=await J({visitorId:j});if(null!=e&&e.length&&e[0].address)return e[0].address});_(()=>{U&&null!=z&&z.token&&D(null)},[z,U,D]);let N=k(()=>D(null),[D]),W=d("POST","/v1/livechat/transcript/:rid",{rid:B}),X=k(async(e,t)=>{try{await W({email:e,subject:t}),N(),x({type:"success",message:A("Livechat_email_transcript_has_been_requested")})}catch(e){x({type:"error",message:e})}},[N,x,W,A]),Y=d("POST","/v1/omnichannel/:rid/request-transcript",{rid:B}),Z=k(async()=>{try{await Y(),x({type:"success",message:A("Livechat_transcript_has_been_requested")})}catch(e){x({type:"error",message:e})}},[x,Y,A]),$=m("livechat:sendTranscript"),ee=k(async(e,t,a)=>{try{await $(a,B,e,t),N()}catch(e){x({type:"error",message:e})}},[N,x,B,$]),et=d("DELETE","/v1/livechat/transcript/:rid",{rid:B}),ea=k(async()=>{try{await et(),x({type:"success",message:A("Livechat_transcript_request_has_been_canceled")}),N()}catch(e){x({type:"error",message:e})}},[N,et,x,A]),en=d("POST","/v1/livechat/room.forward"),es=k(async(e,t,a)=>{if(e&&t)return;let n={roomId:B,comment:a,clientAction:!0};e&&(n.departmentId=e),t&&(n.userId=t);try{await en(n),x({type:"success",message:A("Transferred")}),F.navigate("/home"),g.close(Q.t+B),N()}catch(e){x({type:"error",message:e})}},[N,x,en,Q.t,B,F,A]),er=d("POST","/v1/livechat/room.closeByUser"),eo=k(async(e,t,a,s)=>{try{await er(n(n(n(n({rid:B},e&&{comment:e}),t&&{tags:t}),(null==a?void 0:a.omnichannelTranscriptPDF)&&{generateTranscriptPdf:!0}),null!=a&&a.omnichannelTranscriptEmail&&s?{transcriptEmail:{sendToVisitor:null==a?void 0:a.omnichannelTranscriptEmail,requestData:s}}:{transcriptEmail:{sendToVisitor:!1}})),y.remove({rid:B}),N(),x({type:"success",message:A("Chat_closed_successfully")})}catch(e){x({type:"error",message:e})}},[er,N,x,B,A]),el=q({onSuccess:()=>{g.close(Q.t+B),F.navigate("/home")},onError:e=>{x({type:"error",message:e})},onSettled:()=>{N()}}),ei=H({onSuccess:()=>{x({type:"success",message:A("Chat_On_Hold_Successfully")})},onError:e=>{x({type:"error",message:e})},onSettled:()=>{N()}}),ec=s(async e=>{switch(e){case P.MoveQueue:D(v.createElement(w,{onMoveChat:()=>el.mutate(B),onCancel:()=>{N()}}));break;case P.TranscriptPDF:Z();break;case P.TranscriptEmail:let t=await K();if(!t){x({type:"error",message:A("Customer_without_registered_email")});break}D(v.createElement(b,{room:Q,email:t,onRequest:X,onSend:ee,onDiscard:ea,onCancel:N}));break;case P.ChatForward:D(v.createElement(O,{room:Q,onForward:es,onCancel:N}));break;case P.CloseChat:let a=await K();D(Q.departmentId?v.createElement(E,{visitorEmail:a,departmentId:Q.departmentId,onConfirm:eo,onCancel:N}):v.createElement(T,{visitorEmail:a,onConfirm:eo,onCancel:N}));break;case P.OnHoldChat:D(v.createElement(f,{onOnHoldChat:()=>ei.mutate(B),onCancel:()=>{N(),V(!1)}})),V(!0)}}),eu=L(),ed=i("Livechat_allow_manual_on_hold"),em=u("livechat-manager"),eh=u("livechat-monitor"),ep=(null==Q?void 0:Q.open)&&((null===(e=Q.u)||void 0===e?void 0:e._id)===G||em||eh)&&(null==Q?void 0:null===(t=Q.lastMessage)||void 0===t?void 0:t.t)!=="livechat-close",ev=!!(null!=eu&&eu.returnQueue)&&(null==Q?void 0:Q.u)!==void 0,ek=c("transfer-livechat-guest"),eC=c("send-omnichannel-chat-transcript"),e_=M("livechat-enterprise"),ey=c("request-pdf-transcript"),eg=c("close-livechat-room"),ef=c("close-others-livechat-room"),eM=i("Livechat_allow_manual_on_hold_upon_agent_engagement_only"),eT=!Q.onHold&&Q.u,eE=!(null!==(a=Q.lastMessage)&&void 0!==a&&a.token),eO=!!(ed&&eT&&(!eM||eE)),ew=S(Q),eb=e=>{switch(e){case P.MoveQueue:return!ew&&!!ep&&ev;case P.ChatForward:return!ew&&!!ep&&ek;case P.Transcript:return!ew&&(eC||e_&&ey);case P.TranscriptEmail:return!ew&&eC;case P.TranscriptPDF:return e_&&!ew&&ey;case P.CloseChat:return!!ep&&(eg||ef);case P.OnHoldChat:return!!ep&&eO}return!1},eS=R.map(e=>e()).filter(e=>!!e).filter(e=>{let{options:t,id:a}=e;return t&&(e.options=t.filter(e=>{let{id:t}=e;return eb(t)})),eb(a)}).sort((e,t)=>{var a,n;return(null!==(a=e.order)&&void 0!==a?a:0)-(null!==(n=t.order)&&void 0!==n?n:0)}),eL=s(e=>{ec(e)});return{quickActions:eS,actionDefault:eL}}}
//# sourceMappingURL=/dynamic/client/views/room/Header/Omnichannel/QuickActions/hooks/4bc05fd6d05f7900ceff34485d18c727f556bd0d.map
