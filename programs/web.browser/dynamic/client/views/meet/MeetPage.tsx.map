)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/meet/MeetPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Button, Box, Flex } from '@rocket.chat/fuselage';\nimport { useRouteParameter, useSearchParameter, useTranslation } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport React, { useEffect, useState, useCallback } from 'react';\n\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport UserAvatar from '../../components/avatar/UserAvatar';\nimport { useEmbeddedLayout } from '../../hooks/useEmbeddedLayout';\nimport NotFoundPage from '../notFound/NotFoundPage';\nimport PageLoading from '../root/PageLoading';\nimport CallPage from './CallPage';\nimport './styles.css';\n\nconst MeetPage = () => {\n\tconst t = useTranslation();\n\tconst [isRoomMember, setIsRoomMember] = useState(false);\n\tconst [status, setStatus] = useState(null);\n\tconst [visitorId, setVisitorId] = useState(null);\n\tconst roomId = useRouteParameter('rid');\n\tconst visitorToken = useSearchParameter('token');\n\tconst isLayoutEmbedded = useEmbeddedLayout();\n\tconst [visitorName, setVisitorName] = useState('');\n\tconst [agentName, setAgentName] = useState('');\n\tconst [callStartTime, setCallStartTime] = useState(undefined);\n\n\tconst isMobileDevice = (): boolean => window.innerWidth <= 450;\n\tconst closeCallTab = (): void => window.close();\n\n\tconst setupCallForVisitor = useCallback(async () => {\n\t\tif (!visitorToken || !roomId) {\n\t\t\tthrow new Error('Missing parameters');\n\t\t}\n\n\t\tconst room = (await sdk.rest.get('/v1/livechat/room', {\n\t\t\ttoken: visitorToken,\n\t\t\trid: roomId,\n\t\t})) as any;\n\t\tif (room?.room?.v?.token === visitorToken) {\n\t\t\tsetVisitorId(room.room.v._id);\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [visitorToken, roomId]);\n\n\tconst setupCallForAgent = useCallback(async () => {\n\t\tif (!roomId) {\n\t\t\tthrow new Error('Missing parameters');\n\t\t}\n\n\t\tconst room = (await sdk.rest.get('/v1/rooms.info', { roomId })) as any;\n\t\tif (room?.room?.servedBy?._id === Meteor.userId()) {\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [roomId]);\n\n\tuseEffect(() => {\n\t\tif (visitorToken) {\n\t\t\tsetupCallForVisitor();\n\t\t\treturn;\n\t\t}\n\t\tsetupCallForAgent();\n\t}, [setupCallForAgent, setupCallForVisitor, visitorToken]);\n\n\tif (status === null) {\n\t\treturn <PageLoading />;\n\t}\n\n\tif (!isRoomMember) {\n\t\treturn <NotFoundPage />;\n\t}\n\n\tif (status === 'ended') {\n\t\treturn (\n\t\t\t<Flex.Container direction='column' justifyContent='center'>\n\t\t\t\t<Box width='full' minHeight='sh' alignItems='center' backgroundColor='dark' overflow='hidden' position='relative'>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: '5%',\n\t\t\t\t\t\t\tright: '2%',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName='Self_Video'\n\t\t\t\t\t\tbackgroundColor='dark'\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? visitorName : agentName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize={isMobileDevice() ? 'x32' : 'x48'}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tzIndex={1}\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: isMobileDevice() ? '30%' : '20%',\n\t\t\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\t\t\tjustifyContent: 'center',\n\t\t\t\t\t\t\tflexDirection: 'column',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize='x124'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<p style={{ color: 'white', fontSize: 16, margin: 15 }}>Call Ended!</p>\n\t\t\t\t\t\t<p\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\t\tfontSize: isMobileDevice() ? 15 : 22,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box position='absolute' alignItems='center' style={{ bottom: '20%' }}>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ticon='cross'\n\t\t\t\t\t\t\tsquare\n\t\t\t\t\t\t\ttitle={t('Close_Window')}\n\t\t\t\t\t\t\tonClick={closeCallTab}\n\t\t\t\t\t\t\tbackgroundColor='dark'\n\t\t\t\t\t\t\tborderColor='extra-dark'\n\t\t\t\t\t\t></Button>\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t</Flex.Container>\n\t\t);\n\t}\n\n\treturn (\n\t\t<CallPage\n\t\t\troomId={roomId}\n\t\t\tstatus={status}\n\t\t\tvisitorToken={visitorToken}\n\t\t\tvisitorId={visitorId}\n\t\t\tsetStatus={setStatus}\n\t\t\tvisitorName={visitorName}\n\t\t\tagentName={agentName}\n\t\t\tisLayoutEmbedded={isLayoutEmbedded}\n\t\t\tcallStartTime={callStartTime}\n\t\t/>\n\t);\n};\n\nexport default MeetPage;\n",null],"names":["Button","Box","Flex","useRouteParameter","useSearchParameter","useTranslation","Meteor","React","useEffect","useState","useCallback","sdk","UserAvatar","useEmbeddedLayout","NotFoundPage","PageLoading","CallPage","module","link","v","default","exportDefault","t","isRoomMember","setIsRoomMember","status","setStatus","visitorId","setVisitorId","roomId","visitorToken","isLayoutEmbedded","visitorName","setVisitorName","agentName","setAgentName","callStartTime","setCallStartTime","undefined","setupCallForVisitor","_room$room","_room$room$v","_room$room2","_room$room2$responseB","_room$room3","Error","room","rest","get","token","rid","_id","fname","responseBy","username","servedBy","callStatus","webRtcCallStartTime","setupCallForAgent","_room$room4","_room$room4$servedBy","_room$room5","_room$room5$responseB","_room$room6","userId","createElement","Container","direction","justifyContent","width","minHeight","alignItems","backgroundColor","overflow","position","style","top","right","className","display","margin","size","isMobileDevice","window","innerWidth","zIndex","flexDirection","color","fontSize","bottom","icon","square","title","onClick","close","borderColor"],"mappings":"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"}