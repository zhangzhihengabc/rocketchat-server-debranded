)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/settings/GroupPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ISetting, ISettingColor } from '@rocket.chat/core-typings';\nimport { Accordion, Box, Button, ButtonGroup } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport {\n\tuseToastMessageDispatch,\n\tuseUser,\n\tuseSettingsDispatch,\n\tuseSettings,\n\tuseTranslation,\n\tuseLoadLanguage,\n\tuseRoute,\n} from '@rocket.chat/ui-contexts';\nimport type { FC, ReactNode, FormEvent, MouseEvent } from 'react';\nimport React, { useMemo, memo } from 'react';\n\nimport Page from '../../../components/Page';\nimport type { EditableSetting } from '../EditableSettingsContext';\nimport { useEditableSettingsDispatch, useEditableSettings } from '../EditableSettingsContext';\nimport GroupPageSkeleton from './GroupPageSkeleton';\n\ntype GroupPageProps = {\n\tchildren: ReactNode;\n\theaderButtons?: ReactNode;\n\t_id: string;\n\ti18nLabel: string;\n\ti18nDescription?: string;\n\ttabs?: ReactNode;\n\tisCustom?: boolean;\n};\n\nconst GroupPage: FC<GroupPageProps> = ({\n\tchildren = undefined,\n\theaderButtons = undefined,\n\t_id,\n\ti18nLabel,\n\ti18nDescription = undefined,\n\ttabs = undefined,\n\tisCustom = false,\n}) => {\n\tconst t = useTranslation();\n\tconst user = useUser();\n\tconst router = useRoute('admin-settings');\n\tconst dispatch = useSettingsDispatch();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst loadLanguage = useLoadLanguage();\n\n\tconst changedEditableSettings = useEditableSettings(\n\t\tuseMemo(\n\t\t\t() => ({\n\t\t\t\tgroup: _id,\n\t\t\t\tchanged: true,\n\t\t\t}),\n\t\t\t[_id],\n\t\t),\n\t);\n\n\tconst originalSettings = useSettings(\n\t\tuseMemo(\n\t\t\t() => ({\n\t\t\t\t_id: changedEditableSettings.map(({ _id }) => _id),\n\t\t\t}),\n\t\t\t[changedEditableSettings],\n\t\t),\n\t);\n\n\tconst isColorSetting = (setting: ISetting): setting is ISettingColor => setting.type === 'color';\n\n\tconst save = useMutableCallback(async () => {\n\t\tconst changes = changedEditableSettings.map((setting) => {\n\t\t\tif (isColorSetting(setting)) {\n\t\t\t\treturn {\n\t\t\t\t\t_id: setting._id,\n\t\t\t\t\tvalue: setting.value,\n\t\t\t\t\teditor: setting.editor,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t_id: setting._id,\n\t\t\t\tvalue: setting.value,\n\t\t\t};\n\t\t});\n\n\t\tif (changes.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait dispatch(changes);\n\n\t\t\tif (changes.some(({ _id }) => _id === 'Language')) {\n\t\t\t\tconst lng = user?.language || changes.filter(({ _id }) => _id === 'Language').shift()?.value || 'en';\n\t\t\t\tif (typeof lng === 'string') {\n\t\t\t\t\tawait loadLanguage(lng);\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Settings_updated', { lng }) });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthrow new Error('lng is not a string');\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Settings_updated') });\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst dispatchToEditing = useEditableSettingsDispatch();\n\n\tconst cancel = useMutableCallback(() => {\n\t\tconst settingsToDispatch = changedEditableSettings\n\t\t\t.map(({ _id }) => originalSettings.find((setting) => setting._id === _id))\n\t\t\t.map((setting) => {\n\t\t\t\tif (!setting) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (isColorSetting(setting)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t_id: setting._id,\n\t\t\t\t\t\tvalue: setting.value,\n\t\t\t\t\t\teditor: setting.editor,\n\t\t\t\t\t\tchanged: false,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t_id: setting._id,\n\t\t\t\t\tvalue: setting.value,\n\t\t\t\t\tchanged: false,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter(Boolean);\n\t\tdispatchToEditing(settingsToDispatch as Partial<EditableSetting>[]);\n\t});\n\n\tconst handleSubmit = (event: FormEvent<HTMLFormElement>): void => {\n\t\tevent.preventDefault();\n\t\tsave();\n\t};\n\n\tconst handleBack = useMutableCallback(() => router.push({}));\n\n\tconst handleCancelClick = (event: MouseEvent<HTMLOrSVGElement>): void => {\n\t\tevent.preventDefault();\n\t\tcancel();\n\t};\n\n\tconst handleSaveClick = (event: MouseEvent<HTMLOrSVGElement>): void => {\n\t\tevent.preventDefault();\n\t\tsave();\n\t};\n\n\tif (!_id) {\n\t\treturn <Page>{children}</Page>;\n\t}\n\n\t// The settings\n\tconst isTranslationKey = (key: string): key is TranslationKey => (key as TranslationKey) !== undefined;\n\n\treturn (\n\t\t<Page is='form' action='#' method='post' onSubmit={handleSubmit}>\n\t\t\t<Page.Header onClickBack={handleBack} title={i18nLabel && isTranslationKey(i18nLabel) && t(i18nLabel)}>\n\t\t\t\t<ButtonGroup>{headerButtons}</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t{tabs}\n\t\t\t{isCustom ? (\n\t\t\t\tchildren\n\t\t\t) : (\n\t\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t\t<Box marginBlock='none' marginInline='auto' width='full' maxWidth='x580'>\n\t\t\t\t\t\t{i18nDescription && isTranslationKey(i18nDescription) && t.has(i18nDescription) && (\n\t\t\t\t\t\t\t<Box is='p' color='hint' fontScale='p2'>\n\t\t\t\t\t\t\t\t{t(i18nDescription)}\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t<Accordion className='page-settings'>{children}</Accordion>\n\t\t\t\t\t</Box>\n\t\t\t\t</Page.ScrollableContentWithShadow>\n\t\t\t)}\n\t\t\t<Page.Footer isDirty={!(changedEditableSettings.length === 0)}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t{changedEditableSettings.length > 0 && (\n\t\t\t\t\t\t<Button type='reset' onClick={handleCancelClick}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tchildren={t('Save_changes')}\n\t\t\t\t\t\tclassName='save'\n\t\t\t\t\t\tdisabled={changedEditableSettings.length === 0}\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\ttype='submit'\n\t\t\t\t\t\tonClick={handleSaveClick}\n\t\t\t\t\t/>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Footer>\n\t\t</Page>\n\t);\n};\n\nexport default Object.assign(memo(GroupPage), {\n\tSkeleton: GroupPageSkeleton,\n});\n",null],"names":["Accordion","Box","Button","ButtonGroup","useMutableCallback","useToastMessageDispatch","useUser","useSettingsDispatch","useSettings","useTranslation","useLoadLanguage","useRoute","React","useMemo","memo","Page","useEditableSettingsDispatch","useEditableSettings","GroupPageSkeleton","module","link","v","default","exportDefault","Object","assign","_ref","children","headerButtons","_id","i18nLabel","i18nDescription","tabs","isCustom","t","user","router","dispatch","dispatchToastMessage","loadLanguage","changedEditableSettings","group","changed","originalSettings","map","_ref2","isColorSetting","setting","type","save","changes","value","editor","length","some","_ref3","_changes$filter$shift","lng","language","filter","_ref4","shift","message","Error","error","dispatchToEditing","cancel","settingsToDispatch","_ref5","find","Boolean","handleBack","push","createElement","isTranslationKey","key","undefined","is","action","method","onSubmit","event","preventDefault","Header","onClickBack","title","ScrollableContentWithShadow","marginBlock","marginInline","width","maxWidth","has","color","fontScale","className","Footer","isDirty","onClick","disabled","primary","Skeleton"],"mappings":"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"}