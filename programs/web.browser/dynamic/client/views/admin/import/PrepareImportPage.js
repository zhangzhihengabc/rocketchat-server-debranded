function module(e,t,a){let r,n,l,i,s,o,m,u,c,p,d,g,E,_,f,h,k,I,S,v,b,C,y,T,x,F,P,w,D,B;a.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),a.link("@rocket.chat/fuselage",{Badge(e){n=e},Box(e){l=e},Button(e){i=e},ButtonGroup(e){s=e},Margins(e){o=e},ProgressBar(e){m=e},Throbber(e){u=e},Tabs(e){c=e}},0),a.link("@rocket.chat/fuselage-hooks",{useDebouncedValue(e){p=e},useSafely(e){d=e}},1),a.link("@rocket.chat/ui-contexts",{useEndpoint(e){g=e},useTranslation(e){E=e},useStream(e){_=e},useRouter(e){f=e}},2),a.link("react",{default(e){h=e},useEffect(e){k=e},useState(e){I=e},useMemo(e){S=e}},3),a.link("../../../../app/importer/lib/ImporterProgressStep",{ProgressStep(e){v=e},ImportWaitingStates(e){b=e},ImportFileReadyStates(e){C=e},ImportPreparingStartedStates(e){y=e},ImportingStartedStates(e){T=e},ImportingErrorStates(e){x=e}},4),a.link("../../../../lib/utils/stringUtils",{numberFormat(e){F=e}},5),a.link("../../../components/Page",{default(e){P=e}},6),a.link("./PrepareChannels",{default(e){w=e}},7),a.link("./PrepareUsers",{default(e){D=e}},8),a.link("./useErrorHandler",{useErrorHandler(e){B=e}},9);let U=(e,t)=>new Promise((a,r)=>{let n=()=>{e().then(e=>{if(t(e)){a(e);return}setTimeout(n,1e3)},r)};n()});a.exportDefault(function(){let e=E(),t=B(),[a,O]=d(I(!0)),[L,j]=d(I(null)),[G,H]=d(I(null)),[M,R]=d(I(0)),[W,N]=I([]),[V,q]=I([]),[z,A]=d(I(!1)),J=S(()=>W.filter(e=>{let{do_import:t}=e;return t}).length,[W]),K=S(()=>V.filter(e=>{let{do_import:t}=e;return t}).length,[V]),Q=f(),X=g("GET","/v1/getImportFileData"),Y=g("GET","/v1/getCurrentImportOperation"),Z=g("POST","/v1/startImport"),$=_("importers");k(()=>$("progress",e=>{let{rate:t}=e;j(t)}),[$,j]),k(()=>{let a=async()=>{try{let a=await U(X,e=>e&&!e.waiting);if(!a){t(e("Importer_not_setup")),Q.navigate("/admin/import");return}if(a.step){t(e("Failed_To_Load_Import_Data")),Q.navigate("/admin/import");return}R(a.message_count),N(a.users.map(e=>r(r({},e),{},{do_import:!0}))),q(a.channels.map(e=>r(r({},e),{},{do_import:!0}))),O(!1),j(null)}catch(a){t(a,e("Failed_To_Load_Import_Data")),Q.navigate("/admin/import")}},n=async()=>{try{let{operation:r}=await U(Y,e=>{let{operation:t}=e;return t.valid&&!b.includes(t.status)});if(!r.valid){Q.navigate("/admin/import/new");return}if(T.includes(r.status)){Q.navigate("/admin/import/progress");return}if(r.status===v.USER_SELECTION||y.includes(r.status)||C.includes(r.status)){H(r.status),a();return}if(x.includes(r.status)){t(e("Import_Operation_Failed")),Q.navigate("/admin/import");return}if(r.status===v.DONE){Q.navigate("/admin/import");return}t(e("Unknown_Import_State")),Q.navigate("/admin/import")}catch(a){t(e("Failed_To_Load_Import_Data")),Q.navigate("/admin/import")}};n()},[Y,X,t,Q,R,O,j,H,e]);let ee=async()=>{A(!0);try{await Z({input:{users:W,channels:V}}),Q.navigate("/admin/import/progress")}catch(a){t(a,e("Failed_To_Start_Import")),Q.navigate("/admin/import")}},[et,ea]=I("users"),er=S(()=>e=>()=>ea(e),[]),en=p(G,100),el=!!(!J&&!K&&!M||!J&&!K&&0!==M);return h.createElement(P,null,h.createElement(P.Header,{title:e("Importing_Data")},h.createElement(s,null,h.createElement(i,{icon:"back",secondary:!0,onClick:()=>{Q.navigate("/admin/import")}},e("Back_to_imports")),h.createElement(i,{primary:!0,disabled:z||el,onClick:ee},e("Importer_Prepare_Start_Import")))),h.createElement(P.ScrollableContentWithShadow,null,h.createElement(l,{marginInline:"auto",marginBlock:"x24",width:"full",maxWidth:"590px"},h.createElement(l,{is:"h2",fontScale:"p2m"},en&&e(en.replace("importer_","importer_status_"))),!a&&h.createElement(c,{flexShrink:0},h.createElement(c.Item,{selected:"users"===et,onClick:er("users")},e("Users")," ",h.createElement(n,null,J)),h.createElement(c.Item,{selected:"channels"===et,onClick:er("channels")},e("Channels")," ",h.createElement(n,null,K)),h.createElement(c.Item,{disabled:!0},e("Messages"),h.createElement(n,null,M))),h.createElement(o,{block:"x24"},a&&h.createElement(h.Fragment,null,L?h.createElement(l,{display:"flex",justifyContent:"center",fontScale:"p2"},h.createElement(m,{percentage:L.toFixed(0)}),h.createElement(l,{is:"span",mis:"x24"},F(L,0),"%")):h.createElement(u,{justifyContent:"center"})),!a&&"users"===et&&h.createElement(D,{usersCount:J,users:W,setUsers:N}),!a&&"channels"===et&&h.createElement(w,{channels:V,channelsCount:K,setChannels:q})))))})}
//# sourceMappingURL=/dynamic/client/views/admin/import/d85b850f3fe15217e896fee6a217c050d2a3600d.map
