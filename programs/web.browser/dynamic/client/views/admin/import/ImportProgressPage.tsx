function module(e,t,r){let a,n,o,s,i,l,c,p,m,u,d,g,f,E,_,k,y,h,S;r.link("@rocket.chat/fuselage",{Box(e){a=e},Margins(e){n=e},ProgressBar(e){o=e},Throbber(e){s=e}},0),r.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){i=e}},1),r.link("@rocket.chat/ui-contexts",{useToastMessageDispatch(e){l=e},useEndpoint(e){c=e},useTranslation(e){p=e},useStream(e){m=e},useRouter(e){u=e}},2),r.link("@tanstack/react-query",{useQuery(e){d=e},useMutation(e){g=e},useQueryClient(e){f=e}},3),r.link("react",{default(e){E=e},useEffect(e){_=e}},4),r.link("../../../../app/importer/lib/ImporterProgressStep",{ImportingStartedStates(e){k=e}},5),r.link("../../../../lib/utils/stringUtils",{numberFormat(e){y=e}},6),r.link("../../../components/Page",{default(e){h=e}},7),r.link("./useErrorHandler",{useErrorHandler(e){S=e}},8),r.exportDefault(function e(){let e=f(),t=m("importers"),r=p(),I=l(),v=S(),C=u(),b=c("GET","/v1/getCurrentImportOperation"),w=c("GET","/v1/getImportProgress"),T=g({mutationFn:async t=>{e.setQueryData(["importers","progress"],t)}}),x=d(["ImportProgressPage","currentOperation"],async()=>{let{operation:e}=await b();return e},{refetchInterval:1e3,onSuccess:e=>{let{valid:t,status:a}=e;if(!t){C.navigate("/admin/import");return}if("importer_done"===a){I({type:"success",message:r("Importer_done")}),C.navigate("/admin/import");return}k.includes(a)||C.navigate("/admin/import/prepare")},onError:e=>{v(e,r("Failed_To_Load_Import_Data")),C.navigate("/admin/import")}}),D=i(e=>{let{key:t,step:a,completed:n,total:o}=e;if(!x.isSuccess||t.toLowerCase()!==x.data.importerKey.toLowerCase())return;let s=a[0].toUpperCase()+a.slice(1);switch(a){case"importer_done":r.has(s)&&I({type:"success",message:r(s)}),C.navigate("/admin/import");return;case"importer_import_failed":case"importer_import_cancelled":r.has(s)&&v(s),C.navigate("/admin/import");return;default:T.mutate({step:a,completed:n,total:o})}}),L=d(["importers","progress"],async()=>{let{key:e,step:t,count:{completed:r=0,total:a=0}={}}=await w();return{key:e,step:t,completed:r,total:a}},{enabled:!!x.isSuccess,onSuccess:e=>{if(!e){I({type:"warning",message:r("Importer_not_in_progress")}),C.navigate("/admin/import/prepare");return}k.includes(e.step)||D({key:e.key,step:e.step,total:e.total,completed:e.completed})},onError:e=>{v(e,r("Failed_To_Load_Import_Data")),C.navigate("/admin/import")}});return _(()=>t("progress",e=>{"rate"in e||D({key:e.key,step:e.step,completed:e.count.completed,total:e.count.total})}),[D,t]),E.createElement(h,null,E.createElement(h.Header,{title:r("Importing_Data")}),E.createElement(h.ScrollableContentWithShadow,null,E.createElement(a,{marginInline:"auto",marginBlock:"neg-x24",width:"full",maxWidth:"x580"},E.createElement(n,{block:24},x.isLoading&&E.createElement(s,{justifyContent:"center"}),"idle"!==L.fetchStatus&&L.isLoading&&E.createElement(s,{justifyContent:"center"}),(x.isError||L.isError)&&E.createElement(a,{is:"p"},r("Failed_To_Load_Import_Data")),L.isSuccess&&E.createElement(E.Fragment,null,E.createElement(a,{is:"p",fontScale:"p2"},r(L.data.step[0].toUpperCase()+L.data.step.slice(1))),E.createElement(a,{display:"flex",justifyContent:"center"},E.createElement(o,{percentage:L.data.completed/L.data.total*100}),E.createElement(a,{is:"span",fontScale:"p2",mis:24},y(L.data.completed/L.data.total*100,0),"%")))))))})}
//# sourceMappingURL=/dynamic/client/views/admin/import/ac56703f929422a0c9404cfef3d941d35d2867e0.map
