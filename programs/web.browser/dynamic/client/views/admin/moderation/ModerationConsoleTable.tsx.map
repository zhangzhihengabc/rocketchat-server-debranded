)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/moderation/ModerationConsoleTable.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Pagination, Field, FieldLabel, FieldRow } from '@rocket.chat/fuselage';\nimport { useDebouncedValue, useMediaQuery, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useEndpoint, useToastMessageDispatch, useRoute, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport type { FC } from 'react';\nimport React, { useMemo, useState } from 'react';\n\nimport FilterByText from '../../../components/FilterByText';\nimport GenericNoResults from '../../../components/GenericNoResults';\nimport {\n\tGenericTable,\n\tGenericTableLoadingTable,\n\tGenericTableHeaderCell,\n\tGenericTableBody,\n\tGenericTableHeader,\n} from '../../../components/GenericTable';\nimport { usePagination } from '../../../components/GenericTable/hooks/usePagination';\nimport { useSort } from '../../../components/GenericTable/hooks/useSort';\nimport ModerationConsoleTableRow from './ModerationConsoleTableRow';\nimport DateRangePicker from './helpers/DateRangePicker';\n\n// TODO: Missing error state\nconst ModerationConsoleTable: FC = () => {\n\tconst [text, setText] = useState('');\n\tconst moderationRoute = useRoute('moderation-console');\n\tconst t = useTranslation();\n\tconst isDesktopOrLarger = useMediaQuery('(min-width: 1024px)');\n\n\tconst { sortBy, sortDirection, setSort } = useSort<'reports.ts' | 'reports.message.u.username' | 'reports.description' | 'count'>(\n\t\t'reports.ts',\n\t);\n\tconst { current, itemsPerPage, setItemsPerPage: onSetItemsPerPage, setCurrent: onSetCurrent, ...paginationProps } = usePagination();\n\n\tconst [dateRange, setDateRange] = useState<{ start: string | null; end: string | null }>({\n\t\tstart: '',\n\t\tend: '',\n\t});\n\tconst { start, end } = dateRange;\n\n\tconst query = useDebouncedValue(\n\t\tuseMemo(\n\t\t\t() => ({\n\t\t\t\tselector: text,\n\t\t\t\tsort: JSON.stringify({ [sortBy]: sortDirection === 'asc' ? 1 : -1 }),\n\t\t\t\tcount: itemsPerPage,\n\t\t\t\toffset: current,\n\t\t\t\t...(end && { latest: `${new Date(end).toISOString().slice(0, 10)}T23:59:59.999Z` }),\n\t\t\t\t...(start && { oldest: `${new Date(start).toISOString().slice(0, 10)}T00:00:00.000Z` }),\n\t\t\t}),\n\t\t\t[current, end, itemsPerPage, sortBy, sortDirection, start, text],\n\t\t),\n\t\t500,\n\t);\n\n\tconst getReports = useEndpoint('GET', '/v1/moderation.reportsByUsers');\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst { data, isLoading, isSuccess } = useQuery(['moderation.reports', query], async () => getReports(query), {\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tkeepPreviousData: true,\n\t});\n\n\tconst handleClick = useMutableCallback((id): void => {\n\t\tmoderationRoute.push({\n\t\t\tcontext: 'info',\n\t\t\tid,\n\t\t});\n\t});\n\n\t// header sequence would be: name, reportedMessage, room, postdate, reports, actions\n\tconst headers = useMemo(\n\t\t() => [\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tkey='name'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'reports.message.u.username'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='reports.message.u.username'\n\t\t\t>\n\t\t\t\t{t('Name')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\tisDesktopOrLarger && (\n\t\t\t\t<GenericTableHeaderCell\n\t\t\t\t\tw='x140'\n\t\t\t\t\tkey='username'\n\t\t\t\t\tdirection={sortDirection}\n\t\t\t\t\tactive={sortBy === 'reports.message.u.username'}\n\t\t\t\t\tonClick={setSort}\n\t\t\t\t\tsort='reports.message.u.username'\n\t\t\t\t>\n\t\t\t\t\t{t('Username')}\n\t\t\t\t</GenericTableHeaderCell>\n\t\t\t),\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tkey='reportedMessage'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'reports.description'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='reports.description'\n\t\t\t>\n\t\t\t\t{t('Moderation_Reported_message')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='room' direction={sortDirection}>\n\t\t\t\t{t('Room')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='postdate' direction={sortDirection} active={sortBy === 'reports.ts'} onClick={setSort} sort='reports.ts'>\n\t\t\t\t{t('Moderation_Report_date')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='reports' direction={sortDirection} active={sortBy === 'count'} onClick={setSort} sort='count'>\n\t\t\t\t{t('Moderation_Report_plural')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='actions' width='x48' />,\n\t\t],\n\t\t[sortDirection, sortBy, setSort, t, isDesktopOrLarger],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FilterByText autoFocus placeholder={t('Search')} onChange={({ text }): void => setText(text)} />\n\t\t\t<Field alignSelf='stretch'>\n\t\t\t\t<FieldLabel>{t('Date')}</FieldLabel>\n\t\t\t\t<FieldRow>\n\t\t\t\t\t<DateRangePicker display='flex' flexGrow={1} onChange={setDateRange} />\n\t\t\t\t</FieldRow>\n\t\t\t</Field>\n\t\t\t{isLoading && (\n\t\t\t\t<GenericTable>\n\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t<GenericTableBody>{isLoading && <GenericTableLoadingTable headerCells={6} />}</GenericTableBody>\n\t\t\t\t</GenericTable>\n\t\t\t)}\n\t\t\t{isSuccess && data.reports.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t<GenericTable>\n\t\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t\t{data.reports.map((report) => (\n\t\t\t\t\t\t\t\t<ModerationConsoleTableRow\n\t\t\t\t\t\t\t\t\tkey={report.userId}\n\t\t\t\t\t\t\t\t\treport={report}\n\t\t\t\t\t\t\t\t\tonClick={handleClick}\n\t\t\t\t\t\t\t\t\tisDesktopOrLarger={isDesktopOrLarger}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</GenericTableBody>\n\t\t\t\t\t</GenericTable>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tcurrent={current}\n\t\t\t\t\t\tdivider\n\t\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\t\tcount={data?.total || 0}\n\t\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t\t\t{...paginationProps}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{isSuccess && data.reports.length === 0 && <GenericNoResults />}\n\t\t</>\n\t);\n};\n\nexport default ModerationConsoleTable;\n",null],"names":["_extends","_objectSpread","_objectWithoutProperties","Pagination","Field","FieldLabel","FieldRow","useDebouncedValue","useMediaQuery","useMutableCallback","useEndpoint","useToastMessageDispatch","useRoute","useTranslation","useQuery","React","useMemo","useState","FilterByText","GenericNoResults","GenericTable","GenericTableLoadingTable","GenericTableHeaderCell","GenericTableBody","GenericTableHeader","usePagination","useSort","ModerationConsoleTableRow","DateRangePicker","module","link","default","v","exportDefault","text","setText","moderationRoute","t","isDesktopOrLarger","sortBy","sortDirection","setSort","_usePagination","current","itemsPerPage","setItemsPerPage","onSetItemsPerPage","setCurrent","onSetCurrent","paginationProps","_excluded","dateRange","setDateRange","start","end","query","selector","sort","JSON","stringify","count","offset","latest","concat","Date","toISOString","slice","oldest","getReports","dispatchToastMessage","data","isLoading","isSuccess","onError","error","type","message","keepPreviousData","handleClick","id","push","context","headers","createElement","key","direction","active","onClick","w","width","Fragment","autoFocus","placeholder","onChange","_ref","alignSelf","display","flexGrow","headerCells","reports","length","map","report","userId","divider","total"],"mappings":"2BAAAA,EAAgFC,EAAAC,EAAhFC,EAASC,EAAYC,EAAOC,EAAoDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,kEAAvEC,EAAUC,IAAE,CAAA,iCAAmC,CAAAC,QAAAA,CAAAA,EAAA/B,EAAuBgC,CAAC,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAE,QAAAA,CAAAA,EAAA9B,EAAAA,CAAA,CAAA,EAAA,GAAA4B,EAAAA,IAAAA,CAAAA,iDAAAA,CAAAE,QAAAA,CAAAA,EAAA7B,EAAAA,CAAA,CAAA,EAAA,GAAxC2B,EAAQC,IAAE,CAAA,wBAAM,CAAA3B,WAAwB6B,CAAA,EAAA7B,EAAAA,CAAA,EAAAC,MAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAuB,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAtB,kBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAoB,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAnB,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAgB,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAf,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAe,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAhB,EAAAA,CAAA,EAAAC,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,mCAAAA,CAAAE,QAAAA,CAAAA,EAAAb,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAE,QAAAA,CAAAA,EAAAZ,EAAAA,CAAA,CAAA,EAAA,GAAAU,EAAAA,IAAAA,CAAAA,mCAAAA,CAAAT,aAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,yBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,uBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,uDAAAA,CAAAJ,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,iDAAAA,CAAAH,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAE,QAAAA,CAAAA,EAAAJ,EAAAA,CAAA,CAAA,EAAA,IAAAE,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAE,QAAAA,CAAAA,EAAAH,EAAAA,CAAA,CAAA,EAAA,IAAhFC,EAAOI,aAAY,CAsBgB,KAClC,GAAM,CAACC,EAAMC,EAAQ,CAAGlB,EAAS,IAC3BmB,EAAkBxB,EAAS,sBAC3ByB,EAAIxB,IACJyB,EAAoB9B,EAAc,uBAElC,CAAE+B,OAAAA,CAAM,CAAEC,cAAAA,CAAa,CAAEC,QAAAA,CAAAA,CAAS,CAAGf,EAC1C,cAEDgB,EAAoHjB,IAA9G,CAAEkB,QAAAA,CAAO,CAAEC,aAAAA,CAAY,CAAEC,gBAAiBC,CAAiB,CAAEC,WAAYC,CAAAA,CAAkC,CAAAN,EAAjBO,EAAe/C,EAAAwC,EAAAQ,GAEzG,CAACC,EAAWC,EAAa,CAAGnC,EAAuD,CACxFoC,MAAO,GACPC,IAAK,KAEA,CAAED,MAAAA,CAAK,CAAEC,IAAAA,CAAAA,CAAK,CAAGH,EAEjBI,EAAQhD,EACbS,EACC,IAAAf,EAAAA,EAAA,CACCuD,SAAUtB,EACVuB,KAAMC,KAAKC,SAAS,CAAC,CAAE,CAACpB,EAAM,CAAGC,AAAkB,QAAlBA,EAA0B,EAAI,EAAE,GACjEoB,MAAOhB,EACPiB,OAAQlB,CAAO,EACXW,GAAO,CAAEQ,OAAM,GAAAC,MAAA,CAAK,IAAIC,KAAKV,GAAKW,WAAW,GAAGC,KAAK,CAAC,EAAG,IAAG,iBAAgB,GAC5Eb,GAAS,CAAEc,OAAM,GAAAJ,MAAA,CAAK,IAAIC,KAAKX,GAAOY,WAAW,GAAGC,KAAK,CAAC,EAAG,IAAG,iBAAgB,GAErF,CAACvB,EAASW,EAAKV,EAAcL,EAAQC,EAAea,EAAOnB,EAAK,EAEjE,KAGKkC,EAAa1D,EAAY,MAAO,iCAEhC2D,EAAuB1D,IAEvB,CAAE2D,KAAAA,CAAI,CAAEC,UAAAA,CAAS,CAAEC,UAAAA,CAAAA,CAAW,CAAG1D,EAAS,CAAC,qBAAsByC,EAAM,CAAE,SAAYa,EAAWb,GAAQ,CAC7GkB,QAAUC,IACTL,EAAqB,CAAEM,KAAM,QAASC,QAASF,CAAK,EACrD,EACAG,iBAAkB,CAAA,IAGbC,GAAcrE,EAAoBsE,IACvC3C,EAAgB4C,IAAI,CAAC,CACpBC,QAAS,OACTF,GAAAA,GAEF,GAGMG,GAAUlE,EACf,IAAM,CACLD,EAAAoE,aAAA,CAAC7D,EAAsB,CACtB8D,IAAI,OACJC,UAAW7C,EACX8C,OAAQ/C,AAAW,+BAAXA,EACRgD,QAAS9C,EACTgB,KAAK,4BAA4B,EAEhCpB,EAAE,SAEJC,GACCvB,EAAAoE,aAAA,CAAC7D,EAAsB,CACtBkE,EAAE,OACFJ,IAAI,WACJC,UAAW7C,EACX8C,OAAQ/C,AAAW,+BAAXA,EACRgD,QAAS9C,EACTgB,KAAK,4BAA4B,EAEhCpB,EAAE,aAGLtB,EAAAoE,aAAA,CAAC7D,EAAsB,CACtB8D,IAAI,kBACJC,UAAW7C,EACX8C,OAAQ/C,AAAW,wBAAXA,EACRgD,QAAS9C,EACTgB,KAAK,qBAAqB,EAEzBpB,EAAE,gCAEJtB,EAAAoE,aAAA,CAAC7D,EAAsB,CAAC8D,IAAI,OAAOC,UAAW7C,CAAc,EAC1DH,EAAE,SAEJtB,EAAAoE,aAAA,CAAC7D,EAAsB,CAAC8D,IAAI,WAAWC,UAAW7C,EAAe8C,OAAQ/C,AAAW,eAAXA,EAAyBgD,QAAS9C,EAASgB,KAAK,YAAY,EACnIpB,EAAE,2BAEJtB,EAAAoE,aAAA,CAAC7D,EAAsB,CAAC8D,IAAI,UAAUC,UAAW7C,EAAe8C,OAAQ/C,AAAW,UAAXA,EAAoBgD,QAAS9C,EAASgB,KAAK,OAAO,EACxHpB,EAAE,6BAEJtB,EAAAoE,aAAA,CAAC7D,EAAsB,CAAC8D,IAAI,UAAUK,MAAM,KAAK,GACjD,CACD,CAACjD,EAAeD,EAAQE,EAASJ,EAAGC,EAAkB,EAGvD,OACCvB,EAAAoE,aAAA,CAAApE,EAAA2E,QAAA,CAAA,KACC3E,EAAAoE,aAAA,CAACjE,EAAY,CAACyE,UAAS,CAAA,EAACC,YAAavD,EAAE,UAAWwD,SAAUC,IAAA,GAAC,CAAE5D,KAAAA,CAAAA,CAAM,CAAA4D,EAAA,OAAW3D,EAAQD,EAAK,CAAC,GAC9FnB,EAAAoE,aAAA,CAAC/E,EAAK,CAAC2F,UAAU,SAAS,EACzBhF,EAAAoE,aAAA,CAAC9E,EAAU,KAAEgC,EAAE,SACftB,EAAAoE,aAAA,CAAC7E,EAAQ,KACRS,EAAAoE,aAAA,CAACvD,EAAe,CAACoE,QAAQ,OAAOC,SAAU,EAAGJ,SAAUzC,CAAa,KAGrEmB,GACAxD,EAAAoE,aAAA,CAAC/D,EAAY,KACZL,EAAAoE,aAAA,CAAC3D,EAAkB,KAAE0D,IACrBnE,EAAAoE,aAAA,CAAC5D,EAAgB,KAAEgD,GAAaxD,EAAAoE,aAAA,CAAC9D,EAAwB,CAAC6E,YAAa,CAAE,KAG1E1B,GAAaF,EAAK6B,OAAO,CAACC,MAAM,CAAG,GACnCrF,EAAAoE,aAAA,CAAApE,EAAA2E,QAAA,CAAA,KACC3E,EAAAoE,aAAA,CAAC/D,EAAY,KACZL,EAAAoE,aAAA,CAAC3D,EAAkB,KAAE0D,IACrBnE,EAAAoE,aAAA,CAAC5D,EAAgB,KACf+C,EAAK6B,OAAO,CAACE,GAAG,CAAEC,GAClBvF,EAAAoE,aAAA,CAACxD,EAAyB,CACzByD,IAAKkB,EAAOC,MAAO,CACnBD,OAAQA,EACRf,QAAST,GACTxC,kBAAmBA,CAAkB,MAKzCvB,EAAAoE,aAAA,CAAChF,EAAUH,EAAA,CACV2C,QAASA,EACT6D,QAAO,CAAA,EACP5D,aAAcA,EACdgB,MAAO,AAAAU,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMmC,KAAK,AAALA,GAAS,EACtB3D,kBAAmBA,EACnBE,aAAcA,CAAa,EACvBC,KAINuB,GAAaF,AAAwB,IAAxBA,EAAK6B,OAAO,CAACC,MAAM,EAAUrF,EAAAoE,aAAA,CAAChE,EAAgB,MAG/D"}