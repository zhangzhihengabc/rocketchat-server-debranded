)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/customSounds/EditSound.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Button, ButtonGroup, Margins, TextInput, Field, FieldLabel, FieldRow, IconButton } from '@rocket.chat/fuselage';\nimport { useSetModal, useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, SyntheticEvent } from 'react';\nimport React, { useCallback, useState, useMemo, useEffect } from 'react';\n\nimport { ContextualbarScrollableContent, ContextualbarFooter } from '../../../components/Contextualbar';\nimport GenericModal from '../../../components/GenericModal';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\ntype EditSoundProps = {\n\tclose?: () => void;\n\tonChange: () => void;\n\tdata: {\n\t\t_id: string;\n\t\tname: string;\n\t\textension?: string;\n\t};\n};\n\nfunction EditSound({ close, onChange, data, ...props }: EditSoundProps): ReactElement {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst { _id, name: previousName } = data || {};\n\tconst previousSound = useMemo(() => data || {}, [data]);\n\n\tconst [name, setName] = useState(() => data?.name ?? '');\n\tconst [sound, setSound] = useState(() => data);\n\n\tuseEffect(() => {\n\t\tsetName(previousName || '');\n\t\tsetSound(previousSound || '');\n\t}, [previousName, previousSound, _id]);\n\n\tconst deleteCustomSound = useMethod('deleteCustomSound');\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst hasUnsavedChanges = useMemo(() => previousName !== name || previousSound !== sound, [name, previousName, previousSound, sound]);\n\n\tconst saveAction = useCallback(\n\t\tasync (sound) => {\n\t\t\tconst soundData = createSoundData(sound, name, { previousName, previousSound, _id, extension: sound.extension });\n\t\t\tconst validation = validate(soundData, sound);\n\t\t\tif (validation.length === 0) {\n\t\t\t\tlet soundId: string;\n\t\t\t\ttry {\n\t\t\t\t\tsoundId = await insertOrUpdateSound(soundData);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsoundData._id = soundId;\n\t\t\t\tsoundData.random = Math.round(Math.random() * 1000);\n\n\t\t\t\tif (sound && sound !== previousSound) {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(sound);\n\t\t\t\t\treader.onloadend = (): void => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tuploadCustomSound(reader.result as string, sound.type, { ...soundData, _id: soundId });\n\t\t\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvalidation.forEach((error) =>\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('error-the-field-is-required', { field: t(error) }),\n\t\t\t\t}),\n\t\t\t);\n\t\t},\n\t\t[_id, dispatchToastMessage, insertOrUpdateSound, name, previousName, previousSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\tsaveAction(sound);\n\t\tonChange();\n\t}, [saveAction, sound, onChange]);\n\n\tconst handleDeleteButtonClick = useCallback(() => {\n\t\tconst handleDelete = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait deleteCustomSound(_id);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Has_Been_Deleted') });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t} finally {\n\t\t\t\tsetModal(null);\n\t\t\t\tclose?.();\n\t\t\t\tonChange();\n\t\t\t}\n\t\t};\n\n\t\tconst handleCancel = (): void => setModal(null);\n\n\t\tsetModal(() => (\n\t\t\t<GenericModal variant='danger' onConfirm={handleDelete} onCancel={handleCancel} onClose={handleCancel} confirmText={t('Delete')}>\n\t\t\t\t{t('Custom_Sound_Delete_Warning')}\n\t\t\t</GenericModal>\n\t\t));\n\t}, [_id, close, deleteCustomSound, dispatchToastMessage, onChange, setModal, t]);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent {...props}>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Name')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\t\tonChange={(e: SyntheticEvent<HTMLInputElement>): void => setName(e.currentTarget.value)}\n\t\t\t\t\t\t\tplaceholder={t('Name')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel alignSelf='stretch'>{t('Sound_File_mp3')}</FieldLabel>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t\t<IconButton icon='upload' secondary onClick={clickUpload} />\n\t\t\t\t\t\t\t{sound?.name || 'none'}\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t</Field>\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button onClick={close}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button primary onClick={handleSave} disabled={!hasUnsavedChanges}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t\t<ButtonGroup mbs={8} stretch>\n\t\t\t\t\t<Button icon='trash' danger onClick={handleDeleteButtonClick}>\n\t\t\t\t\t\t{t('Delete')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n}\n\nexport default EditSound;\n",null],"names":["_objectSpread","_objectWithoutProperties","Box","Button","ButtonGroup","Margins","TextInput","Field","FieldLabel","FieldRow","useSetModal","useToastMessageDispatch","useMethod","useTranslation","React","useCallback","useState","useMemo","useEffect","ContextualbarScrollableContent","ContextualbarFooter","GenericModal","useFileInput","validate","createSoundData","module","link","default","v","IconButton","exportDefault","_ref","close","onChange","data","props","_excluded","t","dispatchToastMessage","setModal","_id","name","previousName","previousSound","setName","_data$name","sound","setSound","deleteCustomSound","uploadCustomSound","insertOrUpdateSound","handleChangeFile","soundFile","hasUnsavedChanges","saveAction","soundData","extension","validation","length","soundId","error","type","message","random","Math","round","reader","FileReader","readAsBinaryString","onloadend","result","forEach","field","handleSave","handleDeleteButtonClick","handleDelete","handleCancel","createElement","variant","onConfirm","onCancel","onClose","confirmText","clickUpload","Fragment","value","e","currentTarget","placeholder","alignSelf","display","flexDirection","mbs","inline","icon","secondary","onClick","stretch","primary","disabled","danger"],"mappings":"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"}