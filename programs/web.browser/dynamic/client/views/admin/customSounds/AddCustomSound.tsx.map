)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/customSounds/AddCustomSound.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Field, FieldLabel, FieldRow, TextInput, Box, Icon, Margins, Button, ButtonGroup } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, FormEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\n\nimport { ContextualbarScrollableContent, ContextualbarFooter } from '../../../components/Contextualbar';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\ntype AddCustomSoundProps = {\n\tgoToNew: (_id: string) => () => void;\n\tclose: () => void;\n\tonChange: () => void;\n};\n\nconst AddCustomSound = ({ goToNew, close, onChange, ...props }: AddCustomSoundProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [name, setName] = useState('');\n\tconst [sound, setSound] = useState<{ name: string }>();\n\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\tconst saveAction = useCallback(\n\t\tasync (name, soundFile): Promise<string | undefined> => {\n\t\t\tconst soundData = createSoundData(soundFile, name);\n\t\t\tconst validation = validate(soundData, soundFile) as Array<Parameters<typeof t>[0]>;\n\n\t\t\tvalidation.forEach((error) => {\n\t\t\t\tthrow new Error(t('error-the-field-is-required', { field: t(error) }));\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst soundId = await insertOrUpdateSound(soundData);\n\n\t\t\t\tif (!soundId) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\tconst reader = new FileReader();\n\t\t\t\treader.readAsBinaryString(soundFile);\n\t\t\t\treader.onloadend = (): void => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tuploadCustomSound(reader.result as string, soundFile.type, {\n\t\t\t\t\t\t\t...soundData,\n\t\t\t\t\t\t\t_id: soundId,\n\t\t\t\t\t\t\trandom: Math.round(Math.random() * 1000),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t(typeof error === 'string' || error instanceof Error) && dispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treturn soundId;\n\t\t\t} catch (error) {\n\t\t\t\t(typeof error === 'string' || error instanceof Error) && dispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t},\n\t\t[dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await saveAction(name, sound);\n\t\t\tif (result) {\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Saved_Successfully') });\n\t\t\t}\n\t\t\tresult && goToNew(result);\n\t\t\tonChange();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent {...props}>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Name')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\t\tonChange={(e: FormEvent<HTMLInputElement>): void => setName(e.currentTarget.value)}\n\t\t\t\t\t\t\tplaceholder={t('Name')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel alignSelf='stretch'>{t('Sound_File_mp3')}</FieldLabel>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t\t{/* FIXME: replace to IconButton */}\n\t\t\t\t\t\t\t<Button square onClick={clickUpload}>\n\t\t\t\t\t\t\t\t<Icon name='upload' size='x20' />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{sound?.name || t('None')}\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t</Field>\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button mie={4} onClick={close}>\n\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button primary onClick={handleSave} disabled={name === ''}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n};\n\nexport default AddCustomSound;\n",null],"names":["_objectSpread","_objectWithoutProperties","Field","FieldLabel","FieldRow","TextInput","Box","Icon","Margins","Button","ButtonGroup","useToastMessageDispatch","useMethod","useTranslation","React","useState","useCallback","ContextualbarScrollableContent","ContextualbarFooter","useFileInput","validate","createSoundData","module","default","v","link","exportDefault","_ref","goToNew","close","onChange","props","_excluded","t","dispatchToastMessage","name","setName","sound","setSound","uploadCustomSound","insertOrUpdateSound","handleChangeFile","soundFile","clickUpload","saveAction","soundData","validation","forEach","error","Error","field","soundId","type","message","reader","FileReader","readAsBinaryString","onloadend","result","_id","random","Math","round","handleSave","createElement","Fragment","value","e","currentTarget","placeholder","alignSelf","display","flexDirection","mbs","inline","square","onClick","size","stretch","mie","primary","disabled"],"mappings":"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"}