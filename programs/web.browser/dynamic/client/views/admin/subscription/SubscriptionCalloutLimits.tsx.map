)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/subscription/SubscriptionCalloutLimits.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { LicenseBehavior } from '@rocket.chat/core-typings';\nimport { Callout } from '@rocket.chat/fuselage';\nimport { validateWarnLimit } from '@rocket.chat/license/src/validation/validateLimit';\nimport { ExternalLink } from '@rocket.chat/ui-client';\nimport React from 'react';\nimport { Trans, useTranslation } from 'react-i18next';\n\nimport { useLicense } from '../../../hooks/useLicense';\nimport { useCheckoutUrl } from './hooks/useCheckoutUrl';\n\nexport const SubscriptionCalloutLimits = () => {\n\tconst manageSubscriptionUrl = useCheckoutUrl();\n\n\tconst { t } = useTranslation();\n\tconst result = useLicense({ loadValues: true });\n\n\tif (result.isLoading || result.isError) {\n\t\treturn null;\n\t}\n\n\tconst { license, limits } = result.data;\n\n\tif (!license || !limits) {\n\t\treturn null;\n\t}\n\n\tconst keyLimits = Object.keys(limits) as Array<keyof typeof limits>;\n\n\t// Get the rule with the highest limit that applies to this key\n\n\tconst rules = keyLimits\n\t\t.map((key) => {\n\t\t\tconst rule = license.limits[key]\n\t\t\t\t?.filter((limit) => validateWarnLimit(limit.max, limits[key].value ?? 0, limit.behavior))\n\t\t\t\t.sort((a, b) => b.max - a.max)[0];\n\n\t\t\tif (!rule) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (rule.max === 0) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (rule.max === -1) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn [key, rule.behavior];\n\t\t})\n\t\t.filter(Boolean) as Array<[keyof typeof limits, LicenseBehavior]>;\n\n\tif (!rules.length) {\n\t\treturn null;\n\t}\n\n\t// Group by behavior\n\tconst groupedRules = rules.reduce((acc, [key, behavior]) => {\n\t\tif (!acc[behavior]) {\n\t\t\tacc[behavior] = [];\n\t\t}\n\n\t\tacc[behavior].push(key);\n\n\t\treturn acc;\n\t}, {} as Record<LicenseBehavior, (keyof typeof limits)[]>);\n\n\tconst { prevent_action, disable_modules, invalidate_license, start_fair_policy } = groupedRules;\n\n\tconst map = (key: keyof typeof limits) => t(`subscription.callout.${key}`);\n\n\treturn (\n\t\t<>\n\t\t\t{start_fair_policy && (\n\t\t\t\t<Callout type='warning' title={t('subscription.callout.servicesDisruptionsMayOccur')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsReached' count={start_fair_policy.length}>\n\t\t\t\t\t\tYour workspace reached the <>{{ val: start_fair_policy.map(map) }}</> limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'start_fair_policy',\n\t\t\t\t\t\t\t\tlimits: start_fair_policy.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\t\t\t{prevent_action && (\n\t\t\t\t<Callout type='danger' title={t('subscription.callout.servicesDisruptionsOccurring')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsExceeded' count={prevent_action.length}>\n\t\t\t\t\t\tYour workspace exceeded the <>{{ val: prevent_action.map(map) }}</> license limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'prevent_action',\n\t\t\t\t\t\t\t\tlimits: prevent_action.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\n\t\t\t{disable_modules && (\n\t\t\t\t<Callout type='danger' title={t('subscription.callout.capabilitiesDisabled')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsExceeded' count={disable_modules.length}>\n\t\t\t\t\t\tYour workspace exceeded the <>{{ val: disable_modules.map(map) }}</> license limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'disable_modules',\n\t\t\t\t\t\t\t\tlimits: disable_modules.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\n\t\t\t{invalidate_license && (\n\t\t\t\t<Callout type='danger' title={t('subscription.callout.allPremiumCapabilitiesDisabled')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsExceeded' count={disable_modules.length}>\n\t\t\t\t\t\tYour workspace exceeded the <>{{ val: invalidate_license.map(map) }}</> license limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'invalidate_license',\n\t\t\t\t\t\t\t\tlimits: invalidate_license.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\t\t</>\n\t);\n};\n",null],"names":["Callout","validateWarnLimit","ExternalLink","React","Trans","useTranslation","useLicense","useCheckoutUrl","module","export","SubscriptionCalloutLimits","default","manageSubscriptionUrl","t","result","loadValues","isLoading","isError","license","limits","data","keyLimits","Object","keys","rules","map","key","_license$limits$key","rule","filter","limit","_limits$key$value","max","value","behavior","sort","a","b","Boolean","length","groupedRules","reduce","acc","_ref","push","prevent_action","disable_modules","invalidate_license","start_fair_policy","concat","createElement","Fragment","type","title","m","i18nKey","count","val","to","target","action","join"],"mappings":"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"}