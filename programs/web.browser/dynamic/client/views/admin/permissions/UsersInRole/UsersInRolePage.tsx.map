)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/permissions/UsersInRole/UsersInRolePage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRole, IRoom } from '@rocket.chat/core-typings';\nimport { Box, Field, FieldLabel, FieldRow, Margins, ButtonGroup, Button, Callout } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useToastMessageDispatch, useRoute, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useRef } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\n\nimport Page from '../../../../components/Page';\nimport RoomAutoComplete from '../../../../components/RoomAutoComplete';\nimport UserAutoCompleteMultiple from '../../../../components/UserAutoCompleteMultiple';\nimport UsersInRoleTable from './UsersInRoleTable';\n\ntype UsersInRolePayload = {\n\trid?: IRoom['_id'];\n\tusers: string[];\n};\n\nconst UsersInRolePage = ({ role }: { role: IRole }): ReactElement => {\n\tconst t = useTranslation();\n\tconst reload = useRef<() => void>(() => undefined);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst {\n\t\tcontrol,\n\t\thandleSubmit,\n\t\tformState: { isDirty },\n\t\treset,\n\t\tgetValues,\n\t} = useForm<UsersInRolePayload>({ defaultValues: { users: [] } });\n\n\tconst { _id, name, description } = role;\n\tconst router = useRoute('admin-permissions');\n\tconst addUser = useEndpoint('POST', '/v1/roles.addUserToRole');\n\n\tconst rid = getValues('rid');\n\n\tconst handleReturn = useMutableCallback(() => {\n\t\trouter.push({\n\t\t\tcontext: 'edit',\n\t\t\t_id,\n\t\t});\n\t});\n\n\tconst handleAdd = useMutableCallback(async ({ users, rid }: UsersInRolePayload) => {\n\t\ttry {\n\t\t\tawait Promise.all(\n\t\t\t\tusers.map(async (user) => {\n\t\t\t\t\tif (user) {\n\t\t\t\t\t\tawait addUser({ roleName: _id, username: user, roomId: rid });\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Users_added') });\n\t\t\treload.current();\n\t\t\treset();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={`${t('Users_in_role')} \"${description || name}\"`}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button onClick={handleReturn}>{t('Back')}</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.Content>\n\t\t\t\t<Box display='flex' flexDirection='column' w='full' mi='neg-x4'>\n\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t{role.scope !== 'Users' && (\n\t\t\t\t\t\t\t<Field mbe={4}>\n\t\t\t\t\t\t\t\t<FieldLabel>{t('Choose_a_room')}</FieldLabel>\n\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\t\t\tname='rid'\n\t\t\t\t\t\t\t\t\t\trender={({ field: { onChange, value } }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t\t<RoomAutoComplete value={value} onChange={onChange} placeholder={t('User')} />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel>{t('Add_users')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\t\tname='users'\n\t\t\t\t\t\t\t\t\trender={({ field: { onChange, value } }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t<UserAutoCompleteMultiple value={value} placeholder={t('User')} onChange={onChange} />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<ButtonGroup mis={8} align='end'>\n\t\t\t\t\t\t\t\t\t<Button primary onClick={handleSubmit(handleAdd)} disabled={!isDirty}>\n\t\t\t\t\t\t\t\t\t\t{t('Add')}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t\t<Margins blockStart={8}>\n\t\t\t\t\t{(role.scope === 'Users' || rid) && (\n\t\t\t\t\t\t<UsersInRoleTable reloadRef={reload} rid={rid} roleId={_id} roleName={name} description={description} />\n\t\t\t\t\t)}\n\t\t\t\t\t{role.scope !== 'Users' && !rid && <Callout type='info'>{t('Select_a_room')}</Callout>}\n\t\t\t\t</Margins>\n\t\t\t</Page.Content>\n\t\t</Page>\n\t);\n};\n\nexport default UsersInRolePage;\n",null],"names":["Box","Field","FieldLabel","FieldRow","Margins","ButtonGroup","Button","Callout","useMutableCallback","useToastMessageDispatch","useRoute","useEndpoint","useTranslation","React","useRef","useForm","Controller","Page","RoomAutoComplete","UserAutoCompleteMultiple","UsersInRoleTable","module","link","default","exportDefault","_ref","role","t","reload","undefined","dispatchToastMessage","control","handleSubmit","formState","isDirty","reset","getValues","defaultValues","users","_id","name","description","router","addUser","rid","handleReturn","push","context","handleAdd","_ref2","Promise","all","map","user","roleName","username","roomId","type","message","current","error","createElement","Header","title","concat","onClick","Content","display","flexDirection","w","mi","inline","scope","mbe","render","_ref3","field","onChange","value","placeholder","_ref4","mis","align","primary","disabled","blockStart","reloadRef","roleId"],"mappings":"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"}