)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/permissions/EditRolePage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRole } from '@rocket.chat/core-typings';\nimport { Box, ButtonGroup, Button, Margins } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetModal, useToastMessageDispatch, useRoute, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React from 'react';\nimport { FormProvider, useForm } from 'react-hook-form';\n\nimport { ContextualbarFooter, ContextualbarScrollableContent } from '../../../components/Contextualbar';\nimport GenericModal from '../../../components/GenericModal';\nimport RoleForm from './RoleForm';\n\nconst EditRolePage = ({ role, isEnterprise }: { role?: IRole; isEnterprise: boolean }): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\tconst usersInRoleRouter = useRoute('admin-permissions');\n\tconst router = useRoute('admin-permissions');\n\n\tconst createRole = useEndpoint('POST', '/v1/roles.create');\n\tconst updateRole = useEndpoint('POST', '/v1/roles.update');\n\tconst deleteRole = useEndpoint('POST', '/v1/roles.delete');\n\n\tconst methods = useForm({\n\t\tdefaultValues: {\n\t\t\troleId: role?._id,\n\t\t\tname: role?.name,\n\t\t\tdescription: role?.description,\n\t\t\tscope: role?.scope || 'Users',\n\t\t\tmandatory2fa: !!role?.mandatory2fa,\n\t\t},\n\t});\n\n\tconst handleManageUsers = useMutableCallback(() => {\n\t\tif (role?._id) {\n\t\t\tusersInRoleRouter.push({\n\t\t\t\tcontext: 'users-in-role',\n\t\t\t\t_id: role._id,\n\t\t\t});\n\t\t}\n\t});\n\n\tconst handleSave = useMutableCallback(async (data) => {\n\t\ttry {\n\t\t\tif (data.roleId) {\n\t\t\t\tawait updateRole(data);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\t\treturn router.push({});\n\t\t\t}\n\n\t\t\tawait createRole(data);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\trouter.push({});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst handleDelete = useMutableCallback(async () => {\n\t\tif (!role?._id) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst deleteRoleAction = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait deleteRole({ roleId: role._id });\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Role_removed') });\n\t\t\t\tsetModal();\n\n\t\t\t\trouter.push({});\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\tsetModal();\n\t\t\t}\n\t\t};\n\n\t\tconst deleteRoleMessage = isEnterprise ? t('Delete_Role_Warning') : t('Delete_Role_Warning_Not_Enterprise');\n\n\t\tsetModal(\n\t\t\t<GenericModal\n\t\t\t\tvariant='danger'\n\t\t\t\tonConfirm={deleteRoleAction}\n\t\t\t\tonClose={(): void => setModal()}\n\t\t\t\tonCancel={(): void => setModal()}\n\t\t\t\tconfirmText={t('Delete')}\n\t\t\t>\n\t\t\t\t{deleteRoleMessage}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent>\n\t\t\t\t<Box w='full' alignSelf='center' mb='neg-x8'>\n\t\t\t\t\t<Margins block={8}>\n\t\t\t\t\t\t<FormProvider {...methods}>\n\t\t\t\t\t\t\t<RoleForm editing={Boolean(role?._id)} isProtected={role?.protected} isDisabled={!isEnterprise} />\n\t\t\t\t\t\t</FormProvider>\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup vertical stretch>\n\t\t\t\t\t<Button primary disabled={!methods.formState.isDirty || !isEnterprise} onClick={methods.handleSubmit(handleSave)}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t{!role?.protected && role?._id && (\n\t\t\t\t\t\t<Button secondary danger onClick={handleDelete}>\n\t\t\t\t\t\t\t{t('Delete')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t\t{role?._id && <Button onClick={handleManageUsers}>{t('Users_in_role')}</Button>}\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n};\n\nexport default EditRolePage;\n",null],"names":["Box","ButtonGroup","Button","Margins","useMutableCallback","useSetModal","useToastMessageDispatch","useRoute","useEndpoint","useTranslation","React","FormProvider","useForm","ContextualbarFooter","ContextualbarScrollableContent","GenericModal","RoleForm","module","link","v","default","exportDefault","_ref","role","isEnterprise","t","dispatchToastMessage","setModal","usersInRoleRouter","router","createRole","updateRole","deleteRole","methods","defaultValues","roleId","_id","name","description","scope","mandatory2fa","handleManageUsers","push","context","handleSave","data","type","message","error","handleDelete","deleteRoleAction","deleteRoleMessage","createElement","variant","onConfirm","onClose","onCancel","confirmText","Fragment","w","alignSelf","mb","block","editing","Boolean","isProtected","protected","isDisabled","vertical","stretch","primary","disabled","formState","isDirty","onClick","handleSubmit","secondary","danger"],"mappings":"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"}