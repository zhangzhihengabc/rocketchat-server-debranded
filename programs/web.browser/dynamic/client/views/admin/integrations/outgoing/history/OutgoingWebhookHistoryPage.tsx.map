)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/integrations/outgoing/history/OutgoingWebhookHistoryPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Button, ButtonGroup, Pagination } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useRouteParameter, useMethod, useTranslation, useEndpoint, useRouter } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ComponentProps } from 'react';\nimport React, { useMemo, useState, useEffect } from 'react';\n\nimport { sdk } from '../../../../../../app/utils/client/lib/SDKClient';\nimport { usePagination } from '../../../../../components/GenericTable/hooks/usePagination';\nimport Page from '../../../../../components/Page';\nimport ScrollableContentWrapper from '../../../../../components/ScrollableContentWrapper';\nimport HistoryContent from './HistoryContent';\n\nconst OutgoingWebhookHistoryPage = (props: ComponentProps<typeof Page>) => {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\n\tconst { itemsPerPage, setItemsPerPage, current, setCurrent, itemsPerPageLabel, showingResultsLabel } = usePagination();\n\n\tconst [mounted, setMounted] = useState(false);\n\tconst [total, setTotal] = useState(0);\n\n\tconst clearIntegrationHistory = useMethod('clearIntegrationHistory');\n\n\tconst id = useRouteParameter('id') as string;\n\n\tconst query = useMemo(\n\t\t() => ({\n\t\t\tid,\n\t\t\tcount: itemsPerPage,\n\t\t\toffset: current,\n\t\t}),\n\t\t[id, itemsPerPage, current],\n\t);\n\n\tconst fetchHistory = useEndpoint('GET', '/v1/integrations.history');\n\n\tconst queryKey = useMemo(() => ['integrations/history', id, itemsPerPage, current], [id, itemsPerPage, current]);\n\n\tconst queryClient = useQueryClient();\n\n\ttype HistoryData = Awaited<ReturnType<typeof fetchHistory>>;\n\n\tconst { data, isLoading, refetch } = useQuery(\n\t\tqueryKey,\n\t\tasync () => {\n\t\t\tconst result = fetchHistory(query);\n\t\t\tsetMounted(true);\n\t\t\treturn result;\n\t\t},\n\t\t{\n\t\t\tcacheTime: 99999,\n\t\t\tstaleTime: 99999,\n\t\t},\n\t);\n\n\tconst handleClearHistory = async (): Promise<void> => {\n\t\ttry {\n\t\t\tawait clearIntegrationHistory(id);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Integration_History_Cleared') });\n\t\t\trefetch();\n\t\t\tsetMounted(false);\n\t\t} catch (e) {\n\t\t\tdispatchToastMessage({ type: 'error', message: e });\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tif (mounted) {\n\t\t\treturn sdk.stream('integrationHistory', [id], (integration) => {\n\t\t\t\tif (integration.type === 'inserted') {\n\t\t\t\t\tsetTotal((total) => total + 1);\n\t\t\t\t\tqueryClient.setQueryData<HistoryData>(queryKey, (oldData): HistoryData | undefined => {\n\t\t\t\t\t\tif (!oldData || !integration.data) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...oldData,\n\t\t\t\t\t\t\thistory: [integration.data as unknown as HistoryData['history'][number]].concat(oldData.history),\n\t\t\t\t\t\t\ttotal: oldData.total + 1,\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (integration.type === 'updated') {\n\t\t\t\t\tqueryClient.setQueryData<HistoryData>(queryKey, (oldData): HistoryData | undefined => {\n\t\t\t\t\t\tif (!oldData) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst index = oldData.history.findIndex(({ _id }) => _id === id);\n\t\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tObject.assign(oldData.history[index], integration.diff);\n\t\t\t\t\t\treturn { ...oldData };\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (integration.type === 'removed') {\n\t\t\t\t\trefetch();\n\t\t\t\t}\n\t\t\t}).stop;\n\t\t}\n\t}, [id, mounted, queryClient, queryKey, refetch]);\n\n\treturn (\n\t\t<Page flexDirection='column' {...props}>\n\t\t\t<Page.Header title={t('Integration_Outgoing_WebHook_History')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button icon='back' onClick={() => router.navigate(`/admin/integrations/edit/outgoing/${id}`)}>\n\t\t\t\t\t\t{t('Back')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button icon='trash' danger onClick={handleClearHistory} disabled={total === 0}>\n\t\t\t\t\t\t{t('clear_history')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.Content>\n\t\t\t\t<ScrollableContentWrapper>\n\t\t\t\t\t<HistoryContent key='historyContent' data={data?.history || []} isLoading={isLoading} />\n\t\t\t\t</ScrollableContentWrapper>\n\t\t\t\t<Pagination\n\t\t\t\t\tcurrent={current}\n\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\titemsPerPageLabel={itemsPerPageLabel}\n\t\t\t\t\tshowingResultsLabel={showingResultsLabel}\n\t\t\t\t\tcount={data?.total || 0}\n\t\t\t\t\tonSetItemsPerPage={setItemsPerPage}\n\t\t\t\t\tonSetCurrent={setCurrent}\n\t\t\t\t/>\n\t\t\t</Page.Content>\n\t\t</Page>\n\t);\n};\n\nexport default OutgoingWebhookHistoryPage;\n",null],"names":["_extends","_objectSpread","Button","ButtonGroup","Pagination","useToastMessageDispatch","useRouteParameter","useMethod","useTranslation","useEndpoint","useRouter","useQuery","useQueryClient","React","useMemo","useState","useEffect","sdk","usePagination","Page","ScrollableContentWrapper","HistoryContent","module","link","default","v","exportDefault","props","dispatchToastMessage","t","router","itemsPerPage","setItemsPerPage","current","setCurrent","itemsPerPageLabel","showingResultsLabel","mounted","setMounted","total","setTotal","clearIntegrationHistory","id","query","count","offset","fetchHistory","queryKey","queryClient","data","isLoading","refetch","result","cacheTime","staleTime","handleClearHistory","type","message","e","stream","integration","setQueryData","oldData","history","concat","index","findIndex","_ref","_id","Object","assign","diff","stop","createElement","flexDirection","Header","title","icon","onClick","navigate","danger","disabled","Content","key","onSetItemsPerPage","onSetCurrent"],"mappings":"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"}