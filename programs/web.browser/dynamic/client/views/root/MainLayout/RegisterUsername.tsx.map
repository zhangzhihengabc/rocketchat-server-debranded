)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/root/MainLayout/RegisterUsername.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { TextInput, ButtonGroup, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { VerticalWizardLayout, Form } from '@rocket.chat/layout';\nimport { CustomFieldsForm } from '@rocket.chat/ui-client';\nimport {\n\tuseSetting,\n\tuseTranslation,\n\tuseLogout,\n\tuseEndpoint,\n\tuseUserId,\n\tuseToastMessageDispatch,\n\tuseAssetWithDarkModePath,\n\tuseMethod,\n\tuseAccountsCustomFields,\n} from '@rocket.chat/ui-contexts';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport React, { useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport MarkdownText from '../../../components/MarkdownText';\nimport { queryClient } from '../../../lib/queryClient';\n\ntype RegisterUsernamePayload = {\n\tusername: Exclude<IUser['username'], undefined>;\n} & IUser['customFields'];\n\nconst RegisterUsername = () => {\n\tconst t = useTranslation();\n\tconst uid = useUserId();\n\tconst logout = useLogout();\n\tconst formLabelId = useUniqueId();\n\tconst hideLogo = useSetting<boolean>('Layout_Login_Hide_Logo');\n\tconst customLogo = useAssetWithDarkModePath('logo');\n\tconst customBackground = useAssetWithDarkModePath('background');\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst customFields = useAccountsCustomFields();\n\n\tif (!uid) {\n\t\tthrow new Error('Invalid user');\n\t}\n\n\tconst setUsername = useMethod('setUsername');\n\tconst saveCustomFields = useMethod('saveCustomFields');\n\tconst usernameSuggestion = useEndpoint('GET', '/v1/users.getUsernameSuggestion');\n\tconst { data, isLoading } = useQuery(['suggestion'], async () => usernameSuggestion());\n\n\tconst {\n\t\tregister,\n\t\thandleSubmit,\n\t\tsetValue,\n\t\tgetValues,\n\t\tsetError,\n\t\tcontrol,\n\t\tformState: { errors },\n\t} = useForm<RegisterUsernamePayload>({\n\t\tmode: 'onBlur',\n\t});\n\n\tuseEffect(() => {\n\t\tif (data?.result && getValues('username') === '') {\n\t\t\tsetValue('username', data.result);\n\t\t}\n\t});\n\n\tconst registerUsernameMutation = useMutation({\n\t\tmutationFn: async (data: RegisterUsernamePayload) => {\n\t\t\tconst { username, ...customFields } = data;\n\t\t\treturn Promise.all([setUsername(username), saveCustomFields({ ...customFields })]);\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Username_has_been_updated') });\n\t\t\tqueryClient.invalidateQueries(['users.info']);\n\t\t},\n\t\tonError: (error: any, { username }) => {\n\t\t\tif ([error.error, error.errorType].includes('error-blocked-username')) {\n\t\t\t\treturn setError('username', { type: 'error-blocked-username', message: t('error-blocked-username', { field: username }) });\n\t\t\t}\n\n\t\t\tif ([error.errorType].includes('error-field-unavailable')) {\n\t\t\t\treturn setError('username', { type: 'error-field-unavailable', message: t('error-field-unavailable', { field: username }) });\n\t\t\t}\n\n\t\t\tif ([error.errorType].includes('')) {\n\t\t\t\treturn setError('username', { type: 'username-invalid', message: t('Username_invalid') });\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t});\n\n\treturn (\n\t\t<VerticalWizardLayout\n\t\t\tbackground={customBackground}\n\t\t\tlogo={!hideLogo && customLogo ? <Box is='img' maxHeight='x40' mi='neg-x8' src={customLogo} alt='Logo' /> : <></>}\n\t\t>\n\t\t\t<Form aria-labelledby={formLabelId} onSubmit={handleSubmit((data) => registerUsernameMutation.mutate(data))}>\n\t\t\t\t<Form.Header>\n\t\t\t\t\t<Form.Title id={formLabelId}>{t('Username_title')}</Form.Title>\n\t\t\t\t\t<Form.Subtitle>{t('Username_description')}</Form.Subtitle>\n\t\t\t\t</Form.Header>\n\t\t\t\t<Form.Container>\n\t\t\t\t\t{!isLoading && (\n\t\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t\t<FieldLabel id='username-label'>{t('Username')}</FieldLabel>\n\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t<TextInput aria-labelledby='username-label' {...register('username', { required: t('Username_cant_be_empty') })} />\n\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t{errors.username && (\n\t\t\t\t\t\t\t\t\t<FieldError>\n\t\t\t\t\t\t\t\t\t\t<MarkdownText content={errors.username.message} />\n\t\t\t\t\t\t\t\t\t</FieldError>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t</FieldGroup>\n\t\t\t\t\t)}\n\t\t\t\t\t{isLoading && t('Loading_suggestion')}\n\t\t\t\t\t<CustomFieldsForm formName='customFields' formControl={control} metadata={customFields} />\n\t\t\t\t</Form.Container>\n\t\t\t\t<Form.Footer>\n\t\t\t\t\t<ButtonGroup stretch vertical flexGrow={1}>\n\t\t\t\t\t\t<Button disabled={isLoading} type='submit' primary>\n\t\t\t\t\t\t\t{t('Use_this_username')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={logout}>{t('Logout')}</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Form.Footer>\n\t\t\t</Form>\n\t\t</VerticalWizardLayout>\n\t);\n};\n\nexport default RegisterUsername;\n",null],"names":["_extends","_objectSpread","_objectWithoutProperties","TextInput","ButtonGroup","Button","FieldGroup","Field","FieldLabel","FieldRow","FieldError","Box","useUniqueId","VerticalWizardLayout","Form","CustomFieldsForm","useSetting","useTranslation","useLogout","useEndpoint","useUserId","useToastMessageDispatch","useAssetWithDarkModePath","useMethod","useAccountsCustomFields","useQuery","useMutation","React","useEffect","useForm","MarkdownText","queryClient","module","link","default","v","exportDefault","t","uid","logout","formLabelId","hideLogo","customLogo","customBackground","dispatchToastMessage","customFields","Error","setUsername","saveCustomFields","usernameSuggestion","data","isLoading","register","handleSubmit","setValue","getValues","setError","control","formState","errors","mode","result","registerUsernameMutation","mutationFn","username","_excluded","Promise","all","onSuccess","type","message","invalidateQueries","onError","error","_ref","errorType","includes","field","createElement","background","logo","is","maxHeight","mi","src","alt","Fragment","onSubmit","mutate","Header","Title","id","Subtitle","Container","required","content","formName","formControl","metadata","Footer","stretch","vertical","flexGrow","disabled","primary","onClick"],"mappings":"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"}