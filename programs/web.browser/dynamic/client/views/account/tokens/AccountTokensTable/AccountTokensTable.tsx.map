)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/account/tokens/AccountTokensTable/AccountTokensTable.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Pagination, States, StatesAction, StatesActions, StatesIcon, StatesSubtitle, StatesTitle } from '@rocket.chat/fuselage';\nimport { useSetModal, useToastMessageDispatch, useUserId, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, RefObject } from 'react';\nimport React, { useMemo, useCallback } from 'react';\n\nimport GenericModal from '../../../../components/GenericModal';\nimport GenericNoResults from '../../../../components/GenericNoResults';\nimport {\n\tGenericTable,\n\tGenericTableHeader,\n\tGenericTableBody,\n\tGenericTableLoadingTable,\n\tGenericTableHeaderCell,\n} from '../../../../components/GenericTable';\nimport { usePagination } from '../../../../components/GenericTable/hooks/usePagination';\nimport { useEndpointData } from '../../../../hooks/useEndpointData';\nimport { useResizeInlineBreakpoint } from '../../../../hooks/useResizeInlineBreakpoint';\nimport { AsyncStatePhase } from '../../../../lib/asyncState';\nimport AccountTokensRow from './AccountTokensRow';\nimport AddToken from './AddToken';\n\nconst AccountTokensTable = (): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\tconst userId = useUserId();\n\n\tconst regenerateToken = useMethod('personalAccessTokens:regenerateToken');\n\tconst removeToken = useMethod('personalAccessTokens:removeToken');\n\tconst { value: data, phase, error, reload } = useEndpointData('/v1/users.getPersonalAccessTokens');\n\n\tconst [ref, isMedium] = useResizeInlineBreakpoint([600], 200) as [RefObject<HTMLElement>, boolean];\n\n\tconst { current, itemsPerPage, setItemsPerPage: onSetItemsPerPage, setCurrent: onSetCurrent, ...paginationProps } = usePagination();\n\n\tconst filteredTokens = useMemo(() => {\n\t\tif (!data?.tokens) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst sliceStart = current > data?.tokens.length ? data?.tokens.length - itemsPerPage : current;\n\t\treturn data?.tokens.slice(sliceStart, sliceStart + itemsPerPage);\n\t}, [current, data?.tokens, itemsPerPage]);\n\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tconst headers = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\t<GenericTableHeaderCell key='name'>{t('API_Personal_Access_Token_Name')}</GenericTableHeaderCell>,\n\t\t\t\tisMedium && <GenericTableHeaderCell key='createdAt'>{t('Created_at')}</GenericTableHeaderCell>,\n\t\t\t\t<GenericTableHeaderCell key='lastTokenPart'>{t('Last_token_part')}</GenericTableHeaderCell>,\n\t\t\t\t<GenericTableHeaderCell key='2fa'>{t('Two Factor Authentication')}</GenericTableHeaderCell>,\n\t\t\t\t<GenericTableHeaderCell key='actions' />,\n\t\t\t].filter(Boolean),\n\t\t[isMedium, t],\n\t);\n\n\tconst handleRegenerate = useCallback(\n\t\t(name) => {\n\t\t\tconst onConfirm: () => Promise<void> = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tsetModal(null);\n\t\t\t\t\tconst token = await regenerateToken({ tokenName: name });\n\n\t\t\t\t\tsetModal(\n\t\t\t\t\t\t<GenericModal title={t('API_Personal_Access_Token_Generated')} onConfirm={closeModal}>\n\t\t\t\t\t\t\t<Box\n\t\t\t\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t\t\t\t__html: t('API_Personal_Access_Token_Generated_Text_Token_s_UserId_s', {\n\t\t\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t\t\t\tuserId,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</GenericModal>,\n\t\t\t\t\t);\n\n\t\t\t\t\treload();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tsetModal(null);\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tsetModal(\n\t\t\t\t<GenericModal\n\t\t\t\t\tvariant='warning'\n\t\t\t\t\tconfirmText={t('API_Personal_Access_Tokens_Regenerate_It')}\n\t\t\t\t\tonConfirm={onConfirm}\n\t\t\t\t\tonCancel={closeModal}\n\t\t\t\t\tonClose={closeModal}\n\t\t\t\t>\n\t\t\t\t\t{t('API_Personal_Access_Tokens_Regenerate_Modal')}\n\t\t\t\t</GenericModal>,\n\t\t\t);\n\t\t},\n\t\t[closeModal, dispatchToastMessage, regenerateToken, reload, setModal, t, userId],\n\t);\n\n\tconst handleRemove = useCallback(\n\t\t(name) => {\n\t\t\tconst onConfirm: () => Promise<void> = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait removeToken({ tokenName: name });\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Token_has_been_removed') });\n\t\t\t\t\treload();\n\t\t\t\t\tcloseModal();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tsetModal(\n\t\t\t\t<GenericModal variant='danger' confirmText={t('Remove')} onConfirm={onConfirm} onCancel={closeModal} onClose={closeModal}>\n\t\t\t\t\t{t('API_Personal_Access_Tokens_Remove_Modal')}\n\t\t\t\t</GenericModal>,\n\t\t\t);\n\t\t},\n\t\t[closeModal, dispatchToastMessage, reload, removeToken, setModal, t],\n\t);\n\n\tif (phase === AsyncStatePhase.REJECTED) {\n\t\treturn (\n\t\t\t<Box display='flex' justifyContent='center' alignItems='center' height='100%'>\n\t\t\t\t<States>\n\t\t\t\t\t<StatesIcon name='warning' variation='danger' />\n\t\t\t\t\t<StatesTitle>{t('Something_went_wrong')}</StatesTitle>\n\t\t\t\t\t<StatesSubtitle>{t('We_Could_not_retrive_any_data')}</StatesSubtitle>\n\t\t\t\t\t<StatesSubtitle>{error?.message}</StatesSubtitle>\n\t\t\t\t\t<StatesActions>\n\t\t\t\t\t\t<StatesAction onClick={reload}>{t('Retry')}</StatesAction>\n\t\t\t\t\t</StatesActions>\n\t\t\t\t</States>\n\t\t\t</Box>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<AddToken reload={reload} />\n\t\t\t{phase === AsyncStatePhase.LOADING && (\n\t\t\t\t<GenericTable aria-busy>\n\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t<GenericTableBody>{phase === AsyncStatePhase.LOADING && <GenericTableLoadingTable headerCells={5} />}</GenericTableBody>\n\t\t\t\t</GenericTable>\n\t\t\t)}\n\t\t\t{filteredTokens && filteredTokens?.length > 0 && phase === AsyncStatePhase.RESOLVED && (\n\t\t\t\t<>\n\t\t\t\t\t<GenericTable ref={ref}>\n\t\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t\t{phase === AsyncStatePhase.RESOLVED &&\n\t\t\t\t\t\t\t\tfilteredTokens &&\n\t\t\t\t\t\t\t\tfilteredTokens.map((filteredToken) => (\n\t\t\t\t\t\t\t\t\t<AccountTokensRow\n\t\t\t\t\t\t\t\t\t\t{...filteredToken}\n\t\t\t\t\t\t\t\t\t\tkey={filteredToken.createdAt}\n\t\t\t\t\t\t\t\t\t\tonRegenerate={handleRegenerate}\n\t\t\t\t\t\t\t\t\t\tonRemove={handleRemove}\n\t\t\t\t\t\t\t\t\t\tisMedium={isMedium}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</GenericTableBody>\n\t\t\t\t\t</GenericTable>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tdivider\n\t\t\t\t\t\tcurrent={current}\n\t\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\t\tcount={data?.tokens.length || 0}\n\t\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t\t\t{...paginationProps}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{phase === AsyncStatePhase.RESOLVED && filteredTokens?.length === 0 && <GenericNoResults />}\n\t\t</>\n\t);\n};\n\nexport default AccountTokensTable;\n",null],"names":["_extends","_objectWithoutProperties","Box","Pagination","States","StatesAction","StatesActions","StatesIcon","StatesSubtitle","StatesTitle","useSetModal","useToastMessageDispatch","useUserId","useMethod","useTranslation","React","useMemo","useCallback","GenericModal","GenericNoResults","GenericTable","GenericTableHeader","GenericTableBody","GenericTableLoadingTable","GenericTableHeaderCell","usePagination","useEndpointData","useResizeInlineBreakpoint","AsyncStatePhase","AccountTokensRow","AddToken","module","link","default","v","exportDefault","t","dispatchToastMessage","setModal","userId","regenerateToken","removeToken","value","data","phase","error","reload","ref","isMedium","_usePagination","current","itemsPerPage","setItemsPerPage","onSetItemsPerPage","setCurrent","onSetCurrent","paginationProps","_excluded","filteredTokens","tokens","sliceStart","length","slice","closeModal","headers","createElement","key","filter","Boolean","handleRegenerate","name","onConfirm","token","tokenName","title","dangerouslySetInnerHTML","__html","type","message","variant","confirmText","onCancel","onClose","handleRemove","REJECTED","display","justifyContent","alignItems","height","variation","onClick","Fragment","LOADING","headerCells","RESOLVED","map","filteredToken","createdAt","onRegenerate","onRemove","divider","count"],"mappings":"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"}