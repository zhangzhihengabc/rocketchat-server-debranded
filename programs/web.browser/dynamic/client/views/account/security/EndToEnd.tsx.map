)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/account/security/EndToEnd.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Margins, PasswordInput, Field, FieldGroup, FieldLabel, FieldRow, FieldError, FieldHint, Button } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useMethod, useTranslation, useLogout } from '@rocket.chat/ui-contexts';\nimport type { ComponentProps, ReactElement } from 'react';\nimport React, { useCallback, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { e2e } from '../../../../app/e2e/client/rocketchat.e2e';\n\nconst EndToEnd = (props: ComponentProps<typeof Box>): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst logout = useLogout();\n\n\tconst publicKey = localStorage.getItem('public_key');\n\tconst privateKey = localStorage.getItem('private_key');\n\n\tconst resetE2eKey = useMethod('e2e.resetOwnE2EKey');\n\n\tconst {\n\t\tregister,\n\t\thandleSubmit,\n\t\twatch,\n\t\tresetField,\n\t\tformState: { errors, isValid },\n\t} = useForm({\n\t\tdefaultValues: {\n\t\t\tpassword: '',\n\t\t\tpasswordConfirm: '',\n\t\t},\n\t\tmode: 'onChange',\n\t});\n\n\tconst { password } = watch();\n\n\tconst keysExist = Boolean(publicKey && privateKey);\n\n\tconst hasTypedPassword = Boolean(password?.trim().length);\n\n\tconst saveNewPassword = async (data: { password: string; passwordConfirm: string }) => {\n\t\ttry {\n\t\t\tawait e2e.changePassword(data.password);\n\t\t\tresetField('password');\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Encryption_key_saved_successfully') });\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t};\n\n\tconst handleResetE2eKey = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await resetE2eKey();\n\t\t\tif (result) {\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_e2e_key_was_reset') });\n\t\t\t\tlogout();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, resetE2eKey, logout, t]);\n\n\tuseEffect(() => {\n\t\tif (password?.trim() === '') {\n\t\t\tresetField('passwordConfirm');\n\t\t}\n\t}, [password, resetField]);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' alignItems='flex-start' mbs={16} {...props}>\n\t\t\t<Margins blockEnd={8}>\n\t\t\t\t<Box fontScale='h4'>{t('E2E_Encryption_Password_Change')}</Box>\n\t\t\t\t<Box dangerouslySetInnerHTML={{ __html: t('E2E_Encryption_Password_Explanation') }} />\n\t\t\t\t<FieldGroup w='full'>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel id='New_encryption_password'>{t('New_encryption_password')}</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<PasswordInput\n\t\t\t\t\t\t\t\t{...register('password', { required: true })}\n\t\t\t\t\t\t\t\tplaceholder={t('New_Password_Placeholder')}\n\t\t\t\t\t\t\t\tdisabled={!keysExist}\n\t\t\t\t\t\t\t\taria-labelledby='New_encryption_password'\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t{!keysExist && <FieldHint>{t('EncryptionKey_Change_Disabled')}</FieldHint>}\n\t\t\t\t\t</Field>\n\t\t\t\t\t{hasTypedPassword && (\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel id='Confirm_new_encryption_password'>{t('Confirm_new_encryption_password')}</FieldLabel>\n\t\t\t\t\t\t\t<PasswordInput\n\t\t\t\t\t\t\t\terror={errors.passwordConfirm?.message}\n\t\t\t\t\t\t\t\t{...register('passwordConfirm', {\n\t\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t\t\tvalidate: (value: string) => (password !== value ? 'Your passwords do no match' : true),\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\tplaceholder={t('Confirm_New_Password_Placeholder')}\n\t\t\t\t\t\t\t\taria-labelledby='Confirm_new_encryption_password'\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{errors.passwordConfirm && <FieldError>{errors.passwordConfirm.message}</FieldError>}\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t)}\n\t\t\t\t</FieldGroup>\n\t\t\t\t<Button\n\t\t\t\t\tprimary\n\t\t\t\t\tdisabled={!(keysExist && isValid)}\n\t\t\t\t\tonClick={handleSubmit(saveNewPassword)}\n\t\t\t\t\tdata-qa-type='e2e-encryption-save-password-button'\n\t\t\t\t>\n\t\t\t\t\t{t('Save_changes')}\n\t\t\t\t</Button>\n\t\t\t\t<Box fontScale='h4' mbs={16}>\n\t\t\t\t\t{t('Reset_E2E_Key')}\n\t\t\t\t</Box>\n\t\t\t\t<Box dangerouslySetInnerHTML={{ __html: t('E2E_Reset_Key_Explanation') }} />\n\t\t\t\t<Button onClick={handleResetE2eKey} data-qa-type='e2e-encryption-reset-key-button'>\n\t\t\t\t\t{t('Reset_E2E_Key')}\n\t\t\t\t</Button>\n\t\t\t</Margins>\n\t\t</Box>\n\t);\n};\n\nexport default EndToEnd;\n",null],"names":["_extends","Box","Margins","PasswordInput","Field","FieldGroup","FieldLabel","FieldRow","FieldError","FieldHint","Button","useToastMessageDispatch","useMethod","useTranslation","useLogout","React","useCallback","useEffect","useForm","e2e","module","link","default","v","exportDefault","props","_errors$passwordConfi","t","dispatchToastMessage","logout","publicKey","localStorage","getItem","privateKey","resetE2eKey","register","handleSubmit","watch","resetField","formState","errors","isValid","defaultValues","password","passwordConfirm","mode","keysExist","Boolean","hasTypedPassword","trim","length","saveNewPassword","data","changePassword","type","message","error","handleResetE2eKey","result","createElement","display","flexDirection","alignItems","mbs","blockEnd","fontScale","dangerouslySetInnerHTML","__html","w","id","required","placeholder","disabled","validate","value","primary","onClick"],"mappings":"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"}