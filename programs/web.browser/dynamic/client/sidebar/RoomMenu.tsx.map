)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/RoomMenu.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { RoomType } from '@rocket.chat/core-typings';\nimport { Option, Menu } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { TranslationKey, Fields } from '@rocket.chat/ui-contexts';\nimport {\n\tuseRouter,\n\tuseSetModal,\n\tuseToastMessageDispatch,\n\tuseUserSubscription,\n\tuseSetting,\n\tusePermission,\n\tuseMethod,\n\tuseTranslation,\n\tuseEndpoint,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { memo, useMemo } from 'react';\n\nimport { LegacyRoomManager } from '../../app/ui-utils/client';\nimport { UiTextContext } from '../../definition/IRoomTypeConfig';\nimport { useOmnichannelPrioritiesMenu } from '../../ee/client/omnichannel/hooks/useOmnichannelPrioritiesMenu';\nimport { GenericModalDoNotAskAgain } from '../components/GenericModal';\nimport WarningModal from '../components/WarningModal';\nimport { useDontAskAgain } from '../hooks/useDontAskAgain';\nimport { roomCoordinator } from '../lib/rooms/roomCoordinator';\n\nconst fields: Fields = {\n\tf: true,\n\tt: true,\n\tname: true,\n};\n\ntype RoomMenuProps = {\n\trid: string;\n\tunread?: boolean;\n\tthreadUnread?: boolean;\n\talert?: boolean;\n\troomOpen?: boolean;\n\ttype: RoomType;\n\tcl?: boolean;\n\tname?: string;\n\thideDefaultOptions: boolean;\n};\n\nconst closeEndpoints = {\n\tp: '/v1/groups.close',\n\tc: '/v1/channels.close',\n\td: '/v1/im.close',\n\n\tv: '/v1/channels.close',\n\tl: '/v1/groups.close',\n} as const;\n\nconst leaveEndpoints = {\n\tp: '/v1/groups.leave',\n\tc: '/v1/channels.leave',\n\td: '/v1/im.leave',\n\n\tv: '/v1/channels.leave',\n\tl: '/v1/groups.leave',\n} as const;\n\nconst RoomMenu = ({\n\trid,\n\tunread,\n\tthreadUnread,\n\talert,\n\troomOpen,\n\ttype,\n\tcl,\n\tname = '',\n\thideDefaultOptions = false,\n}: RoomMenuProps): ReactElement | null => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst closeModal = useMutableCallback(() => setModal());\n\n\tconst router = useRouter();\n\n\tconst subscription = useUserSubscription(rid, fields);\n\tconst canFavorite = useSetting('Favorite_Rooms');\n\tconst isFavorite = Boolean(subscription?.f);\n\n\tconst dontAskHideRoom = useDontAskAgain('hideRoom');\n\n\tconst hideRoom = useEndpoint('POST', closeEndpoints[type]);\n\tconst readMessages = useEndpoint('POST', '/v1/subscriptions.read');\n\tconst toggleFavorite = useEndpoint('POST', '/v1/rooms.favorite');\n\tconst leaveRoom = useEndpoint('POST', leaveEndpoints[type]);\n\n\tconst unreadMessages = useMethod('unreadMessages');\n\n\tconst isUnread = alert || unread || threadUnread;\n\n\tconst canLeaveChannel = usePermission('leave-c');\n\tconst canLeavePrivate = usePermission('leave-p');\n\n\tconst isOmnichannelRoom = type === 'l';\n\tconst prioritiesMenu = useOmnichannelPrioritiesMenu(rid);\n\n\tconst canLeave = ((): boolean => {\n\t\tif (type === 'c' && !canLeaveChannel) {\n\t\t\treturn false;\n\t\t}\n\t\tif (type === 'p' && !canLeavePrivate) {\n\t\t\treturn false;\n\t\t}\n\t\treturn !((cl != null && !cl) || ['d', 'l'].includes(type));\n\t})();\n\n\tconst handleLeave = useMutableCallback(() => {\n\t\tconst leave = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait leaveRoom({ roomId: rid });\n\t\t\t\tif (roomOpen) {\n\t\t\t\t\trouter.navigate('/home');\n\t\t\t\t}\n\t\t\t\tLegacyRoomManager.close(rid);\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t\tcloseModal();\n\t\t};\n\n\t\tconst warnText = roomCoordinator.getRoomDirectives(type).getUiText(UiTextContext.LEAVE_WARNING);\n\n\t\tsetModal(\n\t\t\t<WarningModal\n\t\t\t\ttext={t(warnText as TranslationKey, name)}\n\t\t\t\tconfirmText={t('Leave_room')}\n\t\t\t\tclose={closeModal}\n\t\t\t\tcancel={closeModal}\n\t\t\t\tcancelText={t('Cancel')}\n\t\t\t\tconfirm={leave}\n\t\t\t/>,\n\t\t);\n\t});\n\n\tconst handleHide = useMutableCallback(async () => {\n\t\tconst hide = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait hideRoom({ roomId: rid });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t\tcloseModal();\n\t\t};\n\n\t\tconst warnText = roomCoordinator.getRoomDirectives(type).getUiText(UiTextContext.HIDE_WARNING);\n\n\t\tif (dontAskHideRoom) {\n\t\t\treturn hide();\n\t\t}\n\n\t\tsetModal(\n\t\t\t<GenericModalDoNotAskAgain\n\t\t\t\tvariant='danger'\n\t\t\t\tconfirmText={t('Yes_hide_it')}\n\t\t\t\tcancelText={t('Cancel')}\n\t\t\t\tonClose={closeModal}\n\t\t\t\tonCancel={closeModal}\n\t\t\t\tonConfirm={hide}\n\t\t\t\tdontAskAgain={{\n\t\t\t\t\taction: 'hideRoom',\n\t\t\t\t\tlabel: t('Hide_room'),\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{t(warnText as TranslationKey, name)}\n\t\t\t</GenericModalDoNotAskAgain>,\n\t\t);\n\t});\n\n\tconst handleToggleRead = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tif (isUnread) {\n\t\t\t\tawait readMessages({ rid, readThreads: true });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait unreadMessages(undefined, rid);\n\t\t\tif (subscription == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tLegacyRoomManager.close(subscription.t + subscription.name);\n\n\t\t\trouter.navigate('/home');\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst handleToggleFavorite = useMutableCallback(async () => {\n\t\ttry {\n\t\t\tawait toggleFavorite({ roomId: rid, favorite: !isFavorite });\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t});\n\n\tconst menuOptions = useMemo(\n\t\t() => ({\n\t\t\t...(!hideDefaultOptions && {\n\t\t\t\thideRoom: {\n\t\t\t\t\tlabel: { label: t('Hide'), icon: 'eye-off' },\n\t\t\t\t\taction: handleHide,\n\t\t\t\t},\n\t\t\t\ttoggleRead: {\n\t\t\t\t\tlabel: { label: isUnread ? t('Mark_read') : t('Mark_unread'), icon: 'flag' },\n\t\t\t\t\taction: handleToggleRead,\n\t\t\t\t},\n\t\t\t\t...(canFavorite\n\t\t\t\t\t? {\n\t\t\t\t\t\t\ttoggleFavorite: {\n\t\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\t\tlabel: isFavorite ? t('Unfavorite') : t('Favorite'),\n\t\t\t\t\t\t\t\t\ticon: isFavorite ? 'star-filled' : 'star',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taction: handleToggleFavorite,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t  }\n\t\t\t\t\t: {}),\n\t\t\t\t...(canLeave && {\n\t\t\t\t\tleaveRoom: {\n\t\t\t\t\t\tlabel: { label: t('Leave_room'), icon: 'sign-out' },\n\t\t\t\t\t\taction: handleLeave,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t}),\n\t\t\t...(isOmnichannelRoom && prioritiesMenu),\n\t\t}),\n\t\t[\n\t\t\thideDefaultOptions,\n\t\t\tt,\n\t\t\thandleHide,\n\t\t\tisUnread,\n\t\t\thandleToggleRead,\n\t\t\tcanFavorite,\n\t\t\tisFavorite,\n\t\t\thandleToggleFavorite,\n\t\t\tcanLeave,\n\t\t\thandleLeave,\n\t\t\tisOmnichannelRoom,\n\t\t\tprioritiesMenu,\n\t\t],\n\t);\n\n\treturn (\n\t\t<Menu\n\t\t\trcx-sidebar-item__menu\n\t\t\ttitle={t('Options')}\n\t\t\tmini\n\t\t\taria-keyshortcuts='alt'\n\t\t\ttabIndex={-1}\n\t\t\toptions={menuOptions}\n\t\t\tmaxHeight={300}\n\t\t\trenderItem={({ label: { label, icon }, ...props }): JSX.Element => <Option label={label} icon={icon} {...props} />}\n\t\t/>\n\t);\n};\n\nexport default memo(RoomMenu);\n",null],"names":["_extends","_objectWithoutProperties","_objectSpread","Option","Menu","useMutableCallback","useRouter","useSetModal","useToastMessageDispatch","useUserSubscription","useSetting","usePermission","useMethod","useTranslation","useEndpoint","React","memo","useMemo","LegacyRoomManager","UiTextContext","useOmnichannelPrioritiesMenu","GenericModalDoNotAskAgain","WarningModal","useDontAskAgain","roomCoordinator","module","link","default","fields","f","t","name","closeEndpoints","p","c","d","v","l","leaveEndpoints","exportDefault","_ref","rid","unread","threadUnread","alert","roomOpen","type","cl","hideDefaultOptions","dispatchToastMessage","setModal","closeModal","router","subscription","canFavorite","isFavorite","Boolean","dontAskHideRoom","hideRoom","readMessages","toggleFavorite","leaveRoom","unreadMessages","isUnread","canLeaveChannel","canLeavePrivate","isOmnichannelRoom","prioritiesMenu","canLeave","includes","handleLeave","leave","roomId","navigate","close","error","message","warnText","getRoomDirectives","getUiText","LEAVE_WARNING","createElement","text","confirmText","cancel","cancelText","confirm","handleHide","hide","HIDE_WARNING","variant","onClose","onCancel","onConfirm","dontAskAgain","action","label","handleToggleRead","readThreads","undefined","handleToggleFavorite","favorite","menuOptions","icon","toggleRead","title","mini","tabIndex","options","maxHeight","renderItem","_ref2","props","_excluded"],"mappings":"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"}