)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/header/MatrixFederationSearch/FederatedRoomList.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Throbber, Box } from '@rocket.chat/fuselage';\nimport type { IFederationPublicRooms } from '@rocket.chat/rest-typings';\nimport { useSetModal, useEndpoint, useToastMessageDispatch, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation } from '@tanstack/react-query';\nimport type { VFC } from 'react';\nimport React from 'react';\nimport { Virtuoso } from 'react-virtuoso';\n\nimport ScrollableContentWrapper from '../../../components/ScrollableContentWrapper';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport FederatedRoomListEmptyPlaceholder from './FederatedRoomListEmptyPlaceholder';\nimport FederatedRoomListItem from './FederatedRoomListItem';\nimport { useInfiniteFederationSearchPublicRooms } from './useInfiniteFederationSearchPublicRooms';\n\ntype FederatedRoomListProps = {\n\tserverName: string;\n\troomName?: string;\n\tpageToken?: string;\n\tcount?: number;\n};\n\nconst FederatedRoomList: VFC<FederatedRoomListProps> = ({ serverName, roomName, count }) => {\n\tconst joinExternalPublicRoom = useEndpoint('POST', '/v1/federation/joinExternalPublicRoom');\n\n\tconst setModal = useSetModal();\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst { data, isLoading, isFetchingNextPage, fetchNextPage } = useInfiniteFederationSearchPublicRooms(serverName, roomName, count);\n\n\tconst { mutate: onClickJoin, isLoading: isLoadingMutation } = useMutation(\n\t\t['federation/joinExternalPublicRoom'],\n\t\tasync ({ id, pageToken }: IFederationPublicRooms) => {\n\t\t\treturn joinExternalPublicRoom({ externalRoomId: id as `!${string}:${string}`, roomName, pageToken });\n\t\t},\n\t\t{\n\t\t\tonSuccess: (_, data) => {\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tmessage: t('Your_request_to_join__roomName__has_been_made_it_could_take_up_to_15_minutes_to_be_processed', {\n\t\t\t\t\t\troomName: data.name,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t\tsetModal(null);\n\t\t\t},\n\t\t\tonError: (error, { id }) => {\n\t\t\t\tif (error instanceof Error && error.message === 'already-joined') {\n\t\t\t\t\tsetModal(null);\n\t\t\t\t\troomCoordinator.openRouteLink('c', { rid: id });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t},\n\t\t},\n\t);\n\n\tif (isLoading) {\n\t\treturn <Throbber />;\n\t}\n\n\tconst flattenedData = data?.pages.flatMap((page) => page.rooms);\n\treturn (\n\t\t<Box is='ul' overflow='hidden' height='356px' flexGrow={1} flexShrink={0} mi={-24}>\n\t\t\t<Virtuoso\n\t\t\t\tdata={flattenedData || []}\n\t\t\t\tcomputeItemKey={(index, room) => room?.id || index}\n\t\t\t\toverscan={4}\n\t\t\t\tcomponents={{\n\t\t\t\t\t// eslint-disable-next-line react/no-multi-comp\n\t\t\t\t\tFooter: () => (isFetchingNextPage ? <Throbber /> : null),\n\t\t\t\t\tScroller: ScrollableContentWrapper,\n\t\t\t\t\tEmptyPlaceholder: FederatedRoomListEmptyPlaceholder,\n\t\t\t\t}}\n\t\t\t\tendReached={isLoading || isFetchingNextPage ? () => undefined : () => fetchNextPage()}\n\t\t\t\titemContent={(_, room) => (\n\t\t\t\t\t<FederatedRoomListItem onClickJoin={() => onClickJoin(room)} {...room} disabled={isLoadingMutation} key={room.id} />\n\t\t\t\t)}\n\t\t\t/>\n\t\t</Box>\n\t);\n};\n\nexport default FederatedRoomList;\n",null],"names":["_extends","Throbber","Box","useSetModal","useEndpoint","useToastMessageDispatch","useTranslation","useMutation","React","Virtuoso","ScrollableContentWrapper","roomCoordinator","FederatedRoomListEmptyPlaceholder","FederatedRoomListItem","useInfiniteFederationSearchPublicRooms","module","link","default","exportDefault","_ref","serverName","roomName","count","joinExternalPublicRoom","setModal","t","dispatchToastMessage","data","isLoading","isFetchingNextPage","fetchNextPage","mutate","onClickJoin","isLoadingMutation","_ref2","id","pageToken","externalRoomId","onSuccess","_","type","message","name","onError","error","_ref3","Error","openRouteLink","rid","createElement","flattenedData","pages","flatMap","page","rooms","is","overflow","height","flexGrow","flexShrink","mi","computeItemKey","index","room","overscan","components","Footer","Scroller","EmptyPlaceholder","endReached","undefined","itemContent","disabled","key"],"mappings":"2BAAAA,EAAAC,EAASC,EAA6CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA7CC,EAAUC,IAAK,CAAA,iCAA8B,CAAAC,QAAAA,CAAAA,EAAAjB,EAAAA,CAAA,CAAA,EAAA,GAArCe,EAAOC,IAAAA,CAAAA,wBAA6B,CAACf,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,IAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAZ,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,wBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAR,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,QAAAA,CAAAE,QAAAA,CAAAA,EAAAT,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAN,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,+CAAAA,CAAAE,QAAAA,CAAAA,EAAAP,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,qCAAAA,CAAAJ,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAE,QAAAA,CAAAA,EAAAL,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAE,QAAAA,CAAAA,EAAAJ,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,2CAAAA,CAAAD,uCAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAtDC,EAAOG,aAAY,CAqBoCC,IAAoC,GAAnC,CAAEC,WAAAA,CAAU,CAAEC,SAAAA,CAAQ,CAAEC,MAAAA,CAAAA,CAAO,CAAAH,EAChFI,EAAyBnB,EAAY,OAAQ,yCAE7CoB,EAAWrB,IACXsB,EAAInB,IACJoB,EAAuBrB,IACvB,CAAEsB,KAAAA,CAAI,CAAEC,UAAAA,CAAS,CAAEC,mBAAAA,CAAkB,CAAEC,cAAAA,CAAAA,CAAe,CAAGhB,EAAuCM,EAAYC,EAAUC,GAEtH,CAAES,OAAQC,CAAW,CAAEJ,UAAWK,CAAAA,CAAmB,CAAG1B,EAC7D,CAAC,oCAAoC,CACrC,MAAA2B,IAAoD,GAA7C,CAAEC,GAAAA,CAAE,CAAEC,UAAAA,CAAAA,CAAmC,CAAAF,EAC/C,OAAOX,EAAuB,CAAEc,eAAgBF,EAA8Bd,SAAAA,EAAUe,UAAAA,CAAS,EAClG,EACA,CACCE,UAAW,CAACC,EAAGZ,KACdD,EAAqB,CACpBc,KAAM,UACNC,QAAShB,EAAE,+FAAgG,CAC1GJ,SAAUM,EAAKe,IAAAA,KAGjBlB,EAAS,KACV,EACAmB,QAAS,CAACC,EAAKC,KAAY,GAAV,CAAEV,GAAAA,CAAAA,CAAI,CAAAU,EACtB,GAAID,aAAiBE,OAASF,AAAkB,mBAAlBA,EAAMH,OAAO,CAAuB,CACjEjB,EAAS,MACTb,EAAgBoC,aAAa,CAAC,IAAK,CAAEC,IAAKb,CAAE,GAC5C,OAGDT,EAAqB,CAAEc,KAAM,QAASC,QAASG,CAAK,EACrD,IAIF,GAAIhB,EACH,OAAOpB,EAAAyC,aAAA,CAAChD,EAAQ,MAGjB,IAAMiD,EAAgBvB,MAAAA,EAAI,KAAA,EAAJA,EAAMwB,KAAK,CAACC,OAAO,CAAEC,GAASA,EAAKC,KAAK,EAC9D,OACC9C,EAAAyC,aAAA,CAAC/C,EAAG,CAACqD,GAAG,KAAKC,SAAS,SAASC,OAAO,QAAQC,SAAU,EAAGC,WAAY,EAAGC,GAAI,GAAI,EACjFpD,EAAAyC,aAAA,CAACxC,EAAQ,CACRkB,KAAMuB,GAAiB,EAAG,CAC1BW,eAAgB,CAACC,EAAOC,IAAS,AAAAA,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAM5B,EAAE,AAAFA,GAAM2B,EAC7CE,SAAU,EACVC,WAAY,CAEXC,OAAQ,IAAOrC,EAAqBrB,EAAAyC,aAAA,CAAChD,EAAQ,MAAM,KACnDkE,SAAUzD,EACV0D,iBAAkBxD,GAEnByD,WAAYzC,GAAaC,EAAqB,IAAMyC,KAAAA,EAAY,IAAMxC,IACtEyC,YAAa,CAAChC,EAAGwB,IAChBvD,EAAAyC,aAAA,CAACpC,EAAqBb,EAAA,CAACgC,YAAa,IAAMA,EAAY+B,EAAM,EAAKA,EAAI,CAAES,SAAUvC,EAAmBwC,IAAKV,EAAK5B,EAAAA,AAAG,GAChH,GAIN"}