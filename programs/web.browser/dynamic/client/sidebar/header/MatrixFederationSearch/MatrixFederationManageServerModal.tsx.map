)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/header/MatrixFederationSearch/MatrixFederationManageServerModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Divider, Modal, ButtonGroup, Button, Field, TextInput, FieldLabel, FieldRow, FieldError, FieldHint } from '@rocket.chat/fuselage';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport { useSetModal, useTranslation, useEndpoint, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport type { VFC, FormEvent } from 'react';\nimport React, { useState } from 'react';\n\nimport MatrixFederationRemoveServerList from './MatrixFederationRemoveServerList';\nimport MatrixFederationSearch from './MatrixFederationSearch';\nimport { useMatrixServerList } from './useMatrixServerList';\n\ntype MatrixFederationAddServerModalProps = {\n\tonClickClose: () => void;\n};\n\nconst getErrorKey = (error: any): TranslationKey | undefined => {\n\tif (!error) {\n\t\treturn;\n\t}\n\tif (error.error === 'invalid-server-name') {\n\t\treturn 'Server_doesnt_exist';\n\t}\n\tif (error.error === 'invalid-server-name') {\n\t\treturn 'Server_already_added';\n\t}\n};\n\nconst MatrixFederationAddServerModal: VFC<MatrixFederationAddServerModalProps> = ({ onClickClose }) => {\n\tconst t = useTranslation();\n\tconst addMatrixServer = useEndpoint('POST', '/v1/federation/addServerByUser');\n\tconst [serverName, setServerName] = useState('');\n\tconst [errorKey, setErrorKey] = useState<TranslationKey | undefined>();\n\tconst setModal = useSetModal();\n\tconst queryClient = useQueryClient();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst {\n\t\tmutate: addServer,\n\t\tisLoading,\n\t\tisError,\n\t} = useMutation(['v1/federation/addServerByUser', serverName], () => addMatrixServer({ serverName }), {\n\t\tonSuccess: async () => {\n\t\t\tawait queryClient.invalidateQueries(['federation/listServersByUsers']);\n\t\t\tsetModal(<MatrixFederationSearch defaultSelectedServer={serverName} onClose={onClickClose} key={serverName} />);\n\t\t},\n\t\tonError: (error) => {\n\t\t\tconst errorKey = getErrorKey(error);\n\t\t\tif (!errorKey) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetErrorKey(errorKey);\n\t\t},\n\t});\n\n\tconst { data, isLoading: isLoadingServerList } = useMatrixServerList();\n\n\treturn (\n\t\t<Modal maxHeight='x600'>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Manage_servers')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onClickClose} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Server_name')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\tvalue={serverName}\n\t\t\t\t\t\t\tonChange={(e: FormEvent<HTMLInputElement>) => {\n\t\t\t\t\t\t\t\tsetServerName(e.currentTarget.value);\n\t\t\t\t\t\t\t\tif (errorKey) {\n\t\t\t\t\t\t\t\t\tsetErrorKey(undefined);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tmie={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button onClick={() => addServer()} primary loading={isLoading}>\n\t\t\t\t\t\t\t{t('Add')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t\t{isError && errorKey && <FieldError>{t(errorKey)}</FieldError>}\n\t\t\t\t\t<FieldHint>{t('Federation_Example_matrix_server')}</FieldHint>\n\t\t\t\t</Field>\n\t\t\t\t<Divider mb={16} />\n\t\t\t\t{!isLoadingServerList && data?.servers && <MatrixFederationRemoveServerList servers={data.servers} />}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button onClick={onClickClose}>{t('Cancel')}</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default MatrixFederationAddServerModal;\n",null],"names":["Divider","Modal","ButtonGroup","Button","Field","TextInput","FieldLabel","FieldRow","FieldHint","useSetModal","useTranslation","useEndpoint","useToastMessageDispatch","useMutation","useQueryClient","React","useState","MatrixFederationRemoveServerList","MatrixFederationSearch","useMatrixServerList","module","link","v","FieldError","default","getErrorKey","error","exportDefault","_ref","onClickClose","t","addMatrixServer","serverName","setServerName","errorKey","setErrorKey","setModal","queryClient","dispatchToastMessage","mutate","addServer","isLoading","isError","onSuccess","invalidateQueries","createElement","defaultSelectedServer","onClose","key","onError","type","message","data","isLoadingServerList","maxHeight","Header","Title","Close","onClick","Content","disabled","value","onChange","e","currentTarget","undefined","mie","primary","loading","mb","servers","Footer"],"mappings":"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"}