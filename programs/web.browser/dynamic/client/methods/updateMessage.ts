function module(e,t,i){let s,n,l,a,d,r,o,u,m,g;i.link("meteor/meteor",{Meteor(e){s=e}},0),i.link("meteor/tracker",{Tracker(e){n=e}},1),i.link("moment",{default(e){l=e}},2),i.link("../../app/authorization/client",{hasAtLeastOnePermission(e){a=e},hasPermission(e){d=e}},3),i.link("../../app/models/client",{ChatMessage(e){r=e}},4),i.link("../../app/settings/client",{settings(e){o=e}},5),i.link("../../app/utils/lib/i18n",{t(e){u=e}},6),i.link("../../lib/callbacks",{callbacks(e){m=e}},7),i.link("../lib/toast",{dispatchToastMessage(e){g=e}},8),s.methods({updateMessage(e){var t,i,c,p;let f=s.userId();if(!f)return;let k=r.findOne(e._id);if(!k)return;let v=a("edit-message",e.rid),h=o.get("Message_AllowEditing"),_=!1,b=null!==(t=null==k?void 0:null===(i=k.attachments)||void 0===i?void 0:null===(c=i[0])||void 0===c?void 0:c.description)&&void 0!==t?t:k.msg;if(b===e.msg)return;null!=k&&null!==(p=k.u)&&void 0!==p&&p._id&&(_=k.u._id===f);let M=s.users.findOne(f);if(!M)return;if(!(v||h&&_)){g({type:"error",message:u("error-action-not-allowed",{action:u("Message_editing")})});return}let y=Number(o.get("Message_AllowEditing_BlockEditInMinutes")),w=d("bypass-time-limit-edit-and-delete");if(!w&&0!==y&&k.ts){let e=l(k.ts);if(e){let t=l().diff(e,"minutes");if(t>y){g({type:"error",message:u("error-message-editing-blocked")});return}}}n.nonreactive(async()=>{var t;e.editedAt=new Date(Date.now()),e.editedBy={_id:f,username:M.username},e=await m.run("beforeSaveMessage",e);let i={editedAt:e.editedAt,editedBy:e.editedBy,msg:e.msg};null!==(t=k.attachments)&&void 0!==t&&t.length&&void 0!==k.attachments[0].description&&(delete i.msg,k.attachments[0].description=e.msg),r.update({_id:e._id,"u._id":f},{$set:i})})}})}
//# sourceMappingURL=/dynamic/client/methods/769066cfdab8b04aa18bad5e30eabbcc102e1c7a.map
