)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/custom-sounds/client/lib/CustomSounds.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ICustomSound } from '@rocket.chat/core-typings';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { getURL } from '../../../utils/client';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\nconst getCustomSoundId = (soundId: ICustomSound['_id']) => `custom-sound-${soundId}`;\nconst getAssetUrl = (asset: string, params?: Record<string, any>) => getURL(asset, params, undefined, true);\n\nconst defaultSounds = [\n\t{ _id: 'chime', name: 'Chime', extension: 'mp3', src: getAssetUrl('sounds/chime.mp3') },\n\t{ _id: 'door', name: 'Door', extension: 'mp3', src: getAssetUrl('sounds/door.mp3') },\n\t{ _id: 'beep', name: 'Beep', extension: 'mp3', src: getAssetUrl('sounds/beep.mp3') },\n\t{ _id: 'chelle', name: 'Chelle', extension: 'mp3', src: getAssetUrl('sounds/chelle.mp3') },\n\t{ _id: 'ding', name: 'Ding', extension: 'mp3', src: getAssetUrl('sounds/ding.mp3') },\n\t{ _id: 'droplet', name: 'Droplet', extension: 'mp3', src: getAssetUrl('sounds/droplet.mp3') },\n\t{ _id: 'highbell', name: 'Highbell', extension: 'mp3', src: getAssetUrl('sounds/highbell.mp3') },\n\t{ _id: 'seasons', name: 'Seasons', extension: 'mp3', src: getAssetUrl('sounds/seasons.mp3') },\n\t{ _id: 'telephone', name: 'Telephone', extension: 'mp3', src: getAssetUrl('sounds/telephone.mp3') },\n\t{ _id: 'outbound-call-ringing', name: 'Outbound Call Ringing', extension: 'mp3', src: getAssetUrl('sounds/outbound-call-ringing.mp3') },\n\t{ _id: 'call-ended', name: 'Call Ended', extension: 'mp3', src: getAssetUrl('sounds/call-ended.mp3') },\n\t{ _id: 'dialtone', name: 'Dialtone', extension: 'mp3', src: getAssetUrl('sounds/dialtone.mp3') },\n\t{ _id: 'ringtone', name: 'Ringtone', extension: 'mp3', src: getAssetUrl('sounds/ringtone.mp3') },\n];\n\nclass CustomSoundsClass {\n\tlist: ReactiveVar<Record<string, ICustomSound>>;\n\n\tinitialFetchDone: boolean;\n\n\tconstructor() {\n\t\tthis.list = new ReactiveVar({});\n\t\tthis.initialFetchDone = false;\n\t\tdefaultSounds.forEach((sound) => this.add(sound));\n\t}\n\n\tadd(sound: ICustomSound) {\n\t\tif (!sound.src) {\n\t\t\tsound.src = this.getURL(sound);\n\t\t}\n\n\t\tconst source = document.createElement('source');\n\t\tsource.src = sound.src;\n\n\t\tconst audio = document.createElement('audio');\n\t\taudio.id = getCustomSoundId(sound._id);\n\t\taudio.preload = 'none';\n\t\taudio.appendChild(source);\n\n\t\tdocument.body.appendChild(audio);\n\n\t\tconst list = this.list.get();\n\t\tlist[sound._id] = sound;\n\t\tthis.list.set(list);\n\t}\n\n\tremove(sound: ICustomSound) {\n\t\tconst list = this.list.get();\n\t\tdelete list[sound._id];\n\t\tthis.list.set(list);\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(sound._id)}`);\n\t\taudio?.remove();\n\t}\n\n\tgetSound(soundId: ICustomSound['_id']) {\n\t\tconst list = this.list.get();\n\t\treturn list[soundId];\n\t}\n\n\tupdate(sound: ICustomSound) {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(sound._id)}`);\n\t\tif (audio) {\n\t\t\tconst list = this.list.get();\n\t\t\tif (!sound.src) {\n\t\t\t\tsound.src = this.getURL(sound);\n\t\t\t}\n\t\t\tlist[sound._id] = sound;\n\t\t\tthis.list.set(list);\n\t\t\tconst sourceEl = audio.querySelector('source');\n\t\t\tif (sourceEl) {\n\t\t\t\tsourceEl.src = sound.src;\n\t\t\t}\n\t\t\taudio.load();\n\t\t} else {\n\t\t\tthis.add(sound);\n\t\t}\n\t}\n\n\tgetURL(sound: ICustomSound) {\n\t\treturn getAssetUrl(`/custom-sounds/${sound._id}.${sound.extension}`, { _dc: sound.random || 0 });\n\t}\n\n\tgetList() {\n\t\tconst list = Object.values(this.list.get());\n\t\treturn list.sort((a, b) => (a.name ?? '').localeCompare(b.name ?? ''));\n\t}\n\n\tplay = async (soundId: ICustomSound['_id'], { volume = 1, loop = false } = {}) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\t\tif (!audio?.play) {\n\t\t\treturn;\n\t\t}\n\n\t\taudio.volume = volume;\n\t\taudio.loop = loop;\n\t\tawait audio.play();\n\n\t\treturn audio;\n\t};\n\n\tpause = (soundId: ICustomSound['_id']) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\t\tif (!audio?.pause) {\n\t\t\treturn;\n\t\t}\n\n\t\taudio.pause();\n\t};\n\n\tstop = (soundId: ICustomSound['_id']) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\t\tif (!audio?.load) {\n\t\t\treturn;\n\t\t}\n\n\t\taudio?.load();\n\t};\n\n\tisPlaying = (soundId: ICustomSound['_id']) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\n\t\treturn audio && audio.duration > 0 && !audio.paused;\n\t};\n\n\tfetchCustomSoundList = async () => {\n\t\tif (this.initialFetchDone) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = await sdk.call('listCustomSounds');\n\t\tfor (const sound of result) {\n\t\t\tthis.add(sound);\n\t\t}\n\t\tthis.initialFetchDone = true;\n\t};\n}\n\nexport const CustomSounds = new CustomSoundsClass();\n",null],"names":["ReactiveVar","getURL","sdk","module","export","CustomSounds","getCustomSoundId","soundId","concat","getAssetUrl","asset","params","undefined","defaultSounds","_id","name","extension","src","CustomSoundsClass","constructor","list","initialFetchDone","play","volume","loop","arguments","length","audio","document","querySelector","pause","stop","load","isPlaying","duration","paused","fetchCustomSoundList","result","call","sound","add","forEach","source","createElement","id","preload","appendChild","body","get","set","remove","getSound","update","sourceEl","_dc","random","getList","Object","values","sort","a","b","_a$name","_b$name","localeCompare"],"mappings":"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"}