function module(t,a,e){let n,s,i,r,l,o,u,d,g,c;e.export({AutoTranslate:()=>p,createAutoTranslateMessageStreamHandler:()=>T}),e.link("@rocket.chat/core-typings",{isTranslatedMessageAttachment(t){n=t}},0),e.link("mem",{default(t){s=t}},1),e.link("meteor/meteor",{Meteor(t){i=t}},2),e.link("meteor/tracker",{Tracker(t){r=t}},3),e.link("../../../../client/views/room/MessageList/lib/autoTranslate",{hasTranslationLanguageInAttachments(t){l=t},hasTranslationLanguageInMessage(t){o=t}},4),e.link("../../../authorization/client",{hasPermission(t){u=t}},5),e.link("../../../models/client",{Subscriptions(t){d=t},Messages(t){g=t}},6),e.link("../../../utils/client/lib/SDKClient",{sdk(t){c=t}},7);let h="en",m="";i.startup(()=>{r.autorun(()=>{let t=i.user();t&&(h=t.language||"en",m=t.username||"")})});let p={initialized:!1,providersMetadata:{},messageIdsToWait:{},supportedLanguages:[],findSubscriptionByRid:s(t=>d.findOne({rid:t})),getLanguage(t){var a,e,n;let s;t&&(s=this.findSubscriptionByRid(t));let i=(null===(a=s)||void 0===a?void 0:a.autoTranslateLanguage)||h||(null===(e=(n=window).defaultUserLanguage)||void 0===e?void 0:e.call(n));return -1===i.indexOf("-")||(this.supportedLanguages||[]).some(t=>t.language===i)?i:i.slice(0,2)},translateAttachments(t,a,e){if(!n(t))return t;for(let n of t)n.author_name!==m&&(n.text&&n.translations&&n.translations[a]&&(n.translations.original=n.text,e?n.text=n.translations.original:n.text=n.translations[a]),n.description&&n.translations&&n.translations[a]&&(n.translations.original=n.description,e?n.description=n.translations.original:n.description=n.translations[a]),n.attachments&&n.attachments.length>0&&(n.attachments=this.translateAttachments(n.attachments,a)));return t},init(){this.initialized||(r.autorun(async t=>{let a=i.userId();if(a&&u("auto-translate")){t.stop();try{[this.providersMetadata,this.supportedLanguages]=await Promise.all([c.call("autoTranslate.getProviderUiMetadata"),c.call("autoTranslate.getSupportedLanguages","en")])}catch(t){console.error(t.message)}}}),d.find().observeChanges({changed:(t,a)=>{(a.hasOwnProperty("autoTranslate")||a.hasOwnProperty("autoTranslateLanguage"))&&s.clear(this.findSubscriptionByRid)}}),this.initialized=!0)}},T=()=>(p.init(),t=>{if(t.u&&t.u._id!==i.userId()){let a=p.findSubscriptionByRid(t.rid),e=p.getLanguage(t.rid);!a||!0!==a.autoTranslate||!t.msg||t.translations&&(o(t,e)||l(t.attachments,e))?void 0!==p.messageIdsToWait[t._id]&&a&&!0!==a.autoTranslate?(g.update({_id:t._id},{$set:{autoTranslateShowInverse:!0},$unset:{autoTranslateFetching:!0}}),delete p.messageIdsToWait[t._id]):!0===t.autoTranslateFetching&&g.update({_id:t._id},{$unset:{autoTranslateFetching:!0}}):g.update({_id:t._id},{$set:{autoTranslateFetching:!0}})}})}
//# sourceMappingURL=/dynamic/app/autotranslate/client/lib/ebffcc2af02b6ebcce5ee799dc8802726330752c.map
