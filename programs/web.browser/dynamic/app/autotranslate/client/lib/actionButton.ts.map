)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/autotranslate/client/lib/actionButton.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\nimport { messageArgs } from '../../../../client/lib/utils/messageArgs';\nimport {\n\thasTranslationLanguageInAttachments,\n\thasTranslationLanguageInMessage,\n} from '../../../../client/views/room/MessageList/lib/autoTranslate';\nimport { hasAtLeastOnePermission } from '../../../authorization/client';\nimport { Messages } from '../../../models/client';\nimport { settings } from '../../../settings/client';\nimport { MessageAction } from '../../../ui-utils/client/lib/MessageAction';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\nimport { AutoTranslate } from './autotranslate';\n\nMeteor.startup(() => {\n\tAutoTranslate.init();\n\n\tTracker.autorun(() => {\n\t\tif (settings.get('AutoTranslate_Enabled') && hasAtLeastOnePermission(['auto-translate'])) {\n\t\t\tMessageAction.addButton({\n\t\t\t\tid: 'translate',\n\t\t\t\ticon: 'language',\n\t\t\t\tlabel: 'Translate',\n\t\t\t\tcontext: ['message', 'message-mobile', 'threads'],\n\t\t\t\ttype: 'interaction',\n\t\t\t\taction(_, props) {\n\t\t\t\t\tconst { message = messageArgs(this).msg } = props;\n\t\t\t\t\tconst language = AutoTranslate.getLanguage(message.rid);\n\t\t\t\t\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\n\t\t\t\t\t\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\n\t\t\t\t\t\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\n\t\t\t\t\t\tvoid sdk.call('autoTranslate.translateMessage', message, language);\n\t\t\t\t\t}\n\t\t\t\t\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\n\t\t\t\t\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\n\t\t\t\t},\n\t\t\t\tcondition({ message, subscription, user, room }) {\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\n\t\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\n\t\t\t\t\tconst isDifferentUser = message?.u && message.u._id !== user._id;\n\t\t\t\t\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\n\t\t\t\t\tconst hasLanguage =\n\t\t\t\t\t\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\n\n\t\t\t\t\treturn Boolean(\n\t\t\t\t\t\t(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse ||\n\t\t\t\t\t\t\t(isDifferentUser && autoTranslateEnabled && !hasLanguage),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\torder: 90,\n\t\t\t});\n\t\t\tMessageAction.addButton({\n\t\t\t\tid: 'view-original',\n\t\t\t\ticon: 'language',\n\t\t\t\tlabel: 'View_original',\n\t\t\t\tcontext: ['message', 'message-mobile', 'threads'],\n\t\t\t\ttype: 'interaction',\n\t\t\t\taction(_, props) {\n\t\t\t\t\tconst { message = messageArgs(this).msg } = props;\n\t\t\t\t\tconst language = AutoTranslate.getLanguage(message.rid);\n\t\t\t\t\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\n\t\t\t\t\t\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\n\t\t\t\t\t\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\n\t\t\t\t\t\tvoid sdk.call('autoTranslate.translateMessage', message, language);\n\t\t\t\t\t}\n\t\t\t\t\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\n\t\t\t\t\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\n\t\t\t\t},\n\t\t\t\tcondition({ message, subscription, user, room }) {\n\t\t\t\t\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\n\t\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst isDifferentUser = message?.u && message.u._id !== user._id;\n\t\t\t\t\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\n\t\t\t\t\tconst hasLanguage =\n\t\t\t\t\t\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\n\n\t\t\t\t\treturn Boolean(\n\t\t\t\t\t\t!(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse &&\n\t\t\t\t\t\t\tisDifferentUser &&\n\t\t\t\t\t\t\tautoTranslateEnabled &&\n\t\t\t\t\t\t\thasLanguage,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\torder: 90,\n\t\t\t});\n\t\t} else {\n\t\t\tMessageAction.removeButton('toggle-language');\n\t\t}\n\t});\n});\n",null],"names":["Meteor","Tracker","roomCoordinator","messageArgs","hasTranslationLanguageInAttachments","hasTranslationLanguageInMessage","hasAtLeastOnePermission","Messages","settings","MessageAction","sdk","AutoTranslate","module","link","startup","init","autorun","get","addButton","id","icon","label","context","type","action","_","props","message","msg","language","getLanguage","rid","attachments","messageIdsToWait","_id","update","$set","autoTranslateFetching","call","autoTranslateShowInverse","condition","_ref","subscription","user","room","autoTranslateLanguage","isLivechatRoom","t","isDifferentUser","u","autoTranslateEnabled","autoTranslate","hasLanguage","Boolean","order","_ref2","removeButton"],"mappings":"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"}