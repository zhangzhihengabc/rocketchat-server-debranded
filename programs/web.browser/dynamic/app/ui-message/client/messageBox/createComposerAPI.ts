function module(e,t,n){let l,i,r,s;n.export({createComposerAPI:()=>o}),n.link("@rocket.chat/emitter",{Emitter(e){l=e}},0),n.link("meteor/meteor",{Meteor(e){i=e}},1),n.link("../../../../lib/utils/highOrderFunctions",{withDebouncing(e){r=e}},2),n.link("./messageBoxFormatting",{formattingButtons(e){s=e}},3);let o=(e,t)=>{var n;let o,a,c,u;let d=(e,t)=>{let n=new Event(t,{bubbles:!0}),l=e._valueTracker;l&&l.setValue(new Date().toString()),e.dispatchEvent(n)},g=new l,v=[],m=r({wait:300})(()=>{if(e.value){i._localStorage.setItem(t,e.value);return}i._localStorage.removeItem(t)}),h=()=>{g.emit("quotedMessagesUpdate")};e.addEventListener("input",m);let b=function(t){let{selection:n,skipFocus:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l||p();let{selectionStart:i,selectionEnd:r}=e,s=e.value;if("function"==typeof n&&(n=n({start:i,end:r})),n){var o,a,c,u;!(null!==(o=(a=document).execCommand)&&void 0!==o&&o.call(a,"insertText",!1,t))&&(e.value=s.substring(0,i)+t+s.substring(i),l||p()),e.setSelectionRange(null!==(c=n.start)&&void 0!==c?c:0,null!==(u=n.end)&&void 0!==u?u:t.length)}n||(e.value=t),d(e,"input"),d(e,"change"),l||p()},f=e=>{b(e,{selection:t=>{let{start:n,end:l}=t;return{start:n+e.length,end:l+e.length}}})},p=()=>{e.focus()},x=async t=>{e&&(e.value=t,e.focus())},S=async t=>{v=[...v.filter(e=>e._id!==t._id),t],h(),e.focus()},E=async e=>{v=v.filter(t=>t._id!==e),h()},T=async()=>{v=[],h()},[k,C]=(o=!1,[{get:()=>o,subscribe:e=>g.on("editing",e)},e=>{o=e,g.emit("editing")}]),[w,y]=(a=!1,[{get:()=>a,subscribe:e=>g.on("recording",e)},e=>{a=e,g.emit("recording")}]),[_,M]=(c=!1,[{get:()=>c,subscribe:e=>g.on("recordingVideo",e)},e=>{c=e,g.emit("recordingVideo")}]),[D,I]=(u=!1,[{get:()=>u,subscribe:e=>g.on("mircophoneDenied",e)},e=>{u=e,g.emit("mircophoneDenied")}]),[O,q]=(()=>{let e=[],t=Tracker.autorun(()=>{e=s.filter(e=>{let{condition:t}=e;return!t||t()}),g.emit("formatting")});return[{get:()=>e,subscribe:e=>g.on("formatting",e)},t]})();return b(null!==(n=i._localStorage.getItem(t))&&void 0!==n?n:"",{skipFocus:!0}),{replaceText:(t,n)=>{var l,i,r,s;let{selectionStart:o,selectionEnd:a}=e;e.setSelectionRange(null!==(l=n.start)&&void 0!==l?l:0,null!==(i=n.end)&&void 0!==i?i:t.length);let c=e.value;null!==(r=(s=document).execCommand)&&void 0!==r&&r.call(s,"insertText",!1,t)||(e.value=c.substring(0,n.start)+t+c.substring(n.end)),e.selectionStart=o+t.length,e.selectionEnd=o+t.length,o!==a&&(e.selectionStart=o),d(e,"input"),d(e,"change"),p()},insertNewLine:()=>f("\n"),blur:()=>e.blur(),substring:(t,n)=>e.value.substring(t,n),getCursorPosition:()=>e.selectionStart,setCursorToEnd:()=>{e.selectionEnd=e.value.length,e.selectionStart=e.selectionEnd,p()},setCursorToStart:()=>{e.selectionStart=0,e.selectionEnd=e.selectionStart,p()},release:()=>{e.removeEventListener("input",m),q.stop()},wrapSelection:t=>{var n,l,i,r;let{selectionEnd:s=e.value.length,selectionStart:o=0}=e,a=e.value.slice(0,o),c=e.value.slice(o,s),u=e.value.slice(s,e.value.length);p();let g=t.slice(0,t.indexOf("{{text}}")),v=[...g].reverse().every((t,n)=>e.value.slice(o-n-1,1)===t);if(v){let n=t.slice(t.indexOf("{{text}}")+8),l=[...n].every((t,n)=>e.value.slice(s+n,1)===t);if(l){f(c),e.selectionStart=o-g.length,e.selectionEnd=s+n.length,null!==(i=(r=document).execCommand)&&void 0!==i&&i.call(r,"insertText",!1,c)||(e.value=a.slice(0,a.length-g.length)+c+u.slice(n.length)),e.selectionStart=o-g.length,e.selectionEnd=e.selectionStart+c.length,d(e,"input"),d(e,"change"),p();return}}null!==(n=(l=document).execCommand)&&void 0!==n&&n.call(l,"insertText",!1,t.replace("{{text}}",c))||(e.value=a+t.replace("{{text}}",c)+u),e.selectionStart=o+t.indexOf("{{text}}"),e.selectionEnd=e.selectionStart+c.length,d(e,"input"),d(e,"change"),p()},get text(){return e.value},get selection(){return{start:e.selectionStart,end:e.selectionEnd}},editing:k,setEditingMode:e=>{C(e)},recording:w,setRecordingMode:y,recordingVideo:_,setRecordingVideo:M,insertText:f,setText:b,clear:()=>{b("")},focus:p,replyWith:x,quoteMessage:S,dismissQuotedMessage:E,dismissAllQuotedMessages:T,quotedMessages:{get:()=>v,subscribe:e=>g.on("quotedMessagesUpdate",e)},formatters:O,isMicrophoneDenied:D,setIsMicrophoneDenied:I}}}
//# sourceMappingURL=/dynamic/app/ui-message/client/messageBox/6fa7a07598d8107209814a9a49bcf8d8aadb9ea7.map
