)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui-message/client/findParentMessage.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport { callWithErrorHandling } from '../../../client/lib/utils/callWithErrorHandling';\nimport { withDebouncing } from '../../../lib/utils/highOrderFunctions';\nimport { ChatMessage } from '../../models/client';\n\nexport const findParentMessage = (() => {\n\tconst waiting: string[] = [];\n\tlet resolve: (resolved: IMessage[] | PromiseLike<IMessage[]>) => void;\n\tlet pending = new Promise<IMessage[]>((r) => {\n\t\tresolve = r;\n\t});\n\n\tconst getMessages = withDebouncing({ wait: 500 })(async () => {\n\t\tconst _tmp = [...waiting];\n\t\twaiting.length = 0;\n\t\tresolve(callWithErrorHandling('getMessages', _tmp));\n\t\tpending = new Promise<IMessage[]>((r) => {\n\t\t\tresolve = r;\n\t\t});\n\t});\n\n\tconst get = async (tmid: IMessage['_id']) => {\n\t\tvoid getMessages();\n\t\tconst messages = await pending;\n\t\treturn messages.find(({ _id }) => _id === tmid);\n\t};\n\n\treturn async (tmid: IMessage['_id']) => {\n\t\tconst message = ChatMessage.findOne({ _id: tmid });\n\n\t\tif (message) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (waiting.indexOf(tmid) === -1) {\n\t\t\twaiting.push(tmid);\n\t\t}\n\t\treturn get(tmid);\n\t};\n})();\n",null],"names":["callWithErrorHandling","withDebouncing","ChatMessage","module","export","findParentMessage","link","resolve","waiting","pending","Promise","r","getMessages","wait","_tmp","length","get","tmid","messages","find","_ref","_id","message","findOne","indexOf","push"],"mappings":"2BAEsCA,EAAkDC,EAAAC,EAAxFC,EAAOC,MAAE,CAAA,CAAAC,kBAAuB,IAAAA,CAAM,GAAAF,EAAkDG,IAAA,CAAA,kDAAA,CAAAN,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAF,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAD,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAIjF,IAAMG,EAAoB,AAAC,CAAA,SAE7BE,EADJ,IAAMC,EAAoB,EAAE,CAExBC,EAAU,IAAIC,QAAqBC,IACtCJ,EAAUI,CACX,GAEMC,EAAcX,EAAe,CAAEY,KAAM,GAAG,GAAI,UACjD,IAAMC,EAAO,IAAIN,EAAQ,AACzBA,CAAAA,EAAQO,MAAM,CAAG,EACjBR,EAAQP,EAAsB,cAAec,IAC7CL,EAAU,IAAIC,QAAqBC,IAClCJ,EAAUI,CACX,EACD,GAEMK,EAAM,MAAOC,IACbL,IACL,IAAMM,EAAW,MAAMT,EACvB,OAAOS,EAASC,IAAI,CAACC,IAAA,GAAC,CAAEC,IAAAA,CAAAA,CAAK,CAAAD,EAAA,OAAKC,IAAQJ,CAAI,EAC/C,EAEA,OAAO,MAAOA,IACb,IAAMK,EAAUpB,EAAYqB,OAAO,CAAC,CAAEF,IAAKJ,CAAI,UAE/C,AAAIK,IAI0B,KAA1Bd,EAAQgB,OAAO,CAACP,IACnBT,EAAQiB,IAAI,CAACR,GAEPD,EAAIC,GACZ,CACD,CAAA"}