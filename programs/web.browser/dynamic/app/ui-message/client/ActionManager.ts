function module(e,t,i){let n,s,a,r,o,l,d,c,h;let u=["type","triggerId"];i.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){n=e}},0),i.link("@babel/runtime/helpers/objectSpread2",{default(e){s=e}},1),i.export({ActionManager:()=>v}),i.link("@rocket.chat/emitter",{Emitter(e){a=e}},0),i.link("@rocket.chat/random",{Random(e){r=e}},1),i.link("react",{lazy(e){o=e}},2),i.link("../../../client/lib/banners",{"*"(e){l=e}},3),i.link("../../../client/lib/imperativeModal",{imperativeModal(e){d=e}},4),i.link("../../utils/client/lib/SDKClient",{sdk(e){c=e}},5),i.link("./UiKitTriggerTimeoutError",{UiKitTriggerTimeoutError(e){h=e}},6);let I=o(()=>i.dynamicImport("../../../client/views/modal/uikit/UiKitModal"));class v{constructor(e){this.router=void 0,this.events=new a,this.triggersId=new Map,this.viewInstances=new Map,this.router=e}invalidateTriggerId(e){let t=this.triggersId.get(e);return this.triggersId.delete(e),t}on(e,t){return this.events.on(e,t)}off(e,t){return this.events.off(e,t)}notifyBusy(){this.events.emit("busy",{busy:!0})}notifyIdle(){this.events.emit("busy",{busy:!1})}generateTriggerId(e){let t=r.id();return this.triggersId.set(t,e),setTimeout(()=>this.invalidateTriggerId(t),v.TRIGGER_TIMEOUT),t}async emitInteraction(e,t){let i;this.notifyBusy();let n=this.generateTriggerId(e);await Promise.race([new Promise((t,s)=>{i=setTimeout(()=>s(new h("Timeout",{triggerId:n,appId:e})),v.TRIGGER_TIMEOUT)}),c.rest.post("/apps/ui.interaction/".concat(e),s(s({},t),{},{triggerId:n})).then(e=>this.handleServerInteraction(e))]).finally(()=>{i&&clearTimeout(i),this.notifyIdle()})}handleServerInteraction(e){var t,i;let{triggerId:s}=e;if(!this.triggersId.has(s))return;let a=this.invalidateTriggerId(s);if(a){switch(e.type){case"errors":{let{type:t,triggerId:i,viewId:n,appId:s,errors:a}=e;this.events.emit(e.viewId,{type:t,triggerId:i,viewId:n,appId:s,errors:a});break}case"modal.open":{let{view:t}=e;this.openModal(t);break}case"modal.update":case"contextual_bar.update":{let{type:t,triggerId:i,appId:n,view:s}=e;this.events.emit(s.id,{type:t,triggerId:i,viewId:s.id,appId:n,view:s});break}case"modal.close":break;case"banner.open":{let{type:t,triggerId:i}=e,s=n(e,u);this.openBanner(s);break}case"banner.update":{let{type:t,triggerId:i,appId:n,view:s}=e;this.events.emit(s.viewId,{type:t,triggerId:i,viewId:s.viewId,appId:n,view:s});break}case"banner.close":{let{viewId:i}=e;null===(t=this.viewInstances.get(i))||void 0===t||t.close();break}case"contextual_bar.open":{let{view:t}=e;this.openContextualBar(t);break}case"contextual_bar.close":{let{view:t}=e;null===(i=this.viewInstances.get(t.id))||void 0===i||i.close()}}return e.type}}getInteractionPayloadByViewId(e){var t;if(!e)throw Error("No viewId provided when checking for `user interaction payload`");return null===(t=this.viewInstances.get(e))||void 0===t?void 0:t.payload}openView(e,t){switch(e){case"modal":this.openModal(t);break;case"banner":this.openBanner(t);break;case"contextual_bar":this.openContextualBar(t)}}openModal(e){let t=d.open({component:I,props:{key:e.id,initialView:e}});this.viewInstances.set(e.id,{close:()=>{t.close(),this.viewInstances.delete(e.id)}})}openBanner(e){l.open(e),this.viewInstances.set(e.viewId,{close:()=>{l.closeById(e.viewId)}})}openContextualBar(e){this.viewInstances.set(e.id,{payload:{view:e},close:()=>{this.viewInstances.delete(e.id)}});let t=this.router.getRouteName(),i=this.router.getRouteParameters();t&&this.router.navigate({name:t,params:s(s({},i),{},{tab:"app",context:e.id})})}disposeView(e){var t;let i=this.viewInstances.get(e);null==i||null===(t=i.close)||void 0===t||t.call(i),this.viewInstances.delete(e)}}v.TRIGGER_TIMEOUT=5e3,v.TRIGGER_TIMEOUT_ERROR="TRIGGER_TIMEOUT_ERROR"}
//# sourceMappingURL=/dynamic/app/ui-message/client/cce24fd4049ec6421a906af5b37a3c87ef5e23df.map
