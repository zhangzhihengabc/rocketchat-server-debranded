)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui-message/client/popup/components/composerBoxPopupPreview/ComposerBoxPopupPreview.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Skeleton, Tile } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod } from '@rocket.chat/ui-contexts';\nimport React, { forwardRef, useEffect, useImperativeHandle } from 'react';\n\nimport { useChat } from '../../../../../../client/views/room/contexts/ChatContext';\nimport type { ComposerBoxPopupProps } from '../../ComposerBoxPopup';\n\ntype ComposerBoxPopupPreviewItem = { _id: string; type: 'image' | 'video' | 'audio' | 'text' | 'other'; value: string; sort?: number };\n\nconst ComposerBoxPopupPreview = forwardRef<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: ComposerBoxPopupPreviewItem) => void;\n\t  }\n\t| undefined,\n\tComposerBoxPopupProps<ComposerBoxPopupPreviewItem> & {\n\t\trid: string;\n\t\ttmid?: string;\n\t\tsuspended?: boolean;\n\t}\n>(function ComposerBoxPopupPreview({ focused, items, rid, tmid, select, suspended }, ref) {\n\tconst id = useUniqueId();\n\tconst chat = useChat();\n\tconst executeSlashCommandPreviewMethod = useMethod('executeSlashCommandPreview');\n\tuseImperativeHandle(\n\t\tref,\n\t\t() => ({\n\t\t\tgetFilter: () => {\n\t\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\t\tif (!value) {\n\t\t\t\t\tthrow new Error('No value');\n\t\t\t\t}\n\t\t\t\tconst matches = value.match(/(\\/[\\w\\d\\S]+ )([^]*)$/);\n\n\t\t\t\tif (!matches) {\n\t\t\t\t\tthrow new Error('No matches');\n\t\t\t\t}\n\n\t\t\t\tconst cmd = matches[1].replace('/', '').trim().toLowerCase();\n\n\t\t\t\tconst params = matches[2];\n\t\t\t\treturn { cmd, params, msg: { rid, tmid } };\n\t\t\t},\n\t\t\t...(!suspended && {\n\t\t\t\tselect: (item) => {\n\t\t\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tthrow new Error('No value');\n\t\t\t\t\t}\n\t\t\t\t\tconst matches = value.match(/(\\/[\\w\\d\\S]+ )([^]*)$/);\n\n\t\t\t\t\tif (!matches) {\n\t\t\t\t\t\tthrow new Error('No matches');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst cmd = matches[1].replace('/', '').trim().toLowerCase();\n\n\t\t\t\t\tconst params = matches[2];\n\t\t\t\t\t// TODO: Fix this solve the typing issue\n\t\t\t\t\tvoid executeSlashCommandPreviewMethod({ cmd, params, msg: { rid, tmid } }, { id: item._id, type: item.type, value: item.value });\n\t\t\t\t\tchat?.composer?.setText('');\n\t\t\t\t},\n\t\t\t}),\n\t\t}),\n\t\t[chat?.composer, executeSlashCommandPreviewMethod, rid, tmid, suspended],\n\t);\n\n\tconst itemsFlat = items\n\t\t.flatMap((item) => {\n\t\t\tif (item.isSuccess) {\n\t\t\t\treturn item.data;\n\t\t\t}\n\t\t\treturn [];\n\t\t})\n\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\tconst isLoading = items.some((item) => item.isLoading && item.fetchStatus !== 'idle');\n\n\tuseEffect(() => {\n\t\tif (focused) {\n\t\t\tconst element = document.getElementById(`popup-item-${focused._id}`);\n\t\t\tif (element) {\n\t\t\t\telement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n\t\t\t}\n\t\t}\n\t}, [focused]);\n\n\tif (suspended) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box className='message-popup-position' position='relative'>\n\t\t\t<Tile className='message-popup' display='flex' padding={8} role='menu' mbe={8} aria-labelledby={id}>\n\t\t\t\t<Box role='listbox' display='flex' overflow='auto' fontSize={0} width={0} flexGrow={1} aria-busy={isLoading}>\n\t\t\t\t\t{isLoading &&\n\t\t\t\t\t\tArray(5)\n\t\t\t\t\t\t\t.fill(5)\n\t\t\t\t\t\t\t.map((_, index) => <Skeleton variant='rect' h='100px' w='120px' m={2} key={index} />)}\n\n\t\t\t\t\t{!isLoading &&\n\t\t\t\t\t\titemsFlat.map((item) => (\n\t\t\t\t\t\t\t<Box\n\t\t\t\t\t\t\t\tonClick={() => select(item)}\n\t\t\t\t\t\t\t\trole='option'\n\t\t\t\t\t\t\t\tclassName={['popup-item', item === focused && 'selected'].filter(Boolean).join(' ')}\n\t\t\t\t\t\t\t\tid={`popup-item-${item._id}`}\n\t\t\t\t\t\t\t\tkey={item._id}\n\t\t\t\t\t\t\t\tbg={item === focused ? 'selected' : undefined}\n\t\t\t\t\t\t\t\tborderColor={item === focused ? 'highlight' : 'transparent'}\n\t\t\t\t\t\t\t\ttabIndex={item === focused ? 0 : -1}\n\t\t\t\t\t\t\t\taria-selected={item === focused}\n\t\t\t\t\t\t\t\tm={2}\n\t\t\t\t\t\t\t\tborderWidth='default'\n\t\t\t\t\t\t\t\tborderRadius='x4'\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{item.type === 'image' && <img src={item.value} alt={item._id} />}\n\t\t\t\t\t\t\t\t{item.type === 'audio' && (\n\t\t\t\t\t\t\t\t\t<audio controls>\n\t\t\t\t\t\t\t\t\t\t<source src={item.value} />\n\t\t\t\t\t\t\t\t\t\tYour browser does not support the audio element.\n\t\t\t\t\t\t\t\t\t</audio>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{item.type === 'video' && (\n\t\t\t\t\t\t\t\t\t<video controls className='inline-video'>\n\t\t\t\t\t\t\t\t\t\t<source src={item.value} />\n\t\t\t\t\t\t\t\t\t\tYour browser does not support the video element.\n\t\t\t\t\t\t\t\t\t</video>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{item.type === 'text' && <h4>{item.value}</h4>}\n\t\t\t\t\t\t\t\t{item.type === 'other' && <code>{item.value}</code>}\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t))}\n\t\t\t\t</Box>\n\t\t\t</Tile>\n\t\t</Box>\n\t);\n});\n\nexport default ComposerBoxPopupPreview;\n",null],"names":["_objectSpread","Box","Skeleton","Tile","useUniqueId","useMethod","React","forwardRef","useEffect","useImperativeHandle","useChat","module","link","default","v","ComposerBoxPopupPreview","_ref","ref","focused","items","rid","tmid","select","suspended","id","chat","executeSlashCommandPreviewMethod","getFilter","_chat$composer","_chat$composer2","value","composer","substring","selection","start","Error","matches","match","cmd","replace","trim","toLowerCase","params","msg","item","_chat$composer3","_chat$composer4","_chat$composer5","_id","type","setText","itemsFlat","flatMap","isSuccess","data","sort","a","b","isLoading","some","fetchStatus","element","document","getElementById","concat","scrollIntoView","behavior","block","createElement","className","position","display","padding","role","mbe","overflow","fontSize","width","flexGrow","Array","fill","map","_","index","variant","h","w","m","key","onClick","filter","Boolean","join","bg","undefined","borderColor","tabIndex","borderWidth","borderRadius","src","alt","controls","exportDefault"],"mappings":"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"}