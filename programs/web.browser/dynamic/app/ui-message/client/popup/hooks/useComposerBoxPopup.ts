function module(e,t,o){let i,r,l,n,s,u,d;o.export({useComposerBoxPopup:()=>c}),o.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){i=e}},0),o.link("react",{useEffect(e){r=e},useCallback(e){l=e},useState(e){n=e},useRef(e){s=e}},1),o.link("../../../../../client/views/room/contexts/ChatContext",{useChat(e){u=e}},2),o.link("./useComposerBoxPopupQueries",{useComposerBoxPopupQueries(e){d=e}},3);let a={TAB:9,ENTER:13,ESC:27,ARROW_UP:38,ARROW_DOWN:40},c=e=>{let{configurations:t}=e,[o,c]=n(void 0),[v,p]=n(void 0),[f,g]=n(""),h=s(),{queries:m,suspended:x}=d(f,o),R=u(),E=v?"popup-item-".concat(v._id):void 0;r(()=>{if(o){if(null!=o&&o.preview&&x){p(void 0);return}p(e=>{var t;let o=m.filter(e=>e.isSuccess).flatMap(e=>e.data).sort((e,t)=>("sort"in e&&e.sort||0)-("sort"in t&&t.sort||0));return null!==(t=o.find(t=>t._id===(null==e?void 0:e._id)))&&void 0!==t?t:o[0]})}},[m,o,x]);let w=i(e=>{var t,i,r,l,n,s,u,d,a;if(!o)throw Error("No popup is open");if(null!==(t=h.current)&&void 0!==t&&t.select)h.current.select(e);else{let t=null==R?void 0:null===(i=R.composer)||void 0===i?void 0:i.substring(0,null==R?void 0:null===(r=R.composer)||void 0===r?void 0:r.selection.start),c=null!==(l=o.matchSelectorRegex)&&void 0!==l?l:new RegExp(o.triggerAnywhere?"(?:^| |\n)(".concat(o.trigger,")([^\\s]*$)"):"(?:^)(".concat(o.trigger,")([^\\s]*$)")),v=null==t?void 0:t.match(c);if(!v||!t)return;null==R||null===(n=R.composer)||void 0===n||n.replaceText((null!==(s=null!==(u=o.prefix)&&void 0!==u?u:o.trigger)&&void 0!==s?s:"")+o.getValue(e)+(null!==(d=o.suffix)&&void 0!==d?d:""),{start:t.lastIndexOf(v[1]+v[2]),end:null==R?void 0:null===(a=R.composer)||void 0===a?void 0:a.selection.start})}c(void 0),p(void 0)}),y=i(()=>{var e,o,i,r,l,n;let s=null==R?void 0:null===(e=R.composer)||void 0===e?void 0:e.substring(0,null==R?void 0:null===(o=R.composer)||void 0===o?void 0:o.selection.start);if(!s){c(void 0),p(void 0);return}let u=t.find(e=>{let{trigger:t,matchSelectorRegex:o,triggerAnywhere:i,triggerLength:r}=e,l=null!=o?o:new RegExp(i?"(?:^| |\n)(".concat(t,")[^\\s]*$"):"(?:^)(".concat(t,")[^\\s]*$")),n=l.test(s);if(!r||!n)return n;let u=s.match(l);return u&&r<u[0].length});if(c(u),u||(p(void 0),g("")),u){let e=null!==(i=u.matchSelectorRegex)&&void 0!==i?i:new RegExp(u.triggerAnywhere?"(?:^| |\n)(".concat(u.trigger,")([^\\s]*$)"):"(?:^)(".concat(u.trigger,")([^\\s]*$)")),t=s.match(e);g(null!==(r=null===(l=h.current)||void 0===l?void 0:null===(n=l.getFilter)||void 0===n?void 0:n.call(l))&&void 0!==r?r:t?t[2]:"")}return u}),k=i(()=>{o||y()}),C=i(e=>{y()&&o&&!0===o.closeOnEsc&&e.which===a.ESC&&(c(void 0),p(void 0),e.preventDefault(),e.stopPropagation())}),A=i(e=>{if(o){if(e.which===a.ENTER||e.which===a.TAB){if(!v)return;return w(v),e.preventDefault(),e.stopPropagation(),!0}return e.which!==a.ARROW_UP||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?e.which!==a.ARROW_DOWN||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?void 0:(p(e=>{let t=m.filter(e=>e.isSuccess).flatMap(e=>e.data).sort((e,t)=>("sort"in e&&e.sort||0)-("sort"in t&&t.sort||0));if(!t)return;let o=t.findIndex(t=>t===e);return o<t.length-1?t[o+1]:t[0]}),e.preventDefault(),e.stopPropagation(),!0):(p(e=>{let t=m.filter(e=>e.isSuccess).flatMap(e=>e.data).sort((e,t)=>("sort"in e&&e.sort||0)-("sort"in t&&t.sort||0));if(!t)return;let o=t.findIndex(t=>t===e);return o>0?t[o-1]:t[t.length-1]}),e.preventDefault(),e.stopPropagation(),!0)}}),P=i(()=>{o&&(c(void 0),p(void 0),g(""))}),K=l(e=>{e&&(e.addEventListener("keyup",C),e.addEventListener("keydown",A),e.addEventListener("focus",k))},[C,A,k]);return o?{focused:v,items:m,ariaActiveDescendant:E,popup:o,select:w,filter:f,suspended:x,commandsRef:h,callbackRef:K,clearPopup:P}:{callbackRef:K,focused:void 0,items:void 0,ariaActiveDescendant:void 0,popup:void 0,select:void 0,suspended:!0,commandsRef:h,filter:void 0,clearPopup:P}}}
//# sourceMappingURL=/dynamic/app/ui-message/client/popup/hooks/6f39d984633904f57e5825f4218f3aaf519d525f.map
