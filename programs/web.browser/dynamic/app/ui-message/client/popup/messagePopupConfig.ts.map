)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui-message/client/popup/messagePopupConfig.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { Tracker } from 'meteor/tracker';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { asReactiveSource } from '../../../../client/lib/tracker';\nimport { Messages } from '../../../models/client';\n\nexport const usersFromRoomMessages = new Mongo.Collection<{\n\t_id: string;\n\tusername: string;\n\tname: string | undefined;\n\tts: Date;\n\tsuggestion?: boolean;\n}>(null);\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\t\tconst rid = asReactiveSource(\n\t\t\t(cb) => RoomManager.on('changed', cb),\n\t\t\t() => RoomManager.opened,\n\t\t);\n\t\tconst user = uid ? (Meteor.users.findOne(uid, { fields: { username: 1 } }) as IUser | undefined) : undefined;\n\t\tif (!rid || !user) {\n\t\t\treturn;\n\t\t}\n\n\t\tusersFromRoomMessages.remove({});\n\n\t\tconst uniqueMessageUsersControl: Record<string, boolean> = {};\n\n\t\tMessages.find(\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\t'u.username': { $ne: user.username },\n\t\t\t\t't': { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t'u.username': 1,\n\t\t\t\t\t'u.name': 1,\n\t\t\t\t\t'u._id': 1,\n\t\t\t\t\t'ts': 1,\n\t\t\t\t},\n\t\t\t\tsort: { ts: -1 },\n\t\t\t},\n\t\t)\n\t\t\t.fetch()\n\t\t\t.filter(({ u: { username } }) => {\n\t\t\t\tconst notMapped = !uniqueMessageUsersControl[username];\n\t\t\t\tuniqueMessageUsersControl[username] = true;\n\t\t\t\treturn notMapped;\n\t\t\t})\n\t\t\t.forEach(({ u: { username, name, _id }, ts }) =>\n\t\t\t\tusersFromRoomMessages.upsert(_id, {\n\t\t\t\t\t_id,\n\t\t\t\t\tusername,\n\t\t\t\t\tname,\n\t\t\t\t\tts,\n\t\t\t\t}),\n\t\t\t);\n\t});\n});\n",null],"names":["Meteor","Mongo","Tracker","RoomManager","asReactiveSource","Messages","module","export","usersFromRoomMessages","Collection","startup","autorun","uid","userId","rid","cb","on","opened","user","users","findOne","fields","username","undefined","remove","uniqueMessageUsersControl","find","$ne","$exists","sort","ts","fetch","filter","_ref","u","notMapped","forEach","_ref2","name","_id","upsert"],"mappings":"2BACuCA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAvCC,EAAOC,MAAE,CAAA,CAAMC,sBAAQ,IAAgBA,CAAA,GAAAF,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAN,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,eAAAA,CAAAL,MAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAJ,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,qCAAAA,CAAAH,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAF,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAD,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQhC,IAAMG,EAAwB,IAAIP,EAAMQ,UAAU,CAMtD,MAEHT,EAAOU,OAAO,CAAC,KACdR,EAAQS,OAAO,CAAC,KACf,IAAMC,EAAMZ,EAAOa,MAAM,GACnBC,EAAMV,EACVW,GAAOZ,EAAYa,EAAE,CAAC,UAAWD,GAClC,IAAMZ,EAAYc,MAAM,EAEnBC,EAAON,EAAOZ,EAAOmB,KAAK,CAACC,OAAO,CAACR,EAAK,CAAES,OAAQ,CAAEC,SAAU,CAAC,CAAE,GAA4BC,KAAAA,EACnG,GAAI,CAACT,GAAO,CAACI,EACZ,OAGDV,EAAsBgB,MAAM,CAAC,CAAA,GAE7B,IAAMC,EAAqD,CAAA,EAE3DpB,EAASqB,IAAI,CACZ,CACCZ,IAAAA,EACA,aAAc,CAAEa,IAAKT,EAAKI,QAAAA,AAAQ,EAClC,EAAK,CAAEM,QAAS,CAAA,CAAK,GAEtB,CACCP,OAAQ,CACP,aAAc,EACd,SAAU,EACV,QAAS,EACT,GAAM,GAEPQ,KAAM,CAAEC,GAAI,EAAE,IAGdC,KAAK,GACLC,MAAM,CAACC,IAAwB,GAAvB,CAAEC,EAAG,CAAEZ,SAAAA,CAAAA,CAAQ,CAAI,CAAAW,EACrBE,EAAY,CAACV,CAAyB,CAACH,EAAS,CAEtD,OADAG,CAAyB,CAACH,EAAS,CAAG,CAAA,EAC/Ba,CACR,GACCC,OAAO,CAACC,IAAA,GAAC,CAAEH,EAAG,CAAEZ,SAAAA,CAAQ,CAAEgB,KAAAA,CAAI,CAAEC,IAAAA,CAAAA,CAAK,CAAET,GAAAA,CAAAA,CAAI,CAAAO,EAAA,OAC3C7B,EAAsBgC,MAAM,CAACD,EAAK,CACjCA,IAAAA,EACAjB,SAAAA,EACAgB,KAAAA,EACAR,GAAAA,GACC,EAEL,EACD"}