function module(e,r,n){let t,o,l,s,u,i;n.export({usersFromRoomMessages:()=>a}),n.link("meteor/meteor",{Meteor(e){t=e}},0),n.link("meteor/mongo",{Mongo(e){o=e}},1),n.link("meteor/tracker",{Tracker(e){l=e}},2),n.link("../../../../client/lib/RoomManager",{RoomManager(e){s=e}},3),n.link("../../../../client/lib/tracker",{asReactiveSource(e){u=e}},4),n.link("../../../models/client",{Messages(e){i=e}},5);let a=new o.Collection(null);t.startup(()=>{l.autorun(()=>{let e=t.userId(),r=u(e=>s.on("changed",e),()=>s.opened),n=e?t.users.findOne(e,{fields:{username:1}}):void 0;if(!r||!n)return;a.remove({});let o={};i.find({rid:r,"u.username":{$ne:n.username},t:{$exists:!1}},{fields:{"u.username":1,"u.name":1,"u._id":1,ts:1},sort:{ts:-1}}).fetch().filter(e=>{let{u:{username:r}}=e,n=!o[r];return o[r]=!0,n}).forEach(e=>{let{u:{username:r,name:n,_id:t},ts:o}=e;return a.upsert(t,{_id:t,username:r,name:n,ts:o})})})})}
//# sourceMappingURL=/dynamic/app/ui-message/client/popup/4e45b7824831be0c1a82dbc47606a08cd59af60e.map
