)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/2fa/client/overrideMeteorCall.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { process2faReturn, process2faAsyncReturn } from '../../../client/lib/2fa/process2faReturn';\nimport { isTotpInvalidError } from '../../../client/lib/2fa/utils';\nimport { t } from '../../utils/lib/i18n';\n\nconst { call, callAsync } = Meteor;\n\ntype Callback = {\n\t(error: unknown): void;\n\t(error: unknown, result: unknown): void;\n};\n\nconst callWithTotp =\n\t(methodName: string, args: unknown[], callback: Callback) =>\n\t(twoFactorCode: string, twoFactorMethod: string): unknown =>\n\t\tcall(methodName, ...args, { twoFactorCode, twoFactorMethod }, (error: unknown, result: unknown): void => {\n\t\t\tif (isTotpInvalidError(error)) {\n\t\t\t\tcallback(new Error(twoFactorMethod === 'password' ? t('Invalid_password') : t('Invalid_two_factor_code')));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcallback(error, result);\n\t\t});\n\nconst callWithoutTotp = (methodName: string, args: unknown[], callback: Callback) => (): unknown =>\n\tcall(methodName, ...args, async (error: unknown, result: unknown): Promise<void> => {\n\t\tawait process2faReturn({\n\t\t\terror,\n\t\t\tresult,\n\t\t\tonCode: callWithTotp(methodName, args, callback),\n\t\t\toriginalCallback: callback,\n\t\t\temailOrUsername: undefined,\n\t\t});\n\t});\n\nMeteor.call = function (methodName: string, ...args: unknown[]): unknown {\n\tconst callback = args.length > 0 && typeof args[args.length - 1] === 'function' ? (args.pop() as Callback) : (): void => undefined;\n\n\treturn callWithoutTotp(methodName, args, callback)();\n};\n\nMeteor.callAsync = async function _callAsyncWithTotp(methodName: string, ...args: unknown[]): Promise<unknown> {\n\ttry {\n\t\treturn await callAsync(methodName, ...args);\n\t} catch (error: unknown) {\n\t\treturn process2faAsyncReturn({\n\t\t\terror,\n\t\t\tonCode: (twoFactorCode, twoFactorMethod) => Meteor.callAsync(methodName, ...args, { twoFactorCode, twoFactorMethod }),\n\t\t\temailOrUsername: undefined,\n\t\t});\n\t}\n};\n",null],"names":["Meteor","process2faReturn","process2faAsyncReturn","isTotpInvalidError","t","module","link","call","callAsync","callWithTotp","methodName","args","callback","twoFactorCode","twoFactorMethod","error","result","Error","callWithoutTotp","onCode","originalCallback","emailOrUsername","undefined","_len","arguments","length","Array","_key","pop","_callAsyncWithTotp","_len2","_key2"],"mappings":"2BAAAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAN,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,2CAAAA,CAAAJ,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAF,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,uBAAAA,CAAAD,EAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAMvC,GAAM,CAAEG,KAAAA,CAAI,CAAEC,UAAAA,CAAAA,CAAW,CAAGR,EAOtBS,EACL,CAACC,EAAoBC,EAAiBC,IACtC,CAACC,EAAuBC,IACvBP,EAAKG,KAAeC,EAAM,CAAEE,cAAAA,EAAeC,gBAAAA,CAAe,EAAI,CAACC,EAAgBC,KAC9E,GAAIb,EAAmBY,GAAQ,CAC9BH,EAAS,AAAIK,MAAMH,AAAoB,aAApBA,EAAiCV,EAAE,oBAAsBA,EAAE,6BAC9E,OAGDQ,EAASG,EAAOC,EACjB,GAEIE,EAAkB,CAACR,EAAoBC,EAAiBC,IAAuB,IACpFL,EAAKG,KAAeC,EAAM,MAAOI,EAAgBC,KAChD,MAAMf,EAAiB,CACtBc,MAAAA,EACAC,OAAAA,EACAG,OAAQV,EAAaC,EAAYC,EAAMC,GACvCQ,iBAAkBR,EAClBS,gBAAiBC,KAAAA,GAEnB,EAEDtB,CAAAA,EAAOO,IAAI,CAAG,SAAUG,CAAkB,EAAoB,IAAA,IAAAa,EAAAC,UAAAC,MAAA,CAAfd,EAAe,AAAAe,MAAAH,EAAA,EAAAA,EAAA,EAAA,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAfhB,CAAe,CAAAgB,EAAA,EAAA,CAAAH,SAAA,CAAAG,EAAA,CAC7D,IAAMf,EAAWD,EAAKc,MAAM,CAAG,GAAK,AAAiC,YAAjC,OAAOd,CAAI,CAACA,EAAKc,MAAM,CAAG,EAAE,CAAmBd,EAAKiB,GAAG,GAAkB,IAAYN,KAAAA,EAEzH,OAAOJ,EAAgBR,EAAYC,EAAMC,IAC1C,EAEAZ,EAAOQ,SAAS,CAAG,eAAeqB,EAAmBnB,CAAkB,EAAoB,IAAA,IAAAoB,EAAAN,UAAAC,MAAA,CAAfd,EAAe,AAAAe,MAAAI,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAfpB,CAAe,CAAAoB,EAAA,EAAA,CAAAP,SAAA,CAAAO,EAAA,CAC1F,GAAI,CACH,OAAO,MAAMvB,EAAUE,KAAeC,GACrC,MAAOI,EAAgB,CACxB,OAAOb,EAAsB,CAC5Ba,MAAAA,EACAI,OAAQ,CAACN,EAAeC,IAAoBd,EAAOQ,SAAS,CAACE,KAAeC,EAAM,CAAEE,cAAAA,EAAeC,gBAAAA,CAAe,GAClHO,gBAAiBC,KAAAA,IAGpB"}