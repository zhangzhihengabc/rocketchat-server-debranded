)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/mentions/lib/MentionsParser.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { escapeHTML } from '@rocket.chat/string-helpers';\n\nconst userTemplateDefault = ({ prefix, className, mention, title, label, type = 'username' }) =>\n\t`${prefix}<a class=\"${className}\" data-${type}=\"${mention}\"${title ? ` title=\"${title}\"` : ''}>${label}</a>`;\nconst roomTemplateDefault = ({ prefix, reference, mention }) =>\n\t`${prefix}<a class=\"mention-link mention-link--room\" data-channel=\"${reference}\">${`#${mention}`}</a>`;\nexport class MentionsParser {\n\tconstructor({ pattern, useRealName, me, roomTemplate = roomTemplateDefault, userTemplate = userTemplateDefault }) {\n\t\tthis.pattern = pattern;\n\t\tthis.useRealName = useRealName;\n\t\tthis.me = me;\n\t\tthis.userTemplate = userTemplate;\n\t\tthis.roomTemplate = roomTemplate;\n\t}\n\n\tset me(m) {\n\t\tthis._me = m;\n\t}\n\n\tget me() {\n\t\treturn typeof this._me === 'function' ? this._me() : this._me;\n\t}\n\n\tset pattern(p) {\n\t\tthis._pattern = p;\n\t}\n\n\tget pattern() {\n\t\treturn typeof this._pattern === 'function' ? this._pattern() : this._pattern;\n\t}\n\n\tset useRealName(s) {\n\t\tthis._useRealName = s;\n\t}\n\n\tget useRealName() {\n\t\treturn typeof this._useRealName === 'function' ? this._useRealName() : this._useRealName;\n\t}\n\n\tget userMentionRegex() {\n\t\treturn new RegExp(`(^|\\\\s|>)@(${this.pattern}(@(${this.pattern}))?(:([0-9a-zA-Z-_.]+))?)`, 'gm');\n\t}\n\n\tget channelMentionRegex() {\n\t\treturn new RegExp(`(^|\\\\s|>)#(${this.pattern}(@(${this.pattern}))?)`, 'gm');\n\t}\n\n\treplaceUsers = (msg, { mentions, temp }, me) =>\n\t\tmsg.replace(this.userMentionRegex, (match, prefix, mention) => {\n\t\t\tconst classNames = ['mention-link'];\n\n\t\t\tif (mention === 'all') {\n\t\t\t\tclassNames.push('mention-link--all');\n\t\t\t\tclassNames.push('mention-link--group');\n\t\t\t} else if (mention === 'here') {\n\t\t\t\tclassNames.push('mention-link--here');\n\t\t\t\tclassNames.push('mention-link--group');\n\t\t\t} else if (mention === me) {\n\t\t\t\tclassNames.push('mention-link--me');\n\t\t\t\tclassNames.push('mention-link--user');\n\t\t\t} else {\n\t\t\t\tclassNames.push('mention-link--user');\n\t\t\t}\n\n\t\t\tconst className = classNames.join(' ');\n\n\t\t\tif (mention === 'all' || mention === 'here') {\n\t\t\t\treturn this.userTemplate({ prefix, className, mention, label: mention, type: 'group' });\n\t\t\t}\n\n\t\t\tconst filterUser = ({ username, type }) => (!type || type === 'user') && username === mention;\n\t\t\tconst filterTeam = ({ name, type }) => type === 'team' && name === mention;\n\n\t\t\tconst [mentionObj] = (mentions || []).filter((m) => filterUser(m) || filterTeam(m));\n\n\t\t\tconst label = temp\n\t\t\t\t? mention && escapeHTML(mention)\n\t\t\t\t: mentionObj && escapeHTML(mentionObj.type === 'team' || this.useRealName ? mentionObj.name : mentionObj.username);\n\n\t\t\tif (!label) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\treturn this.userTemplate({\n\t\t\t\tprefix,\n\t\t\t\tclassName,\n\t\t\t\tmention,\n\t\t\t\tlabel,\n\t\t\t\ttype: mentionObj?.type === 'team' ? 'team' : 'username',\n\t\t\t\ttitle: this.useRealName ? mention : label,\n\t\t\t});\n\t\t});\n\n\treplaceChannels = (msg, { temp, channels }) =>\n\t\tmsg.replace(/&#39;/g, \"'\").replace(this.channelMentionRegex, (match, prefix, mention) => {\n\t\t\tif (\n\t\t\t\t!temp &&\n\t\t\t\t!(\n\t\t\t\t\tchannels &&\n\t\t\t\t\tchannels.find((c) => {\n\t\t\t\t\t\treturn c.dname ? c.dname === mention : c.name === mention;\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tconst channel =\n\t\t\t\tchannels &&\n\t\t\t\tchannels.find(({ name, dname }) => {\n\t\t\t\t\treturn dname ? dname === mention : name === mention;\n\t\t\t\t});\n\t\t\tconst reference = channel ? channel._id : mention;\n\t\t\treturn this.roomTemplate({ prefix, reference, channel, mention });\n\t\t});\n\n\tgetUserMentions(str) {\n\t\treturn (str.match(this.userMentionRegex) || []).map((match) => match.trim());\n\t}\n\n\tgetChannelMentions(str) {\n\t\treturn (str.match(this.channelMentionRegex) || []).map((match) => match.trim());\n\t}\n\n\tparse(message) {\n\t\tlet msg = (message && message.html) || '';\n\t\tif (!msg.trim()) {\n\t\t\treturn message;\n\t\t}\n\t\tmsg = this.replaceUsers(msg, message, this.me);\n\t\tmsg = this.replaceChannels(msg, message, this.me);\n\t\tmessage.html = msg;\n\t\treturn message;\n\t}\n}\n",null],"names":["escapeHTML","module","export","MentionsParser","link","v","userTemplateDefault","_ref","prefix","className","mention","title","label","type","concat","roomTemplateDefault","_ref2","reference","constructor","_ref3","pattern","useRealName","me","roomTemplate","userTemplate","replaceUsers","msg","_ref4","mentions","temp","replace","userMentionRegex","match","classNames","push","join","filterUser","_ref5","username","filterTeam","_ref6","name","mentionObj","filter","m","replaceChannels","_ref7","channels","channelMentionRegex","find","c","dname","channel","_ref8","_id","_me","p","_pattern","s","_useRealName","RegExp","getUserMentions","str","map","trim","getChannelMentions","parse","message","html"],"mappings":"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"}