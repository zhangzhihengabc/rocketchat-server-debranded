function module(e,t,n){let a;n.export({MentionsParser:()=>i}),n.link("@rocket.chat/string-helpers",{escapeHTML(e){a=e}},0);let r=e=>{let{prefix:t,className:n,mention:a,title:r,label:s,type:i="username"}=e;return"".concat(t,'<a class="').concat(n,'" data-').concat(i,'="').concat(a,'"').concat(r?' title="'.concat(r,'"'):"",">").concat(s,"</a>")},s=e=>{let{prefix:t,reference:n,mention:a}=e;return"".concat(t,'<a class="mention-link mention-link--room" data-channel="').concat(n,'">',"#".concat(a),"</a>")};class i{constructor(e){let{pattern:t,useRealName:n,me:i,roomTemplate:l=s,userTemplate:m=r}=e;this.replaceUsers=(e,t,n)=>{let{mentions:r,temp:s}=t;return e.replace(this.userMentionRegex,(e,t,i)=>{let l=["mention-link"];"all"===i?(l.push("mention-link--all"),l.push("mention-link--group")):"here"===i?(l.push("mention-link--here"),l.push("mention-link--group")):(i===n&&l.push("mention-link--me"),l.push("mention-link--user"));let m=l.join(" ");if("all"===i||"here"===i)return this.userTemplate({prefix:t,className:m,mention:i,label:i,type:"group"});let h=e=>{let{username:t,type:n}=e;return(!n||"user"===n)&&t===i},o=e=>{let{name:t,type:n}=e;return"team"===n&&t===i},[u]=(r||[]).filter(e=>h(e)||o(e)),c=s?i&&a(i):u&&a("team"===u.type||this.useRealName?u.name:u.username);return c?this.userTemplate({prefix:t,className:m,mention:i,label:c,type:(null==u?void 0:u.type)==="team"?"team":"username",title:this.useRealName?i:c}):e})},this.replaceChannels=(e,t)=>{let{temp:n,channels:a}=t;return e.replace(/&#39;/g,"'").replace(this.channelMentionRegex,(e,t,r)=>{if(!n&&!(a&&a.find(e=>e.dname?e.dname===r:e.name===r)))return e;let s=a&&a.find(e=>{let{name:t,dname:n}=e;return n?n===r:t===r}),i=s?s._id:r;return this.roomTemplate({prefix:t,reference:i,channel:s,mention:r})})},this.pattern=t,this.useRealName=n,this.me=i,this.userTemplate=m,this.roomTemplate=l}set me(e){this._me=e}get me(){return"function"==typeof this._me?this._me():this._me}set pattern(e){this._pattern=e}get pattern(){return"function"==typeof this._pattern?this._pattern():this._pattern}set useRealName(e){this._useRealName=e}get useRealName(){return"function"==typeof this._useRealName?this._useRealName():this._useRealName}get userMentionRegex(){return RegExp("(^|\\s|>)@(".concat(this.pattern,"(@(").concat(this.pattern,"))?(:([0-9a-zA-Z-_.]+))?)"),"gm")}get channelMentionRegex(){return RegExp("(^|\\s|>)#(".concat(this.pattern,"(@(").concat(this.pattern,"))?)"),"gm")}getUserMentions(e){return(e.match(this.userMentionRegex)||[]).map(e=>e.trim())}getChannelMentions(e){return(e.match(this.channelMentionRegex)||[]).map(e=>e.trim())}parse(e){let t=e&&e.html||"";return t.trim()&&(t=this.replaceUsers(t,e,this.me),t=this.replaceChannels(t,e,this.me),e.html=t),e}}}
//# sourceMappingURL=/dynamic/app/mentions/lib/5e5a7cc134e283f980e75748baa11e352f798ef5.map
