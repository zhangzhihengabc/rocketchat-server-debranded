)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/markdown/lib/markdown.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\n\nimport { filtered } from './parser/filtered/filtered';\nimport { code } from './parser/original/code';\nimport { original } from './parser/original/original';\n\nconst parsers = {\n\toriginal,\n\tfiltered,\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: escapeHTML(text),\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text,\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst options = {\n\t\t\trootUrl: Meteor.absoluteUrl(),\n\t\t};\n\n\t\treturn parsers.original(message, options);\n\t}\n\n\tmountTokensBackRecursively(message, tokenList, useHtml = true) {\n\t\tconst missingTokens = [];\n\n\t\tif (tokenList.length > 0) {\n\t\t\tfor (const { token, text, noHtml } of tokenList) {\n\t\t\t\tif (message.html.indexOf(token) >= 0) {\n\t\t\t\t\tmessage.html = message.html.replace(token, () => (useHtml ? text : noHtml)); // Uses lambda so doesn't need to escape $\n\t\t\t\t} else {\n\t\t\t\t\tmissingTokens.push({ token, text, noHtml });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If there are tokens that were missing from the string, but the last iteration replaced at least one token, then go again\n\t\t// this is done because one of the tokens may have been hidden by another one\n\t\tif (missingTokens.length > 0 && missingTokens.length < tokenList.length) {\n\t\t\tthis.mountTokensBackRecursively(message, missingTokens, useHtml);\n\t\t}\n\t}\n\n\tmountTokensBack(message, useHtml = true) {\n\t\tif (message.tokens) {\n\t\t\tthis.mountTokensBackRecursively(message, message.tokens, useHtml);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tcode(...args) {\n\t\treturn code(...args);\n\t}\n\n\tfilterMarkdownFromMessage(message) {\n\t\treturn parsers.filtered(message);\n\t}\n}\n\nexport const Markdown = new MarkdownClass();\n\nexport const filterMarkdown = (message) => Markdown.filterMarkdownFromMessage(message);\n\nexport const createMarkdownMessageRenderer = ({ ...options }) => {\n\tconst markedParser = parsers.marked;\n\treturn (message, useMarkedParser = false) => {\n\t\tif (!message?.html?.trim()) {\n\t\t\treturn message;\n\t\t}\n\n\t\treturn useMarkedParser ? markedParser(message, options) : parsers.original(message, options);\n\t};\n};\n\nexport const createMarkdownNotificationRenderer = () => (message) => parsers.filtered(message);\n",null],"names":["_objectDestructuringEmpty","_extends","escapeHTML","Meteor","filtered","code","original","module","link","default","v","export","Markdown","filterMarkdown","createMarkdownMessageRenderer","createMarkdownNotificationRenderer","parsers","MarkdownClass","parse","text","message","html","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","options","rootUrl","absoluteUrl","mountTokensBackRecursively","tokenList","useHtml","arguments","length","undefined","missingTokens","token","noHtml","indexOf","replace","push","tokens","filterMarkdownFromMessage","_ref","markedParser","marked","_message$html","useMarkedParser","trim"],"mappings":"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"}