)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/e2e/client/helper.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Random } from '@rocket.chat/random';\nimport ByteBuffer from 'bytebuffer';\n\n// eslint-disable-next-line no-proto\nconst StaticArrayBufferProto = new ArrayBuffer().__proto__;\n\nexport function toString(thing) {\n\tif (typeof thing === 'string') {\n\t\treturn thing;\n\t}\n\t// eslint-disable-next-line new-cap\n\treturn new ByteBuffer.wrap(thing).toString('binary');\n}\n\nexport function toArrayBuffer(thing) {\n\tif (thing === undefined) {\n\t\treturn undefined;\n\t}\n\tif (thing === Object(thing)) {\n\t\t// eslint-disable-next-line no-proto\n\t\tif (thing.__proto__ === StaticArrayBufferProto) {\n\t\t\treturn thing;\n\t\t}\n\t}\n\n\tif (typeof thing !== 'string') {\n\t\tthrow new Error(`Tried to convert a non-string of type ${typeof thing} to an array buffer`);\n\t}\n\t// eslint-disable-next-line new-cap\n\treturn new ByteBuffer.wrap(thing, 'binary').toArrayBuffer();\n}\n\nexport function joinVectorAndEcryptedData(vector, encryptedData) {\n\tconst cipherText = new Uint8Array(encryptedData);\n\tconst output = new Uint8Array(vector.length + cipherText.length);\n\toutput.set(vector, 0);\n\toutput.set(cipherText, vector.length);\n\treturn output;\n}\n\nexport function splitVectorAndEcryptedData(cipherText) {\n\tconst vector = cipherText.slice(0, 16);\n\tconst encryptedData = cipherText.slice(16);\n\n\treturn [vector, encryptedData];\n}\n\nexport async function encryptRSA(key, data) {\n\treturn crypto.subtle.encrypt({ name: 'RSA-OAEP' }, key, data);\n}\n\nexport async function encryptAES(vector, key, data) {\n\treturn crypto.subtle.encrypt({ name: 'AES-CBC', iv: vector }, key, data);\n}\n\nexport async function decryptRSA(key, data) {\n\treturn crypto.subtle.decrypt({ name: 'RSA-OAEP' }, key, data);\n}\n\nexport async function decryptAES(vector, key, data) {\n\treturn crypto.subtle.decrypt({ name: 'AES-CBC', iv: vector }, key, data);\n}\n\nexport async function generateAESKey() {\n\treturn crypto.subtle.generateKey({ name: 'AES-CBC', length: 128 }, true, ['encrypt', 'decrypt']);\n}\n\nexport async function generateRSAKey() {\n\treturn crypto.subtle.generateKey(\n\t\t{\n\t\t\tname: 'RSA-OAEP',\n\t\t\tmodulusLength: 2048,\n\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n\t\t\thash: { name: 'SHA-256' },\n\t\t},\n\t\ttrue,\n\t\t['encrypt', 'decrypt'],\n\t);\n}\n\nexport async function exportJWKKey(key) {\n\treturn crypto.subtle.exportKey('jwk', key);\n}\n\nexport async function importRSAKey(keyData, keyUsages = ['encrypt', 'decrypt']) {\n\treturn crypto.subtle.importKey(\n\t\t'jwk',\n\t\tkeyData,\n\t\t{\n\t\t\tname: 'RSA-OAEP',\n\t\t\tmodulusLength: 2048,\n\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n\t\t\thash: { name: 'SHA-256' },\n\t\t},\n\t\ttrue,\n\t\tkeyUsages,\n\t);\n}\n\nexport async function importAESKey(keyData, keyUsages = ['encrypt', 'decrypt']) {\n\treturn crypto.subtle.importKey('jwk', keyData, { name: 'AES-CBC' }, true, keyUsages);\n}\n\nexport async function importRawKey(keyData, keyUsages = ['deriveKey']) {\n\treturn crypto.subtle.importKey('raw', keyData, { name: 'PBKDF2' }, false, keyUsages);\n}\n\nexport async function deriveKey(salt, baseKey, keyUsages = ['encrypt', 'decrypt']) {\n\tconst iterations = 1000;\n\tconst hash = 'SHA-256';\n\n\treturn crypto.subtle.deriveKey({ name: 'PBKDF2', salt, iterations, hash }, baseKey, { name: 'AES-CBC', length: 256 }, true, keyUsages);\n}\n\nexport async function readFileAsArrayBuffer(file) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst reader = new FileReader();\n\t\treader.onload = function (evt) {\n\t\t\tresolve(evt.target.result);\n\t\t};\n\t\treader.onerror = function (evt) {\n\t\t\treject(evt);\n\t\t};\n\t\treader.readAsArrayBuffer(file);\n\t});\n}\n\nexport async function generateMnemonicPhrase(n, sep = ' ') {\n\tconst { default: wordList } = await import('./wordList');\n\tconst result = new Array(n);\n\tlet len = wordList.length;\n\tconst taken = new Array(len);\n\n\twhile (n--) {\n\t\tconst x = Math.floor(Random.fraction() * len);\n\t\tresult[n] = wordList[x in taken ? taken[x] : x];\n\t\ttaken[x] = --len in taken ? taken[len] : len;\n\t}\n\treturn result.join(sep);\n}\n",null],"names":["Random","ByteBuffer","module","export","toString","toArrayBuffer","joinVectorAndEcryptedData","splitVectorAndEcryptedData","encryptRSA","encryptAES","decryptRSA","decryptAES","generateAESKey","generateRSAKey","exportJWKKey","importRSAKey","importAESKey","importRawKey","deriveKey","readFileAsArrayBuffer","generateMnemonicPhrase","link","v","default","StaticArrayBufferProto","ArrayBuffer","__proto__","thing","wrap","undefined","Object","Error","concat","vector","encryptedData","cipherText","Uint8Array","output","length","set","slice","key","data","crypto","subtle","encrypt","name","iv","decrypt","generateKey","modulusLength","publicExponent","hash","exportKey","keyData","keyUsages","arguments","importKey","salt","baseKey","iterations","file","Promise","resolve","reject","reader","FileReader","onload","evt","target","result","onerror","readAsArrayBuffer","n","sep","wordList","dynamicImport","Array","len","taken","x","Math","floor","fraction","join"],"mappings":"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"}