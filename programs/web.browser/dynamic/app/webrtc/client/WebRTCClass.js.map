)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/webrtc/client/WebRTCClass.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport GenericModal from '../../../client/components/GenericModal';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\nimport { ChatSubscription } from '../../models/client';\nimport { Notifications } from '../../notifications/client';\nimport { settings } from '../../settings/client';\nimport { t } from '../../utils/lib/i18n';\nimport { WEB_RTC_EVENTS } from '../lib/constants';\nimport { ChromeScreenShare } from './screenShare';\n\nclass WebRTCTransportClass extends Emitter {\n\tconstructor(webrtcInstance) {\n\t\tsuper();\n\t\tthis.debug = false;\n\t\tthis.webrtcInstance = webrtcInstance;\n\t\tNotifications.onRoom(this.webrtcInstance.room, WEB_RTC_EVENTS.WEB_RTC, (type, data) => {\n\t\t\tthis.log('WebRTCTransportClass - onRoom', type, data);\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tlog(...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonUserStream(type, data) {\n\t\tif (data.room !== this.webrtcInstance.room) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('WebRTCTransportClass - onUser', type, data);\n\t\tthis.emit(type, data);\n\t}\n\n\tstartCall(data) {\n\t\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tNotifications.notifyUsersOfRoom(this.webrtcInstance.room, WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.CALL, {\n\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\troom: this.webrtcInstance.room,\n\t\t\tmedia: data.media,\n\t\t\tmonitor: data.monitor,\n\t\t});\n\t}\n\n\tjoinCall(data) {\n\t\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tif (data.monitor === true) {\n\t\t\tNotifications.notifyUser(data.to, WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.JOIN, {\n\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\tmedia: data.media,\n\t\t\t\tmonitor: data.monitor,\n\t\t\t});\n\t\t} else {\n\t\t\tNotifications.notifyUsersOfRoom(this.webrtcInstance.room, WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.JOIN, {\n\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\tmedia: data.media,\n\t\t\t\tmonitor: data.monitor,\n\t\t\t});\n\t\t}\n\t}\n\n\tsendCandidate(data) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendCandidate', data);\n\t\tNotifications.notifyUser(data.to, WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.CANDIDATE, data);\n\t}\n\n\tsendDescription(data) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendDescription', data);\n\t\tNotifications.notifyUser(data.to, WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.DESCRIPTION, data);\n\t}\n\n\tsendStatus(data) {\n\t\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tNotifications.notifyRoom(this.webrtcInstance.room, WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.STATUS, data);\n\t}\n\n\tonRemoteCall(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\n\t}\n\n\tonRemoteJoin(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\n\t}\n\n\tonRemoteCandidate(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n\t}\n\n\tonRemoteDescription(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n\t}\n\n\tonRemoteStatus(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\n\t}\n}\n\nclass WebRTCClass {\n\t/*\n  \t\t@param seldId {String}\n  \t\t@param room {String}\n   */\n\n\tconstructor(selfId, room, autoAccept = false) {\n\t\tthis.config = {\n\t\t\ticeServers: [],\n\t\t};\n\t\tthis.debug = false;\n\t\tthis.TransportClass = WebRTCTransportClass;\n\t\tthis.selfId = selfId;\n\t\tthis.room = room;\n\t\tlet servers = settings.get('WebRTC_Servers');\n\t\tif (servers && servers.trim() !== '') {\n\t\t\tservers = servers.replace(/\\s/g, '');\n\t\t\tservers = servers.split(',');\n\n\t\t\tservers.forEach((server) => {\n\t\t\t\tserver = server.split('@');\n\t\t\t\tconst serverConfig = {\n\t\t\t\t\turls: server.pop(),\n\t\t\t\t};\n\t\t\t\tif (server.length === 1) {\n\t\t\t\t\tserver = server[0].split(':');\n\t\t\t\t\tserverConfig.username = decodeURIComponent(server[0]);\n\t\t\t\t\tserverConfig.credential = decodeURIComponent(server[1]);\n\t\t\t\t}\n\t\t\t\tthis.config.iceServers.push(serverConfig);\n\t\t\t});\n\t\t}\n\t\tthis.peerConnections = {};\n\t\tthis.remoteItems = new ReactiveVar([]);\n\t\tthis.remoteItemsById = new ReactiveVar({});\n\t\tthis.callInProgress = new ReactiveVar(false);\n\t\tthis.audioEnabled = new ReactiveVar(false);\n\t\tthis.videoEnabled = new ReactiveVar(false);\n\t\tthis.overlayEnabled = new ReactiveVar(false);\n\t\tthis.screenShareEnabled = new ReactiveVar(false);\n\t\tthis.localUrl = new ReactiveVar();\n\t\tthis.active = false;\n\t\tthis.remoteMonitoring = false;\n\t\tthis.monitor = false;\n\t\tthis.autoAccept = autoAccept;\n\t\tthis.navigator = undefined;\n\t\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\n\n\t\tif (userAgent.indexOf('electron') !== -1) {\n\t\t\tthis.navigator = 'electron';\n\t\t} else if (userAgent.indexOf('chrome') !== -1) {\n\t\t\tthis.navigator = 'chrome';\n\t\t} else if (userAgent.indexOf('firefox') !== -1) {\n\t\t\tthis.navigator = 'firefox';\n\t\t} else if (userAgent.indexOf('safari') !== -1) {\n\t\t\tthis.navigator = 'safari';\n\t\t}\n\n\t\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator);\n\t\tthis.media = {\n\t\t\tvideo: true,\n\t\t\taudio: true,\n\t\t};\n\t\tthis.transport = new this.TransportClass(this);\n\t\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\n\t\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n\t\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n\t\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n\t\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n\n\t\tsetInterval(this.checkPeerConnections.bind(this), 1000);\n\t}\n\n\tonUserStream(...args) {\n\t\treturn this.transport.onUserStream(...args);\n\t}\n\n\tlog(...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log.apply(console, args);\n\t\t}\n\t}\n\n\tonError(...args) {\n\t\tconsole.error.apply(console, args);\n\t}\n\n\tcheckPeerConnections() {\n\t\tconst { peerConnections } = this;\n\t\tconst date = Date.now();\n\t\tObject.entries(peerConnections).some(([id, peerConnection]) => {\n\t\t\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tupdateRemoteItems() {\n\t\tconst items = [];\n\t\tconst itemsById = {};\n\t\tconst { peerConnections } = this;\n\n\t\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\n\t\t\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\n\t\t\t\tconst item = {\n\t\t\t\t\tid,\n\t\t\t\t\turl: remoteStream,\n\t\t\t\t\tstate: peerConnection.iceConnectionState,\n\t\t\t\t};\n\t\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\titem.stateText = 'Connecting...';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\titem.stateText = 'Connected';\n\t\t\t\t\t\titem.connected = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\titem.stateText = 'Disconnected';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\titem.stateText = 'Failed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\titem.stateText = 'Closed';\n\t\t\t\t}\n\t\t\t\titems.push(item);\n\t\t\t\titemsById[id] = item;\n\t\t\t});\n\t\t});\n\t\tthis.remoteItems.set(items);\n\t\tthis.remoteItemsById.set(itemsById);\n\t}\n\n\tresetCallInProgress = () => {\n\t\tthis.callInProgress.set(false);\n\t};\n\n\tbroadcastStatus() {\n\t\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [];\n\t\tconst { peerConnections } = this;\n\t\tObject.keys(peerConnections).entries(([id, { remoteMedia: media }]) => {\n\t\t\tremoteConnections.push({\n\t\t\t\tid,\n\t\t\t\tmedia,\n\t\t\t});\n\t\t});\n\n\t\tthis.transport.sendStatus({\n\t\t\tmedia: this.media,\n\t\t\tremoteConnections,\n\t\t});\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tfrom {String}\n  \t\t\tmedia {Object}\n  \t\t\tremoteConnections {Array[Object]}\n  \t\t\t\tid {String}\n  \t\t\t\tmedia {Object}\n   */\n\n\tonRemoteStatus(data) {\n\t\t// this.log(onRemoteStatus, arguments);\n\t\tthis.callInProgress.set(true);\n\t\tclearTimeout(this.callInProgressTimeout);\n\t\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [\n\t\t\t{\n\t\t\t\tid: data.from,\n\t\t\t\tmedia: data.media,\n\t\t\t},\n\t\t\t...data.remoteConnections,\n\t\t];\n\n\t\tremoteConnections.forEach((remoteConnection) => {\n\t\t\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\n\t\t\t\tthis.log('reconnecting with', remoteConnection.id);\n\t\t\t\tthis.onRemoteJoin({\n\t\t\t\t\tfrom: remoteConnection.id,\n\t\t\t\t\tmedia: remoteConnection.media,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n  \t\t@param id {String}\n   */\n\n\tgetPeerConnection(id) {\n\t\tif (this.peerConnections[id] != null) {\n\t\t\treturn this.peerConnections[id];\n\t\t}\n\t\tconst peerConnection = new RTCPeerConnection(this.config);\n\n\t\tpeerConnection.createdAt = Date.now();\n\t\tpeerConnection.remoteMedia = {};\n\t\tthis.peerConnections[id] = peerConnection;\n\t\tconst eventNames = [\n\t\t\t'icecandidate',\n\t\t\t'addstream',\n\t\t\t'removestream',\n\t\t\t'iceconnectionstatechange',\n\t\t\t'datachannel',\n\t\t\t'identityresult',\n\t\t\t'idpassertionerror',\n\t\t\t'idpvalidationerror',\n\t\t\t'negotiationneeded',\n\t\t\t'peeridentity',\n\t\t\t'signalingstatechange',\n\t\t];\n\n\t\teventNames.forEach((eventName) => {\n\t\t\tpeerConnection.addEventListener(eventName, (e) => {\n\t\t\t\tthis.log(id, e.type, e);\n\t\t\t});\n\t\t});\n\n\t\tpeerConnection.addEventListener('icecandidate', (e) => {\n\t\t\tif (e.candidate == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.transport.sendCandidate({\n\t\t\t\tto: id,\n\t\t\t\tcandidate: {\n\t\t\t\t\tcandidate: e.candidate.candidate,\n\t\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\tpeerConnection.addEventListener('addstream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('removestream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\n\t\t\tif (\n\t\t\t\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\n\t\t\t\tpeerConnection === this.peerConnections[id]\n\t\t\t) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (Object.keys(this.peerConnections).length === 0) {\n\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\treturn peerConnection;\n\t}\n\n\t_getUserMedia(media, onSuccess, onError) {\n\t\tconst onSuccessLocal = (stream) => {\n\t\t\tif (AudioContext && stream.getAudioTracks().length > 0) {\n\t\t\t\tconst audioContext = new AudioContext();\n\t\t\t\tconst source = audioContext.createMediaStreamSource(stream);\n\t\t\t\tconst volume = audioContext.createGain();\n\t\t\t\tsource.connect(volume);\n\t\t\t\tconst peer = audioContext.createMediaStreamDestination();\n\t\t\t\tvolume.connect(peer);\n\t\t\t\tvolume.gain.value = 0.6;\n\t\t\t\tstream.removeTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.addTrack(peer.stream.getAudioTracks()[0]);\n\t\t\t\tstream.volume = volume;\n\t\t\t\tthis.audioContext = audioContext;\n\t\t\t}\n\t\t\tonSuccess(stream);\n\t\t};\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n\t\t\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n\t\t}\n\n\t\tnavigator.getUserMedia(media, onSuccessLocal, onError);\n\t}\n\n\tgetUserMedia(media, onSuccess, onError = this.onError) {\n\t\tif (media.desktop !== true) {\n\t\t\tthis._getUserMedia(media, onSuccess, onError);\n\t\t\treturn;\n\t\t}\n\t\tif (this.screenShareAvailable !== true) {\n\t\t\tconsole.log('Screen share is not avaliable');\n\t\t\treturn;\n\t\t}\n\t\tconst getScreen = (audioStream) => {\n\t\t\tconst refresh = function () {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\n\t\t\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\n\n\t\t\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttitle: t('Screen_Share'),\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\tconfirmText: t('Install_Extension'),\n\t\t\t\t\t\tcancelText: t('Cancel'),\n\t\t\t\t\t\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tif (this.navigator === 'chrome') {\n\t\t\t\t\t\t\t\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tchrome.webstore.install(url, refresh, () => {\n\t\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (_error) {\n\t\t\t\t\t\t\t\t\tconsole.log(_error);\n\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (this.navigator === 'firefox') {\n\t\t\t\t\t\t\t\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn onError(false);\n\t\t\t}\n\n\t\t\tconst getScreenSuccess = (stream) => {\n\t\t\t\tif (audioStream != null) {\n\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t}\n\t\t\t\tonSuccess(stream);\n\t\t\t};\n\t\t\tif (this.navigator === 'firefox') {\n\t\t\t\tmedia = {\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmozMediaSource: 'window',\n\t\t\t\t\t\tmediaSource: 'window',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tthis._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t} else {\n\t\t\t\tChromeScreenShare.getSourceId(this.navigator, (id) => {\n\t\t\t\t\tmedia = {\n\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\tchromeMediaSourceId: id,\n\t\t\t\t\t\t\t\tmaxWidth: 1280,\n\t\t\t\t\t\t\t\tmaxHeight: 720,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tthis._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n\t\t\tgetScreen();\n\t\t} else {\n\t\t\tconst getAudioSuccess = (audioStream) => {\n\t\t\t\tgetScreen(audioStream);\n\t\t\t};\n\t\t\tconst getAudioError = () => {\n\t\t\t\tgetScreen();\n\t\t\t};\n\n\t\t\tthis._getUserMedia(\n\t\t\t\t{\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t},\n\t\t\t\tgetAudioSuccess,\n\t\t\t\tgetAudioError,\n\t\t\t);\n\t\t}\n\t}\n\n\t/*\n  \t\t@param callback {Function}\n   */\n\n\tgetLocalUserMedia(callback, ...args) {\n\t\tthis.log('getLocalUserMedia', [callback, ...args]);\n\t\tif (this.localStream != null) {\n\t\t\treturn callback(null, this.localStream);\n\t\t}\n\t\tconst onSuccess = (stream) => {\n\t\t\tthis.localStream = stream;\n\t\t\t!this.audioEnabled.get() && this.disableAudio();\n\t\t\t!this.videoEnabled.get() && this.disableVideo();\n\t\t\tthis.localUrl.set(stream);\n\t\t\tconst { peerConnections } = this;\n\t\t\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\n\t\t\tdocument.querySelector('video#localVideo').srcObject = stream;\n\t\t\tcallback(null, this.localStream);\n\t\t};\n\t\tconst onError = (error) => {\n\t\t\tcallback(false);\n\t\t\tthis.onError(error);\n\t\t};\n\t\tthis.getUserMedia(this.media, onSuccess, onError);\n\t}\n\n\t/*\n  \t\t@param id {String}\n   */\n\n\tstopPeerConnection = (id) => {\n\t\tconst peerConnection = this.peerConnections[id];\n\t\tif (peerConnection == null) {\n\t\t\treturn;\n\t\t}\n\t\tdelete this.peerConnections[id];\n\t\tpeerConnection.close();\n\t\tthis.updateRemoteItems();\n\t};\n\n\tstopAllPeerConnections() {\n\t\tconst { peerConnections } = this;\n\n\t\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\n\n\t\twindow.audioContext && window.audioContext.close();\n\t}\n\n\tsetAudioEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getAudioTracks().forEach((audio) => {\n\t\t\t\taudio.enabled = enabled;\n\t\t\t});\n\t\t\tthis.audioEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableAudio() {\n\t\tthis.setAudioEnabled(false);\n\t}\n\n\tenableAudio() {\n\t\tthis.setAudioEnabled(true);\n\t}\n\n\ttoggleAudio() {\n\t\tif (this.audioEnabled.get()) {\n\t\t\treturn this.disableAudio();\n\t\t}\n\t\treturn this.enableAudio();\n\t}\n\n\tsetVideoEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getVideoTracks().forEach((video) => {\n\t\t\t\tvideo.enabled = enabled;\n\t\t\t});\n\t\t\tthis.videoEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableScreenShare() {\n\t\tthis.setScreenShareEnabled(false);\n\t}\n\n\tenableScreenShare() {\n\t\tthis.setScreenShareEnabled(true);\n\t}\n\n\tsetScreenShareEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.media.desktop = enabled;\n\t\t\tdelete this.localStream;\n\t\t\tthis.getLocalUserMedia((err) => {\n\t\t\t\tif (err != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.screenShareEnabled.set(enabled);\n\t\t\t\tthis.stopAllPeerConnections();\n\t\t\t\tthis.joinCall();\n\t\t\t});\n\t\t}\n\t}\n\n\tdisableVideo() {\n\t\tthis.setVideoEnabled(false);\n\t}\n\n\tenableVideo() {\n\t\tthis.setVideoEnabled(true);\n\t}\n\n\ttoggleVideo() {\n\t\tif (this.videoEnabled.get()) {\n\t\t\treturn this.disableVideo();\n\t\t}\n\t\treturn this.enableVideo();\n\t}\n\n\tstop() {\n\t\tthis.active = false;\n\t\tthis.monitor = false;\n\t\tthis.remoteMonitoring = false;\n\t\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\n\t\t\tthis.localStream.getTracks().forEach((track) => track.stop());\n\t\t}\n\t\tthis.localUrl.set(undefined);\n\t\tdelete this.localStream;\n\t\tthis.stopAllPeerConnections();\n\t}\n\n\t/*\n  \t\t@param media {Object}\n  \t\t\taudio {Boolean}\n  \t\t\tvideo {Boolean}\n   */\n\n\tstartCall(media = {}, ...args) {\n\t\tthis.log('startCall', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.active = true;\n\t\t\tthis.transport.startCall({\n\t\t\t\tmedia: this.media,\n\t\t\t});\n\t\t});\n\t}\n\n\tstartCallAsMonitor(media = {}, ...args) {\n\t\tthis.log('startCallAsMonitor', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.active = true;\n\t\tthis.monitor = true;\n\t\tthis.transport.startCall({\n\t\t\tmedia: this.media,\n\t\t\tmonitor: true,\n\t\t});\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tfrom {String}\n  \t\t\tmonitor {Boolean}\n  \t\t\tmedia {Object}\n  \t\t\t\taudio {Boolean}\n  \t\t\t\tvideo {Boolean}\n   */\n\n\tonRemoteCall(data) {\n\t\tif (this.autoAccept === true) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.joinCall({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(data.from);\n\t\tlet fromUsername = undefined;\n\t\tif (user && user.username) {\n\t\t\tfromUsername = user.username;\n\t\t}\n\t\tconst subscription = ChatSubscription.findOne({\n\t\t\trid: data.room,\n\t\t});\n\n\t\tlet icon;\n\t\tlet title;\n\t\tif (data.monitor === true) {\n\t\t\ticon = 'eye';\n\t\t\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\n\t\t} else if (subscription && subscription.t === 'd') {\n\t\t\tif (data.media && data.media.video) {\n\t\t\t\ticon = 'videocam';\n\t\t\t\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\n\t\t\t} else {\n\t\t\t\ticon = 'phone';\n\t\t\t\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n\t\t\t}\n\t\t} else if (data.media && data.media.video) {\n\t\t\ticon = 'videocam';\n\t\t\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\n\t\t} else {\n\t\t\ticon = 'phone';\n\t\t\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle,\n\t\t\t\ticon,\n\t\t\t\tconfirmText: t('Yes'),\n\t\t\t\tcancelText: t('No'),\n\t\t\t\tchildren: t('Do_you_want_to_accept'),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tgoToRoomById(data.room);\n\t\t\t\t\treturn this.joinCall({\n\t\t\t\t\t\tto: data.from,\n\t\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\t\tmedia: data.media,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => this.stop(),\n\t\t\t\tonClose: () => this.stop(),\n\t\t\t},\n\t\t});\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tto {String}\n  \t\t\tmonitor {Boolean}\n  \t\t\tmedia {Object}\n  \t\t\t\taudio {Boolean}\n  \t\t\t\tvideo {Boolean}\n  \t\t\t\tdesktop {Boolean}\n   */\n\n\tjoinCall(data = {}, ...args) {\n\t\tdata.media = this.media;\n\t\tthis.log('joinCall', [data, ...args]);\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.remoteMonitoring = data.monitor;\n\t\t\tthis.active = true;\n\t\t\tthis.transport.joinCall(data);\n\t\t});\n\t}\n\n\tonRemoteJoin(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteJoin', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from);\n\n\t\t// needsRefresh = false\n\t\t// if peerConnection.iceConnectionState isnt 'new'\n\t\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n\t\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n\t\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n\n\t\t// # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n\n\t\tif (peerConnection.signalingState !== 'checking') {\n\t\t\tthis.stopPeerConnection(data.from);\n\t\t\tpeerConnection = this.getPeerConnection(data.from);\n\t\t}\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\t\tpeerConnection.remoteMedia = data.media;\n\t\tif (this.localStream) {\n\t\t\tpeerConnection.addStream(this.localStream);\n\t\t}\n\t\tconst onOffer = (offer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'offer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tmedia: this.media,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: offer.sdp,\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tpeerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tif (data.monitor === true) {\n\t\t\tpeerConnection.createOffer(onOffer, this.onError, {\n\t\t\t\tmandatory: {\n\t\t\t\t\tOfferToReceiveAudio: data.media.audio,\n\t\t\t\t\tOfferToReceiveVideo: data.media.video,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tpeerConnection.createOffer(onOffer, this.onError);\n\t\t}\n\t}\n\n\tonRemoteOffer(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('onRemoteOffer', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from);\n\n\t\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n\t\t\tthis.stopPeerConnection(data.from);\n\t\t\tpeerConnection = this.getPeerConnection(data.from);\n\t\t}\n\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\n\t\tpeerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\n\t\ttry {\n\t\t\tif (this.localStream) {\n\t\t\t\tpeerConnection.addStream(this.localStream);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tconst onAnswer = (answer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: answer.sdp,\n\t\t\t\t\t\ttype: answer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tpeerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tpeerConnection.createAnswer(onAnswer, this.onError);\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tto {String}\n  \t\t\tfrom {String}\n  \t\t\tcandidate {RTCIceCandidate JSON encoded}\n   */\n\n\tonRemoteCandidate(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteCandidate', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from);\n\t\tif (\n\t\t\tpeerConnection.iceConnectionState !== 'closed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'failed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'disconnected' &&\n\t\t\tpeerConnection.iceConnectionState !== 'completed'\n\t\t) {\n\t\t\tpeerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n\t\t}\n\t\tdocument.querySelector('video#remoteVideo').srcObject = this.remoteItems.get()[0]?.url;\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tto {String}\n  \t\t\tfrom {String}\n  \t\t\ttype {String} [offer, answer]\n  \t\t\tdescription {RTCSessionDescription JSON encoded}\n  \t\t\tts {Integer}\n  \t\t\tmedia {Object}\n  \t\t\t\taudio {Boolean}\n  \t\t\t\tvideo {Boolean}\n  \t\t\t\tdesktop {Boolean}\n   */\n\n\tonRemoteDescription(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteDescription', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from);\n\t\tif (data.type === 'offer') {\n\t\t\tpeerConnection.remoteMedia = data.media;\n\t\t\tthis.onRemoteOffer({\n\t\t\t\tfrom: data.from,\n\t\t\t\tts: data.ts,\n\t\t\t\tdescription: data.description,\n\t\t\t});\n\t\t} else {\n\t\t\tpeerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\t\t}\n\t}\n}\n\nconst WebRTC = new (class {\n\tconstructor() {\n\t\tthis.instancesByRoomId = {};\n\t}\n\n\tgetInstanceByRoomId(rid, visitorId = null) {\n\t\tlet enabled = false;\n\t\tif (!visitorId) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid });\n\t\t\tif (!subscription) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (subscription.t) {\n\t\t\t\tcase 'd':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Direct');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'p':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Private');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'c':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Channel');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'l':\n\t\t\t\t\tenabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n\t\t\t}\n\t\t} else {\n\t\t\tenabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n\t\t}\n\t\tenabled = enabled && settings.get('WebRTC_Enabled');\n\t\tif (enabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.instancesByRoomId[rid] == null) {\n\t\t\tlet uid = Meteor.userId();\n\t\t\tlet autoAccept = false;\n\t\t\tif (visitorId) {\n\t\t\t\tuid = visitorId;\n\t\t\t\tautoAccept = true;\n\t\t\t}\n\t\t\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n\t\t}\n\t\treturn this.instancesByRoomId[rid];\n\t}\n})();\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (Meteor.userId()) {\n\t\t\tNotifications.onUser(WEB_RTC_EVENTS.WEB_RTC, (type, data) => {\n\t\t\t\tif (data.room == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\n\t\t\t\twebrtc.onUserStream(type, data);\n\t\t\t});\n\t\t}\n\t});\n});\n\nexport { WebRTC };\n",null],"names":["Emitter","Meteor","ReactiveVar","Tracker","GenericModal","imperativeModal","goToRoomById","ChatSubscription","Notifications","settings","t","WEB_RTC_EVENTS","ChromeScreenShare","module","export","WebRTC","link","v","default","WebRTCTransportClass","constructor","webrtcInstance","debug","onRoom","room","WEB_RTC","type","data","log","emit","console","arguments","onUserStream","startCall","selfId","notifyUsersOfRoom","CALL","from","media","monitor","joinCall","notifyUser","to","JOIN","sendCandidate","CANDIDATE","sendDescription","DESCRIPTION","sendStatus","notifyRoom","STATUS","onRemoteCall","fn","on","onRemoteJoin","onRemoteCandidate","onRemoteDescription","onRemoteStatus","WebRTCClass","autoAccept","length","undefined","resetCallInProgress","callInProgress","set","stopPeerConnection","id","peerConnection","peerConnections","close","updateRemoteItems","config","iceServers","TransportClass","servers","get","trim","replace","split","forEach","server","serverConfig","urls","pop","username","decodeURIComponent","credential","push","remoteItems","remoteItemsById","audioEnabled","videoEnabled","overlayEnabled","screenShareEnabled","localUrl","active","remoteMonitoring","navigator","userAgent","toLocaleLowerCase","indexOf","screenShareAvailable","includes","video","audio","transport","bind","setInterval","checkPeerConnections","_len","args","Array","_key","apply","onError","_len2","_key2","error","date","Date","now","Object","entries","some","_ref","iceConnectionState","createdAt","items","itemsById","_ref2","getRemoteStreams","remoteStream","item","url","state","stateText","connected","broadcastStatus","remoteConnections","keys","_ref3","remoteMedia","clearTimeout","callInProgressTimeout","setTimeout","remoteConnection","getPeerConnection","RTCPeerConnection","eventNames","eventName","addEventListener","e","candidate","sdpMLineIndex","sdpMid","stop","_getUserMedia","onSuccess","onSuccessLocal","stream","AudioContext","getAudioTracks","audioContext","source","createMediaStreamSource","volume","createGain","connect","peer","createMediaStreamDestination","gain","value","removeTrack","addTrack","mediaDevices","getUserMedia","then","catch","desktop","getScreen","audioStream","refresh","open","component","props","variant","title","isChromeExtensionInstalled","installed","isFirefoxExtensionInstalled","window","rocketchatscreenshare","confirmText","cancelText","children","onConfirm","chrome","webstore","install","_error","getScreenSuccess","mozMediaSource","mediaSource","getSourceId","mandatory","chromeMediaSource","chromeMediaSourceId","maxWidth","maxHeight","getLocalUserMedia","callback","_len3","_key3","localStream","disableAudio","disableVideo","_ref4","addStream","document","querySelector","srcObject","stopAllPeerConnections","setAudioEnabled","enabled","enableAudio","toggleAudio","setVideoEnabled","getVideoTracks","disableScreenShare","setScreenShareEnabled","enableScreenShare","err","enableVideo","toggleVideo","getTracks","track","_len4","_key4","startCallAsMonitor","_len5","_key5","icon","fromUsername","user","users","findOne","subscription","rid","name","onCancel","onClose","_len6","_key6","_len7","_key7","signalingState","onOffer","offer","setLocalDescription","RTCSessionDescription","ts","description","sdp","createOffer","OfferToReceiveAudio","OfferToReceiveVideo","onRemoteOffer","_len8","_key8","setRemoteDescription","createAnswer","answer","_this$remoteItems$get","_len9","_key9","addIceCandidate","RTCIceCandidate","_len10","_key10","instancesByRoomId","getInstanceByRoomId","visitorId","uid","userId","startup","autorun","onUser","webrtc"],"mappings":"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"}