)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui/client/views/app/photoswipeContent.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\nimport type PhotoSwipe from 'photoswipe';\nimport PhotoSwipeUIDefault from 'photoswipe/dist/photoswipe-ui-default';\n\nimport { createAnchor } from '../../../../../client/lib/utils/createAnchor';\n\nconst parseLength = (x: unknown): number | undefined => {\n\tconst length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n\treturn Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = (src: string): Promise<[w: number, h: number]> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve([img.naturalWidth, img.naturalHeight]);\n\t\t});\n\n\t\timg.addEventListener('error', (error) => {\n\t\t\treject(error.error);\n\t\t});\n\n\t\timg.src = src;\n\t});\n\ntype Slide = PhotoSwipe.Item & { description?: string; title?: string };\n\nconst fromElementToSlide = async (element: Element): Promise<Slide | null> => {\n\tif (!(element instanceof HTMLElement)) {\n\t\treturn null;\n\t}\n\n\tconst title = element.dataset.title || element.title;\n\tconst { description } = element.dataset;\n\n\tif (element instanceof HTMLAnchorElement) {\n\t\tconst src = element.dataset.src || element.href;\n\t\tlet w = parseLength(element.dataset.width);\n\t\tlet h = parseLength(element.dataset.height);\n\n\t\tif (w === undefined || h === undefined) {\n\t\t\t[w, h] = await getImageSize(src);\n\t\t}\n\n\t\treturn { src, w, h, title, description };\n\t}\n\n\tif (element instanceof HTMLImageElement) {\n\t\tlet msrc: string | undefined;\n\t\tlet { src } = element;\n\t\tlet w: number | undefined = element.naturalWidth;\n\t\tlet h: number | undefined = element.naturalHeight;\n\n\t\tif (element.dataset.src) {\n\t\t\tmsrc = element.src;\n\t\t\tsrc = element.dataset.src;\n\t\t\tw = parseLength(element.dataset.width);\n\t\t\th = parseLength(element.dataset.height);\n\n\t\t\tif (w === undefined || h === undefined) {\n\t\t\t\t[w, h] = await getImageSize(src);\n\t\t\t}\n\t\t}\n\n\t\treturn { msrc, src, w, h, title, description };\n\t}\n\n\treturn null;\n};\n\nlet currentGallery: PhotoSwipe<PhotoSwipe.Options> | null = null;\n\nconst initGallery = async (items: Slide[], options: PhotoSwipe.Options): Promise<void> => {\n\tconst anchor = createAnchor('photoswipe-root');\n\n\tanchor.innerHTML = `<div class=\"pswp\" id=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n\t<div class=\"pswp__bg\"></div>\n\t<div class=\"pswp__scroll-wrap\">\n\t\t<div class=\"pswp__container\">\n\t\t\t<div class=\"pswp__item\"></div>\n\t\t\t<div class=\"pswp__item\"></div>\n\t\t\t<div class=\"pswp__item\"></div>\n\t\t</div>\n\n\t\t<div class=\"pswp__ui pswp__ui--hidden\">\n\t\t\t<div class=\"pswp__top-bar\">\n\n\t\t\t\t<button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"></button>\n\t\t\t\t<button class=\"pswp__button pswp__button--fs\" title=\"Toggle fullscreen\"></button>\n\t\t\t\t<button class=\"pswp__button pswp__button--zoom\" title=\"Zoom in/out\"></button>\n\n\t\t\t\t<div class=\"pswp__preloader\">\n\t\t\t\t\t<div class=\"pswp__preloader__icn\">\n\t\t\t\t\t<div class=\"pswp__preloader__cut\">\n\t\t\t\t\t\t<div class=\"pswp__preloader__donut\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<button class=\"pswp__button pswp__button--arrow--left\" title=\"Previous (arrow left)\"></button>\n\n\t\t\t<button class=\"pswp__button pswp__button--arrow--right\" title=\"Next (arrow right)\"></button>\n\n\t\t\t<div class=\"pswp__caption\">\n\t\t\t\t<div class=\"pswp__caption__center\"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>`;\n\tconst [{ default: PhotoSwipe }] = await Promise.all([import('photoswipe'), import('photoswipe/dist/photoswipe.css')]);\n\n\tif (!currentGallery) {\n\t\tconst container = document.getElementById('pswp');\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Photoswipe container element not found');\n\t\t}\n\n\t\tcurrentGallery = new PhotoSwipe(container, PhotoSwipeUIDefault, items, options);\n\n\t\tcurrentGallery.listen('destroy', () => {\n\t\t\tanchor.innerHTML = '';\n\t\t\tcurrentGallery = null;\n\t\t});\n\n\t\tcurrentGallery.init();\n\t}\n};\n\nconst defaultGalleryOptions = {\n\tbgOpacity: 0.7,\n\tcounterEl: false,\n\tindex: 0,\n\twheelToZoom: true,\n\tpadding: { top: 20, bottom: 40, left: 100, right: 100 },\n\taddCaptionHTMLFn(item: Slide, captionEl: HTMLElement): boolean {\n\t\tcaptionEl.children[0].innerHTML = `\n\t\t\t${escapeHTML(item.title ?? '')}<br/>\n\t\t\t<small>${escapeHTML(item.description ?? '')}</small>\n\t\t`;\n\t\treturn true;\n\t},\n};\n\nconst createEventListenerFor =\n\t(className: string) =>\n\t(event: Event): void => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst { currentTarget } = event;\n\n\t\tconst galleryItems = Array.from(document.querySelectorAll(className));\n\n\t\tconst sortedElements = galleryItems.sort((a, b) => {\n\t\t\tif (a === currentTarget) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (b === currentTarget) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t});\n\n\t\tconst slidePromises = sortedElements.map((element) => fromElementToSlide(element));\n\n\t\tlet hasOpenedGallery = false;\n\n\t\tvoid slidePromises.reduce(\n\t\t\t(p, curr) =>\n\t\t\t\tp\n\t\t\t\t\t.then(() => curr)\n\t\t\t\t\t.then(async (slide) => {\n\t\t\t\t\t\tif (!slide) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!currentGallery) {\n\t\t\t\t\t\t\t// If the gallery doesn't exist and has been opened this run the user closed it before all promises ran.\n\t\t\t\t\t\t\t// This means it shouldn't be opened again.\n\t\t\t\t\t\t\tif (hasOpenedGallery) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thasOpenedGallery = true;\n\t\t\t\t\t\t\treturn initGallery([slide], defaultGalleryOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentGallery.items.push(slide);\n\t\t\t\t\t\tcurrentGallery.invalidateCurrItems();\n\t\t\t\t\t\tcurrentGallery.updateSize(true);\n\t\t\t\t\t}),\n\t\t\tPromise.resolve(),\n\t\t);\n\t};\n\nMeteor.startup(() => {\n\t$(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});\n",null],"names":["escapeHTML","Meteor","PhotoSwipeUIDefault","createAnchor","module","link","default","parseLength","x","length","parseInt","undefined","Number","isFinite","getImageSize","src","Promise","resolve","reject","img","Image","addEventListener","naturalWidth","naturalHeight","error","fromElementToSlide","element","HTMLElement","title","dataset","description","HTMLAnchorElement","href","w","width","h","height","HTMLImageElement","msrc","currentGallery","initGallery","items","options","anchor","innerHTML","PhotoSwipe","all","dynamicImport","container","document","getElementById","Error","listen","init","defaultGalleryOptions","bgOpacity","counterEl","index","wheelToZoom","padding","top","bottom","left","right","addCaptionHTMLFn","item","captionEl","_item$title","_item$description","children","concat","createEventListenerFor","className","event","preventDefault","stopPropagation","currentTarget","galleryItems","Array","from","querySelectorAll","sortedElements","sort","a","b","slidePromises","map","hasOpenedGallery","reduce","p","curr","then","slide","push","invalidateCurrItems","updateSize","startup","$","on"],"mappings":"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"}