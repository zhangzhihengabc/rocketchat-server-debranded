function module(t,i,s){let e,a,n,r,o,d,c,l,h,g,u,p,m,M,v;s.export({ChatMessages:()=>w}),s.link("@rocket.chat/core-typings",{isVideoConfMessage(t){e=t}},0),s.link("../../../../client/lib/chats/data",{createDataAPI(t){a=t}},1),s.link("../../../../client/lib/chats/flows/processMessageEditing",{processMessageEditing(t){n=t}},2),s.link("../../../../client/lib/chats/flows/processSetReaction",{processSetReaction(t){r=t}},3),s.link("../../../../client/lib/chats/flows/processSlashCommand",{processSlashCommand(t){o=t}},4),s.link("../../../../client/lib/chats/flows/processTooLongMessage",{processTooLongMessage(t){d=t}},5),s.link("../../../../client/lib/chats/flows/replyBroadcast",{replyBroadcast(t){c=t}},6),s.link("../../../../client/lib/chats/flows/requestMessageDeletion",{requestMessageDeletion(t){l=t}},7),s.link("../../../../client/lib/chats/flows/sendMessage",{sendMessage(t){h=t}},8),s.link("../../../../client/lib/chats/flows/uploadFiles",{uploadFiles(t){g=t}},9),s.link("../../../../client/lib/chats/readStateManager",{ReadStateManager(t){u=t}},10),s.link("../../../../client/lib/chats/uploads",{createUploadsAPI(t){p=t}},11),s.link("../../../../client/views/room/MessageList/providers/messageHighlightSubscription",{setHighlightMessage(t){m=t},clearHighlightMessage(t){M=t}},12),s.link("./UserAction",{UserAction(t){v=t}},13);class w{constructor(t){var i=this;this.params=void 0,this.uid=void 0,this.composer=void 0,this.setComposerAPI=t=>{var i;null===(i=this.composer)||void 0===i||i.release(),this.composer=t},this.data=void 0,this.readStateManager=void 0,this.uploads=void 0,this.ActionManager=void 0,this.userCard=void 0,this.emojiPicker=void 0,this.action=void 0,this.currentEditingMID=void 0,this.messageEditing={toPreviousMessage:async()=>{if(!this.composer)return;if(!this.currentEditing){let t=await this.data.findLastOwnMessage();t&&e(t)&&(t=await this.data.findPreviousOwnMessage(t)),t&&(await this.data.saveDraft(void 0,this.composer.text),await this.messageEditing.editMessage(t));return}let t=await this.data.findMessageByID(this.currentEditing.mid),i=t?await this.data.findPreviousOwnMessage(t):void 0;if(i&&e(i)&&(i=await this.data.findPreviousOwnMessage(i)),i){await this.messageEditing.editMessage(i);return}await this.currentEditing.cancel()},toNextMessage:async()=>{if(!this.composer||!this.currentEditing)return;let t=await this.data.findMessageByID(this.currentEditing.mid),i=t?await this.data.findNextOwnMessage(t):void 0;if(i&&e(i)&&(i=await this.data.findNextOwnMessage(i)),i){await this.messageEditing.editMessage(i,{cursorAtStart:!0});return}await this.currentEditing.cancel()},editMessage:async function(t){var s,e,a;let{cursorAtStart:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await i.data.getDraft(t._id)||(null===(s=t.attachments)||void 0===s?void 0:null===(e=s[0])||void 0===e?void 0:e.description)||t.msg;await (null===(a=i.currentEditing)||void 0===a?void 0:a.stop()),i.composer&&await i.data.canUpdateMessage(t)&&(i.currentEditingMID=t._id,m(t._id),i.composer.setEditingMode(!0),i.composer.setText(r),n&&i.composer.setCursorToStart(),n||i.composer.setCursorToEnd(),i.composer.focus())}},this.flows=void 0,this.params=t;let{rid:s,tmid:M}=t;this.uid=t.uid,this.data=a({rid:s,tmid:M}),this.uploads=p({rid:s,tmid:M}),this.ActionManager=t.actionManager;let w=()=>{throw Error("Flow is not implemented")};this.readStateManager=new u(s),this.userCard={open:w,close:w},this.emojiPicker={open:w,close:w},this.action={start:async i=>{v.start(t.rid,"user-".concat(i),{tmid:t.tmid})},performContinuously:async i=>{v.performContinuously(t.rid,"user-".concat(i),{tmid:t.tmid})},stop:async i=>{v.stop(t.rid,"user-".concat(i),{tmid:t.tmid})}},this.flows={uploadFiles:g.bind(null,this),sendMessage:h.bind(this,this),processSlashCommand:o.bind(null,this),processTooLongMessage:d.bind(null,this),processMessageEditing:n.bind(null,this),processSetReaction:r.bind(null,this),requestMessageDeletion:l.bind(this,this),replyBroadcast:c.bind(null,this)}}get currentEditing(){if(this.composer&&this.currentEditingMID)return{mid:this.currentEditingMID,reset:async()=>{if(!this.composer||!this.currentEditingMID)return!1;let t=await this.data.findMessageByID(this.currentEditingMID);if(this.composer.text!==(null==t?void 0:t.msg)){var i;return this.composer.setText(null!==(i=null==t?void 0:t.msg)&&void 0!==i?i:""),!0}return!1},stop:async()=>{if(!this.composer||!this.currentEditingMID)return;let t=await this.data.findMessageByID(this.currentEditingMID),i=this.composer.text;i===(null==t?void 0:t.msg)?await this.data.discardDraft(this.currentEditingMID):await this.data.saveDraft(this.currentEditingMID,await this.data.getDraft(this.currentEditingMID)||i),this.composer.setEditingMode(!1),this.currentEditingMID=void 0,M()},cancel:async()=>{var t,i,s;this.currentEditingMID&&(await this.data.discardDraft(this.currentEditingMID),await (null===(t=this.currentEditing)||void 0===t?void 0:t.stop()),null===(i=this.composer)||void 0===i||i.setText(null!==(s=await this.data.getDraft(void 0))&&void 0!==s?s:""))}}}async release(){if(this.currentEditing){var t;this.params.tmid||await this.currentEditing.cancel(),null===(t=this.composer)||void 0===t||t.clear()}}}}
//# sourceMappingURL=/dynamic/app/ui/client/lib/edda613feee774fdddc001a4c1487a362cb3a3c7.map
