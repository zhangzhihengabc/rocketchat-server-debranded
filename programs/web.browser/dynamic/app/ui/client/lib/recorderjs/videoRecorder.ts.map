)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui/client/lib/recorderjs/videoRecorder.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\n\nclass VideoRecorder {\n\tpublic cameraStarted = new ReactiveVar(false);\n\n\tprivate started = false;\n\n\tprivate recording = new ReactiveVar(false);\n\n\tprivate recordingAvailable = new ReactiveVar(false);\n\n\tprivate videoel: HTMLVideoElement | undefined;\n\n\tprivate chunks: Blob[] = [];\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate mediaRecorder: MediaRecorder | undefined;\n\n\tpublic getSupportedMimeTypes() {\n\t\tif (window.MediaRecorder.isTypeSupported('video/webm')) {\n\t\t\treturn 'video/webm; codecs=vp8,opus';\n\t\t}\n\t\tif (window.MediaRecorder.isTypeSupported('video/mp4')) {\n\t\t\treturn 'video/mp4';\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic start(videoel?: HTMLVideoElement, cb?: (this: this, success: boolean) => void) {\n\t\tthis.videoel = videoel;\n\n\t\tconst handleSuccess = (stream: MediaStream) => {\n\t\t\tthis.startUserMedia(stream);\n\t\t\tcb?.call(this, true);\n\t\t};\n\n\t\tconst handleError = (error: any) => {\n\t\t\tconsole.error(error);\n\t\t\tcb?.call(this, false);\n\t\t};\n\n\t\tif (navigator.mediaDevices) {\n\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldGetUserMedia = navigator.getUserMedia ?? navigator.webkitGetUserMedia ?? navigator.mozGetUserMedia ?? navigator.msGetUserMedia;\n\n\t\tif (oldGetUserMedia) {\n\t\t\toldGetUserMedia.call(navigator, { audio: true, video: true }, handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tcb?.call(this, false);\n\t}\n\n\tpublic record() {\n\t\tthis.chunks = [];\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder = new MediaRecorder(this.stream, { mimeType: this.getSupportedMimeTypes() });\n\t\tthis.mediaRecorder.ondataavailable = (blobev) => {\n\t\t\tthis.chunks.push(blobev.data);\n\t\t\tif (!this.recordingAvailable.get()) {\n\t\t\t\treturn this.recordingAvailable.set(true);\n\t\t\t}\n\t\t};\n\t\tthis.mediaRecorder.start();\n\t\treturn this.recording.set(true);\n\t}\n\n\tprivate startUserMedia(stream: MediaStream) {\n\t\tif (!this.videoel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.stream = stream;\n\n\t\ttry {\n\t\t\tthis.videoel.srcObject = stream;\n\t\t} catch (error) {\n\t\t\tconst URL = window.URL || window.webkitURL;\n\t\t\tthis.videoel.src = URL.createObjectURL(stream as unknown as MediaSource | Blob);\n\t\t}\n\n\t\tthis.started = true;\n\t\treturn this.cameraStarted.set(true);\n\t}\n\n\tpublic stop(cb?: (blob: Blob) => void) {\n\t\tif (!this.started) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stopRecording();\n\n\t\tif (this.stream) {\n\t\t\tconst vtracks = this.stream.getVideoTracks();\n\t\t\tfor (const vtrack of Array.from(vtracks)) {\n\t\t\t\tvtrack.stop();\n\t\t\t}\n\n\t\t\tconst atracks = this.stream.getAudioTracks();\n\t\t\tfor (const atrack of Array.from(atracks)) {\n\t\t\t\tatrack.stop();\n\t\t\t}\n\t\t}\n\n\t\tif (this.videoel) {\n\t\t\tthis.videoel.pause;\n\t\t\tthis.videoel.src = '';\n\t\t}\n\n\t\tthis.started = false;\n\t\tthis.cameraStarted.set(false);\n\t\tthis.recordingAvailable.set(false);\n\n\t\tif (cb && this.chunks) {\n\t\t\tconst blob = new Blob(this.chunks);\n\t\t\tcb(blob);\n\t\t}\n\n\t\tdelete this.stream;\n\t\tdelete this.videoel;\n\t}\n\n\tpublic stopRecording() {\n\t\tif (!this.started || !this.recording || !this.mediaRecorder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder.stop();\n\t\tthis.recording.set(false);\n\t\tdelete this.mediaRecorder;\n\t}\n}\n\nconst instance = new VideoRecorder();\n\nexport { instance as VideoRecorder };\n",null],"names":["ReactiveVar","module","export","VideoRecorder","instance","constructor","cameraStarted","started","recording","recordingAvailable","videoel","chunks","stream","mediaRecorder","getSupportedMimeTypes","window","MediaRecorder","isTypeSupported","start","cb","_ref","_ref2","_navigator$getUserMed","handleSuccess","startUserMedia","call","handleError","error","console","navigator","mediaDevices","getUserMedia","audio","video","then","oldGetUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","record","mimeType","ondataavailable","blobev","push","data","get","set","srcObject","URL","webkitURL","src","createObjectURL","stop","stopRecording","vtracks","getVideoTracks","vtrack","Array","from","atracks","getAudioTracks","atrack","pause","blob","Blob"],"mappings":"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"}