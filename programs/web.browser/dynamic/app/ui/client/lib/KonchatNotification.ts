function module(e,t,i){let a,o,n,r,l,d,s,c,u,m,p,v,y,f,g;i.link("@babel/runtime/helpers/objectSpread2",{default(e){a=e}},0),i.export({KonchatNotification:()=>h}),i.link("@rocket.chat/random",{Random(e){o=e}},0),i.link("meteor/meteor",{Meteor(e){n=e}},1),i.link("meteor/reactive-var",{ReactiveVar(e){r=e}},2),i.link("../../../../client/lib/RoomManager",{RoomManager(e){l=e}},3),i.link("../../../../client/lib/onClientMessageReceived",{onClientMessageReceived(e){d=e}},4),i.link("../../../../client/lib/utils/getAvatarAsPng",{getAvatarAsPng(e){s=e}},5),i.link("../../../../client/providers/RouterProvider",{router(e){c=e}},6),i.link("../../../../lib/utils/stringUtils",{stripTags(e){u=e}},7),i.link("../../../custom-sounds/client/lib/CustomSounds",{CustomSounds(e){m=e}},8),i.link("../../../e2e/client",{e2e(e){p=e}},9),i.link("../../../models/client",{ChatSubscription(e){v=e}},10),i.link("../../../utils/client",{getUserPreference(e){y=e}},11),i.link("../../../utils/client/getUserAvatarURL",{getUserAvatarURL(e){f=e}},12),i.link("../../../utils/client/lib/SDKClient",{sdk(e){g=e}},13);let h=new class e{constructor(){this.notificationStatus=new r(void 0)}getDesktopPermission(){if(window.Notification&&"granted"!==Notification.permission)return Notification.requestPermission(e=>{this.notificationStatus.set(e)})}async notify(e){var t,i;if(void 0===window.Notification||"granted"!==Notification.permission||!e.payload)return;let{rid:r}=e.payload;if(!r)return;let l=await d({rid:r,msg:e.text,notification:!0}),s=y(n.userId(),"desktopNotificationRequireInteraction"),m=new Notification(e.title,{icon:e.icon||f(null===(t=e.payload.sender)||void 0===t?void 0:t.username),body:u(l.msg),tag:e.payload._id,canReply:!0,silent:!0,requireInteraction:s}),p=s?-1:(null!==(i=e.duration)&&void 0!==i?i:0)-0||10;p>0&&setTimeout(()=>m.close(),1e3*p),m.addEventListener&&m.addEventListener("reply",e=>{let{response:t}=e;g.call("sendMessage",{_id:o.id(),rid:r,msg:t})}),m.onclick=function(){var t;if(this.close(),window.focus(),e.payload._id&&e.payload.rid&&e.payload.name)switch(null===(t=e.payload)||void 0===t?void 0:t.type){case"d":return c.navigate({pattern:"/direct/:rid/:tab?/:context?",params:a({rid:e.payload.rid},e.payload.tmid&&{tab:"thread",context:e.payload.tmid}),search:a(a({},c.getSearchParameters()),{},{jump:e.payload._id})});case"c":return c.navigate({pattern:"/channel/:name/:tab?/:context?",params:a({name:e.payload.name},e.payload.tmid&&{tab:"thread",context:e.payload.tmid}),search:a(a({},c.getSearchParameters()),{},{jump:e.payload._id})});case"p":return c.navigate({pattern:"/group/:name/:tab?/:context?",params:a({name:e.payload.name},e.payload.tmid&&{tab:"thread",context:e.payload.tmid}),search:a(a({},c.getSearchParameters()),{},{jump:e.payload._id})});case"l":return c.navigate({pattern:"/live/:id/:tab?/:context?",params:{id:e.payload.rid,tab:"room-info"},search:a(a({},c.getSearchParameters()),{},{jump:e.payload._id})})}}}async showDesktop(e){var t,i,a,o,r,d;if(!(!e.payload.rid||(null===(t=e.payload)||void 0===t?void 0:t.rid)===l.opened&&("function"==typeof window.document.hasFocus?window.document.hasFocus():void 0))&&(null===(i=n.user())||void 0===i?void 0:i.status)!=="busy"){if((null===(a=e.payload)||void 0===a?void 0:null===(o=a.message)||void 0===o?void 0:o.t)==="e2e"){let t=await p.getInstanceByRoomId(e.payload.rid);t&&(e.text=(await t.decrypt(e.payload.message.msg)).text)}return s(null===(r=e.payload)||void 0===r?void 0:null===(d=r.sender)||void 0===d?void 0:d.username,t=>(e.icon=t,this.notify(e)))}}async newMessage(e){var t;if((null===(t=n.user())||void 0===t?void 0:t.status)==="busy")return;let i=n.userId(),a=y(i,"newMessageNotification"),o=y(i,"notificationsSoundVolume",100);if(!e)return;let r=v.findOne({rid:e},{fields:{audioNotificationValue:1}});if(r&&"none"!==r.audioNotificationValue)try{if(r.audioNotificationValue&&"0"!==r.audioNotificationValue){m.play(r.audioNotificationValue,{volume:Number((o/100).toPrecision(2))});return}a&&"none"!==a&&m.play(a,{volume:Number((o/100).toPrecision(2))})}catch(e){}}newRoom(e){Tracker.nonreactive(()=>{let t=Session.get("newRoomSound");return t=t?[...t,e]:[e],Session.set("newRoomSound",t)})}removeRoomNotification(e){var t;let i=null!==(t=Session.get("newRoomSound"))&&void 0!==t?t:[];i=i.filter(t=>t!==e),Tracker.nonreactive(()=>Session.set("newRoomSound",i));let a=document.querySelector(".link-room-".concat(e));null==a||a.classList.remove("new-room-highlight")}}}
//# sourceMappingURL=/dynamic/app/ui/client/lib/dce4c2381ed7ce3b0a884ea36cdaa1b56ca99b99.map
