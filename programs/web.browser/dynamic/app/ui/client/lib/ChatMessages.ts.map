)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui/client/lib/ChatMessages.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\nimport type { UIEvent } from 'react';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t  };\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic userCard: { open(username: string): (event: UIEvent) => void; close(): void };\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.userCard = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n",null],"names":["isVideoConfMessage","createDataAPI","processMessageEditing","processSetReaction","processSlashCommand","processTooLongMessage","replyBroadcast","requestMessageDeletion","sendMessage","uploadFiles","ReadStateManager","createUploadsAPI","setHighlightMessage","clearHighlightMessage","UserAction","module","export","ChatMessages","constructor","params","_this","uid","composer","setComposerAPI","_this$composer","release","data","readStateManager","uploads","ActionManager","userCard","emojiPicker","action","currentEditingMID","messageEditing","toPreviousMessage","currentEditing","lastMessage","findLastOwnMessage","findPreviousOwnMessage","saveDraft","undefined","text","editMessage","currentMessage","findMessageByID","mid","previousMessage","cancel","toNextMessage","nextMessage","findNextOwnMessage","cursorAtStart","message","_message$attachments","_message$attachments$","_this$currentEditing","arguments","length","getDraft","_id","attachments","description","msg","stop","canUpdateMessage","setEditingMode","setText","setCursorToStart","setCursorToEnd","focus","flows","rid","tmid","actionManager","unimplemented","Error","open","close","start","concat","performContinuously","bind","reset","_message$msg","draft","discardDraft","_this$currentEditing2","_this$composer2","_await$this$data$getD","_this$composer3","clear"],"mappings":"2BACmCA,EAA4BC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA/DC,EAAOC,MAAE,CAAA,CAAAC,aAAkB,IAAEA,CAAM,GAA4BF,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAf,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAe,EAAAA,IAAAA,CAAAA,oCAAAA,CAAAd,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAc,EAAAA,IAAAA,CAAAA,2DAAAA,CAAAb,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAa,EAAAA,IAAAA,CAAAA,wDAAAA,CAAAZ,mBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,yDAAAA,CAAAX,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,2DAAAA,CAAAV,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAU,EAAAA,IAAAA,CAAAA,oDAAAA,CAAAT,eAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,4DAAAA,CAAAR,uBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,iDAAAA,CAAAP,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,iDAAAA,CAAAN,YAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,gDAAAA,CAAAL,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAK,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAJ,iBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAI,EAAAA,IAAAA,CAAAA,mFAAAA,CAAAH,oBAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAAAE,EAAAA,IAAAA,CAAAA,eAAAA,CAAAD,WAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GA4BzD,OAAOG,EAgHZC,YACSC,CAKP,CAAA,CAAA,IAAAC,EAAA,IAAA,CAAA,IAAA,CALOD,MAAAA,CAAAA,KAAAA,EAAA,IAAA,CAhHFE,GAAG,CAAA,KAAA,EAAA,IAAA,CAEHC,QAAQ,CAAA,KAAA,EAAA,IAAA,CAERC,cAAc,CAAID,IAA+B,IAAAE,CACvD,AAAa,QAAbA,CAAAA,EAAA,IAAI,CAACF,QAAQ,AAARA,GAAQE,AAAA,KAAA,IAAAA,GAAbA,EAAeC,OAAO,GACtB,IAAI,CAACH,QAAQ,CAAGA,CACjB,EAAC,IAAA,CAEMI,IAAI,CAAA,KAAA,EAAA,IAAA,CAEJC,gBAAgB,CAAA,KAAA,EAAA,IAAA,CAEhBC,OAAO,CAAA,KAAA,EAAA,IAAA,CAEPC,aAAa,CAAA,KAAA,EAAA,IAAA,CAEbC,QAAQ,CAAA,KAAA,EAAA,IAAA,CAERC,WAAW,CAAA,KAAA,EAAA,IAAA,CAKXC,MAAM,CAAA,KAAA,EAAA,IAAA,CAMLC,iBAAiB,CAAA,KAAA,EAAA,IAAA,CAElBC,cAAc,CAA8B,CAClDC,kBAAmB,UAClB,GAAI,CAAC,IAAI,CAACb,QAAQ,CACjB,OAGD,GAAI,CAAC,IAAI,CAACc,cAAc,CAAE,CACzB,IAAIC,EAAc,MAAM,IAAI,CAACX,IAAI,CAACY,kBAAkB,GAGhDD,GAAerC,EAAmBqC,IACrCA,CAAAA,EAAc,MAAM,IAAI,CAACX,IAAI,CAACa,sBAAsB,CAACF,EAAW,EAG7DA,IACH,MAAM,IAAI,CAACX,IAAI,CAACc,SAAS,CAACC,KAAAA,EAAW,IAAI,CAACnB,QAAQ,CAACoB,IAAI,EACvD,MAAM,IAAI,CAACR,cAAc,CAACS,WAAW,CAACN,IAGvC,OAGD,IAAMO,EAAiB,MAAM,IAAI,CAAClB,IAAI,CAACmB,eAAe,CAAC,IAAI,CAACT,cAAc,CAACU,GAAG,EAC1EC,EAAkBH,EAAiB,MAAM,IAAI,CAAClB,IAAI,CAACa,sBAAsB,CAACK,GAAkBH,KAAAA,EAOhG,GAJIM,GAAmB/C,EAAmB+C,IACzCA,CAAAA,EAAkB,MAAM,IAAI,CAACrB,IAAI,CAACa,sBAAsB,CAACQ,EAAe,EAGrEA,EAAiB,CACpB,MAAM,IAAI,CAACb,cAAc,CAACS,WAAW,CAACI,GACtC,OAGD,MAAM,IAAI,CAACX,cAAc,CAACY,MAAM,EACjC,EACAC,cAAe,UACd,GAAI,CAAC,IAAI,CAAC3B,QAAQ,EAAI,CAAC,IAAI,CAACc,cAAc,CACzC,OAGD,IAAMQ,EAAiB,MAAM,IAAI,CAAClB,IAAI,CAACmB,eAAe,CAAC,IAAI,CAACT,cAAc,CAACU,GAAG,EAC1EI,EAAcN,EAAiB,MAAM,IAAI,CAAClB,IAAI,CAACyB,kBAAkB,CAACP,GAAkBH,KAAAA,EAOxF,GAJIS,GAAelD,EAAmBkD,IACrCA,CAAAA,EAAc,MAAM,IAAI,CAACxB,IAAI,CAACyB,kBAAkB,CAACD,EAAW,EAGzDA,EAAa,CAChB,MAAM,IAAI,CAAChB,cAAc,CAACS,WAAW,CAACO,EAAa,CAAEE,cAAe,CAAA,CAAI,GACxE,OAGD,MAAM,IAAI,CAAChB,cAAc,CAACY,MAAM,EACjC,EACAL,YAAa,eAAOU,CAAiB,EAAiE,IAAAC,EAAAC,EAAAC,EAAA,GAA/D,CAAEJ,cAAAA,EAAgB,CAAA,CAAA,CAAK,CAAAK,UAAAC,MAAA,CAAA,GAAAD,AAAAhB,KAAAA,IAAAgB,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAkC,CAAA,EACzFf,EAAO,AAAC,MAAMtB,EAAKM,IAAI,CAACiC,QAAQ,CAACN,EAAQO,GAAG,GAAC,CAAA,AAAwB,OAAxBN,CAAAA,EAAKD,EAAQQ,WAAW,AAAXA,GAAWP,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAA,AAAK,OAALC,CAAAA,EAAnBD,CAAA,CAAsB,EAAE,AAAD,GAACC,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAxBA,EAA0BO,WAAW,AAAXA,GAAeT,EAAQU,GAAG,AAE5G,OAAA,CAAA,AAAyB,OAAzBP,CAAAA,EAAMpC,EAAKgB,cAAc,AAAdA,GAAcoB,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAnBA,EAAqBQ,IAAI,EAAA,EAE1B5C,EAAKE,QAAQ,EAAM,MAAMF,EAAKM,IAAI,CAACuC,gBAAgB,CAACZ,KAIzDjC,EAAKa,iBAAiB,CAAGoB,EAAQO,GAAG,CACpChD,EAAoByC,EAAQO,GAAG,EAC/BxC,EAAKE,QAAQ,CAAC4C,cAAc,CAAC,CAAA,GAE7B9C,EAAKE,QAAQ,CAAC6C,OAAO,CAACzB,GACtBU,GAAiBhC,EAAKE,QAAQ,CAAC8C,gBAAgB,GAC/C,AAAChB,GAAiBhC,EAAKE,QAAQ,CAAC+C,cAAc,GAC9CjD,EAAKE,QAAQ,CAACgD,KAAK,GACpB,GACA,IAAA,CAEMC,KAAK,CAAA,KAAA,EAGH,IAAA,CAAApD,MAAM,CAANA,EAOR,GAAM,CAAEqD,IAAAA,CAAG,CAAEC,KAAAA,CAAAA,CAAM,CAAGtD,CACtB,CAAA,IAAI,CAACE,GAAG,CAAGF,EAAOE,GAAG,CACrB,IAAI,CAACK,IAAI,CAAGzB,EAAc,CAAEuE,IAAAA,EAAKC,KAAAA,CAAI,GACrC,IAAI,CAAC7C,OAAO,CAAGjB,EAAiB,CAAE6D,IAAAA,EAAKC,KAAAA,CAAI,GAC3C,IAAI,CAAC5C,aAAa,CAAGV,EAAOuD,aAAa,CAEzC,IAAMC,EAAgB,KACrB,MAAM,AAAIC,MAAM,0BACjB,CAEA,CAAA,IAAI,CAACjD,gBAAgB,CAAG,IAAIjB,EAAiB8D,GAE7C,IAAI,CAAC1C,QAAQ,CAAG,CACf+C,KAAMF,EACNG,MAAOH,GAGR,IAAI,CAAC5C,WAAW,CAAG,CAClB8C,KAAMF,EACNG,MAAOH,GAGR,IAAI,CAAC3C,MAAM,CAAG,CACb+C,MAAO,MAAO/C,IACblB,EAAWiE,KAAK,CAAC5D,EAAOqD,GAAG,CAAA,QAAAQ,MAAA,CAAUhD,GAAU,CAAEyC,KAAMtD,EAAOsD,IAAAA,AAAI,EACnE,EACAQ,oBAAqB,MAAOjD,IAC3BlB,EAAWmE,mBAAmB,CAAC9D,EAAOqD,GAAG,CAAA,QAAAQ,MAAA,CAAUhD,GAAU,CAAEyC,KAAMtD,EAAOsD,IAAAA,AAAI,EACjF,EACAT,KAAM,MAAOhC,IACZlB,EAAWkD,IAAI,CAAC7C,EAAOqD,GAAG,CAAA,QAAAQ,MAAA,CAAUhD,GAAU,CAAEyC,KAAMtD,EAAOsD,IAAAA,AAAI,EAClE,GAGD,IAAI,CAACF,KAAK,CAAG,CACZ9D,YAAaA,EAAYyE,IAAI,CAAC,KAAM,IAAI,EACxC1E,YAAaA,EAAY0E,IAAI,CAAC,IAAI,CAAE,IAAI,EACxC9E,oBAAqBA,EAAoB8E,IAAI,CAAC,KAAM,IAAI,EACxD7E,sBAAuBA,EAAsB6E,IAAI,CAAC,KAAM,IAAI,EAC5DhF,sBAAuBA,EAAsBgF,IAAI,CAAC,KAAM,IAAI,EAC5D/E,mBAAoBA,EAAmB+E,IAAI,CAAC,KAAM,IAAI,EACtD3E,uBAAwBA,EAAuB2E,IAAI,CAAC,IAAI,CAAE,IAAI,EAC9D5E,eAAgBA,EAAe4E,IAAI,CAAC,KAAM,IAAI,EAEhD,CAEA,IAAW9C,gBAAc,CACxB,GAAI,AAAC,IAAI,CAACd,QAAQ,EAAK,IAAI,CAACW,iBAAiB,CAI7C,MAAO,CACNa,IAAK,IAAI,CAACb,iBAAiB,CAC3BkD,MAAO,UACN,GAAI,CAAC,IAAI,CAAC7D,QAAQ,EAAI,CAAC,IAAI,CAACW,iBAAiB,CAC5C,MAAO,CAAA,EAGR,IAAMoB,EAAU,MAAM,IAAI,CAAC3B,IAAI,CAACmB,eAAe,CAAC,IAAI,CAACZ,iBAAiB,EACtE,GAAI,IAAI,CAACX,QAAQ,CAACoB,IAAI,GAAKW,CAAAA,MAAAA,EAAO,KAAA,EAAPA,EAASU,GAAG,AAAHA,EAAK,CAAA,IAAAqB,EAExC,OADA,IAAI,CAAC9D,QAAQ,CAAC6C,OAAO,CAAA,AAAa,OAAbiB,CAAAA,EAAC/B,MAAAA,EAAO,KAAA,EAAPA,EAASU,GAAG,AAAHA,GAAGqB,AAAA,KAAA,IAAAA,EAAAA,EAAI,IAC/B,CAAA,EAGR,MAAO,CAAA,CACR,EACApB,KAAM,UACL,GAAI,CAAC,IAAI,CAAC1C,QAAQ,EAAI,CAAC,IAAI,CAACW,iBAAiB,CAC5C,OAGD,IAAMoB,EAAU,MAAM,IAAI,CAAC3B,IAAI,CAACmB,eAAe,CAAC,IAAI,CAACZ,iBAAiB,EAChEoD,EAAQ,IAAI,CAAC/D,QAAQ,CAACoB,IAAI,AAE5B2C,CAAAA,IAAUhC,CAAAA,MAAAA,EAAO,KAAA,EAAPA,EAASU,GAAG,AAAHA,EACtB,MAAM,IAAI,CAACrC,IAAI,CAAC4D,YAAY,CAAC,IAAI,CAACrD,iBAAiB,EAEnD,MAAM,IAAI,CAACP,IAAI,CAACc,SAAS,CAAC,IAAI,CAACP,iBAAiB,CAAE,AAAC,MAAM,IAAI,CAACP,IAAI,CAACiC,QAAQ,CAAC,IAAI,CAAC1B,iBAAiB,GAAMoD,GAGzG,IAAI,CAAC/D,QAAQ,CAAC4C,cAAc,CAAC,CAAA,GAC7B,IAAI,CAACjC,iBAAiB,CAAGQ,KAAAA,EACzB5B,GACD,EACAmC,OAAQ,UAA0B,IAAAuC,EAAAC,EAAAC,CAC5B,CAAA,IAAI,CAACxD,iBAAiB,GAI3B,MAAM,IAAI,CAACP,IAAI,CAAC4D,YAAY,CAAC,IAAI,CAACrD,iBAAiB,EACnD,MAAA,CAAA,AAAyB,OAAzBsD,CAAAA,EAAM,IAAI,CAACnD,cAAc,AAAdA,GAAcmD,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAnBA,EAAqBvB,IAAI,EAAA,EAC/B,AAAa,OAAbwB,CAAAA,EAAA,IAAI,CAAClE,QAAQ,AAARA,GAAQkE,AAAA,KAAA,IAAAA,GAAbA,EAAerB,OAAO,CAAA,AAAqC,OAArCsB,CAAAA,EAAE,MAAM,IAAI,CAAC/D,IAAI,CAACiC,QAAQ,CAAClB,KAAAA,EAAS,GAACgD,AAAA,KAAA,IAAAA,EAAAA,EAAK,IACjE,EAEF,CAEO,MAAMhE,SAAO,CACnB,GAAI,IAAI,CAACW,cAAc,CAAE,CAAA,IAAAsD,CACnB,CAAA,IAAI,CAACvE,MAAM,CAACsD,IAAI,EACpB,MAAM,IAAI,CAACrC,cAAc,CAACY,MAAM,GAEjC,AAAa,OAAb0C,CAAAA,EAAA,IAAI,CAACpE,QAAQ,AAARA,GAAQoE,AAAA,KAAA,IAAAA,GAAbA,EAAeC,KAAK,GAEtB"}