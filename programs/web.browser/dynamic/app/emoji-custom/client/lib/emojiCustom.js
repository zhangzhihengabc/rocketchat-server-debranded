function module(e,a,o){let t,i,c,s,n,m,l,r,u,p,g;o.export({getEmojiUrlFromName:()=>j,deleteEmojiCustom:()=>d,updateEmojiCustom:()=>k}),o.link("@rocket.chat/string-helpers",{escapeRegExp(e){t=e}},0),o.link("jquery",{default(e){i=e}},1),o.link("meteor/meteor",{Meteor(e){c=e}},2),o.link("meteor/session",{Session(e){s=e}},3),o.link("../../../emoji/client",{emoji(e){n=e},updateRecent(e){m=e}},4),o.link("../../../ui-cached-collection/client",{CachedCollectionManager(e){l=e}},5),o.link("../../../ui-utils/client",{LegacyRoomManager(e){r=e}},6),o.link("../../../utils/client",{getURL(e){u=e}},7),o.link("../../../utils/client/lib/SDKClient",{sdk(e){p=e}},8),o.link("./function-isSet",{isSetNotNull(e){g=e}},9);let j=function(e,a){if(null==e)return;let o="emoji_random_".concat(e),t=g(()=>s.keys[o])?s.keys[o]:0;return u("/emoji-custom/".concat(encodeURIComponent(e),".").concat(a,"?_dc=").concat(t))},d=function(e){delete n.list[":".concat(e.name,":")];let a=n.packages.emojiCustom.emojisByCategory.rocket.indexOf(e.name);-1!==a&&n.packages.emojiCustom.emojisByCategory.rocket.splice(a,1);let o=n.packages.emojiCustom.list.indexOf(":".concat(e.name,":"));if(-1!==o&&n.packages.emojiCustom.list.splice(o,1),g(()=>e.aliases))for(let a of e.aliases){delete n.list[":".concat(a,":")];let e=n.packages.emojiCustom.list.indexOf(":".concat(a,":"));-1!==e&&n.packages.emojiCustom.list.splice(e,1)}m("rocket")},k=function(e){let a="emoji_random_".concat(e.name);s.set(a,Math.round(1e3*Math.random()));let o=g(()=>e.previousName),t=g(()=>e.aliases);if(o&&g(()=>n.list[":".concat(e.previousName,":")].aliases))for(let a of n.list[":".concat(e.previousName,":")].aliases){delete n.list[":".concat(a,":")];let e=n.packages.emojiCustom.list.indexOf(":".concat(a,":"));-1!==e&&n.packages.emojiCustom.list.splice(e,1)}if(o&&e.name!==e.previousName){let a=n.packages.emojiCustom.emojisByCategory.rocket.indexOf(e.previousName);-1!==a&&n.packages.emojiCustom.emojisByCategory.rocket.splice(a,1);let o=n.packages.emojiCustom.list.indexOf(":".concat(e.previousName,":"));-1!==o&&n.packages.emojiCustom.list.splice(o,1),delete n.list[":".concat(e.previousName,":")]}let c=n.packages.emojiCustom.emojisByCategory.rocket.indexOf("".concat(e.name));if(-1===c&&(n.packages.emojiCustom.emojisByCategory.rocket.push("".concat(e.name)),n.packages.emojiCustom.list.push(":".concat(e.name,":"))),n.list[":".concat(e.name,":")]=Object.assign({emojiPackage:"emojiCustom"},n.list[":".concat(e.name,":")],e),t)for(let a of e.aliases)n.packages.emojiCustom.list.push(":".concat(a,":")),n.list[":".concat(a,":")]={},n.list[":".concat(a,":")].emojiPackage="emojiCustom",n.list[":".concat(a,":")].aliasOf=e.name;let l=j(e.name,e.extension);for(a in o&&e.name!==e.previousName?i(document).find(".emojiAdminPreview-image[data-emoji='".concat(e.previousName,"']")).css("background-image","url('".concat(l,")'")).attr("data-emoji","".concat(e.name)):i(document).find(".emojiAdminPreview-image[data-emoji='".concat(e.name,"']")).css("background-image","url('".concat(l,"')")),o&&e.name!==e.previousName?(i(document).find("li[data-emoji='".concat(e.previousName,"'] span")).css("background-image","url('".concat(l,"')")).attr("data-emoji","".concat(e.name)),i(document).find("li[data-emoji='".concat(e.previousName,"']")).attr("data-emoji","".concat(e.name)).attr("class","emoji-".concat(e.name))):i(document).find("li[data-emoji='".concat(e.name,"'] span")).css("background-image","url('".concat(l,"')")),r.openedRooms)if(r.openedRooms.hasOwnProperty(a)){let t=r.openedRooms[a];o&&e.name!==e.previousName?i(t.dom).find("span[data-emoji='".concat(e.previousName,"']")).css("background-image","url('".concat(l,"')")).attr("data-emoji","".concat(e.name)):i(t.dom).find("span[data-emoji='".concat(e.name,"']")).css("background-image","url('".concat(l,"')"))}m("rocket")},C=e=>{let a=n.packages.emojiCustom.list.map(t).join("|");return a!==n.packages.emojiCustom._regexpSignature&&(n.packages.emojiCustom._regexpSignature=a,n.packages.emojiCustom._regexp=RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|(".concat(a,")"),"gi")),e=e.replace(n.packages.emojiCustom._regexp,e=>{if(void 0===e||""===e||-1===n.packages.emojiCustom.list.indexOf(e))return e;let a=e.replace(/:/g,""),o=n.list[e];return o.hasOwnProperty("aliasOf")&&(a=o.aliasOf,o=n.list[":".concat(a,":")]),'<span class="emoji" style="background-image:url('.concat(j(a,o.extension),');" data-emoji="').concat(a,'" title="').concat(e,'">').concat(e,"</span>")})};n.packages.emojiCustom={emojiCategories:[{key:"rocket",i18n:"Custom"}],categoryIndex:1,toneList:{},list:[],_regexpSignature:null,_regexp:null,render:C,renderPicker:C},c.startup(()=>l.onLogin(async()=>{try{let{emojis:{update:e}}=await p.rest.get("/v1/emoji-custom.list");for(let a of(n.packages.emojiCustom.emojisByCategory={rocket:[]},e))for(let e of(n.packages.emojiCustom.emojisByCategory.rocket.push(a.name),n.packages.emojiCustom.list.push(":".concat(a.name,":")),n.list[":".concat(a.name,":")]=a,n.list[":".concat(a.name,":")].emojiPackage="emojiCustom",a.aliases))n.packages.emojiCustom.list.push(":".concat(e,":")),n.list[":".concat(e,":")]={emojiPackage:"emojiCustom",aliasOf:a.name}}catch(e){console.error("Error getting custom emoji",e)}}))}
//# sourceMappingURL=/dynamic/app/emoji-custom/client/lib/b73da6fb687936978ae6b23076486e09bac937ea.map
