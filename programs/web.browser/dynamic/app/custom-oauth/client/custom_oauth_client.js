function module(e,t,i){let n,o,r,s,a,c,h,u;i.export({CustomOAuth:()=>l}),i.link("@rocket.chat/random",{Random(e){n=e}},0),i.link("@rocket.chat/string-helpers",{capitalize(e){o=e}},1),i.link("meteor/accounts-base",{Accounts(e){r=e}},2),i.link("meteor/check",{Match(e){s=e}},3),i.link("meteor/meteor",{Meteor(e){a=e}},4),i.link("meteor/oauth",{OAuth(e){c=e}},5),i.link("meteor/service-configuration",{ServiceConfiguration(e){h=e}},6),i.link("../../../lib/utils/isURL",{isURL(e){u=e}},7);class l{constructor(e,t){if(this.name=e,!s.test(this.name,String))throw new a.Error("CustomOAuth: Name is required and must be String");this.configure(t),r.oauth.registerService(this.name),this.configureLogin()}configure(e){if(!s.test(e,Object))throw new a.Error("CustomOAuth: Options is required and must be Object");if(!s.test(e.serverURL,String))throw new a.Error("CustomOAuth: Options.serverURL is required and must be String");s.test(e.authorizePath,String)||(e.authorizePath="/oauth/authorize"),s.test(e.scope,String)||(e.scope="openid"),this.serverURL=e.serverURL,this.authorizePath=e.authorizePath,this.scope=e.scope,this.responseType=e.responseType||"code",u(this.authorizePath)||(this.authorizePath=this.serverURL+this.authorizePath)}configureLogin(){let e="loginWith".concat(o(String(this.name||"")));a[e]=async(e,t)=>{t||"function"!=typeof e||(t=e,e=null);let i=r.oauth.credentialRequestCompleteHandler(t);await this.requestCredential(e,i)}}async requestCredential(e,t){t||"function"!=typeof e||(t=e,e={});let i=await h.configurations.findOneAsync({service:this.name});if(!i){t&&t(new h.ConfigError);return}let o=n.secret(),r=c._loginStyle(this.name,i,e),s=-1!==this.authorizePath.indexOf("?")?"&":"?",a="".concat(this.authorizePath).concat(s,"client_id=").concat(i.clientId,"&redirect_uri=").concat(encodeURIComponent(c._redirectUri(this.name,i)),"&response_type=").concat(encodeURIComponent(this.responseType))+"&state=".concat(encodeURIComponent(c._stateParam(r,o,e.redirectUrl)),"&scope=").concat(encodeURIComponent(this.scope));c.launchLogin({loginService:this.name,loginStyle:r,loginUrl:a,credentialRequestCompleteCallback:t,credentialToken:o,popupOptions:{width:900,height:450}})}}}
//# sourceMappingURL=/dynamic/app/custom-oauth/client/ac838f3458fe88c3445069eacf2359a2bc93ae24.map
