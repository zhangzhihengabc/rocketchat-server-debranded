)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/threads/client/lib/normalizeThreadTitle.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\n\nimport { emojiParser } from '../../../emoji/client/emojiParser.js';\nimport { filterMarkdown } from '../../../markdown/lib/markdown';\nimport { MentionsParser } from '../../../mentions/lib/MentionsParser';\nimport { Users } from '../../../models/client';\nimport { settings } from '../../../settings/client';\n\nexport function normalizeThreadTitle({ ...message }: Readonly<IMessage>) {\n\tif (message.msg) {\n\t\tconst filteredMessage = filterMarkdown(escapeHTML(message.msg));\n\t\tif (!message.channels && !message.mentions) {\n\t\t\treturn filteredMessage;\n\t\t}\n\t\tconst uid = Meteor.userId();\n\t\tconst me = uid && Users.findOne(uid, { fields: { username: 1 } })?.username;\n\t\tconst pattern = settings.get('UTF8_User_Names_Validation');\n\t\tconst useRealName = settings.get('UI_Use_Real_Name');\n\n\t\tconst instance = new MentionsParser({\n\t\t\tpattern: () => pattern,\n\t\t\tuseRealName: () => useRealName,\n\t\t\tme: () => me,\n\t\t\tuserTemplate: ({ label }) => `<strong> ${label} </strong>`,\n\t\t\troomTemplate: ({ prefix, mention }) => `${prefix}<strong> ${mention} </strong>`,\n\t\t});\n\t\tconst { html } = emojiParser({ html: filteredMessage });\n\t\treturn instance.parse({ ...message, msg: filteredMessage, html }).html;\n\t}\n\n\tif (message.attachments) {\n\t\tconst attachment = message.attachments.find((attachment) => attachment.title || attachment.description);\n\n\t\tif (attachment?.description) {\n\t\t\treturn escapeHTML(attachment.description);\n\t\t}\n\n\t\tif (attachment?.title) {\n\t\t\treturn escapeHTML(attachment.title);\n\t\t}\n\t}\n}\n",null],"names":["_objectSpread","_objectDestructuringEmpty","_extends","escapeHTML","Meteor","emojiParser","filterMarkdown","MentionsParser","Users","settings","normalizeThreadTitle","_ref","message","msg","_Users$findOne","filteredMessage","channels","mentions","uid","userId","me","findOne","fields","username","pattern","get","useRealName","instance","userTemplate","_ref2","label","concat","roomTemplate","_ref3","prefix","mention","html","parse","attachments","attachment","find","title","description","module","link","default","export"],"mappings":"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"}