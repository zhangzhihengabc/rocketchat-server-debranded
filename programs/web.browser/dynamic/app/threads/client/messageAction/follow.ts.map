)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/threads/client/messageAction/follow.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\nimport { Messages } from '../../../models/client';\nimport { settings } from '../../../settings/client';\nimport { MessageAction } from '../../../ui-utils/client';\nimport { t } from '../../../utils/lib/i18n';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (!settings.get('Threads_enabled')) {\n\t\t\treturn MessageAction.removeButton('follow-message');\n\t\t}\n\t\tMessageAction.addButton({\n\t\t\tid: 'follow-message',\n\t\t\ticon: 'bell',\n\t\t\tlabel: 'Follow_message',\n\t\t\ttype: 'interaction',\n\t\t\tcontext: ['message', 'message-mobile', 'threads', 'federated', 'videoconf', 'videoconf-threads'],\n\t\t\tasync action(_, { message }) {\n\t\t\t\tif (!message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait callWithErrorHandling('followMessage', { mid: message._id }).then(() =>\n\t\t\t\t\tdispatchToastMessage({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tmessage: t('You_followed_this_message'),\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t},\n\t\t\tcondition({ message: { _id, tmid, replies = [] }, room, user, context }) {\n\t\t\t\tif (tmid || context) {\n\t\t\t\t\tconst parentMessage = Messages.findOne({ _id: tmid || _id }, { fields: { replies: 1 } });\n\t\t\t\t\tif (parentMessage) {\n\t\t\t\t\t\treplies = parentMessage.replies || [];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\n\t\t\t\tif (isLivechatRoom) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn user?._id ? !replies.includes(user._id) : false;\n\t\t\t},\n\t\t\torder: 1,\n\t\t\tgroup: 'menu',\n\t\t});\n\t});\n});\n",null],"names":["Meteor","Tracker","roomCoordinator","dispatchToastMessage","callWithErrorHandling","Messages","settings","MessageAction","t","module","link","startup","autorun","get","removeButton","addButton","id","icon","label","type","context","action","_","_ref","message","mid","_id","then","condition","_ref2","tmid","replies","room","user","parentMessage","findOne","fields","isLivechatRoom","includes","order","group"],"mappings":"2BAAAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAV,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAR,QAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,+CAAAA,CAAAP,gBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAN,qBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,qDAAAA,CAAAL,sBAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAJ,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAH,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAF,cAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAD,EAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAWvCR,EAAOW,OAAO,CAAC,KACdV,EAAQW,OAAO,CAAC,KACf,GAAI,CAACN,EAASO,GAAG,CAAC,mBACjB,OAAON,EAAcO,YAAY,CAAC,kBAEnCP,EAAcQ,SAAS,CAAC,CACvBC,GAAI,iBACJC,KAAM,OACNC,MAAO,iBACPC,KAAM,cACNC,QAAS,CAAC,UAAW,iBAAkB,UAAW,YAAa,YAAa,oBAAoB,CAChG,MAAMC,OAAOC,CAAC,CAAAC,CAAA,EAAa,GAAX,CAAEC,QAAAA,CAAAA,CAAS,CAAAD,EACrBC,GAIL,MAAMpB,EAAsB,gBAAiB,CAAEqB,IAAKD,EAAQE,GAAAA,AAAG,GAAIC,IAAI,CAAC,IACvExB,EAAqB,CACpBgB,KAAM,UACNK,QAAShB,EAAE,+BAGd,EACAoB,UAASC,CAAA,EAA8D,GAA7D,CAAEL,QAAS,CAAEE,IAAAA,CAAG,CAAEI,KAAAA,CAAI,CAAEC,QAAAA,EAAU,EAAA,CAAI,CAAEC,KAAAA,CAAI,CAAEC,KAAAA,CAAI,CAAEb,QAAAA,CAAAA,CAAS,CAAAS,EACtE,GAAIC,GAAQV,EAAS,CACpB,IAAMc,EAAgB7B,EAAS8B,OAAO,CAAC,CAAET,IAAKI,GAAQJ,CAAG,EAAI,CAAEU,OAAQ,CAAEL,QAAS,CAAC,CAAE,GACjFG,GACHH,CAAAA,EAAUG,EAAcH,OAAO,EAAI,EAAE,AAAF,EAGrC,IAAMM,EAAiBnC,EAAgBmC,cAAc,CAACL,EAAKxB,CAAC,QAC5D,CAAI6B,GAGGJ,MAAAA,KAAAA,EAAMP,GAAG,EAAG,CAACK,EAAQO,QAAQ,CAACL,EAAKP,GAAG,CAC9C,EACAa,MAAO,EACPC,MAAO,QAET,EACD"}