)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/cas/client/cas_client.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Random } from '@rocket.chat/random';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n\tconst screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n\tconst outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n\tconst outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight - 22;\n\t// XXX what is the 22?\n\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\tnewwindow?.focus();\n\n\treturn newwindow;\n};\n\n(Meteor as any).loginWithCas = (_?: unknown, callback?: () => void) => {\n\tconst credentialToken = Random.id();\n\tconst loginUrl = settings.get('CAS_login_url');\n\tconst popupWidth = settings.get('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get('CAS_popup_height') || 600;\n\n\tif (!loginUrl) {\n\t\treturn;\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t// check if the provided CAS URL already has some parameters\n\tconst delim = loginUrl.split('?').length > 1 ? '&' : '?';\n\tconst popupUrl = `${loginUrl}${delim}service=${appUrl}/_cas/${credentialToken}`;\n\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tconst checkPopupOpen = setInterval(() => {\n\t\tlet popupClosed;\n\t\ttry {\n\t\t\t// Fix for #328 - added a second test criteria (popup.closed === undefined)\n\t\t\t// to humour this Android quirk:\n\t\t\t// http://code.google.com/p/android/issues/detail?id=21061\n\t\t\tpopupClosed = popup?.closed || popup?.closed === undefined;\n\t\t} catch (e) {\n\t\t\t// For some unknown reason, IE9 (and others?) sometimes (when\n\t\t\t// the popup closes too quickly?) throws \"SCRIPT16386: No such\n\t\t\t// interface supported\" when trying to read 'popup.closed'. Try\n\t\t\t// again in 100ms.\n\t\t\treturn;\n\t\t}\n\n\t\tif (popupClosed) {\n\t\t\tclearInterval(checkPopupOpen);\n\n\t\t\t// check auth on server.\n\t\t\tAccounts.callLoginMethod({\n\t\t\t\tmethodArguments: [{ cas: { credentialToken } }],\n\t\t\t\tuserCallback: callback,\n\t\t\t});\n\t\t}\n\t}, 100);\n};\n",null],"names":["Random","Accounts","Meteor","settings","module","link","openCenteredPopup","url","width","height","screenX","window","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","top","features","concat","newwindow","open","focus","loginWithCas","_","callback","credentialToken","id","loginUrl","get","popupWidth","popupHeight","appUrl","absoluteUrl","replace","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","delim","split","length","popupUrl","popup","checkPopupOpen","setInterval","popupClosed","closed","undefined","e","clearInterval","callLoginMethod","methodArguments","cas","userCallback"],"mappings":"2BAAAA,EAA6CC,EAAAC,EAAAC,EAApCC,EAAQC,IAAA,CAAM,sBAAsB,CAAAL,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,uBAAAA,CAAAH,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAF,OAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAD,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAM7C,IAAMG,EAAoB,CAACC,EAAaC,EAAeC,KACtD,IAAMC,EAAU,AAA0B,KAAA,IAAnBC,OAAOD,OAAO,CAAmBC,OAAOD,OAAO,CAAGC,OAAOC,UAAU,CACpFC,EAAU,AAA0B,KAAA,IAAnBF,OAAOE,OAAO,CAAmBF,OAAOE,OAAO,CAAGF,OAAOG,SAAS,CACnFC,EAAa,AAA6B,KAAA,IAAtBJ,OAAOI,UAAU,CAAmBJ,OAAOI,UAAU,CAAGC,SAASC,IAAI,CAACC,WAAW,CACrGC,EAAc,AAA8B,KAAA,IAAvBR,OAAOQ,WAAW,CAAmBR,OAAOQ,WAAW,CAAGH,SAASC,IAAI,CAACG,YAAY,CAAG,GAM5GC,EAAMR,EAAU,AAACM,CAAAA,EAAcV,CAAAA,EAAU,EACzCa,EAAQ,SAAAC,MAAA,CAAYf,EAAK,YAAAe,MAAA,CAAWd,EAAM,UAAAc,MAAA,CAFnCb,EAAU,AAACK,CAAAA,EAAaP,CAAAA,EAAS,EAEe,SAAAe,MAAA,CAAQF,EAAG,mBAElEG,EAAYb,OAAOc,IAAI,CAAClB,EAAK,QAASe,GAG5C,OAFAE,MAAAA,GAAAA,EAAWE,KAAK,GAETF,CACR,CAECtB,CAAAA,EAAeyB,YAAY,CAAG,CAACC,EAAaC,KAC5C,IAAMC,EAAkB9B,EAAO+B,EAAE,GAC3BC,EAAW7B,EAAS8B,GAAG,CAAC,iBACxBC,EAAa/B,EAAS8B,GAAG,CAAC,oBAAsB,IAChDE,EAAchC,EAAS8B,GAAG,CAAC,qBAAuB,IAExD,GAAI,CAACD,EACJ,OAGD,IAAMI,EAASlC,EAAOmC,WAAW,GAAGC,OAAO,CAAC,MAAO,IAAMC,0BAA0BC,oBAAoB,CAEjGC,EAAQT,EAASU,KAAK,CAAC,KAAKC,MAAM,CAAG,EAAI,IAAM,IAC/CC,EAAQ,GAAArB,MAAA,CAAMS,GAAQT,MAAA,CAAGkB,EAAK,YAAAlB,MAAA,CAAWa,EAAM,UAAAb,MAAA,CAASO,GAExDe,EAAQvC,EAAkBsC,EAAUV,EAAYC,GAEhDW,EAAiBC,YAAY,KAClC,IAAIC,EACJ,GAAI,CAIHA,EAAc,AAAAH,CAAAA,MAAAA,EAAK,KAAA,EAALA,EAAOI,MAAM,AAANA,GAAU,AAAAJ,CAAAA,MAAAA,EAAK,KAAA,EAALA,EAAOI,MAAM,AAANA,IAAWC,KAAAA,EAChD,MAAOC,EAAG,CAKX,OAGGH,IACHI,cAAcN,GAGd7C,EAASoD,eAAe,CAAC,CACxBC,gBAAiB,CAAC,CAAEC,IAAK,CAAEzB,gBAAAA,CAAe,CAAE,EAAG,CAC/C0B,aAAc3B,IAGjB,EAAG,IACJ"}