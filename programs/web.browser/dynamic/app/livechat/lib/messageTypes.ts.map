)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/livechat/lib/messageTypes.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IOmnichannelSystemMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport formatDistance from 'date-fns/formatDistance';\nimport moment from 'moment';\n\nimport { MessageTypes } from '../../ui-utils/lib/MessageTypes';\nimport { t } from '../../utils/lib/i18n';\n\nMessageTypes.registerType({\n\tid: 'livechat_navigation_history',\n\tsystem: true,\n\tmessage: 'New_visitor_navigation',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\thistory: message.navigation\n\t\t\t\t? `${(message.navigation.page.title ? `${message.navigation.page.title} - ` : '') + message.navigation.page.location.href}`\n\t\t\t\t: '',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transfer_history',\n\tsystem: true,\n\tmessage: 'New_chat_transfer',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.transferData) {\n\t\t\treturn {\n\t\t\t\ttransfer: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { comment } = message.transferData;\n\t\tconst commentLabel = comment && comment !== '' ? '_with_a_comment' : '';\n\t\tconst from =\n\t\t\tmessage.transferData.transferredBy && (message.transferData.transferredBy.name || message.transferData.transferredBy.username);\n\t\tconst transferTypes = {\n\t\t\tagent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tdepartment: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_department${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.nextDepartment?.name || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tqueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToAgent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToQueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t};\n\t\treturn {\n\t\t\ttransfer: transferTypes[message.transferData.scope](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transcript_history',\n\tsystem: true,\n\tmessage: 'Livechat_chat_transcript_sent',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.requestData) {\n\t\t\treturn {\n\t\t\t\ttranscript: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { requestData: { type, visitor, user } = { type: 'user' } } = message;\n\t\tconst requestTypes = {\n\t\t\tvisitor: (): string =>\n\t\t\t\tt('Livechat_visitor_transcript_request', {\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t\tuser: (): string =>\n\t\t\t\tt('Livechat_user_sent_chat_transcript_to_visitor', {\n\t\t\t\t\tagent: user?.name || user?.username || '',\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t};\n\n\t\treturn {\n\t\t\ttranscript: requestTypes[type](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_video_call',\n\tsystem: true,\n\tmessage: 'New_videocall_request',\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_webrtc_video_call',\n\trender(message) {\n\t\tif (message.msg === 'ended' && message.webRtcCallEndTs && message.ts) {\n\t\t\treturn t('WebRTC_call_ended_message', {\n\t\t\t\tcallDuration: formatDistance(new Date(message.webRtcCallEndTs), new Date(message.ts)),\n\t\t\t\tendTime: moment(message.webRtcCallEndTs).format('h:mm A'),\n\t\t\t});\n\t\t}\n\t\tif (message.msg === 'declined' && message.webRtcCallEndTs) {\n\t\t\treturn t('WebRTC_call_declined_message');\n\t\t}\n\t\treturn escapeHTML(message.msg);\n\t},\n\tmessage: 'room_changed_type',\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_placed_chat_on_hold',\n\tsystem: true,\n\tmessage: 'Omnichannel_placed_chat_on_hold',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_on_hold_chat_resumed',\n\tsystem: true,\n\tmessage: 'Omnichannel_on_hold_chat_resumed',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n",null],"names":["_objectSpread","escapeHTML","formatDistance","moment","MessageTypes","t","module","link","default","registerType","id","system","message","data","history","navigation","concat","page","title","location","href","transferData","transfer","comment","commentLabel","from","transferredBy","name","username","transferTypes","agent","_message$transferData","_message$transferData2","_message$transferData3","_message$transferData4","to","transferredTo","department","_message$transferData5","_message$transferData6","nextDepartment","queue","autoTransferUnansweredChatsToAgent","_message$transferData7","_message$transferData8","_message$transferData9","_message$transferData10","duration","autoTransferUnansweredChatsToQueue","scope","requestData","transcript","type","visitor","user","requestTypes","guest","render","msg","webRtcCallEndTs","ts","callDuration","Date","endTime","format"],"mappings":"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"}