function module(e,t,i){let a,n,r,l,u,s,c,d;let o=["type"],p=["type"];i.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){a=e}},0),i.link("@babel/runtime/helpers/objectSpread2",{default(e){n=e}},1),i.export({initializeLivechatInquiryStream:()=>C}),i.link("../../../../../client/lib/queryClient",{queryClient(e){r=e}},0),i.link("../../../../../client/lib/utils/callWithErrorHandling",{callWithErrorHandling(e){l=e}},1),i.link("../../../../settings/client",{settings(e){u=e}},2),i.link("../../../../utils/client/lib/SDKClient",{sdk(e){s=e}},3),i.link("../../collections/LivechatInquiry",{LivechatInquiry(e){c=e}},4);let v=new Set,y={added:async e=>{v.has(e.department)&&(c.insert(n(n({},e),{},{alert:!0,_updatedAt:new Date(e._updatedAt)})),await m(e.rid))},changed:async e=>{if("queued"!==e.status||e.department&&!v.has(e.department))return h(e);c.upsert({_id:e._id},n(n({},e),{},{alert:!0,_updatedAt:new Date(e._updatedAt)})),await m(e.rid)},removed:e=>h(e)},m=async e=>{await r.invalidateQueries(["rooms",{reference:e,type:"l"}]),await r.removeQueries(["rooms",e]),await r.removeQueries(["/v1/rooms.info",e])},h=async e=>(await c.remove(e._id),r.invalidateQueries(["rooms",{reference:e.rid,type:"l"}])),w=async()=>{var e;let t=null!==(e=u.get("Livechat_guest_pool_max_number_incoming_livechats_displayed"))&&void 0!==e?e:0,{inquiries:i}=await s.rest.get("/v1/livechat/inquiries.queuedForUser",{count:t});return i},g=e=>{s.stop("livechat-inquiry-queue-observer","department/".concat(e)),v.delete(e)},_=e=>(v.add(e),s.stream("livechat-inquiry-queue-observer",["department/".concat(e)],async e=>{if(!("type"in e))return;let{type:t}=e,i=a(e,o);await y[e.type](i)}),()=>g(e)),b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map(e=>_(e));return()=>t.forEach(e=>e())},f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.forEach(e=>c.upsert({_id:e._id},n(n({},e),{},{_updatedAt:new Date(e._updatedAt)})))},q=async e=>{let{departments:t}=await s.rest.get("/v1/livechat/agents/".concat(e,"/departments"),{enabledDepartmentsOnly:"true"});return t},k=()=>s.stop("livechat-inquiry-queue-observer","public"),A=()=>(s.stream("livechat-inquiry-queue-observer",["public"],async e=>{if(!("type"in e))return;let{type:t}=e,i=a(e,p);await y[e.type](i)}),k),D=async e=>{let t=await l("livechat:getRoutingConfig");if(null!=t&&t.autoAssignAgent)return;let i=(await q(e)).map(e=>e.departmentId),a=b(i),n=A(),r=Tracker.autorun(async()=>{let e=await w();await f(e)});return()=>{c.remove({}),k(),null==a||a(),null==n||n(),v.clear(),r.stop()}},C=async function(){var e;null===(e=d)||void 0===e||e(),d=await D(...arguments)}}
//# sourceMappingURL=/dynamic/app/livechat/client/lib/stream/c5b4b91d4b1f5d16f86e134b777de606bc643bb2.map
