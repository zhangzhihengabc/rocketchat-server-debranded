{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:restivus/lib/restivus.js","meteor://ðŸ’»app/packages/rocketchat:restivus/lib/auth.js","meteor://ðŸ’»app/packages/rocketchat:restivus/lib/iron-router-error-to-response.js","meteor://ðŸ’»app/packages/rocketchat:restivus/lib/json-routes.js","meteor://ðŸ’»app/packages/rocketchat:restivus/lib/route.js"],"names":["_objectSpread","module","link","default","v","export","Restivus","Accounts","Users","Auth","Route","constructor","options","_routes","_config","paths","useDefaultAuth","apiPath","version","prettyJson","auth","token","user","request","headers","_hashLoginToken","userId","defaultHeaders","enableCors","corsHeaders","defaultOptionsEndpoint","response","writeHead","done","startsWith","slice","endsWith","_initAuth","useAuth","console","warn","addRoute","path","endpoints","route","push","addToApi","self","authRequired","post","bodyParams","indexOf","username","email","password","hashed","digest","algorithm","loginWithPassword","e","statusCode","error","authToken","searchQuery","findOne","_id","status","data","extraData","onLoggedIn","call","Object","assign","extra","logout","hashedToken","tokenLocation","index","lastIndexOf","tokenPath","substring","tokenFieldName","tokenToRemove","tokenRemovalQuery","updateOne","$pull","message","onLoggedOut","get","check","Match","Meteor","userValidator","Where","id","Optional","String","keys","length","Error","passwordValidator","OneOf","getUserQuerySelector","authenticatingUserSelector","authenticatingUser","services","undefined","passwordVerification","_checkPasswordAsync","_generateStampedLoginToken","_insertHashedLoginToken","ironRouterSendErrorToResponse","env","process","NODE_ENV","err","req","res","msg","stack","toString","headersSent","socket","destroy","setHeader","Buffer","byteLength","method","end","JsonRoutes","WebApp","connect","Npm","require","connectRoute","connectHandlers","use","urlencoded","limit","json","query","connectRouter","responseHeaders","router","setHeaders","entries","forEach","key","value","add","handler","toLowerCase","next","availableMethods","api","endpoints1","includes","_resolveEndpoints","_configureEndpoints","allowedMethods","filter","rejectedMethods","fullPath","endpoint","responseInitiated","doneFunc","endpointContext","urlParams","params","queryParams","body","responseData","_callEndpoint","_respond","Allow","join","toUpperCase","action","roleRequired","_authAccepted","success","_roleAccepted","_authenticate","userSelector","intersection","roles","reduce","a","b","c","delayInMilliseconds","minimumDelayInMilliseconds","randomMultiplierBetweenOneAndTwo","_lowerCaseKeys","match","JSON","stringify","sendResponse","write","Math","random","setTimeout","object","accumulator"],"mappings":"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","file":"/packages/rocketchat_restivus.js","sourcesContent":["import { Accounts } from 'meteor/accounts-base';\nimport { Users } from '@rocket.chat/models';\n\nimport { Auth } from './auth';\nimport { Route } from './route';\n\nexport class Restivus {\n\tconstructor(options) {\n\t\tthis._routes = [];\n\t\tthis._config = {\n\t\t\tpaths: [],\n\t\t\tuseDefaultAuth: false,\n\t\t\tapiPath: 'api/',\n\t\t\tversion: null,\n\t\t\tprettyJson: false,\n\t\t\tauth: {\n\t\t\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\t\t\tuser() {\n\t\t\t\t\tlet token;\n\t\t\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefaultHeaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tenableCors: true,\n\t\t\t...options,\n\t\t};\n\n\t\tif (this._config.enableCors) {\n\t\t\tconst corsHeaders = {\n\t\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept',\n\t\t\t};\n\t\t\tif (this._config.useDefaultAuth) {\n\t\t\t\tcorsHeaders['Access-Control-Allow-Headers'] += ', X-User-Id, X-Auth-Token';\n\t\t\t}\n\t\t\tthis._config.defaultHeaders = {\n\t\t\t\t...this._config.defaultHeaders,\n\t\t\t\t...corsHeaders,\n\t\t\t};\n\t\t\tif (!this._config.defaultOptionsEndpoint) {\n\t\t\t\tthis._config.defaultOptionsEndpoint = function () {\n\t\t\t\t\tthis.response.writeHead(200, corsHeaders);\n\t\t\t\t\treturn this.done();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif (this._config.apiPath.startsWith('/')) {\n\t\t\tthis._config.apiPath = this._config.apiPath.slice(1);\n\t\t}\n\t\tif (!this._config.apiPath.endsWith('/')) {\n\t\t\tthis._config.apiPath = `${this._config.apiPath}/`;\n\t\t}\n\t\tif (this._config.version) {\n\t\t\tthis._config.apiPath += `${this._config.version}/`;\n\t\t}\n\t\tif (this._config.useDefaultAuth) {\n\t\t\tthis._initAuth();\n\t\t} else if (this._config.useAuth) {\n\t\t\tthis._initAuth();\n\t\t\tconsole.warn('Warning: useAuth API config option will be removed in Restivus v1.0 \\n    Use the useDefaultAuth option instead');\n\t\t}\n\t}\n\n\t/**\n\t \tAdd endpoints for the given HTTP methods at the given path\n\n\t\t@param path {String} The extended URL path (will be appended to base path of the API)\n\t\t@param options {Object} Route configuration options\n\t\t@param options.authRequired {Boolean} The default auth requirement for each endpoint on the route\n\t\t@param options.roleRequired {String or String[]} The default role required for each endpoint on the route\n\t\t@param endpoints {Object} A set of endpoints available on the new route (get, post, put, patch, delete, options)\n\t\t@param endpoints.<method> {Function or Object} If a function is provided, all default route\n\t\t\tconfiguration options will be applied to the endpoint. Otherwise an object with an `action`\n\t\t\tand all other route config options available. An `action` must be provided with the object.\n\t*/\n\n\taddRoute(path, options, endpoints) {\n\t\tconst route = new Route(this, path, options, endpoints);\n\t\tthis._routes.push(route);\n\t\troute.addToApi();\n\t\treturn this;\n\t}\n\n\t/*\n\t\tAdd /login and /logout endpoints to the API\n\t*/\n\n\t_initAuth() {\n\t\tconst self = this;\n\n\t\t/*\n\t\t\tAdd a login endpoint to the API\n\n\t\t\tAfter the user is logged in, the onLoggedIn hook is called (see Restfully.configure() for\n\t\t\tadding hook).\n\t\t*/\n\t\tthis.addRoute(\n\t\t\t'login',\n\t\t\t{ authRequired: false },\n\t\t\t{\n\t\t\t\tasync post() {\n\t\t\t\t\tconst user = {};\n\t\t\t\t\tif (this.bodyParams.user) {\n\t\t\t\t\t\tif (this.bodyParams.user.indexOf('@') === -1) {\n\t\t\t\t\t\t\tuser.username = this.bodyParams.user;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuser.email = this.bodyParams.user;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (this.bodyParams.username) {\n\t\t\t\t\t\tuser.username = this.bodyParams.username;\n\t\t\t\t\t} else if (this.bodyParams.email) {\n\t\t\t\t\t\tuser.email = this.bodyParams.email;\n\t\t\t\t\t}\n\t\t\t\t\tlet { password } = this.bodyParams;\n\t\t\t\t\tif (this.bodyParams.hashed) {\n\t\t\t\t\t\tpassword = {\n\t\t\t\t\t\t\tdigest: password,\n\t\t\t\t\t\t\talgorithm: 'sha-256',\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tlet auth;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tauth = await Auth.loginWithPassword(user, password);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tstatusCode: e.error,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tif (auth.userId && auth.authToken) {\n\t\t\t\t\t\tconst searchQuery = {};\n\t\t\t\t\t\tsearchQuery[self._config.auth.token] = Accounts._hashLoginToken(auth.authToken);\n\t\t\t\t\t\tthis.user = await Users.findOne(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t_id: auth.userId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsearchQuery,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.userId = this.user?._id;\n\t\t\t\t\t}\n\t\t\t\t\tconst response = {\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\tdata: auth,\n\t\t\t\t\t};\n\t\t\t\t\tconst extraData = self._config.onLoggedIn?.call(this);\n\t\t\t\t\tif (extraData != null) {\n\t\t\t\t\t\tObject.assign(response.data, {\n\t\t\t\t\t\t\textra: extraData,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\tconst logout = async function () {\n\t\t\tconst authToken = this.request.headers['x-auth-token'];\n\t\t\tconst hashedToken = Accounts._hashLoginToken(authToken);\n\t\t\tconst tokenLocation = self._config.auth.token;\n\t\t\tconst index = tokenLocation.lastIndexOf('.');\n\t\t\tconst tokenPath = tokenLocation.substring(0, index);\n\t\t\tconst tokenFieldName = tokenLocation.substring(index + 1);\n\t\t\tconst tokenToRemove = {};\n\t\t\ttokenToRemove[tokenFieldName] = hashedToken;\n\t\t\tconst tokenRemovalQuery = {};\n\t\t\ttokenRemovalQuery[tokenPath] = tokenToRemove;\n\t\t\tawait Users.updateOne(\n\t\t\t\t{ _id: this.user._id },\n\t\t\t\t{\n\t\t\t\t\t$pull: tokenRemovalQuery,\n\t\t\t\t},\n\t\t\t);\n\t\t\tconst response = {\n\t\t\t\tstatus: 'success',\n\t\t\t\tdata: {\n\t\t\t\t\tmessage: \"You've been logged out!\",\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst extraData = self._config.onLoggedOut?.call(this);\n\t\t\tif (extraData != null) {\n\t\t\t\tObject.assign(response.data, {\n\t\t\t\t\textra: extraData,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn response;\n\t\t};\n\n\t\t/*\n\t\t\tAdd a logout endpoint to the API\n\n\t\t\tAfter the user is logged out, the onLoggedOut hook is called (see Restfully.configure() for\n\t\t\tadding hook).\n\t\t*/\n\t\treturn this.addRoute(\n\t\t\t'logout',\n\t\t\t{ authRequired: true },\n\t\t\t{\n\t\t\t\tasync get() {\n\t\t\t\t\tconsole.warn('Warning: Default logout via GET will be removed in Restivus v1.0. Use POST instead.');\n\t\t\t\t\tconsole.warn('    See https://github.com/kahmali/meteor-restivus/issues/100');\n\t\t\t\t\treturn logout.call(this);\n\t\t\t\t},\n\t\t\t\tpost: logout,\n\t\t\t},\n\t\t);\n\t}\n}\n","/*\n * decaffeinate suggestions:\n * DS207: Consider shorter variations of null checks\n * DS208: Avoid top-level this\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\n */\n\nimport { Accounts } from 'meteor/accounts-base';\nimport { check, Match } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Users } from '@rocket.chat/models';\n\n/*\n  A valid user will have exactly one of the following identification fields: id, username, or email\n*/\nconst userValidator = Match.Where(function (user) {\n\tcheck(user, {\n\t\tid: Match.Optional(String),\n\t\tusername: Match.Optional(String),\n\t\temail: Match.Optional(String),\n\t});\n\n\tif (Object.keys(user).length !== 1) {\n\t\tthrow new Match.Error('User must have exactly one identifier field');\n\t}\n\n\treturn true;\n});\n\n/*\n  A password can be either in plain text or hashed\n*/\nconst passwordValidator = Match.OneOf(String, {\n\tdigest: String,\n\talgorithm: String,\n});\n\n/*\n  Return a MongoDB query selector for finding the given user\n*/\nconst getUserQuerySelector = function (user) {\n\tif (user.id) {\n\t\treturn { _id: user.id };\n\t}\n\tif (user.username) {\n\t\treturn { username: user.username };\n\t}\n\tif (user.email) {\n\t\treturn { 'emails.address': user.email };\n\t}\n\n\t// We shouldn't be here if the user object was properly validated\n\tthrow new Error('Cannot create selector from invalid user');\n};\n\n/*\n  Log a user in with their password\n*/\nexport class Auth {\n\tasync loginWithPassword(user, password) {\n\t\tif (!user || !password) {\n\t\t\tthrow new Meteor.Error(401, 'Unauthorized');\n\t\t}\n\n\t\t// Validate the login input types\n\t\tcheck(user, userValidator);\n\t\tcheck(password, passwordValidator);\n\n\t\t// Retrieve the user from the database\n\t\tconst authenticatingUserSelector = getUserQuerySelector(user);\n\t\tconst authenticatingUser = await Users.findOne(authenticatingUserSelector);\n\n\t\tif (!authenticatingUser) {\n\t\t\tthrow new Meteor.Error(401, 'Unauthorized');\n\t\t}\n\t\tif (!(authenticatingUser.services != null ? authenticatingUser.services.password : undefined)) {\n\t\t\tthrow new Meteor.Error(401, 'Unauthorized');\n\t\t}\n\n\t\t// Authenticate the user's password\n\t\tconst passwordVerification = await Accounts._checkPasswordAsync(authenticatingUser, password);\n\t\tif (passwordVerification.error) {\n\t\t\tthrow new Meteor.Error(401, 'Unauthorized');\n\t\t}\n\n\t\t// Add a new auth token to the user's account\n\t\tconst authToken = Accounts._generateStampedLoginToken();\n\t\tconst hashedToken = Accounts._hashLoginToken(authToken.token);\n\t\tAccounts._insertHashedLoginToken(authenticatingUser._id, { hashedToken });\n\n\t\treturn { authToken: authToken.token, userId: authenticatingUser._id };\n\t}\n}\n","// We need a function that treats thrown errors exactly like Iron Router would.\n// This file is written in JavaScript to enable copy-pasting Iron Router code.\n\n// Taken from: https://github.com/iron-meteor/iron-router/blob/9c369499c98af9fd12ef9e68338dee3b1b1276aa/lib/router_server.js#L3\nconst env = process.env.NODE_ENV || 'development';\n\n// Taken from: https://github.com/iron-meteor/iron-router/blob/9c369499c98af9fd12ef9e68338dee3b1b1276aa/lib/router_server.js#L47\nexport function ironRouterSendErrorToResponse(err, req, res) {\n\tif (res.statusCode < 400) res.statusCode = 500;\n\n\tif (err.status) res.statusCode = err.status;\n\n\tlet msg;\n\tif (env === 'development') msg = `${err.stack || err.toString()}\\n`;\n\t// XXX get this from standard dict of error messages?\n\telse msg = 'Server error.';\n\n\tconsole.error(err.stack || err.toString());\n\n\tif (res.headersSent) return req.socket.destroy();\n\n\tres.setHeader('Content-Type', 'text/html');\n\tres.setHeader('Content-Length', Buffer.byteLength(msg));\n\tif (req.method === 'HEAD') return res.end();\n\tres.end(msg);\n}\n","import { WebApp } from 'meteor/webapp';\n\nconst connect = Npm.require('connect');\nconst connectRoute = Npm.require('connect-route');\n\nWebApp.connectHandlers.use(connect.urlencoded({ limit: '50mb' })); // Override default request size\nWebApp.connectHandlers.use(connect.json({ limit: '50mb' })); // Override default request size\nWebApp.connectHandlers.use(connect.query());\n\n// Save reference to router for later\nlet connectRouter;\n\nconst responseHeaders = {\n\t'Cache-Control': 'no-store',\n\t'Pragma': 'no-cache',\n};\n\n// Register as a middleware\nWebApp.connectHandlers.use(\n\tconnectRoute(function (router) {\n\t\tconnectRouter = router;\n\t}),\n);\n\nfunction setHeaders(res, headers) {\n\tObject.entries(headers).forEach(([key, value]) => {\n\t\tres.setHeader(key, value);\n\t});\n}\n\nexport const JsonRoutes = {\n\tadd(method, path, handler) {\n\t\t// Make sure path starts with a slash\n\t\tif (path[0] !== '/') {\n\t\t\tpath = `/${path}`;\n\t\t}\n\n\t\tconnectRouter[method.toLowerCase()](path, async (req, res, next) => {\n\t\t\t// Set headers on response\n\t\t\tsetHeaders(res, responseHeaders);\n\n\t\t\ttry {\n\t\t\t\tawait handler(req, res, next);\n\t\t\t} catch (error) {\n\t\t\t\tnext(error);\n\t\t\t}\n\t\t});\n\t},\n};\n","import { Users } from '@rocket.chat/models';\n\nimport { ironRouterSendErrorToResponse } from './iron-router-error-to-response';\nimport { JsonRoutes } from './json-routes';\n\nconst availableMethods = ['get', 'post', 'put', 'patch', 'delete', 'options'];\n\nexport class Route {\n\tconstructor(api, path, options, endpoints1) {\n\t\tthis.api = api;\n\t\tthis.path = path;\n\t\tthis.options = options;\n\t\tthis.endpoints = endpoints1;\n\t\tif (!this.endpoints) {\n\t\t\tthis.endpoints = this.options;\n\t\t\tthis.options = {};\n\t\t}\n\t}\n\n\taddToApi() {\n\t\tconst self = this;\n\t\tif (this.api._config.paths.includes(this.path)) {\n\t\t\tthrow new Error(`Cannot add a route at an existing path: ${this.path}`);\n\t\t}\n\t\tthis.endpoints = {\n\t\t\toptions: this.api._config.defaultOptionsEndpoint,\n\t\t\t...this.endpoints,\n\t\t};\n\t\tthis._resolveEndpoints();\n\t\tthis._configureEndpoints();\n\t\tthis.api._config.paths.push(this.path);\n\t\tconst allowedMethods = availableMethods.filter(function (method) {\n\t\t\treturn Object.keys(self.endpoints).includes(method);\n\t\t});\n\t\tconst rejectedMethods = availableMethods.filter(function (method) {\n\t\t\treturn !Object.keys(self.endpoints).includes(method);\n\t\t});\n\t\tconst fullPath = this.api._config.apiPath + this.path;\n\t\tallowedMethods.forEach(function (method) {\n\t\t\tconst endpoint = self.endpoints[method];\n\t\t\treturn JsonRoutes.add(method, fullPath, async function (req, res) {\n\t\t\t\tlet responseInitiated = false;\n\t\t\t\tconst doneFunc = function () {\n\t\t\t\t\tresponseInitiated = true;\n\t\t\t\t};\n\t\t\t\tconst endpointContext = {\n\t\t\t\t\turlParams: req.params,\n\t\t\t\t\tqueryParams: req.query,\n\t\t\t\t\tbodyParams: req.body,\n\t\t\t\t\trequest: req,\n\t\t\t\t\tresponse: res,\n\t\t\t\t\tdone: doneFunc,\n\t\t\t\t\t...endpoint,\n\t\t\t\t};\n\t\t\t\tlet responseData = null;\n\t\t\t\ttry {\n\t\t\t\t\tresponseData = await self._callEndpoint(endpointContext, endpoint);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tironRouterSendErrorToResponse(e, req, res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (responseInitiated) {\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (res.headersSent) {\n\t\t\t\t\tthrow new Error(`Must call this.done() after handling endpoint response manually: ${method} ${fullPath}`);\n\t\t\t\t} else if (responseData === null || responseData === void 0) {\n\t\t\t\t\tthrow new Error(`Cannot return null or undefined from an endpoint: ${method} ${fullPath}`);\n\t\t\t\t}\n\t\t\t\tif (responseData.body && (responseData.statusCode || responseData.headers)) {\n\t\t\t\t\treturn self._respond(res, responseData.body, responseData.statusCode, responseData.headers);\n\t\t\t\t}\n\t\t\t\treturn self._respond(res, responseData);\n\t\t\t});\n\t\t});\n\t\treturn rejectedMethods.forEach(function (method) {\n\t\t\treturn JsonRoutes.add(method, fullPath, function (req, res) {\n\t\t\t\tconst responseData = {\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\tmessage: 'API endpoint does not exist',\n\t\t\t\t};\n\t\t\t\tconst headers = {\n\t\t\t\t\tAllow: allowedMethods.join(', ').toUpperCase(),\n\t\t\t\t};\n\t\t\t\treturn self._respond(res, responseData, 405, headers);\n\t\t\t});\n\t\t});\n\t}\n\n\t/*\n\t\tConvert all endpoints on the given route into our expected endpoint object if it is a bare\n\t\tfunction\n\n\t\t@param {Route} route The route the endpoints belong to\n\t\t*/\n\n\t_resolveEndpoints() {\n\t\tObject.entries(this.endpoints).forEach(([method, endpoint]) => {\n\t\t\tif (typeof endpoint === 'function') {\n\t\t\t\tthis.endpoints[method] = {\n\t\t\t\t\taction: endpoint,\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n\t\tConfigure the authentication and role requirement on all endpoints (except OPTIONS, which must\n\t\tbe configured directly on the endpoint)\n\n\t\tAuthentication can be required on an entire route or individual endpoints. If required on an\n\t\tentire route, that serves as the default. If required in any individual endpoints, that will\n\t\toverride the default.\n\n\t\tAfter the endpoint is configured, all authentication and role requirements of an endpoint can be\n\t\taccessed at <code>endpoint.authRequired</code> and <code>endpoint.roleRequired</code>,\n\t\trespectively.\n\n\t\t@param {Route} route The route the endpoints belong to\n\t\t@param {Endpoint} endpoint The endpoint to configure\n\t\t*/\n\n\t_configureEndpoints() {\n\t\tObject.entries(this.endpoints).forEach(([method, endpoint]) => {\n\t\t\tif (method !== 'options') {\n\t\t\t\tif (!this.options?.roleRequired) {\n\t\t\t\t\tthis.options.roleRequired = [];\n\t\t\t\t}\n\t\t\t\tif (!endpoint.roleRequired) {\n\t\t\t\t\tendpoint.roleRequired = [];\n\t\t\t\t}\n\t\t\t\tendpoint.roleRequired = [...endpoint.roleRequired, ...this.options.roleRequired];\n\t\t\t\tif (endpoint.roleRequired.length === 0) {\n\t\t\t\t\tendpoint.roleRequired = false;\n\t\t\t\t}\n\t\t\t\tif (endpoint.authRequired === void 0) {\n\t\t\t\t\tif (this.options?.authRequired || endpoint.roleRequired) {\n\t\t\t\t\t\tendpoint.authRequired = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendpoint.authRequired = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n\t\tAuthenticate an endpoint if required, and return the result of calling it\n\n\t\t@returns The endpoint response or a 401 if authentication fails\n\t\t*/\n\n\tasync _callEndpoint(endpointContext, endpoint) {\n\t\tconst auth = await this._authAccepted(endpointContext, endpoint);\n\t\tif (auth.success) {\n\t\t\tif (this._roleAccepted(endpointContext, endpoint)) {\n\t\t\t\treturn endpoint.action.call(endpointContext);\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tstatusCode: 403,\n\t\t\t\tbody: {\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\tmessage: 'You do not have permission to do this.',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tif (auth.data) {\n\t\t\treturn auth.data;\n\t\t}\n\t\treturn {\n\t\t\tstatusCode: 401,\n\t\t\tbody: {\n\t\t\t\tstatus: 'error',\n\t\t\t\tmessage: 'You must be logged in to do this.',\n\t\t\t},\n\t\t};\n\t}\n\n\t/*\n\t\tAuthenticate the given endpoint if required\n\n\t\tOnce it's globally configured in the API, authentication can be required on an entire route or\n\t\tindividual endpoints. If required on an entire endpoint, that serves as the default. If required\n\t\tin any individual endpoints, that will override the default.\n\n\t\t@returns An object of the following format:\n\n\t\t\t\t{\n\t\t\t\t\tsuccess: Boolean\n\t\t\t\t\tdata: String or Object\n\t\t\t\t}\n\n\t\t\twhere `success` is `true` if all required authentication checks pass and the optional `data`\n\t\t\twill contain the auth data when successful and an optional error response when auth fails.\n\t\t*/\n\n\tasync _authAccepted(endpointContext, endpoint) {\n\t\tif (endpoint.authRequired) {\n\t\t\treturn this._authenticate(endpointContext);\n\t\t}\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t};\n\t}\n\n\t/*\n\t\tVerify the request is being made by an actively logged in user\n\n\t\tIf verified, attach the authenticated user to the context.\n\n\t\t@returns An object of the following format:\n\n\t\t\t\t{\n\t\t\t\t\tsuccess: Boolean\n\t\t\t\t\tdata: String or Object\n\t\t\t\t}\n\n\t\t\twhere `success` is `true` if all required authentication checks pass and the optional `data`\n\t\t\twill contain the auth data when successful and an optional error response when auth fails.\n\t\t*/\n\n\tasync _authenticate(endpointContext) {\n\t\tconst auth = await this.api._config.auth.user.call(endpointContext);\n\t\tif (!auth) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t};\n\t\t}\n\t\tif (auth.userId && auth.token && !auth.user) {\n\t\t\tconst userSelector = {};\n\t\t\tuserSelector._id = auth.userId;\n\t\t\tuserSelector[this.api._config.auth.token] = auth.token;\n\t\t\tauth.user = await Users.findOne(userSelector);\n\t\t}\n\t\tif (auth.error) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tdata: auth.error,\n\t\t\t};\n\t\t}\n\t\tif (auth.user) {\n\t\t\tendpointContext.user = auth.user;\n\t\t\tendpointContext.userId = auth.user._id;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: auth,\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t};\n\t}\n\n\t/*\n\t\tAuthenticate the user role if required\n\n\t\tMust be called after _authAccepted().\n\n\t\t@returns True if the authenticated user belongs to <i>any</i> of the acceptable roles on the\n\t\t\t\t\t\t\tendpoint\n\t\t*/\n\n\t_roleAccepted(endpointContext, endpoint) {\n\t\tif (endpoint.roleRequired) {\n\t\t\tconst intersection = [endpoint.roleRequired, endpointContext.user.roles].reduce((a, b) => a.filter((c) => b.includes(c)));\n\t\t\tif (intersection.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/*\n\t\tRespond to an HTTP request\n\t\t*/\n\n\t_respond(response, body, statusCode, headers) {\n\t\tlet delayInMilliseconds;\n\t\tlet minimumDelayInMilliseconds;\n\t\tlet randomMultiplierBetweenOneAndTwo;\n\t\tif (statusCode == null) {\n\t\t\tstatusCode = 200;\n\t\t}\n\t\tif (headers == null) {\n\t\t\theaders = {};\n\t\t}\n\t\tconst defaultHeaders = this._lowerCaseKeys(this.api._config.defaultHeaders);\n\t\theaders = this._lowerCaseKeys(headers);\n\t\theaders = { ...defaultHeaders, ...headers };\n\t\tif (headers['content-type'].match(/json|javascript/) !== null) {\n\t\t\tif (this.api._config.prettyJson) {\n\t\t\t\tbody = JSON.stringify(body, void 0, 2);\n\t\t\t} else {\n\t\t\t\tbody = JSON.stringify(body);\n\t\t\t}\n\t\t}\n\t\tconst sendResponse = function () {\n\t\t\tresponse.writeHead(statusCode, headers);\n\t\t\tresponse.write(body);\n\t\t\treturn response.end();\n\t\t};\n\t\tif (statusCode === 401 || statusCode === 403) {\n\t\t\tminimumDelayInMilliseconds = 500;\n\t\t\trandomMultiplierBetweenOneAndTwo = 1 + Math.random();\n\t\t\tdelayInMilliseconds = minimumDelayInMilliseconds * randomMultiplierBetweenOneAndTwo;\n\t\t\treturn setTimeout(sendResponse, delayInMilliseconds);\n\t\t}\n\t\treturn sendResponse();\n\t}\n\n\t/*\n\t\tReturn the object with all of the keys converted to lowercase\n\t\t*/\n\n\t_lowerCaseKeys(object) {\n\t\treturn Object.keys(object).reduce((accumulator, key) => {\n\t\t\taccumulator[key.toLowerCase()] = object[key];\n\t\t\treturn accumulator;\n\t\t}, {});\n\t}\n}\n"]}