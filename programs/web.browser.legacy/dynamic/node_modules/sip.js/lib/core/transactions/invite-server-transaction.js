function module(e,t,s){var r,i,n,o;s.export({InviteServerTransaction:function(){return a}}),s.link("../messages",{C:function(e){r=e}},0),s.link("../timers",{Timers:function(e){i=e}},1),s.link("./server-transaction",{ServerTransaction:function(e){n=e}},2),s.link("./transaction-state",{TransactionState:function(e){o=e}},3);class a extends n{constructor(e,t,s){super(e,t,s,o.Proceeding,"sip.transaction.ist")}dispose(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),super.dispose()}get kind(){return"ist"}receiveRequest(e){switch(this.state){case o.Proceeding:if(e.method===r.INVITE){this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch(e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")});return}break;case o.Accepted:if(e.method===r.INVITE)return;break;case o.Completed:if(e.method===r.INVITE){if(!this.lastFinalResponse)throw Error("Last final response undefined.");this.send(this.lastFinalResponse).catch(e=>{this.logTransportError(e,"Failed to send retransmission of final response.")});return}if(e.method===r.ACK){this.stateTransition(o.Confirmed);return}break;case o.Confirmed:case o.Terminated:if(e.method===r.INVITE||e.method===r.ACK)return;break;default:throw Error(`Invalid state ${this.state}`)}let t=`INVITE server transaction received unexpected ${e.method} request while in state ${this.state}.`;this.logger.warn(t)}receiveResponse(e,t){if(e<100||e>699)throw Error(`Invalid status code ${e}`);switch(this.state){case o.Proceeding:if(e>=100&&e<=199){this.lastProvisionalResponse=t,e>100&&this.startProgressExtensionTimer(),this.send(t).catch(e=>{this.logTransportError(e,"Failed to send 1xx response.")});return}if(e>=200&&e<=299){this.lastFinalResponse=t,this.stateTransition(o.Accepted),this.send(t).catch(e=>{this.logTransportError(e,"Failed to send 2xx response.")});return}if(e>=300&&e<=699){this.lastFinalResponse=t,this.stateTransition(o.Completed),this.send(t).catch(e=>{this.logTransportError(e,"Failed to send non-2xx final response.")});return}break;case o.Accepted:if(e>=200&&e<=299){this.send(t).catch(e=>{this.logTransportError(e,"Failed to send 2xx response.")});return}break;case o.Completed:case o.Confirmed:case o.Terminated:break;default:throw Error(`Invalid state ${this.state}`)}let s=`INVITE server transaction received unexpected ${e} response from TU while in state ${this.state}.`;throw this.logger.error(s),Error(s)}retransmitAcceptedResponse(){this.state===o.Accepted&&this.lastFinalResponse&&this.send(this.lastFinalResponse).catch(e=>{this.logTransportError(e,"Failed to send 2xx response.")})}onTransportError(e){this.user.onTransportError&&this.user.onTransportError(e)}typeToString(){return"INVITE server transaction"}stateTransition(e){let t=()=>{throw Error(`Invalid state transition from ${this.state} to ${e}`)};switch(e){case o.Proceeding:t();break;case o.Accepted:case o.Completed:this.state!==o.Proceeding&&t();break;case o.Confirmed:this.state!==o.Completed&&t();break;case o.Terminated:this.state!==o.Accepted&&this.state!==o.Completed&&this.state!==o.Confirmed&&t();break;default:t()}this.stopProgressExtensionTimer(),e===o.Accepted&&(this.L=setTimeout(()=>this.timerL(),i.TIMER_L)),e===o.Completed&&(this.H=setTimeout(()=>this.timerH(),i.TIMER_H)),e===o.Confirmed&&(this.I=setTimeout(()=>this.timerI(),i.TIMER_I)),e===o.Terminated&&this.dispose(),this.setState(e)}startProgressExtensionTimer(){void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval(()=>{if(this.logger.debug(`Progress extension timer expired for INVITE server transaction ${this.id}.`),!this.lastProvisionalResponse)throw Error("Last provisional response undefined.");this.send(this.lastProvisionalResponse).catch(e=>{this.logTransportError(e,"Failed to send retransmission of provisional response.")})},i.PROVISIONAL_RESPONSE_INTERVAL))}stopProgressExtensionTimer(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)}timerG(){}timerH(){this.logger.debug(`Timer H expired for INVITE server transaction ${this.id}.`),this.state===o.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(o.Terminated))}timerI(){this.logger.debug(`Timer I expired for INVITE server transaction ${this.id}.`),this.stateTransition(o.Terminated)}timerL(){this.logger.debug(`Timer L expired for INVITE server transaction ${this.id}.`),this.state===o.Accepted&&this.stateTransition(o.Terminated)}}}
//# sourceMappingURL=/dynamic/node_modules/sip.js/lib/core/transactions/a448eda1c49d5c647119e5274c9a81b4e6fdc426.map
