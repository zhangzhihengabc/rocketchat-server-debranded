function module(e,t,r){var o,a;r.export({Dialog:function(){return i}}),r.link("../messages",{C:function(e){o=e},NameAddrHeader:function(e){a=e}},0);class i{constructor(e,t){this.core=e,this.dialogState=t,this.core.dialogs.set(this.id,this)}static initialDialogStateForUserAgentClient(e,t){let r=t.getHeaders("record-route").reverse(),o=t.parseHeader("contact");if(!o)throw Error("Contact undefined.");if(!(o instanceof a))throw Error("Contact not instance of NameAddrHeader.");let i=o.uri,u=e.cseq,s=e.callId,n=e.fromTag,l=t.toTag;if(!s)throw Error("Call id undefined.");if(!n)throw Error("From tag undefined.");if(!l)throw Error("To tag undefined.");if(!e.from)throw Error("From undefined.");if(!e.to)throw Error("To undefined.");let c=e.from.uri,d=e.to.uri;if(!t.statusCode)throw Error("Incoming response status code undefined.");let g=t.statusCode<200;return{id:s+n+l,early:g,callId:s,localTag:n,remoteTag:l,localSequenceNumber:u,remoteSequenceNumber:void 0,localURI:c,remoteURI:d,remoteTarget:i,routeSet:r,secure:!1}}static initialDialogStateForUserAgentServer(e,t,r=!1){let o=e.getHeaders("record-route"),i=e.parseHeader("contact");if(!i)throw Error("Contact undefined.");if(!(i instanceof a))throw Error("Contact not instance of NameAddrHeader.");let u=i.uri,s=e.cseq,n=e.callId,l=e.fromTag,c=e.from.uri,d=e.to.uri;return{id:n+t+l,early:r,callId:n,localTag:t,remoteTag:l,localSequenceNumber:void 0,remoteSequenceNumber:s,localURI:d,remoteURI:c,remoteTarget:u,routeSet:o,secure:!1}}dispose(){this.core.dialogs.delete(this.id)}get id(){return this.dialogState.id}get early(){return this.dialogState.early}get callId(){return this.dialogState.callId}get localTag(){return this.dialogState.localTag}get remoteTag(){return this.dialogState.remoteTag}get localSequenceNumber(){return this.dialogState.localSequenceNumber}get remoteSequenceNumber(){return this.dialogState.remoteSequenceNumber}get localURI(){return this.dialogState.localURI}get remoteURI(){return this.dialogState.remoteURI}get remoteTarget(){return this.dialogState.remoteTarget}get routeSet(){return this.dialogState.routeSet}get secure(){return this.dialogState.secure}get userAgentCore(){return this.core}confirm(){this.dialogState.early=!1}receiveRequest(e){if(e.method!==o.ACK){if(this.remoteSequenceNumber){if(e.cseq<=this.remoteSequenceNumber)throw Error("Out of sequence in dialog request. Did you forget to call sequenceGuard()?");this.dialogState.remoteSequenceNumber=e.cseq}this.remoteSequenceNumber||(this.dialogState.remoteSequenceNumber=e.cseq)}}recomputeRouteSet(e){this.dialogState.routeSet=e.getHeaders("record-route").reverse()}createOutgoingRequestMessage(e,t){let r;let o=this.remoteURI,a=this.remoteTag,i=this.localURI,u=this.localTag,s=this.callId;r=t&&t.cseq?t.cseq:this.dialogState.localSequenceNumber?this.dialogState.localSequenceNumber+=1:this.dialogState.localSequenceNumber=1;let n=this.remoteTarget,l=this.routeSet,c=t&&t.extraHeaders,d=t&&t.body,g=this.userAgentCore.makeOutgoingRequestMessage(e,n,i,o,{callId:s,cseq:r,fromTag:u,toTag:a,routeSet:l},c,d);return g}incrementLocalSequenceNumber(){if(!this.dialogState.localSequenceNumber)throw Error("Local sequence number undefined.");this.dialogState.localSequenceNumber+=1}sequenceGuard(e){return e.method===o.ACK||!this.remoteSequenceNumber||!(e.cseq<=this.remoteSequenceNumber)||(this.core.replyStateless(e,{statusCode:500}),!1)}}}
//# sourceMappingURL=/dynamic/node_modules/sip.js/lib/core/dialogs/8ec4f0080bd114e6d441e9fefe9144c242b5eeb4.map
