function module(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getData=t.KeywordCxt=t.validateFunctionCode=void 0;let a=e("./boolSchema"),r=e("./dataType"),s=e("./applicability"),i=e("./dataType"),n=e("./defaults"),o=e("./keyword"),l=e("./subschema"),d=e("../codegen"),u=e("../names"),c=e("../resolve"),f=e("../util"),h=e("../errors");function m({gen:e,validateName:t,schema:a,schemaEnv:r,opts:s},i){s.code.es5?e.func(t,(0,d._)`${u.default.data}, ${u.default.valCxt}`,r.$async,()=>{e.code((0,d._)`"use strict"; ${p(a,s)}`),function(e,t){e.if(u.default.valCxt,()=>{e.var(u.default.instancePath,(0,d._)`${u.default.valCxt}.${u.default.instancePath}`),e.var(u.default.parentData,(0,d._)`${u.default.valCxt}.${u.default.parentData}`),e.var(u.default.parentDataProperty,(0,d._)`${u.default.valCxt}.${u.default.parentDataProperty}`),e.var(u.default.rootData,(0,d._)`${u.default.valCxt}.${u.default.rootData}`),t.dynamicRef&&e.var(u.default.dynamicAnchors,(0,d._)`${u.default.valCxt}.${u.default.dynamicAnchors}`)},()=>{e.var(u.default.instancePath,(0,d._)`""`),e.var(u.default.parentData,(0,d._)`undefined`),e.var(u.default.parentDataProperty,(0,d._)`undefined`),e.var(u.default.rootData,u.default.data),t.dynamicRef&&e.var(u.default.dynamicAnchors,(0,d._)`{}`)})}(e,s),e.code(i)}):e.func(t,(0,d._)`${u.default.data}, ${(0,d._)`{${u.default.instancePath}="", ${u.default.parentData}, ${u.default.parentDataProperty}, ${u.default.rootData}=${u.default.data}${s.dynamicRef?(0,d._)`, ${u.default.dynamicAnchors}={}`:d.nil}}={}`}`,r.$async,()=>e.code(p(a,s)).code(i))}function p(e,t){let a="object"==typeof e&&e[t.schemaId];return a&&(t.code.source||t.code.process)?(0,d._)`/*# sourceURL=${a} */`:d.nil}function $({schema:e,self:t}){if("boolean"==typeof e)return!e;for(let a in e)if(t.RULES.all[a])return!0;return!1}function y(e){return"boolean"!=typeof e.schema}function v(e){(0,f.checkUnknownRules)(e),function(e){let{schema:t,errSchemaPath:a,opts:r,self:s}=e;t.$ref&&r.ignoreKeywordsWithRef&&(0,f.schemaHasRulesButRef)(t,s.RULES)&&s.logger.warn(`$ref: keywords ignored in schema at path "${a}"`)}(e)}function g(e,t){if(e.opts.jtd)return E(e,[],!1,t);let a=(0,r.getSchemaTypes)(e.schema),s=(0,r.coerceAndCheckDataType)(e,a);E(e,a,!s,t)}function _({gen:e,schemaEnv:t,schema:a,errSchemaPath:r,opts:s}){let i=a.$comment;if(!0===s.$comment)e.code((0,d._)`${u.default.self}.logger.log(${i})`);else if("function"==typeof s.$comment){let a=(0,d.str)`${r}/$comment`,s=e.scopeValue("root",{ref:t.root});e.code((0,d._)`${u.default.self}.opts.$comment(${i}, ${a}, ${s}.schema)`)}}function E(e,t,a,r){var n,o,l,c;let{gen:h,schema:m,data:p,allErrors:$,opts:y,self:v}=e,{RULES:g}=v;if(m.$ref&&(y.ignoreKeywordsWithRef||!(0,f.schemaHasRulesButRef)(m,g))){h.block(()=>D(e,"$ref",g.all.$ref.definition));return}function _(n){(0,s.shouldUseGroup)(m,n)&&(n.type?(h.if((0,i.checkDataType)(n.type,p,y.strictNumbers)),w(e,n),1===t.length&&t[0]===n.type&&a&&(h.else(),(0,i.reportTypeError)(e)),h.endIf()):w(e,n),$||h.if((0,d._)`${u.default.errors} === ${r||0}`))}y.jtd||!e.schemaEnv.meta&&e.opts.strictTypes&&(function(e,t){if(t.length){if(!e.dataTypes.length){e.dataTypes=t;return}t.forEach(t=>{b(e.dataTypes,t)||k(e,`type "${t}" not allowed by context "${e.dataTypes.join(",")}"`)}),function(e,t){let a=[];for(let r of e.dataTypes)b(t,r)?a.push(r):t.includes("integer")&&"number"===r&&a.push("integer");e.dataTypes=a}(e,t)}}(e,t),e.opts.allowUnionTypes||t.length>1&&!(2===t.length&&t.includes("null"))&&k(e,"use allowUnionTypes to allow union type keyword"),function(e,t){let a=e.self.RULES.all;for(let r in a){let i=a[r];if("object"==typeof i&&(0,s.shouldUseRule)(e.schema,i)){let{type:a}=i.definition;a.length&&!a.some(e=>{var a,r;return t.includes(e)||"number"===e&&t.includes("integer")})&&k(e,`missing type "${a.join(",")}" for keyword "${r}"`)}}}(e,e.dataTypes)),h.block(()=>{for(let e of g.rules)_(e);_(g.post)})}function w(e,t){let{gen:a,schema:r,opts:{useDefaults:i}}=e;i&&(0,n.assignDefaults)(e,t.type),a.block(()=>{for(let a of t.rules)(0,s.shouldUseRule)(r,a)&&D(e,a.keyword,a.definition,t.type)})}function b(e,t){return e.includes(t)||"integer"===t&&e.includes("number")}function k(e,t){let a=e.schemaEnv.baseId+e.errSchemaPath;t+=` at "${a}" (strictTypes)`,(0,f.checkStrictMode)(e,t,e.opts.strictTypes)}t.validateFunctionCode=function(e){if(y(e)&&(v(e),$(e))){!function(e){let{schema:t,opts:a,gen:r}=e;m(e,()=>{a.$comment&&t.$comment&&_(e),function(e){let{schema:t,opts:a}=e;void 0!==t.default&&a.useDefaults&&a.strictSchema&&(0,f.checkStrictMode)(e,"default is ignored in the schema root")}(e),r.let(u.default.vErrors,null),r.let(u.default.errors,0),a.unevaluated&&function(e){let{gen:t,validateName:a}=e;e.evaluated=t.const("evaluated",(0,d._)`${a}.evaluated`),t.if((0,d._)`${e.evaluated}.dynamicProps`,()=>t.assign((0,d._)`${e.evaluated}.props`,(0,d._)`undefined`)),t.if((0,d._)`${e.evaluated}.dynamicItems`,()=>t.assign((0,d._)`${e.evaluated}.items`,(0,d._)`undefined`))}(e),g(e),function(e){let{gen:t,schemaEnv:a,validateName:r,ValidationError:s,opts:i}=e;a.$async?t.if((0,d._)`${u.default.errors} === 0`,()=>t.return(u.default.data),()=>t.throw((0,d._)`new ${s}(${u.default.vErrors})`)):(t.assign((0,d._)`${r}.errors`,u.default.vErrors),i.unevaluated&&function({gen:e,evaluated:t,props:a,items:r}){a instanceof d.Name&&e.assign((0,d._)`${t}.props`,a),r instanceof d.Name&&e.assign((0,d._)`${t}.items`,r)}(e),t.return((0,d._)`${u.default.errors} === 0`))}(e)})}(e);return}m(e,()=>(0,a.topBoolOrEmptySchema)(e))};class T{constructor(e,t,a){if((0,o.validateKeywordUsage)(e,t,a),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=a,this.data=e.data,this.schema=e.schema[a],this.$data=t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,f.schemaRefOrVal)(e,this.schema,a,this.$data),this.schemaType=t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=t,this.$data)this.schemaCode=e.gen.const("vSchema",R(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,o.validSchemaType)(this.schema,t.schemaType,t.allowUndefined))throw Error(`${a} value must be ${JSON.stringify(t.schemaType)}`);("code"in t?t.trackErrors:!1!==t.errors)&&(this.errsCount=e.gen.const("_errs",u.default.errors))}result(e,t,a){this.failResult((0,d.not)(e),t,a)}failResult(e,t,a){this.gen.if(e),a?a():this.error(),t?(this.gen.else(),t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,t){this.failResult((0,d.not)(e),void 0,t)}fail(e){if(void 0===e){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:t}=this;this.fail((0,d._)`${t} !== undefined && (${(0,d.or)(this.invalid$data(),e)})`)}error(e,t,a){if(t){this.setParams(t),this._error(e,a),this.setParams({});return}this._error(e,a)}_error(e,t){(e?h.reportExtraError:h.reportError)(this,this.def.error,t)}$dataError(){(0,h.reportError)(this,this.def.$dataError||h.keyword$DataError)}reset(){if(void 0===this.errsCount)throw Error('add "trackErrors" to keyword definition');(0,h.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,t){t?Object.assign(this.params,e):this.params=e}block$data(e,t,a=d.nil){this.gen.block(()=>{this.check$data(e,a),t()})}check$data(e=d.nil,t=d.nil){if(!this.$data)return;let{gen:a,schemaCode:r,schemaType:s,def:i}=this;a.if((0,d.or)((0,d._)`${r} === undefined`,t)),e!==d.nil&&a.assign(e,!0),(s.length||i.validateSchema)&&(a.elseIf(this.invalid$data()),this.$dataError(),e!==d.nil&&a.assign(e,!1)),a.else()}invalid$data(){let{gen:e,schemaCode:t,schemaType:a,def:r,it:s}=this;return(0,d.or)(function(){if(a.length){if(!(t instanceof d.Name))throw Error("ajv implementation error");let e=Array.isArray(a)?a:[a];return(0,d._)`${(0,i.checkDataTypes)(e,t,s.opts.strictNumbers,i.DataType.Wrong)}`}return d.nil}(),function(){if(r.validateSchema){let a=e.scopeValue("validate$data",{ref:r.validateSchema});return(0,d._)`!${a}(${t})`}return d.nil}())}subschema(e,t){let r=(0,l.getSubschema)(this.it,e);(0,l.extendSubschemaData)(r,this.it,e),(0,l.extendSubschemaMode)(r,e);let s={...this.it,...r,items:void 0,props:void 0};return!function(e,t){if(y(e)&&(v(e),$(e))){(function(e,t){let{schema:a,gen:r,opts:s}=e;s.$comment&&a.$comment&&_(e),function(e){let t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,c.resolveUrl)(e.opts.uriResolver,e.baseId,t))}(e),function(e){if(e.schema.$async&&!e.schemaEnv.$async)throw Error("async schema in sync schema")}(e);let i=r.const("_errs",u.default.errors);g(e,i),r.var(t,(0,d._)`${i} === ${u.default.errors}`)})(e,t);return}(0,a.boolOrEmptySchema)(e,t)}(s,t),s}mergeEvaluated(e,t){let{it:a,gen:r}=this;a.opts.unevaluated&&(!0!==a.props&&void 0!==e.props&&(a.props=f.mergeEvaluated.props(r,e.props,a.props,t)),!0!==a.items&&void 0!==e.items&&(a.items=f.mergeEvaluated.items(r,e.items,a.items,t)))}mergeValidEvaluated(e,t){let{it:a,gen:r}=this;if(a.opts.unevaluated&&(!0!==a.props||!0!==a.items))return r.if(t,()=>this.mergeEvaluated(e,d.Name)),!0}}function D(e,t,a,r){let s=new T(e,a,t);"code"in a?a.code(s,r):s.$data&&a.validate?(0,o.funcKeywordCode)(s,a):"macro"in a?(0,o.macroKeywordCode)(s,a):(a.compile||a.validate)&&(0,o.funcKeywordCode)(s,a)}t.KeywordCxt=T;let S=/^\/(?:[^~]|~0|~1)*$/,C=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function R(e,{dataLevel:t,dataNames:a,dataPathArr:r}){let s,i;if(""===e)return u.default.rootData;if("/"===e[0]){if(!S.test(e))throw Error(`Invalid JSON-pointer: ${e}`);s=e,i=u.default.rootData}else{let n=C.exec(e);if(!n)throw Error(`Invalid JSON-pointer: ${e}`);let o=+n[1];if("#"===(s=n[2])){if(o>=t)throw Error(l("property/index",o));return r[t-o]}if(o>t)throw Error(l("data",o));if(i=a[t-o],!s)return i}let n=i,o=s.split("/");for(let e of o)e&&(n=(0,d._)`${n} && ${i=(0,d._)`${i}${(0,d.getProperty)((0,f.unescapeJsonPointer)(e))}`}`);return n;function l(e,a){return`Cannot access ${e} ${a} levels up, current level is ${t}`}}t.getData=R}
//# sourceMappingURL=/dynamic/node_modules/ajv/dist/compile/validate/7a11293bddaa1c2a8738ad5cdd89eecd16e2876a.map
