function module(e,n,t){t.link("@babel/runtime/helpers/toConsumableArray",{default:function(e){o=e}},0),t.link("@babel/runtime/regenerator",{default:function(e){i=e}},1),t.link("meteor/meteor",{Meteor:function(e){u=e}},0),t.link("../../app/utils/client/lib/SDKClient",{sdk:function(e){l=e}},1);var r,a,c,s,o,i,u,l,p,d=new Promise(function(e){p=e});i.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ECDH_Enabled){e.next=3;break}return u.connection._stream.allowConnection(),e.abrupt("return",p());case 3:return e.next=5,i.awrap(t.dynamicImport("../app/ecdh/client/ClientSession"));case 5:return r=new e.sent.ClientSession,e.next=10,i.awrap(r.init());case 10:return a=e.sent,e.prev=11,e.next=14,i.awrap(fetch("/api/ecdh_proxy/initEncryptedSession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientPublicKey:a})}));case 14:if(!(200!==(c=e.sent).status)){e.next=18;break}return p(),e.abrupt("return",u.connection._stream.allowConnection());case 18:return e.next=20,i.awrap(c.json());case 20:if(!1!==(s=e.sent).success){e.next=24;break}return p(),e.abrupt("return",u.connection._stream.allowConnection());case 24:return e.next=26,i.awrap(r.setServerKey(s.publicKeyString));case 26:p(r),function(e){u.connection._stream.allowConnection();var n=u.connection._stream.socket._didMessage.bind(u.connection._stream.socket),t=u.connection._stream.socket.send.bind(u.connection._stream.socket);u.connection._stream.socket._didMessage=function(t){return i.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.awrap(e.decrypt(t));case 2:r.sent.split("\n").forEach(function(e){return n(e)});case 4:case"end":return r.stop()}},null,null,null,Promise)},u.connection._stream.socket.send=function(n){return i.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=t,r.next=3,i.awrap(e.encrypt(n));case 3:r.t1=r.sent,(0,r.t0)(r.t1);case 5:case"end":return r.stop()}},null,null,null,Promise)}}(r),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(11),console.log(e.t0),p(),u.connection._stream.allowConnection();case 35:case"end":return e.stop()}},null,null,[[11,30]],Promise),l.rest.use(function(e,n){var t,r,a;return i.async(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,i.awrap(d);case 2:if(t=c.sent){c.next=5;break}return c.abrupt("return",n.apply(void 0,o(e)));case 5:return c.t0=i,c.next=8,i.awrap(n.apply(void 0,o(e)));case 8:return c.t1=c.sent.text(),c.next=11,c.t0.awrap.call(c.t0,c.t1);case 11:return r=c.sent,c.next=14,i.awrap(t.decrypt(r));case 14:return a=JSON.parse(c.sent),c.abrupt("return",a);case 17:case"end":return c.stop()}},null,null,null,Promise)})}
//# sourceMappingURL=/dynamic/ee/client/f84f500e6b1ce56f3358ae677ce5f35c5a4a02be.map
