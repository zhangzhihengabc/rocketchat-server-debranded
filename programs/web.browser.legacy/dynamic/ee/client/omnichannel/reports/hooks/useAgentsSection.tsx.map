)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/reports/hooks/useAgentsSection.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\n\nimport { useSort } from '../../../../../client/components/GenericTable/hooks/useSort';\nimport { getPeriodRange } from '../../../components/dashboards/periods';\nimport { usePeriodSelectorStorage } from '../../../components/dashboards/usePeriodSelectorStorage';\nimport { COLORS, PERIOD_OPTIONS } from '../components/constants';\nimport { formatPeriodDescription } from '../utils/formatPeriodDescription';\nimport { useDefaultDownload } from './useDefaultDownload';\n\nconst formatChartData = (data: { label: string; value: number }[] | undefined = []) =>\n\tdata.map((item) => ({\n\t\t...item,\n\t\tcolor: COLORS.info,\n\t}));\n\nexport const useAgentsSection = () => {\n\tconst t = useTranslation();\n\tconst [period, periodSelectorProps] = usePeriodSelectorStorage('reports-agents-period', PERIOD_OPTIONS);\n\tconst getConversationsByAgent = useEndpoint('GET', '/v1/livechat/analytics/dashboards/conversations-by-agent');\n\tconst { sortBy, sortDirection, setSort } = useSort<'name' | 'total'>('total', 'desc');\n\n\tconst {\n\t\tdata: { data, total = 0, unspecified = 0 } = { data: [], total: 0 },\n\t\trefetch,\n\t\tisLoading,\n\t\tisError,\n\t\tisSuccess,\n\t} = useQuery(\n\t\t['omnichannel-reports', 'conversations-by-agent', period, sortBy, sortDirection],\n\t\tasync () => {\n\t\t\tconst { start, end } = getPeriodRange(period);\n\t\t\tconst response = await getConversationsByAgent({\n\t\t\t\tstart: start.toISOString(),\n\t\t\t\tend: end.toISOString(),\n\t\t\t\tsort: JSON.stringify({ [sortBy]: sortDirection === 'asc' ? 1 : -1 }),\n\t\t\t});\n\t\t\treturn { ...response, data: formatChartData(response.data) };\n\t\t},\n\t\t{\n\t\t\trefetchInterval: 5 * 60 * 1000,\n\t\t},\n\t);\n\n\tconst title = t('Conversations_by_agents');\n\n\tconst subtitleTotals = t('__agents__agents_and__count__conversations__period__', {\n\t\tagents: data.length ?? 0,\n\t\tcount: total,\n\t\tperiod: formatPeriodDescription(period, t),\n\t});\n\tconst subtitleUnspecified = unspecified > 0 ? `(${t('__count__without__assignee__', { count: unspecified })})` : '';\n\tconst subtitle = `${subtitleTotals} ${subtitleUnspecified}`;\n\tconst emptyStateSubtitle = t('Omnichannel_Reports_Agents_Empty_Subtitle');\n\n\tconst downloadProps = useDefaultDownload({ columnName: t('Agents'), title, data, period });\n\n\treturn useMemo(\n\t\t() => ({\n\t\t\tid: 'conversations-by-agent',\n\t\t\ttitle,\n\t\t\tsubtitle,\n\t\t\temptyStateSubtitle,\n\t\t\tdata,\n\t\t\ttotal,\n\t\t\tisLoading,\n\t\t\tisError,\n\t\t\tisDataFound: isSuccess && data.length > 0,\n\t\t\tperiodSelectorProps,\n\t\t\tperiod,\n\t\t\tdownloadProps,\n\t\t\tsortBy,\n\t\t\tsortDirection,\n\t\t\tsetSort,\n\t\t\tonRetry: refetch,\n\t\t}),\n\t\t[\n\t\t\ttitle,\n\t\t\tsubtitle,\n\t\t\temptyStateSubtitle,\n\t\t\tdata,\n\t\t\ttotal,\n\t\t\tisLoading,\n\t\t\tisError,\n\t\t\tisSuccess,\n\t\t\tperiodSelectorProps,\n\t\t\tperiod,\n\t\t\tdownloadProps,\n\t\t\tsortBy,\n\t\t\tsortDirection,\n\t\t\tsetSort,\n\t\t\trefetch,\n\t\t],\n\t);\n};\n",null],"names":["module","default","v","_regeneratorRuntime","_slicedToArray","_objectSpread","export","useAgentsSection","useEndpoint","useTranslation","useQuery","useMemo","useSort","getPeriodRange","usePeriodSelectorStorage","COLORS","PERIOD_OPTIONS","formatPeriodDescription","useDefaultDownload","formatChartData","data","map","item","color","info","_data$length","t","_usePeriodSelectorSto2","period","periodSelectorProps","getConversationsByAgent","_useSort","sortBy","sortDirection","setSort","_useQuery","_JSON$stringify","_getPeriodRange","start","end","response","async","_context","prev","next","awrap","toISOString","sort","JSON","stringify","sent","abrupt","stop","Promise","refetchInterval","_useQuery$data","total","_useQuery$data$total","_useQuery$data$unspec","unspecified","refetch","isLoading","isError","isSuccess","title","subtitle","subtitleTotals","agents","length","count","emptyStateSubtitle","downloadProps","columnName","id","isDataFound","onRetry"],"mappings":"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"}