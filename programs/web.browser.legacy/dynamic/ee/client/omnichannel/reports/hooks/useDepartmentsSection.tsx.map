)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/reports/hooks/useDepartmentsSection.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\n\nimport { getPeriodRange } from '../../../components/dashboards/periods';\nimport { usePeriodSelectorStorage } from '../../../components/dashboards/usePeriodSelectorStorage';\nimport { COLORS, PERIOD_OPTIONS } from '../components/constants';\nimport { formatPeriodDescription } from '../utils/formatPeriodDescription';\nimport { useDefaultDownload } from './useDefaultDownload';\n\nconst formatChartData = (data: { label: string; value: number }[] | undefined = []) =>\n\tdata.map((item) => ({\n\t\t...item,\n\t\tcolor: COLORS.info,\n\t}));\n\nexport const useDepartmentsSection = () => {\n\tconst t = useTranslation();\n\tconst [period, periodSelectorProps] = usePeriodSelectorStorage('reports-department-period', PERIOD_OPTIONS);\n\tconst getConversationsByDepartment = useEndpoint('GET', '/v1/livechat/analytics/dashboards/conversations-by-department');\n\n\tconst {\n\t\tdata: { data, total = 0, unspecified = 0 } = { data: [], total: 0 },\n\t\tisLoading,\n\t\tisError,\n\t\tisSuccess,\n\t\trefetch,\n\t} = useQuery(\n\t\t['omnichannel-reports', 'conversations-by-department', period],\n\t\tasync () => {\n\t\t\tconst { start, end } = getPeriodRange(period);\n\t\t\tconst response = await getConversationsByDepartment({ start: start.toISOString(), end: end.toISOString() });\n\t\t\treturn { ...response, data: formatChartData(response.data) };\n\t\t},\n\t\t{\n\t\t\trefetchInterval: 5 * 60 * 1000,\n\t\t},\n\t);\n\n\tconst title = t('Conversations_by_department');\n\tconst subtitleTotals = t('__departments__departments_and__count__conversations__period__', {\n\t\tdepartments: data.length ?? 0,\n\t\tcount: total,\n\t\tperiod: formatPeriodDescription(period, t),\n\t});\n\tconst subtitleUnspecified = unspecified > 0 ? `(${t('__count__without__department__', { count: unspecified })})` : '';\n\tconst subtitle = `${subtitleTotals} ${subtitleUnspecified}`;\n\tconst emptyStateSubtitle = t('Omnichannel_Reports_Departments_Empty_Subtitle');\n\n\tconst downloadProps = useDefaultDownload({ columnName: t('Departments'), title, data, period });\n\n\treturn useMemo(\n\t\t() => ({\n\t\t\tid: 'conversations-by-department',\n\t\t\ttitle,\n\t\t\tsubtitle,\n\t\t\temptyStateSubtitle,\n\t\t\tdata,\n\t\t\ttotal,\n\t\t\tisLoading,\n\t\t\tisError,\n\t\t\tisDataFound: isSuccess && data.length > 0,\n\t\t\tperiodSelectorProps,\n\t\t\tperiod,\n\t\t\tdownloadProps,\n\t\t\tonRetry: refetch,\n\t\t}),\n\t\t[title, subtitle, emptyStateSubtitle, data, total, isLoading, isError, isSuccess, periodSelectorProps, period, downloadProps, refetch],\n\t);\n};\n",null],"names":["module","default","v","_regeneratorRuntime","_slicedToArray","_objectSpread","export","useDepartmentsSection","useEndpoint","useTranslation","useQuery","useMemo","getPeriodRange","usePeriodSelectorStorage","COLORS","PERIOD_OPTIONS","formatPeriodDescription","useDefaultDownload","formatChartData","data","map","item","color","info","_data$length","t","_usePeriodSelectorSto2","period","periodSelectorProps","getConversationsByDepartment","_useQuery","_getPeriodRange","start","end","response","async","_context","prev","next","awrap","toISOString","sent","abrupt","stop","Promise","refetchInterval","_useQuery$data","total","_useQuery$data$total","_useQuery$data$unspec","unspecified","isLoading","isError","isSuccess","refetch","title","subtitle","subtitleTotals","departments","length","count","emptyStateSubtitle","downloadProps","columnName","id","isDataFound","onRetry"],"mappings":"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"}