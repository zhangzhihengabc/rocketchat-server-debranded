)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/reports/hooks/useChannelsSection.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { capitalize } from '@rocket.chat/string-helpers';\nimport type { TranslationContextValue, TranslationKey } from '@rocket.chat/ui-contexts';\nimport { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\n\nimport { getPeriodRange } from '../../../components/dashboards/periods';\nimport { usePeriodSelectorStorage } from '../../../components/dashboards/usePeriodSelectorStorage';\nimport { PERIOD_OPTIONS } from '../components/constants';\nimport { formatPeriodDescription } from '../utils/formatPeriodDescription';\nimport { getTop } from '../utils/getTop';\nimport { round } from '../utils/round';\nimport { useDefaultDownload } from './useDefaultDownload';\n\ntype DataItem = { label: string; value: number; id: string; rawLabel: string };\n\nconst TYPE_LABEL: Record<string, TranslationKey> = {\n\t'widget': 'Livechat',\n\t'email-inbox': 'Email',\n\t'twilio': 'SMS',\n\t'api': 'Custom_Integration',\n};\n\nconst formatItem = (item: { label: string; value: number }, total: number, t: TranslationContextValue['translate']): DataItem => {\n\tconst percentage = total > 0 ? round((item.value / total) * 100) : 0;\n\tconst label = `${t(TYPE_LABEL[item.label]) || capitalize(item.label)}`;\n\treturn {\n\t\t...item,\n\t\tlabel: `${label} ${item.value} (${percentage}%)`,\n\t\trawLabel: label,\n\t\tid: item.label,\n\t};\n};\n\nconst formatChartData = (data: { label: string; value: number }[] | undefined = [], total = 0, t: TranslationContextValue['translate']) => {\n\treturn data.map((item) => formatItem(item, total, t));\n};\n\nexport const useChannelsSection = () => {\n\tconst t = useTranslation();\n\tconst [period, periodSelectorProps] = usePeriodSelectorStorage('reports-channels-period', PERIOD_OPTIONS);\n\tconst getConversationsBySource = useEndpoint('GET', '/v1/livechat/analytics/dashboards/conversations-by-source');\n\n\tconst {\n\t\tdata: { data, rawData, total } = { data: [], rawData: [], total: 0 },\n\t\trefetch,\n\t\tisLoading,\n\t\tisError,\n\t\tisSuccess,\n\t} = useQuery(\n\t\t['omnichannel-reports', 'conversations-by-source', period],\n\t\tasync () => {\n\t\t\tconst { start, end } = getPeriodRange(period);\n\t\t\tconst response = await getConversationsBySource({ start: start.toISOString(), end: end.toISOString() });\n\t\t\tconst data = formatChartData(response.data, response.total, t);\n\t\t\tconst displayData: DataItem[] = getTop<DataItem>(5, data, (value) => formatItem({ label: t('Others'), value }, response.total, t));\n\t\t\treturn { ...response, data: displayData, rawData: data };\n\t\t},\n\t\t{\n\t\t\trefetchInterval: 5 * 60 * 1000,\n\t\t},\n\t);\n\n\tconst title = t('Conversations_by_channel');\n\tconst subtitle = t('__count__conversations__period__', {\n\t\tcount: total ?? 0,\n\t\tperiod: formatPeriodDescription(period, t),\n\t});\n\tconst emptyStateSubtitle = t('Omnichannel_Reports_Channels_Empty_Subtitle');\n\n\tconst downloadProps = useDefaultDownload({ columnName: t('Channel'), title, data: rawData, period });\n\n\treturn useMemo(\n\t\t() => ({\n\t\t\tid: 'conversations-by-channel',\n\t\t\ttitle,\n\t\t\tsubtitle,\n\t\t\temptyStateSubtitle,\n\t\t\tdata,\n\t\t\ttotal,\n\t\t\tisLoading,\n\t\t\tisError,\n\t\t\tisDataFound: isSuccess && data.length > 0,\n\t\t\tperiodSelectorProps,\n\t\t\tperiod,\n\t\t\tdownloadProps,\n\t\t\tonRetry: refetch,\n\t\t}),\n\t\t[title, subtitle, emptyStateSubtitle, data, total, isLoading, isError, isSuccess, periodSelectorProps, period, downloadProps, refetch],\n\t);\n};\n",null],"names":["module","link","default","_regeneratorRuntime","_slicedToArray","_objectSpread","export","useChannelsSection","capitalize","useEndpoint","useTranslation","useQuery","useMemo","getPeriodRange","usePeriodSelectorStorage","PERIOD_OPTIONS","formatPeriodDescription","getTop","round","useDefaultDownload","TYPE_LABEL","formatItem","item","total","t","percentage","value","label","rawLabel","id","formatChartData","data","arguments","length","undefined","map","_usePeriodSelectorSto2","period","periodSelectorProps","getConversationsBySource","_useQuery","_getPeriodRange","start","end","response","displayData","async","_context","prev","next","awrap","toISOString","sent","abrupt","rawData","stop","Promise","refetchInterval","_useQuery$data","refetch","isLoading","isError","isSuccess","title","subtitle","count","emptyStateSubtitle","downloadProps","columnName","isDataFound","onRetry"],"mappings":"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"}