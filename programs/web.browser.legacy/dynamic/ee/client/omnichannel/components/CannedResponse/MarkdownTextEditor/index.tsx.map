)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/components/CannedResponse/MarkdownTextEditor/index.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Divider, PositionAnimated, Tile } from '@rocket.chat/fuselage';\nimport { useUserPreference, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { FC } from 'react';\nimport React, { memo, useCallback, useRef, useState } from 'react';\n\nimport { Backdrop } from '../../../../../../client/components/Backdrop';\nimport { useEmojiPicker } from '../../../../../../client/contexts/EmojiPickerContext';\nimport TextEditor from '../TextEditor';\nimport InsertPlaceholderDropdown from './InsertPlaceholderDropdown';\n\nconst MarkdownTextEditor: FC<{ onChange: any; value: string }> = ({ onChange, value }) => {\n\tconst t = useTranslation();\n\tconst useEmojisPreference = useUserPreference('useEmojis');\n\n\tconst textAreaRef = useRef<HTMLTextAreaElement>(null);\n\tconst ref = useRef<HTMLButtonElement>(null);\n\n\tconst [visible, setVisible] = useState(false);\n\n\tconst { open: openEmojiPicker } = useEmojiPicker();\n\n\tconst useMarkdownSyntax = (char: '*' | '_' | '~' | '[]()'): (() => void) =>\n\t\tuseCallback(() => {\n\t\t\tif (textAreaRef?.current) {\n\t\t\t\tconst text = textAreaRef.current.value;\n\t\t\t\tconst startPos = textAreaRef.current.selectionStart;\n\t\t\t\tconst endPos = textAreaRef.current.selectionEnd;\n\n\t\t\t\tif (char === '[]()') {\n\t\t\t\t\tif (startPos !== endPos) {\n\t\t\t\t\t\ttextAreaRef.current.value = `${text.slice(0, startPos)}[${text.slice(startPos, endPos)}]()${text.slice(endPos)}`;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttextAreaRef.current.value = `${text.slice(0, startPos)}${char}${text.slice(startPos, endPos)}${char}${text.slice(endPos)}`;\n\t\t\t\t}\n\t\t\t\ttextAreaRef.current.focus();\n\n\t\t\t\tif (char === '[]()') {\n\t\t\t\t\tif (startPos === endPos) {\n\t\t\t\t\t\ttextAreaRef.current.setSelectionRange(startPos, endPos);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttextAreaRef.current.setSelectionRange(endPos + 3, endPos + 3);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttextAreaRef.current.setSelectionRange(startPos + 1, endPos + 1);\n\t\t\t\t}\n\n\t\t\t\tonChange(textAreaRef.current.value);\n\t\t\t}\n\t\t}, [char]);\n\n\tconst onClickEmoji = (emoji: string): void => {\n\t\tif (textAreaRef?.current) {\n\t\t\tconst text = textAreaRef.current.value;\n\t\t\tconst startPos = textAreaRef.current.selectionStart;\n\t\t\tconst emojiValue = `:${emoji}: `;\n\n\t\t\ttextAreaRef.current.value = text.slice(0, startPos) + emojiValue + text.slice(startPos);\n\n\t\t\ttextAreaRef.current.focus();\n\t\t\ttextAreaRef.current.setSelectionRange(startPos + emojiValue.length, startPos + emojiValue.length);\n\n\t\t\tonChange(textAreaRef.current.value);\n\t\t}\n\t};\n\n\tconst handleOpenEmojiPicker = (): void => {\n\t\tif (!useEmojisPreference) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!textAreaRef?.current) {\n\t\t\tthrow new Error('Missing textAreaRef');\n\t\t}\n\n\t\topenEmojiPicker(textAreaRef.current, (emoji: string) => onClickEmoji(emoji));\n\t};\n\n\tconst openPlaceholderSelect = (): void => {\n\t\ttextAreaRef?.current && textAreaRef.current.focus();\n\t\tsetVisible(!visible);\n\t};\n\n\treturn (\n\t\t<TextEditor>\n\t\t\t<TextEditor.Toolbox>\n\t\t\t\t<Box display='flex' flexDirection='row'>\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='bold' action={useMarkdownSyntax('*')} title={t('Bold')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='italic' action={useMarkdownSyntax('_')} title={t('Italic')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='strike' action={useMarkdownSyntax('~')} title={t('Strike')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='link' action={useMarkdownSyntax('[]()')} title={t('Link')} />\n\t\t\t\t\t<TextEditor.Toolbox.IconButton name='emoji' action={handleOpenEmojiPicker} title={t('Emoji')} />\n\t\t\t\t</Box>\n\t\t\t\t<TextEditor.Toolbox.TextButton text='Insert_Placeholder' action={openPlaceholderSelect} ref={ref} />\n\t\t\t\t<Backdrop\n\t\t\t\t\tdisplay={visible ? 'block' : 'none'}\n\t\t\t\t\tonClick={(): void => {\n\t\t\t\t\t\ttextAreaRef?.current && textAreaRef.current.focus();\n\t\t\t\t\t\tsetVisible(false);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<PositionAnimated visible={visible ? 'visible' : 'hidden'} anchor={ref}>\n\t\t\t\t\t<Tile elevation='1' w='224px'>\n\t\t\t\t\t\t<InsertPlaceholderDropdown onChange={onChange} textAreaRef={textAreaRef} setVisible={setVisible} />\n\t\t\t\t\t</Tile>\n\t\t\t\t</PositionAnimated>\n\t\t\t</TextEditor.Toolbox>\n\t\t\t<Divider w='full' mbe='16px' />\n\t\t\t<TextEditor.Textarea value={value} onChange={onChange} rows={10} ref={textAreaRef} />\n\t\t</TextEditor>\n\t);\n};\n\nexport default memo(MarkdownTextEditor);\n",null],"names":["_slicedToArray","Box","Divider","PositionAnimated","Tile","useUserPreference","useTranslation","React","memo","useCallback","useRef","useState","Backdrop","useEmojiPicker","TextEditor","InsertPlaceholderDropdown","module","link","default","v","exportDefault","_ref","onChange","value","t","useEmojisPreference","textAreaRef","ref","_useState2","visible","setVisible","openEmojiPicker","_useEmojiPicker","open","useMarkdownSyntax","char","current","text","startPos","selectionStart","endPos","selectionEnd","slice","focus","setSelectionRange","onClickEmoji","emoji","emojiValue","length","createElement","Toolbox","display","flexDirection","IconButton","name","action","title","Error","TextButton","onClick","anchor","elevation","w","mbe","Textarea","rows"],"mappings":"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"}