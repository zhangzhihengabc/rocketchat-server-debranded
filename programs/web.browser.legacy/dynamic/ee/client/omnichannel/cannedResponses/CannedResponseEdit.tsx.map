)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/omnichannel/cannedResponses/CannedResponseEdit.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ILivechatDepartment, IOmnichannelCannedResponse, Serialized } from '@rocket.chat/core-typings';\nimport { Button, ButtonGroup, FieldGroup } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useToastMessageDispatch, useRoute, usePermission, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { FC } from 'react';\nimport React, { memo, useState, useMemo, useEffect, useCallback } from 'react';\n\nimport Page from '../../../../client/components/Page';\nimport { useForm } from '../../../../client/hooks/useForm';\nimport CannedResponseForm from './components/cannedResponseForm';\n\nconst CannedResponseEdit: FC<{\n\tdata?: {\n\t\tcannedResponse: Serialized<IOmnichannelCannedResponse>;\n\t};\n\treload: () => void;\n\ttotalDataReload: () => void;\n\tisNew?: boolean;\n\tdepartmentData?: {\n\t\tdepartment: Serialized<ILivechatDepartment>;\n\t};\n}> = ({ data, reload, totalDataReload, isNew = false }) => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst Route = useRoute('omnichannel-canned-responses');\n\n\tconst handleReturn = useMutableCallback(() =>\n\t\tRoute.push({\n\t\t\tcontext: '',\n\t\t}),\n\t);\n\n\tconst saveCannedResponse = useEndpoint('POST', '/v1/canned-responses');\n\n\tconst hasManagerPermission = usePermission('view-all-canned-responses');\n\tconst hasMonitorPermission = usePermission('save-department-canned-responses');\n\n\tconst form = useForm({\n\t\t_id: data?.cannedResponse ? data.cannedResponse._id : '',\n\t\tshortcut: data ? data.cannedResponse.shortcut : '',\n\t\ttext: data ? data.cannedResponse.text : '',\n\t\ttags: data?.cannedResponse?.tags ?? [],\n\t\tscope: data ? data.cannedResponse.scope : 'user',\n\t\tdepartmentId: data?.cannedResponse?.departmentId ? data.cannedResponse.departmentId : '',\n\t});\n\n\tconst { values, handlers, hasUnsavedChanges } = form;\n\n\tconst [errors, setErrors] = useState<any>({});\n\tconst [radioDescription, setRadioDescription] = useState<string>(t('Canned_Response_Sharing_Private_Description'));\n\tconst [preview, setPreview] = useState(false);\n\n\tconst listErrors = useMemo(() => {\n\t\tconst empty: any = {};\n\n\t\tfor (const [key, value] of Object.entries(values)) {\n\t\t\tif (['shortcut', 'text'].includes(key) && !value) {\n\t\t\t\tempty[key] = t('Field_required');\n\t\t\t}\n\t\t}\n\n\t\tif (values.scope === 'department' && !values.departmentId) {\n\t\t\tempty.departmentId = t('Field_required');\n\t\t}\n\n\t\treturn empty;\n\t}, [t, values]);\n\n\tuseEffect(() => {\n\t\tsetErrors(listErrors);\n\t}, [values.shortcut, values.text, values.departmentId, listErrors]);\n\n\tconst radioHandlers = {\n\t\tsetPublic: (): void => {\n\t\t\thandlers.handleScope('global');\n\t\t\thandlers.handleDepartmentId('');\n\t\t\tsetRadioDescription(t('Canned_Response_Sharing_Public_Description'));\n\t\t},\n\t\tsetDepartment: (): void => {\n\t\t\thandlers.handleScope('department');\n\t\t\tsetRadioDescription(t('Canned_Response_Sharing_Department_Description'));\n\t\t},\n\t\tsetPrivate: (): void => {\n\t\t\thandlers.handleScope('user');\n\t\t\thandlers.handleDepartmentId('');\n\t\t\tsetRadioDescription(t('Canned_Response_Sharing_Private_Description'));\n\t\t},\n\t};\n\n\tconst onSave = useCallback(async (): Promise<void> => {\n\t\ttry {\n\t\t\tconst { _id, shortcut, text, scope, tags, departmentId } = values as {\n\t\t\t\t_id: string;\n\t\t\t\tshortcut: string;\n\t\t\t\ttext: string;\n\t\t\t\tscope: string;\n\t\t\t\ttags: any;\n\t\t\t\tdepartmentId: string;\n\t\t\t};\n\t\t\tawait saveCannedResponse({\n\t\t\t\t...(_id && { _id }),\n\t\t\t\tshortcut,\n\t\t\t\ttext,\n\t\t\t\tscope,\n\t\t\t\ttags,\n\t\t\t\t...(departmentId && { departmentId }),\n\t\t\t});\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: t(_id ? 'Canned_Response_Updated' : 'Canned_Response_Created'),\n\t\t\t});\n\t\t\tRoute.push({\n\t\t\t\tcontext: '',\n\t\t\t});\n\t\t\treload();\n\t\t\ttotalDataReload();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [values, saveCannedResponse, dispatchToastMessage, t, Route, reload, totalDataReload]);\n\n\tconst onPreview = (): void => {\n\t\tsetPreview(!preview);\n\t};\n\n\tconst { shortcut, text, scope, departmentId } = values;\n\n\tconst checkDepartment = scope !== 'department' || (scope === 'department' && departmentId);\n\n\tconst canSave = shortcut && text && checkDepartment;\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={isNew ? t('New_CannedResponse') : t('Edit_CannedResponse')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button icon='back' onClick={handleReturn}>\n\t\t\t\t\t\t{t('Back')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button primary mie='none' flexGrow={1} disabled={!hasUnsavedChanges || !canSave} onClick={onSave}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow fontScale='p2'>\n\t\t\t\t<FieldGroup w='full' alignSelf='center' maxWidth='x600' is='form' autoComplete='off'>\n\t\t\t\t\t<CannedResponseForm\n\t\t\t\t\t\tisManager={hasManagerPermission}\n\t\t\t\t\t\tisMonitor={hasMonitorPermission}\n\t\t\t\t\t\tvalues={values}\n\t\t\t\t\t\thandlers={handlers}\n\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\tradioHandlers={radioHandlers}\n\t\t\t\t\t\tradioDescription={radioDescription}\n\t\t\t\t\t\tonPreview={onPreview}\n\t\t\t\t\t\tpreviewState={preview}\n\t\t\t\t\t></CannedResponseForm>\n\t\t\t\t</FieldGroup>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n};\n\nexport default memo(CannedResponseEdit);\n",null],"names":["_regeneratorRuntime","_objectSpread","_slicedToArray","Button","ButtonGroup","FieldGroup","useMutableCallback","useToastMessageDispatch","useRoute","usePermission","useEndpoint","useTranslation","React","memo","useState","useMemo","useEffect","useCallback","Page","useForm","CannedResponseForm","module","link","default","v","exportDefault","_ref","_data$cannedResponse$","_data$cannedResponse","_data$cannedResponse2","data","reload","totalDataReload","_ref$isNew","isNew","t","dispatchToastMessage","Route","handleReturn","push","context","saveCannedResponse","hasManagerPermission","hasMonitorPermission","form","_id","cannedResponse","shortcut","text","tags","scope","departmentId","values","handlers","hasUnsavedChanges","_useState2","errors","setErrors","_useState4","radioDescription","setRadioDescription","_useState6","preview","setPreview","listErrors","empty","_i","_Object$entries","Object","entries","length","_ref3","key","value","includes","onSave","_shortcut","_text","_scope","_departmentId","async","_context","prev","next","awrap","type","message","t0","stop","Promise","createElement","Header","title","icon","onClick","primary","mie","flexGrow","disabled","checkDepartment","ScrollableContentWithShadow","fontScale","w","alignSelf","maxWidth","is","autoComplete","isManager","isMonitor","radioHandlers","setPublic","handleScope","handleDepartmentId","setDepartment","setPrivate","onPreview","previewState"],"mappings":"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"}