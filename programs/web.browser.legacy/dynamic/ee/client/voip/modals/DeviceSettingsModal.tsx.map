)]}'
{"version":3,"sources":["meteor://ðŸ’»app/ee/client/voip/modals/DeviceSettingsModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { SelectOption } from '@rocket.chat/fuselage';\nimport { Modal, Field, FieldLabel, FieldRow, Select, Button, Box } from '@rocket.chat/fuselage';\nimport {\n\tuseTranslation,\n\tuseAvailableDevices,\n\tuseToastMessageDispatch,\n\tuseSetModal,\n\tuseSelectedDevices,\n\tuseIsDeviceManagementEnabled,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState } from 'react';\nimport type { SubmitHandler } from 'react-hook-form';\nimport { useForm, Controller } from 'react-hook-form';\n\nimport { useChangeAudioInputDevice, useChangeAudioOutputDevice } from '../../../../client/contexts/CallContext';\nimport { isSetSinkIdAvailable } from '../../../../client/providers/DeviceProvider/lib/isSetSinkIdAvailable';\n\ntype FieldValues = {\n\tinputDevice: string;\n\toutputDevice: string;\n};\n\nconst DeviceSettingsModal = (): ReactElement => {\n\tconst setModal = useSetModal();\n\tconst onCancel = (): void => setModal();\n\tconst isDeviceManagementEnabled = useIsDeviceManagementEnabled();\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst selectedAudioDevices = useSelectedDevices();\n\n\tconst { handleSubmit, control } = useForm<FieldValues>({\n\t\tdefaultValues: {\n\t\t\tinputDevice: selectedAudioDevices?.audioInput?.id || '',\n\t\t\toutputDevice: selectedAudioDevices?.audioOutput?.id || '',\n\t\t},\n\t});\n\tconst [setSinkIdAvailable] = useState(() => isSetSinkIdAvailable());\n\tconst availableDevices = useAvailableDevices();\n\tconst changeAudioInputDevice = useChangeAudioInputDevice();\n\tconst changeAudioOutputDevice = useChangeAudioOutputDevice();\n\n\tconst availableInputDevices: SelectOption[] = availableDevices?.audioInput?.map((device) => [device.id, device.label]) || [];\n\tconst availableOutputDevices: SelectOption[] = availableDevices?.audioOutput?.map((device) => [device.id, device.label]) || [];\n\n\tconst onSubmit: SubmitHandler<FieldValues> = async (data) => {\n\t\tconst selectedInputDevice = data.inputDevice && availableDevices?.audioInput?.find((device) => device.id === data.inputDevice);\n\t\tconst selectedOutputDevice = data.outputDevice && availableDevices?.audioOutput?.find((device) => device.id === data.outputDevice);\n\t\ttry {\n\t\t\tselectedInputDevice && changeAudioInputDevice(selectedInputDevice);\n\t\t\tselectedOutputDevice && changeAudioOutputDevice(selectedOutputDevice);\n\t\t\tsetModal();\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Devices_Set') });\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t};\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} />}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Device_settings')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t{!setSinkIdAvailable && (\n\t\t\t\t\t<Box color='status-font-on-danger' display='flex' flexDirection='column'>\n\t\t\t\t\t\t{t('Device_Changes_Not_Available')}\n\t\t\t\t\t\t<Box is='a' href='https://rocket.chat/download' target='_blank' rel='noopener noreferrer'>\n\t\t\t\t\t\t\t{t('Download_Destkop_App')}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{!isDeviceManagementEnabled && (\n\t\t\t\t\t<Box color='status-font-on-danger' display='flex' flexDirection='column'>\n\t\t\t\t\t\t{t('Device_Changes_Not_Available_Insecure_Context')}\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Microphone')}</FieldLabel>\n\t\t\t\t\t<FieldRow w='full' display='flex' flexDirection='column' alignItems='stretch'>\n\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\tname='inputDevice'\n\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t<Select disabled={!setSinkIdAvailable} {...field} options={availableInputDevices || []} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Speakers')}</FieldLabel>\n\t\t\t\t\t<FieldRow w='full' display='flex' flexDirection='column' alignItems='stretch'>\n\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\tname='outputDevice'\n\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t<Select disabled={!setSinkIdAvailable} {...field} options={availableOutputDevices || []} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={(): void => setModal()}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button disabled={!setSinkIdAvailable} primary onClick={handleSubmit(onSubmit)}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default DeviceSettingsModal;\n",null],"names":["_regeneratorRuntime","_extends","_slicedToArray","Modal","Field","FieldLabel","FieldRow","Select","Button","Box","useTranslation","useAvailableDevices","useToastMessageDispatch","useSetModal","useSelectedDevices","useIsDeviceManagementEnabled","React","useState","useForm","Controller","useChangeAudioInputDevice","useChangeAudioOutputDevice","isSetSinkIdAvailable","module","default","v","link","exportDefault","_selectedAudioDevices","_selectedAudioDevices2","_availableDevices$aud","_availableDevices$aud2","setModal","isDeviceManagementEnabled","t","dispatchToastMessage","selectedAudioDevices","_useForm","defaultValues","inputDevice","audioInput","id","outputDevice","audioOutput","handleSubmit","control","setSinkIdAvailable","_useState2","availableDevices","changeAudioInputDevice","changeAudioOutputDevice","availableInputDevices","map","device","label","availableOutputDevices","onSubmit","data","_availableDevices$aud3","_availableDevices$aud4","selectedInputDevice","selectedOutputDevice","async","_context","prev","next","find","type","message","error","stop","Promise","createElement","wrapperFunction","props","is","Header","Title","Close","onClick","Content","fontScale","color","display","flexDirection","href","target","rel","w","alignItems","name","render","_ref","field","disabled","options","_ref2","Footer","FooterControllers","primary"],"mappings":"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"}