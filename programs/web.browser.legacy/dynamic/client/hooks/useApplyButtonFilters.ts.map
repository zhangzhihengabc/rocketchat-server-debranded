)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useApplyButtonFilters.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUIActionButton } from '@rocket.chat/apps-engine/definition/ui';\nimport { RoomTypeFilter } from '@rocket.chat/apps-engine/definition/ui';\nimport type { IRoom } from '@rocket.chat/core-typings';\nimport {\n\tisDirectMessageRoom,\n\tisMultipleDirectMessageRoom,\n\tisOmnichannelRoom,\n\tisPrivateDiscussion,\n\tisPrivateTeamRoom,\n\tisPublicDiscussion,\n\tisPublicTeamRoom,\n} from '@rocket.chat/core-typings';\nimport { AuthorizationContext, useUserId } from '@rocket.chat/ui-contexts';\nimport { useCallback, useContext } from 'react';\n\nimport { useRoom } from '../views/room/contexts/RoomContext';\n\nconst enumToFilter: { [k in RoomTypeFilter]: (room: IRoom) => boolean } = {\n\t[RoomTypeFilter.PUBLIC_CHANNEL]: (room) => room.t === 'c',\n\t[RoomTypeFilter.PRIVATE_CHANNEL]: (room) => room.t === 'p',\n\t[RoomTypeFilter.PUBLIC_TEAM]: isPublicTeamRoom,\n\t[RoomTypeFilter.PRIVATE_TEAM]: isPrivateTeamRoom,\n\t[RoomTypeFilter.PUBLIC_DISCUSSION]: isPublicDiscussion,\n\t[RoomTypeFilter.PRIVATE_DISCUSSION]: isPrivateDiscussion,\n\t[RoomTypeFilter.DIRECT]: isDirectMessageRoom,\n\t[RoomTypeFilter.DIRECT_MULTIPLE]: isMultipleDirectMessageRoom,\n\t[RoomTypeFilter.LIVE_CHAT]: isOmnichannelRoom,\n};\n\nconst applyRoomFilter = (button: IUIActionButton, room: IRoom): boolean => {\n\tconst { roomTypes } = button.when || {};\n\treturn !roomTypes || roomTypes.some((filter): boolean => enumToFilter[filter]?.(room));\n};\n\nexport const useApplyButtonFilters = (): ((button: IUIActionButton) => boolean) => {\n\tconst room = useRoom();\n\tif (!room) {\n\t\tthrow new Error('useApplyButtonFilters must be used inside a room context');\n\t}\n\tconst applyAuthFilter = useApplyButtonAuthFilter();\n\treturn useCallback(\n\t\t(button: IUIActionButton) => applyAuthFilter(button) && (!room || applyRoomFilter(button, room)),\n\t\t[applyAuthFilter, room],\n\t);\n};\n\nexport const useApplyButtonAuthFilter = (): ((button: IUIActionButton) => boolean) => {\n\tconst uid = useUserId();\n\n\tconst { queryAllPermissions, queryAtLeastOnePermission, queryRole } = useContext(AuthorizationContext);\n\n\treturn useCallback(\n\t\t(button: IUIActionButton, room?: IRoom) => {\n\t\t\tconst { hasAllPermissions, hasOnePermission, hasAllRoles, hasOneRole } = button.when || {};\n\n\t\t\tconst hasAllPermissionsResult = hasAllPermissions ? queryAllPermissions(hasAllPermissions)[1]() : true;\n\t\t\tconst hasOnePermissionResult = hasOnePermission ? queryAtLeastOnePermission(hasOnePermission)[1]() : true;\n\t\t\tconst hasAllRolesResult = hasAllRoles ? !!uid && hasAllRoles.every((role) => queryRole(role, room?._id)) : true;\n\t\t\tconst hasOneRoleResult = hasOneRole ? !!uid && hasOneRole.some((role) => queryRole(role, room?._id)[1]()) : true;\n\n\t\t\treturn hasAllPermissionsResult && hasOnePermissionResult && hasAllRolesResult && hasOneRoleResult;\n\t\t},\n\t\t[queryAllPermissions, queryAtLeastOnePermission, queryRole, uid],\n\t);\n};\n",null],"names":["module","export","useApplyButtonFilters","useApplyButtonAuthFilter","RoomTypeFilter","isDirectMessageRoom","isMultipleDirectMessageRoom","isOmnichannelRoom","isPrivateDiscussion","isPrivateTeamRoom","isPublicDiscussion","isPublicTeamRoom","AuthorizationContext","useUserId","useCallback","useContext","useRoom","enumToFilter","_enumToFilter","PUBLIC_CHANNEL","room","t","PRIVATE_CHANNEL","PUBLIC_TEAM","PRIVATE_TEAM","PUBLIC_DISCUSSION","PRIVATE_DISCUSSION","DIRECT","DIRECT_MULTIPLE","LIVE_CHAT","applyRoomFilter","button","roomTypes","_ref","when","some","filter","_enumToFilter$filter","call","Error","applyAuthFilter","uid","_useContext","queryAllPermissions","queryAtLeastOnePermission","queryRole","_ref2","hasAllPermissions","hasOnePermission","hasAllRoles","hasOneRole","hasAllPermissionsResult","hasOnePermissionResult","hasAllRolesResult","every","role","_id","hasOneRoleResult"],"mappings":"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"}