)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useLicense.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { Serialized } from '@rocket.chat/core-typings';\nimport type { OperationResult } from '@rocket.chat/rest-typings';\nimport { useEndpoint, useSingleStream, useUserId } from '@rocket.chat/ui-contexts';\nimport type { QueryClient, UseQueryResult } from '@tanstack/react-query';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { useEffect } from 'react';\n\ntype LicenseDataType = Serialized<Awaited<OperationResult<'GET', '/v1/licenses.info'>>>;\n\ntype LicenseParams = {\n\tloadValues?: boolean;\n};\n\nconst invalidateQueryClientLicenses = (() => {\n\tlet timeout: ReturnType<typeof setTimeout> | undefined;\n\n\treturn (queryClient: QueryClient, milliseconds = 5000) => {\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(() => {\n\t\t\ttimeout = undefined;\n\t\t\tqueryClient.invalidateQueries(['licenses']);\n\t\t}, milliseconds);\n\t};\n})();\n\nexport const useLicenseBase = <TData = LicenseDataType>({\n\tparams,\n\tselect,\n}: {\n\tparams?: LicenseParams;\n\tselect: (data: LicenseDataType) => TData;\n}) => {\n\tconst uid = useUserId();\n\n\tconst getLicenses = useEndpoint('GET', '/v1/licenses.info');\n\n\tconst invalidateQueries = useInvalidateLicense();\n\n\tconst notify = useSingleStream('notify-all');\n\n\tuseEffect(() => notify('license', () => invalidateQueries()), [notify, invalidateQueries]);\n\n\treturn useQuery(['licenses', 'getLicenses', params], () => getLicenses({ ...params }), {\n\t\tstaleTime: Infinity,\n\t\tkeepPreviousData: true,\n\t\tselect,\n\t\tenabled: !!uid,\n\t});\n};\n\nexport const useLicense = (params?: LicenseParams) => {\n\treturn useLicenseBase({ params, select: (data) => data.license });\n};\n\nexport const useHasLicense = (): UseQueryResult<boolean> => {\n\treturn useLicenseBase({ select: (data) => Boolean(data.license) });\n};\n\nexport const useLicenseName = (params?: LicenseParams) => {\n\treturn useLicenseBase({ params, select: (data) => data?.license.tags?.map((tag) => tag.name).join(' ') || 'Community' });\n};\n\nexport const useInvalidateLicense = () => {\n\tconst queryClient = useQueryClient();\n\treturn (milliseconds?: number) => invalidateQueryClientLicenses(queryClient, milliseconds);\n};\n",null],"names":["module","link","default","v","_objectSpread","export","useLicenseBase","useLicense","useHasLicense","useLicenseName","useInvalidateLicense","useEndpoint","useSingleStream","useUserId","useQuery","useQueryClient","useEffect","timeout","invalidateQueryClientLicenses","queryClient","milliseconds","arguments","length","undefined","clearTimeout","setTimeout","invalidateQueries","_ref","params","select","uid","getLicenses","notify","staleTime","Infinity","keepPreviousData","enabled","data","license","Boolean","_data$license$tags","tags","map","tag","name","join"],"mappings":"uBAESA,EAAaC,IAAA,CAAA,uCAAkC,CAAAC,QAAAA,SAA2BC,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAAnFJ,EAAOK,MAAE,CAAA,CAAAC,eAAa,WAAiB,OAASA,CAAQ,EAAAC,WAAAA,WAA2B,OAAAA,CAAA,EAAAC,cAAAA,WAAA,OAAAA,CAAA,EAAAC,eAAAA,WAAA,OAAAA,CAAA,EAAAC,qBAAAA,WAAA,OAAAA,CAAA,CAAA,GAAAV,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAW,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,gBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAb,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAc,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAf,EAAAA,IAAAA,CAAAA,QAAAA,CAAAgB,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAWnF,IACKC,EAZLb,EAAmFO,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAW7EE,EAGE,SAACC,CAAwB,EAAyB,IAAvBC,EAAYC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAG,IAChDG,aAAaP,GACbA,EAAUQ,WAAW,WACpBR,EAAUM,KAAAA,EACVJ,EAAYO,iBAAiB,CAAC,CAAC,WAAW,CAC3C,EAAGN,EACJ,EAGYd,EAAiB,SAAAqB,CAAA,EAMzB,IALJC,EAAMD,EAANC,MAAM,CACNC,EAAMF,EAANE,MAAM,CAKAC,EAAMjB,IAENkB,EAAcpB,EAAY,MAAO,qBAEjCe,EAAoBhB,IAEpBsB,EAASpB,EAAgB,cAI/B,OAFAI,EAAU,WAAA,OAAMgB,EAAO,UAAW,WAAA,OAAMN,GAAmB,EAAC,EAAE,CAACM,EAAQN,EAAkB,EAElFZ,EAAS,CAAC,WAAY,cAAec,EAAO,CAAE,WAAA,OAAMG,EAAW3B,EAAA,CAAA,EAAMwB,GAAS,EAAE,CACtFK,UAAWC,IACXC,iBAAkB,CAAA,EAClBN,OAAAA,EACAO,QAAS,CAAC,CAACN,GAEb,EAEavB,EAAa,SAACqB,CAAsB,EAChD,OAAOtB,EAAe,CAAEsB,OAAAA,EAAQC,OAAQ,SAACQ,CAAI,EAAA,OAAKA,EAAKC,OAAO,CAAA,EAC/D,EAEa9B,EAAgB,WAC5B,OAAOF,EAAe,CAAEuB,OAAQ,SAACQ,CAAI,EAAA,MAAKE,CAAAA,CAAQF,EAAKC,OAAO,AAAC,CAAA,EAChE,EAEa7B,EAAiB,SAACmB,CAAsB,EACpD,OAAOtB,EAAe,CAAEsB,OAAAA,EAAQC,OAAQ,SAACQ,CAAI,EAAA,IAAAG,EAAA,MAAK,AAAAH,CAAAA,MAAAA,EAAI,KAAA,EAAA,AAAc,OAAdG,CAAAA,EAAJH,EAAMC,OAAO,CAACG,IAAI,AAAJA,GAAID,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAlBA,EAAoBE,GAAG,CAAC,SAACC,CAAG,EAAA,OAAKA,EAAIC,IAAI,GAAEC,IAAI,CAAC,IAAG,GAAK,WAAW,CAAA,EACtH,EAEanC,EAAuB,WACnC,IAAMS,EAAcJ,IACpB,OAAO,SAACK,CAAqB,EAAA,OAAKF,EAA8BC,EAAaC,EAAa,CAC3F"}