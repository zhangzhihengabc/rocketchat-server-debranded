)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/useReactiveQuery.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { UseQueryOptions, QueryKey, UseQueryResult } from '@tanstack/react-query';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { Tracker } from 'meteor/tracker';\n\nimport { queueMicrotask } from '../lib/utils/queueMicrotask';\n\nexport const useReactiveQuery = <TQueryFnData, TData = TQueryFnData, TQueryKey extends QueryKey = QueryKey>(\n\tqueryKey: TQueryKey,\n\treactiveQueryFn: () => TQueryFnData,\n\toptions?: UseQueryOptions<TQueryFnData, Error, TData, TQueryKey>,\n): UseQueryResult<TData, Error> => {\n\tconst queryClient = useQueryClient();\n\n\treturn useQuery(\n\t\tqueryKey,\n\t\t(): Promise<TQueryFnData> =>\n\t\t\tnew Promise((resolve, reject) => {\n\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\tTracker.autorun((c) => {\n\t\t\t\t\t\tconst data = reactiveQueryFn();\n\n\t\t\t\t\t\tif (c.firstRun) {\n\t\t\t\t\t\t\tif (data === undefined) {\n\t\t\t\t\t\t\t\treject(new Error('Reactive query returned undefined'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tqueryClient.invalidateQueries(queryKey, { exact: true });\n\t\t\t\t\t\tc.stop();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}),\n\t\t{ staleTime: Infinity, ...options },\n\t);\n};\n",null],"names":["module","link","default","_objectSpread","export","useReactiveQuery","useQuery","useQueryClient","Tracker","queueMicrotask","queryKey","reactiveQueryFn","options","queryClient","Promise","resolve","reject","autorun","c","data","firstRun","undefined","Error","invalidateQueries","exact","stop","staleTime","Infinity"],"mappings":"uBACiBA,EAAEC,IAAA,CAAA,uCAA8C,CAAAC,QAAAA,SAAAA,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAAjEH,EAAOI,MAAE,CAAA,CAAAC,iBAAU,WAAsB,OAAAA,CAAwB,CAAA,GAAAL,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAM,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAP,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAQ,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAS,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAK1D,IALPN,EAAiEG,EAAAC,EAAAC,EAAAC,EAKpDJ,EAAmB,SAC/BK,CAAmB,CACnBC,CAAmC,CACnCC,CAAgE,EAEhE,IAAMC,EAAcN,IAEpB,OAAOD,EACNI,EACA,WAAA,OACC,IAAII,QAAQ,SAACC,CAAO,CAAEC,CAAM,EAC3BP,EAAe,WACdD,EAAQS,OAAO,CAAC,SAACC,CAAC,EACjB,IAAMC,EAAOR,IAEb,GAAIO,EAAEE,QAAQ,CAAE,CACXD,AAASE,KAAAA,IAATF,EACHH,EAAO,AAAIM,MAAM,sCAEjBP,EAAQI,GAET,OAGDN,EAAYU,iBAAiB,CAACb,EAAU,CAAEc,MAAO,CAAA,CAAI,GACrDN,EAAEO,IAAI,EACP,EACD,EACD,EAAE,EAAAtB,EAAA,CACDuB,UAAWC,GAAQ,EAAKf,GAE5B"}