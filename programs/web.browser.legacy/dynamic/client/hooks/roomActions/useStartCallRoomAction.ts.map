)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/hooks/roomActions/useStartCallRoomAction.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useStableArray, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetting, useUser, usePermission } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { useVideoConfDispatchOutgoing, useVideoConfIsCalling, useVideoConfIsRinging } from '../../contexts/VideoConfContext';\nimport { VideoConfManager } from '../../lib/VideoConfManager';\nimport { useRoom } from '../../views/room/contexts/RoomContext';\nimport type { RoomToolboxActionConfig } from '../../views/room/contexts/RoomToolboxContext';\nimport { useVideoConfWarning } from '../../views/room/contextualBar/VideoConference/hooks/useVideoConfWarning';\n\nexport const useStartCallRoomAction = () => {\n\tconst room = useRoom();\n\tconst federated = isRoomFederated(room);\n\n\tconst ownUser = room.uids?.length === 1 ?? false;\n\tconst live = room?.streamingOptions?.type === 'call' ?? false;\n\n\tconst permittedToPostReadonly = usePermission('post-readonly', room._id);\n\tconst permittedToCallManagement = usePermission('call-management', room._id);\n\n\tconst dispatchWarning = useVideoConfWarning();\n\tconst dispatchPopup = useVideoConfDispatchOutgoing();\n\tconst isCalling = useVideoConfIsCalling();\n\tconst isRinging = useVideoConfIsRinging();\n\n\tconst { t } = useTranslation();\n\n\tconst enabledForDMs = useSetting('VideoConf_Enable_DMs', true);\n\tconst enabledForChannels = useSetting('VideoConf_Enable_Channels', true);\n\tconst enabledForTeams = useSetting('VideoConf_Enable_Teams', true);\n\tconst enabledForGroups = useSetting('VideoConf_Enable_Groups', true);\n\tconst enabledForLiveChat = useSetting('Omnichannel_call_provider', 'default-provider') === 'default-provider';\n\n\tconst groups = useStableArray(\n\t\t[\n\t\t\tenabledForDMs && 'direct',\n\t\t\tenabledForDMs && 'direct_multiple',\n\t\t\tenabledForGroups && 'group',\n\t\t\tenabledForLiveChat && 'live',\n\t\t\tenabledForTeams && 'team',\n\t\t\tenabledForChannels && 'channel',\n\t\t].filter((group): group is RoomToolboxActionConfig['groups'][number] => !!group),\n\t);\n\n\tconst enabled = groups.length > 0;\n\n\tconst user = useUser();\n\n\tconst allowed = enabled && permittedToCallManagement && (!user?.username || !room.muted?.includes(user.username)) && !ownUser;\n\n\tconst handleOpenVideoConf = useMutableCallback(async () => {\n\t\tif (isCalling || isRinging) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait VideoConfManager.loadCapabilities();\n\t\t\tdispatchPopup({ rid: room._id });\n\t\t} catch (error: any) {\n\t\t\tdispatchWarning(error.error);\n\t\t}\n\t});\n\n\tconst disabled = federated || (!!room.ro && !permittedToPostReadonly);\n\n\treturn useMemo((): RoomToolboxActionConfig | undefined => {\n\t\tif (!allowed) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'start-call',\n\t\t\tgroups,\n\t\t\ttitle: 'Call',\n\t\t\ticon: 'phone',\n\t\t\taction: () => void handleOpenVideoConf(),\n\t\t\t...(disabled && {\n\t\t\t\ttooltip: t('core.Video_Call_unavailable_for_this_type_of_room'),\n\t\t\t\tdisabled: true,\n\t\t\t}),\n\t\t\tfull: true,\n\t\t\torder: live ? -1 : 4,\n\t\t\tfeatured: true,\n\t\t};\n\t}, [allowed, disabled, groups, handleOpenVideoConf, live, t]);\n};\n",null],"names":["module","link","default","_objectSpread","_regeneratorRuntime","export","useStartCallRoomAction","isRoomFederated","useStableArray","useMutableCallback","useSetting","useUser","usePermission","useMemo","useTranslation","useVideoConfDispatchOutgoing","useVideoConfIsCalling","useVideoConfIsRinging","VideoConfManager","useRoom","useVideoConfWarning","_ref","_room$uids","_ref2","_room$streamingOption","_room$muted","room","federated","ownUser","uids","length","live","streamingOptions","type","permittedToPostReadonly","_id","permittedToCallManagement","dispatchWarning","dispatchPopup","isCalling","isRinging","t","_useTranslation","enabledForDMs","enabledForChannels","enabledForTeams","groups","enabledForGroups","enabledForLiveChat","filter","group","enabled","user","allowed","username","muted","includes","handleOpenVideoConf","async","_context","prev","next","abrupt","awrap","loadCapabilities","rid","t0","error","stop","Promise","disabled","ro","id","title","icon","action","tooltip","full","order","featured"],"mappings":"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"}