)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/UserAutoCompleteMultiple/UserAutoCompleteMultipleFederated.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { MultiSelectFiltered, Icon, Box, Chip } from '@rocket.chat/fuselage';\nimport { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport type { ReactElement, AllHTMLAttributes } from 'react';\nimport React, { memo, useState, useCallback, useMemo } from 'react';\n\nimport UserAvatar from '../avatar/UserAvatar';\nimport AutocompleteOptions, { OptionsContext } from './UserAutoCompleteMultipleOptions';\n\ntype UserAutoCompleteMultipleFederatedProps = {\n\tonChange: (value: Array<string>) => void;\n\tvalue: Array<string>;\n\tplaceholder?: string;\n} & Omit<AllHTMLAttributes<HTMLElement>, 'is' | 'onChange'>;\n\ntype UserAutoCompleteOptionType = {\n\tname: string;\n\tusername: string;\n\t_federated?: boolean;\n};\n\ntype UserAutoCompleteOptions = {\n\t[k: string]: UserAutoCompleteOptionType;\n};\n\nconst matrixRegex = new RegExp('@(.*:.*)');\n\nconst UserAutoCompleteMultipleFederated = ({\n\tonChange,\n\tvalue,\n\tplaceholder,\n\t...props\n}: UserAutoCompleteMultipleFederatedProps): ReactElement => {\n\tconst [filter, setFilter] = useState('');\n\tconst [selectedCache, setSelectedCache] = useState<UserAutoCompleteOptions>({});\n\n\tconst debouncedFilter = useDebouncedValue(filter, 500);\n\tconst getUsers = useEndpoint('GET', '/v1/users.autocomplete');\n\n\tconst { data } = useQuery(\n\t\t['users.autocomplete', debouncedFilter],\n\t\tasync () => {\n\t\t\tconst users = await getUsers({ selector: JSON.stringify({ term: debouncedFilter }) });\n\t\t\tconst options = users.items.map((item): [string, UserAutoCompleteOptionType] => [item.username, item]);\n\n\t\t\t// Add extra option if filter text matches `username:server`\n\t\t\t// Used to add federated users that do not exist yet\n\t\t\tif (matrixRegex.test(debouncedFilter)) {\n\t\t\t\toptions.unshift([debouncedFilter, { name: debouncedFilter, username: debouncedFilter, _federated: true }]);\n\t\t\t}\n\n\t\t\treturn options;\n\t\t},\n\t\t{ keepPreviousData: true },\n\t);\n\n\tconst options = useMemo(() => data || [], [data]);\n\n\tconst onAddUser = useCallback(\n\t\t(username: string): void => {\n\t\t\tconst user = options.find(([val]) => val === username)?.[1];\n\t\t\tif (!user) {\n\t\t\t\tthrow new Error('UserAutoCompleteMultiple - onAddSelected - failed to cache option');\n\t\t\t}\n\t\t\tsetSelectedCache((selectedCache) => ({ ...selectedCache, [username]: user }));\n\t\t},\n\t\t[setSelectedCache, options],\n\t);\n\n\tconst onRemoveUser = useCallback(\n\t\t(username: string): void =>\n\t\t\tsetSelectedCache((selectedCache) => {\n\t\t\t\tconst users = { ...selectedCache };\n\t\t\t\tdelete users[username];\n\t\t\t\treturn users;\n\t\t\t}),\n\t\t[setSelectedCache],\n\t);\n\n\tconst handleOnChange = useCallback(\n\t\t(usernames: string[]) => {\n\t\t\tonChange(usernames);\n\t\t\tconst newAddedUsername = usernames.filter((username) => !value.includes(username))[0];\n\t\t\tconst removedUsername = value.filter((username) => !usernames.includes(username))[0];\n\t\t\tsetFilter('');\n\t\t\tnewAddedUsername && onAddUser(newAddedUsername);\n\t\t\tremovedUsername && onRemoveUser(removedUsername);\n\t\t},\n\t\t[onChange, setFilter, onAddUser, onRemoveUser, value],\n\t);\n\n\treturn (\n\t\t<OptionsContext.Provider value={{ options }}>\n\t\t\t<MultiSelectFiltered\n\t\t\t\t{...props}\n\t\t\t\tdata-qa-type='user-auto-complete-input'\n\t\t\t\tplaceholder={placeholder}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOnChange}\n\t\t\t\tfilter={filter}\n\t\t\t\tsetFilter={setFilter}\n\t\t\t\trenderSelected={({ value, onMouseDown }: { value: string; onMouseDown: () => void }) => {\n\t\t\t\t\tconst currentCachedOption = selectedCache[value] || {};\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<Chip key={value} height='x20' onMouseDown={onMouseDown} mie={4} mb={2}>\n\t\t\t\t\t\t\t{currentCachedOption._federated ? <Icon size='x20' name='globe' /> : <UserAvatar size='x20' username={value} />}\n\t\t\t\t\t\t\t<Box is='span' margin='none' mis={4}>\n\t\t\t\t\t\t\t\t{currentCachedOption.name || currentCachedOption.username || value}\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t</Chip>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\trenderOptions={AutocompleteOptions}\n\t\t\t\toptions={options.concat(Object.entries(selectedCache)).map(([, item]) => [item.username, item.name || item.username])}\n\t\t\t\tdata-qa='create-channel-users-autocomplete'\n\t\t\t/>\n\t\t</OptionsContext.Provider>\n\t);\n};\n\nexport default memo(UserAutoCompleteMultipleFederated);\n",null],"names":["_regeneratorRuntime","_extends","_objectSpread","_slicedToArray","_objectWithoutProperties","MultiSelectFiltered","Icon","Box","Chip","useDebouncedValue","useEndpoint","useQuery","React","memo","useState","useCallback","useMemo","UserAvatar","AutocompleteOptions","OptionsContext","module","link","default","v","matrixRegex","RegExp","exportDefault","_ref","onChange","value","placeholder","props","_excluded","_useState2","filter","setFilter","_useState4","selectedCache","setSelectedCache","debouncedFilter","getUsers","data","_useQuery","options","async","_context","prev","next","awrap","selector","JSON","stringify","term","users","sent","items","map","item","username","test","unshift","name","_federated","abrupt","stop","Promise","keepPreviousData","onAddUser","_options$find","user","find","_ref2","val","_ref3","Error","_objectSpread2","onRemoveUser","handleOnChange","usernames","newAddedUsername","includes","removedUsername","createElement","Provider","renderSelected","_ref4","onMouseDown","currentCachedOption","key","height","mie","mb","size","is","margin","mis","renderOptions","concat","Object","entries","_ref5","_ref6"],"mappings":"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"}