)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser, AvatarObject } from '@rocket.chat/core-typings';\nimport { Box, Button, TextInput, Margins, Avatar, IconButton } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useSetting, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ChangeEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\n\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { isValidImageFormat } from '../../../lib/utils/isValidImageFormat';\nimport UserAvatar from '../UserAvatar';\nimport UserAvatarSuggestions from './UserAvatarSuggestions';\n\nconst toDataURL = (file: File, callback: (result: FileReader['result']) => void): void => {\n\tconst reader = new FileReader();\n\treader.onloadend = function (e): void {\n\t\tcallback(e?.target?.result || null);\n\t};\n\treader.readAsDataURL(file);\n};\n\ntype UserAvatarEditorType = {\n\tcurrentUsername: IUser['username'];\n\tusername: IUser['username'];\n\tsetAvatarObj: (obj: AvatarObject) => void;\n\tdisabled?: boolean;\n\tetag: IUser['avatarETag'];\n};\n\nfunction UserAvatarEditor({ currentUsername, username, setAvatarObj, disabled, etag }: UserAvatarEditorType): ReactElement {\n\tconst t = useTranslation();\n\tconst rotateImages = useSetting('FileUpload_RotateImages');\n\tconst [avatarFromUrl, setAvatarFromUrl] = useState('');\n\tconst [newAvatarSource, setNewAvatarSource] = useState<string>();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst setUploadedPreview = useCallback(\n\t\tasync (file, avatarObj) => {\n\t\t\tsetAvatarObj(avatarObj);\n\t\t\ttoDataURL(file, async (dataURL) => {\n\t\t\t\tif (typeof dataURL === 'string' && (await isValidImageFormat(dataURL))) {\n\t\t\t\t\tsetNewAvatarSource(dataURL);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Avatar_format_invalid') });\n\t\t\t});\n\t\t},\n\t\t[setAvatarObj, t, dispatchToastMessage],\n\t);\n\n\tconst [clickUpload] = useFileInput(setUploadedPreview);\n\n\tconst clickUrl = (): void => {\n\t\tsetNewAvatarSource(avatarFromUrl);\n\t\tsetAvatarObj({ avatarUrl: avatarFromUrl });\n\t};\n\n\tconst clickReset = (): void => {\n\t\tsetNewAvatarSource(`/avatar/%40${username}`);\n\t\tsetAvatarObj('reset');\n\t};\n\n\tconst url = newAvatarSource;\n\n\tconst handleAvatarFromUrlChange = (event: ChangeEvent<HTMLInputElement>): void => {\n\t\tsetAvatarFromUrl(event.currentTarget.value);\n\t};\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' fontScale='p2m' color='default'>\n\t\t\t{t('Profile_picture')}\n\t\t\t<Box display='flex' flexDirection='row' mbs={4}>\n\t\t\t\t<UserAvatar\n\t\t\t\t\tsize='x124'\n\t\t\t\t\turl={url}\n\t\t\t\t\tusername={currentUsername || ''}\n\t\t\t\t\tetag={etag}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tobjectFit: 'contain',\n\t\t\t\t\t\timageOrientation: rotateImages ? 'from-image' : 'none',\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<Box display='flex' flexDirection='column' flexGrow='1' justifyContent='space-between' mis={4}>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t\t<Button square mis='none' onClick={clickReset} disabled={disabled} mie={4} title={t('Accounts_SetDefaultAvatar')}>\n\t\t\t\t\t\t\t\t<Avatar url={`/avatar/%40${username}`} />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<IconButton icon='upload' secondary onClick={clickUpload} disabled={disabled} title={t('Upload')} />\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorSetAvatarLink'\n\t\t\t\t\t\t\t\ticon='permalink'\n\t\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\t\tonClick={clickUrl}\n\t\t\t\t\t\t\t\tdisabled={disabled || !avatarFromUrl}\n\t\t\t\t\t\t\t\ttitle={t('Add_URL')}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UserAvatarSuggestions setAvatarObj={setAvatarObj} setNewAvatarSource={setNewAvatarSource} disabled={disabled} />\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Margins inlineStart={4}>\n\t\t\t\t\t\t<Box>{t('Use_url_for_avatar')}</Box>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorLink'\n\t\t\t\t\t\t\tflexGrow={0}\n\t\t\t\t\t\t\tplaceholder={t('Use_url_for_avatar')}\n\t\t\t\t\t\t\tvalue={avatarFromUrl}\n\t\t\t\t\t\t\tonChange={handleAvatarFromUrlChange}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Margins>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n}\n\nexport default UserAvatarEditor;\n",null],"names":["module","link","default","v","_regeneratorRuntime","_slicedToArray","Box","Button","TextInput","Margins","Avatar","IconButton","useToastMessageDispatch","useSetting","useTranslation","React","useState","useCallback","useFileInput","isValidImageFormat","UserAvatar","UserAvatarSuggestions","toDataURL","file","callback","reader","FileReader","onloadend","e","_e$target","target","result","readAsDataURL","exportDefault","_ref","currentUsername","username","setAvatarObj","disabled","etag","t","rotateImages","_useState2","avatarFromUrl","setAvatarFromUrl","_useState4","newAvatarSource","setNewAvatarSource","dispatchToastMessage","clickUpload","_useFileInput2","avatarObj","async","_context2","prev","next","_callee","dataURL","_callee$","_context","t0","awrap","sent","abrupt","type","message","stop","Promise","createElement","display","flexDirection","fontScale","color","mbs","size","url","style","objectFit","imageOrientation","flexGrow","justifyContent","mis","inline","square","onClick","mie","title","icon","secondary","avatarUrl","inlineStart","placeholder","value","onChange","event","currentTarget"],"mappings":"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"}