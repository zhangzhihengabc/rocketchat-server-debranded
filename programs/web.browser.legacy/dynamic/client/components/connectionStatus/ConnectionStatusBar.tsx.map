)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/connectionStatus/ConnectionStatusBar.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Icon } from '@rocket.chat/fuselage';\nimport { useConnectionStatus, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { MouseEventHandler, FC } from 'react';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport './ConnectionStatusBar.styles.css';\n\n// TODO: frontend chapter day - fix unknown translation keys\n\nconst getReconnectCountdown = (retryTime: number): number => {\n\tconst timeDiff = retryTime - Date.now();\n\treturn (timeDiff > 0 && Math.round(timeDiff / 1000)) || 0;\n};\n\nconst useReconnectCountdown = (\n\tretryTime: number | undefined,\n\tstatus: 'connected' | 'connecting' | 'failed' | 'waiting' | 'offline',\n): number => {\n\tconst reconnectionTimerRef = useRef<ReturnType<typeof setInterval>>();\n\tconst [reconnectCountdown, setReconnectCountdown] = useState(() => (retryTime ? getReconnectCountdown(retryTime) : 0));\n\n\tuseEffect(() => {\n\t\tif (status === 'waiting') {\n\t\t\tif (reconnectionTimerRef.current) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treconnectionTimerRef.current = setInterval(() => {\n\t\t\t\tretryTime && setReconnectCountdown(getReconnectCountdown(retryTime));\n\t\t\t}, 500);\n\t\t\treturn;\n\t\t}\n\n\t\treconnectionTimerRef.current && clearInterval(reconnectionTimerRef.current);\n\t\treconnectionTimerRef.current = undefined;\n\t}, [retryTime, status]);\n\n\tuseEffect(\n\t\t() => (): void => {\n\t\t\treconnectionTimerRef.current && clearInterval(reconnectionTimerRef.current);\n\t\t},\n\t\t[],\n\t);\n\n\treturn reconnectCountdown;\n};\n\nconst ConnectionStatusBar: FC = function ConnectionStatusBar() {\n\tconst { connected, retryTime, status, reconnect } = useConnectionStatus();\n\tconst reconnectCountdown = useReconnectCountdown(retryTime, status);\n\tconst t = useTranslation();\n\n\tif (connected) {\n\t\treturn null;\n\t}\n\n\tconst handleRetryClick: MouseEventHandler<HTMLAnchorElement> = (event) => {\n\t\tevent.preventDefault();\n\t\treconnect?.();\n\t};\n\n\treturn (\n\t\t<div className='ConnectionStatusBar' role='alert'>\n\t\t\t<strong>\n\t\t\t\t<Icon name='warning' /> {t('meteor_status' as Parameters<typeof t>[0], { context: status })}\n\t\t\t</strong>\n\n\t\t\t{status === 'waiting' && <> {t('meteor_status_reconnect_in', { count: reconnectCountdown })}</>}\n\n\t\t\t{['waiting', 'offline'].includes(status) && (\n\t\t\t\t<>\n\t\t\t\t\t{' '}\n\t\t\t\t\t<a className='ConnectionStatusBar__retry-link' href='#' onClick={handleRetryClick}>\n\t\t\t\t\t\t{t('meteor_status_try_now' as Parameters<typeof t>[0], { context: status })}\n\t\t\t\t\t</a>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default ConnectionStatusBar;\n",null],"names":["module","link","default","_slicedToArray","Icon","useConnectionStatus","useTranslation","v","React","useEffect","useRef","useState","getReconnectCountdown","retryTime","timeDiff","Date","now","Math","round","useReconnectCountdown","status","reconnectionTimerRef","_useState2","reconnectCountdown","setReconnectCountdown","current","setInterval","clearInterval","undefined","exportDefault","_useConnectionStatus","connected","reconnect","t","createElement","className","role","name","context","Fragment","count","includes","href","onClick","event","preventDefault"],"mappings":"uBAAeA,EAAMC,IAAA,CAAA,uCAAwB,CAAAC,QAAAA,SAAAA,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAApCH,EAAMC,IAAA,CAAM,wBAAwB,CAAAG,KAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAJ,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAK,oBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAN,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAO,CAAA,EAAAC,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAX,EAAAA,IAAAA,CAAAA,oCAS7C,IATAG,EAAAC,EAA6CC,EAAAC,EAAAE,EAAAC,EAAAC,EAAAC,EASvCC,EAAwB,SAACC,CAAiB,EAC/C,IAAMC,EAAWD,EAAYE,KAAKC,GAAG,GACrC,OAAQF,EAAW,GAAKG,KAAKC,KAAK,CAACJ,EAAW,MAAU,CACzD,EAEMK,EAAwB,SAC7BN,CAA6B,CAC7BO,CAAqE,EAErE,IAAMC,EAAuBX,IACyFY,EAAAnB,EAAlEQ,EAAS,WAAA,OAAOE,EAAYD,EAAsBC,GAAa,CAAC,GAAE,GAA/GU,EAAkBD,CAAA,CAAA,EAAA,CAAEE,EAAqBF,CAAA,CAAA,EAAA,CAyBhD,OAvBAb,EAAU,WACT,GAAIW,AAAW,YAAXA,EAAsB,CACzB,GAAIC,EAAqBI,OAAO,CAC/B,MAGDJ,CAAAA,EAAqBI,OAAO,CAAGC,YAAY,WAC1Cb,GAAaW,EAAsBZ,EAAsBC,GAC1D,EAAG,KACH,OAGDQ,EAAqBI,OAAO,EAAIE,cAAcN,EAAqBI,OAAO,EAC1EJ,EAAqBI,OAAO,CAAGG,KAAAA,CAChC,EAAG,CAACf,EAAWO,EAAO,EAEtBX,EACC,WAAA,OAAM,WACLY,EAAqBI,OAAO,EAAIE,cAAcN,EAAqBI,OAAO,CAC3E,CAAC,EACD,EAAE,EAGIF,CACR,EA7CAvB,EAAO6B,aAAQ,CA+CiB,WAC/B,IAAAC,EAAoDzB,IAA5C0B,EAASD,EAATC,SAAS,CAAElB,EAASiB,EAATjB,SAAS,CAAEO,EAAMU,EAANV,MAAM,CAAEY,EAASF,EAATE,SAAS,CACzCT,EAAqBJ,EAAsBN,EAAWO,GACtDa,EAAI3B,WAEV,AAAIyB,EACI,KASPvB,EAAA0B,aAAA,CAAA,MAAA,CAAKC,UAAU,sBAAsBC,KAAK,OAAO,EAChD5B,EAAA0B,aAAA,CAAA,SAAA,KACC1B,EAAA0B,aAAA,CAAC9B,EAAI,CAACiC,KAAK,SAAS,GAAI,IAACJ,EAAE,gBAA4C,CAAEK,QAASlB,CAAM,IAGxFA,AAAW,YAAXA,GAAwBZ,EAAA0B,aAAA,CAAA1B,EAAA+B,QAAA,CAAA,KAAG,IAACN,EAAE,6BAA8B,CAAEO,MAAOjB,CAAkB,IAEvF,CAAC,UAAW,UAAU,CAACkB,QAAQ,CAACrB,IAChCZ,EAAA0B,aAAA,CAAA1B,EAAA+B,QAAA,CAAA,KACE,IACD/B,EAAA0B,aAAA,CAAA,IAAA,CAAGC,UAAU,kCAAkCO,KAAK,IAAIC,QAhBG,SAACC,CAAK,EACpEA,EAAMC,cAAc,GACpBb,MAAAA,GAAAA,GACD,CAasF,EAChFC,EAAE,wBAAoD,CAAEK,QAASlB,CAAM,KAM9E"}