)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/message/toolbox/MessageToolbox.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, IRoom, ISubscription, ITranslatedMessage } from '@rocket.chat/core-typings';\nimport { isThreadMessage, isRoomFederated, isVideoConfMessage } from '@rocket.chat/core-typings';\nimport { MessageToolbox as FuselageMessageToolbox, MessageToolboxItem } from '@rocket.chat/fuselage';\nimport { useFeaturePreview } from '@rocket.chat/ui-client';\nimport { useUser, useSettings, useTranslation, useMethod } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport type { ReactElement } from 'react';\nimport React, { memo, useMemo } from 'react';\n\nimport type { MessageActionContext } from '../../../../app/ui-utils/client/lib/MessageAction';\nimport { MessageAction } from '../../../../app/ui-utils/client/lib/MessageAction';\nimport { useEmojiPickerData } from '../../../contexts/EmojiPickerContext';\nimport { useMessageActionAppsActionButtons } from '../../../hooks/useAppActionButtons';\nimport EmojiElement from '../../../views/composer/EmojiPicker/EmojiElement';\nimport { useIsSelecting } from '../../../views/room/MessageList/contexts/SelectedMessagesContext';\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\nimport { useChat } from '../../../views/room/contexts/ChatContext';\nimport { useRoomToolbox } from '../../../views/room/contexts/RoomToolboxContext';\nimport MessageActionMenu from './MessageActionMenu';\n\nconst getMessageContext = (message: IMessage, room: IRoom, context?: MessageActionContext): MessageActionContext => {\n\tif (context) {\n\t\treturn context;\n\t}\n\n\tif (isVideoConfMessage(message)) {\n\t\treturn 'videoconf';\n\t}\n\n\tif (isRoomFederated(room)) {\n\t\treturn 'federated';\n\t}\n\n\tif (isThreadMessage(message)) {\n\t\treturn 'threads';\n\t}\n\n\treturn 'message';\n};\n\ntype MessageToolboxProps = {\n\tmessage: IMessage & Partial<ITranslatedMessage>;\n\tmessageContext?: MessageActionContext;\n\troom: IRoom;\n\tsubscription?: ISubscription;\n\tonChangeMenuVisibility: (visible: boolean) => void;\n};\n\nconst MessageToolbox = ({\n\tmessage,\n\tmessageContext,\n\troom,\n\tsubscription,\n\tonChangeMenuVisibility,\n}: MessageToolboxProps): ReactElement | null => {\n\tconst t = useTranslation();\n\tconst user = useUser() ?? undefined;\n\tconst settings = useSettings();\n\n\tconst quickReactionsEnabled = useFeaturePreview('quickReactions');\n\n\tconst setReaction = useMethod('setReaction');\n\n\tconst context = getMessageContext(message, room, messageContext);\n\n\tconst mapSettings = useMemo(() => Object.fromEntries(settings.map((setting) => [setting._id, setting.value])), [settings]);\n\n\tconst chat = useChat();\n\tconst { quickReactions, addRecentEmoji } = useEmojiPickerData();\n\n\tconst actionButtonApps = useMessageActionAppsActionButtons(context);\n\n\tconst actionsQueryResult = useQuery(['rooms', room._id, 'messages', message._id, 'actions'] as const, async () => {\n\t\tconst props = { message, room, user, subscription, settings: mapSettings, chat };\n\n\t\tconst toolboxItems = await MessageAction.getAll(props, context, 'message');\n\t\tconst menuItems = await MessageAction.getAll(props, context, 'menu');\n\n\t\treturn { message: toolboxItems, menu: menuItems };\n\t});\n\n\tconst toolbox = useRoomToolbox();\n\n\tconst selecting = useIsSelecting();\n\n\tconst autoTranslateOptions = useAutoTranslate(subscription);\n\n\tif (selecting) {\n\t\treturn null;\n\t}\n\n\tconst isReactionAllowed = actionsQueryResult.data?.message.find(({ id }) => id === 'reaction-message');\n\n\tconst handleSetReaction = (emoji: string) => {\n\t\tsetReaction(`:${emoji}:`, message._id);\n\t\taddRecentEmoji(emoji);\n\t};\n\n\treturn (\n\t\t<FuselageMessageToolbox>\n\t\t\t{quickReactionsEnabled &&\n\t\t\t\tisReactionAllowed &&\n\t\t\t\tquickReactions.slice(0, 3).map(({ emoji, image }) => {\n\t\t\t\t\treturn <EmojiElement small key={emoji} title={emoji} emoji={emoji} image={image} onClick={() => handleSetReaction(emoji)} />;\n\t\t\t\t})}\n\t\t\t{actionsQueryResult.isSuccess &&\n\t\t\t\tactionsQueryResult.data.message.map((action) => (\n\t\t\t\t\t<MessageToolboxItem\n\t\t\t\t\t\tonClick={(e): void => action.action(e, { message, tabbar: toolbox, room, chat, autoTranslateOptions })}\n\t\t\t\t\t\tkey={action.id}\n\t\t\t\t\t\ticon={action.icon}\n\t\t\t\t\t\ttitle={t(action.label)}\n\t\t\t\t\t\tdata-qa-id={action.label}\n\t\t\t\t\t\tdata-qa-type='message-action-menu'\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t{actionsQueryResult.isSuccess && actionsQueryResult.data.menu.length > 0 && (\n\t\t\t\t<MessageActionMenu\n\t\t\t\t\tonChangeMenuVisibility={onChangeMenuVisibility}\n\t\t\t\t\toptions={[...actionsQueryResult.data?.menu, ...(actionButtonApps.data ?? [])].filter(Boolean).map((action) => ({\n\t\t\t\t\t\t...action,\n\t\t\t\t\t\taction: (e): void => action.action(e, { message, tabbar: toolbox, room, chat, autoTranslateOptions }),\n\t\t\t\t\t}))}\n\t\t\t\t\tdata-qa-type='message-action-menu-options'\n\t\t\t\t/>\n\t\t\t)}\n\t\t</FuselageMessageToolbox>\n\t);\n};\n\nexport default memo(MessageToolbox);\n",null],"names":["_objectSpread","_toConsumableArray","_regeneratorRuntime","isThreadMessage","isRoomFederated","isVideoConfMessage","FuselageMessageToolbox","MessageToolboxItem","useFeaturePreview","useUser","useSettings","useTranslation","useMethod","useQuery","React","memo","useMemo","MessageAction","useEmojiPickerData","useMessageActionAppsActionButtons","EmojiElement","useIsSelecting","useAutoTranslate","useChat","useRoomToolbox","MessageActionMenu","module","link","default","v","MessageToolbox","exportDefault","_ref","_useUser","_actionsQueryResult$d","_actionsQueryResult$d2","_actionButtonApps$dat","message","messageContext","room","subscription","onChangeMenuVisibility","t","user","undefined","settings","quickReactionsEnabled","setReaction","context","mapSettings","Object","fromEntries","map","setting","_id","value","chat","_useEmojiPickerData","quickReactions","addRecentEmoji","actionButtonApps","actionsQueryResult","props","toolboxItems","menuItems","async","_context","prev","next","awrap","getAll","sent","abrupt","menu","stop","Promise","toolbox","selecting","autoTranslateOptions","isReactionAllowed","data","find","_ref2","id","handleSetReaction","emoji","createElement","slice","_ref3","image","small","key","title","onClick","isSuccess","action","e","tabbar","icon","label","length","options","concat","filter","Boolean"],"mappings":"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"}