)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/message/content/UrlPreviews.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { MessageBlock } from '@rocket.chat/fuselage';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport { useOembedLayout } from '../hooks/useOembedLayout';\nimport type { OEmbedPreviewMetadata } from './urlPreviews/OEmbedPreviewMetadata';\nimport OEmbedResolver from './urlPreviews/OEmbedResolver';\nimport UrlPreview from './urlPreviews/UrlPreview';\nimport type { UrlPreviewMetadata } from './urlPreviews/UrlPreviewMetadata';\nimport { buildImageURL } from './urlPreviews/buildImageURL';\n\ntype OembedUrlLegacy = Required<IMessage>['urls'][0];\n\ntype PreviewTypes = 'headers' | 'oembed';\n\ntype PreviewData = {\n\ttype: PreviewTypes;\n\tdata: OEmbedPreviewMetadata | UrlPreviewMetadata;\n};\n\nconst normalizeMeta = ({ url, meta }: { url: string; meta: Record<string, string> }): OEmbedPreviewMetadata => {\n\tconst image = meta.ogImage || meta.twitterImage || meta.msapplicationTileImage || meta.oembedThumbnailUrl || meta.oembedThumbnailUrl;\n\n\tconst imageHeight = meta.ogImageHeight || meta.oembedHeight || meta.oembedThumbnailHeight;\n\tconst imageWidth = meta.ogImageWidth || meta.oembedWidth || meta.oembedThumbnailWidth;\n\n\treturn Object.fromEntries(\n\t\tObject.entries({\n\t\t\tsiteName: meta.ogSiteName || meta.oembedProviderName,\n\t\t\tsiteUrl: meta.ogUrl || meta.oembedProviderUrl,\n\t\t\ttitle: meta.ogTitle || meta.twitterTitle || meta.title || meta.pageTitle || meta.oembedTitle,\n\t\t\tdescription: meta.ogDescription || meta.twitterDescription || meta.description,\n\t\t\tauthorName: meta.oembedAuthorName,\n\t\t\tauthorUrl: meta.oembedAuthorUrl,\n\t\t\t...(image && {\n\t\t\t\timage: {\n\t\t\t\t\turl: buildImageURL(url, image),\n\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t...(imageHeight && { height: imageHeight }),\n\t\t\t\t\t\t...(imageWidth && { width: imageWidth }),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\turl: meta.oembedUrl || url,\n\t\t\ttype: meta.ogType || meta.oembedType,\n\t\t\t...(meta.oembedHtml && { html: meta.oembedHtml }),\n\t\t}).filter(([, value]) => value),\n\t);\n};\n\nconst hasContentType = (headers: OembedUrlLegacy['headers']): headers is { contentType: string } =>\n\theaders ? 'contentType' in headers : false;\n\nconst getHeaderType = (headers: OembedUrlLegacy['headers']): UrlPreviewMetadata['type'] | undefined => {\n\tif (!hasContentType(headers)) {\n\t\treturn;\n\t}\n\tif (headers.contentType.match(/image\\/.*/)) {\n\t\treturn 'image';\n\t}\n\tif (headers.contentType.match(/audio\\/.*/)) {\n\t\treturn 'audio';\n\t}\n\tif (headers.contentType.match(/video\\/.*/)) {\n\t\treturn 'video';\n\t}\n};\n\nconst isValidPreviewMeta = ({\n\tsiteName,\n\tsiteUrl,\n\tauthorName,\n\tauthorUrl,\n\ttitle,\n\tdescription,\n\timage,\n\thtml,\n}: OEmbedPreviewMetadata): boolean =>\n\t!((!siteName || !siteUrl) && (!authorName || !authorUrl) && !title && !description && !image && !html);\n\nconst hasMeta = (url: OembedUrlLegacy): url is { url: string; meta: Record<string, string> } => !!url.meta && !!Object.values(url.meta);\n\nconst processMetaAndHeaders = (url: OembedUrlLegacy): PreviewData | false => {\n\tif (!url.headers && !url.meta) {\n\t\treturn false;\n\t}\n\n\tconst data = hasMeta(url) ? normalizeMeta(url) : undefined;\n\tif (data && isValidPreviewMeta(data)) {\n\t\treturn { type: 'oembed', data };\n\t}\n\n\tconst type = getHeaderType(url.headers);\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\ttype: 'headers',\n\t\tdata: { url: url.url, type, originalType: hasContentType(url.headers) ? url.headers?.contentType : '' },\n\t};\n};\n\nconst isPreviewData = (data: PreviewData | false): data is PreviewData => !!data;\n\nconst isMetaPreview = (_data: PreviewData['data'], type: PreviewTypes): _data is OEmbedPreviewMetadata => type === 'oembed';\n\ntype UrlPreviewsProps = { urls: OembedUrlLegacy[] };\n\nconst UrlPreviews = ({ urls }: UrlPreviewsProps): ReactElement | null => {\n\tconst { maxWidth: oembedMaxWidth } = useOembedLayout();\n\tconst metaAndHeaders = urls.map(processMetaAndHeaders).filter(isPreviewData);\n\n\treturn (\n\t\t<>\n\t\t\t{metaAndHeaders.map(({ type, data }, index) => {\n\t\t\t\tif (isMetaPreview(data, type)) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t\t<OEmbedResolver meta={data} />\n\t\t\t\t\t\t</MessageBlock>\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t<UrlPreview {...data} />\n\t\t\t\t\t</MessageBlock>\n\t\t\t\t);\n\t\t\t})}\n\t\t</>\n\t);\n};\n\nexport default UrlPreviews;\n",null],"names":["module","link","default","_slicedToArray","_objectSpread","MessageBlock","v","React","useOembedLayout","OEmbedResolver","UrlPreview","buildImageURL","normalizeMeta","_ref","url","meta","image","ogImage","twitterImage","msapplicationTileImage","oembedThumbnailUrl","imageHeight","ogImageHeight","oembedHeight","oembedThumbnailHeight","imageWidth","ogImageWidth","oembedWidth","oembedThumbnailWidth","Object","fromEntries","entries","siteName","ogSiteName","oembedProviderName","siteUrl","ogUrl","oembedProviderUrl","title","ogTitle","twitterTitle","pageTitle","oembedTitle","description","ogDescription","twitterDescription","authorName","oembedAuthorName","authorUrl","oembedAuthorUrl","dimensions","height","width","oembedUrl","type","ogType","oembedType","oembedHtml","html","filter","_ref2","_ref3","hasContentType","headers","isValidPreviewMeta","_ref4","processMetaAndHeaders","_url$headers","data","hasMeta","values","undefined","contentType","match","originalType","isPreviewData","exportDefault","_ref5","urls","oembedMaxWidth","_useOembedLayout","maxWidth","metaAndHeaders","map","createElement","Fragment","_ref6","index","key"],"mappings":"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"}