)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/RoomIcon/OmnichannelRoomIcon/provider/OmnichannelRoomIconProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { FC } from 'react';\nimport React, { useCallback, useMemo } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\n\nimport type { AsyncState } from '../../../../lib/asyncState/AsyncState';\nimport { AsyncStatePhase } from '../../../../lib/asyncState/AsyncStatePhase';\nimport { OmnichannelRoomIconContext } from '../context/OmnichannelRoomIconContext';\nimport OmnichannelRoomIcon from '../lib/OmnichannelRoomIcon';\n\nlet icons = Array.from(OmnichannelRoomIcon.icons.values());\n\nexport const OmnichannelRoomIconProvider: FC = ({ children }) => {\n\tconst svgIcons = useSyncExternalStore(\n\t\tuseCallback(\n\t\t\t(callback): (() => void) =>\n\t\t\t\tOmnichannelRoomIcon.on('change', () => {\n\t\t\t\t\ticons = Array.from(OmnichannelRoomIcon.icons.values());\n\t\t\t\t\tcallback();\n\t\t\t\t}),\n\t\t\t[],\n\t\t),\n\t\t(): string[] => icons,\n\t);\n\n\treturn (\n\t\t<OmnichannelRoomIconContext.Provider\n\t\t\tvalue={useMemo(() => {\n\t\t\t\tconst extractSnapshot = (app: string, iconName: string): AsyncState<string> => {\n\t\t\t\t\tconst icon = OmnichannelRoomIcon.get(app, iconName);\n\n\t\t\t\t\tif (icon) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tphase: AsyncStatePhase.RESOLVED,\n\t\t\t\t\t\t\tvalue: icon,\n\t\t\t\t\t\t\terror: undefined,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tphase: AsyncStatePhase.LOADING,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\terror: undefined,\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t// We cache all the icons here, so that we can use them in the OmnichannelRoomIcon component\n\t\t\t\tconst snapshots = new Map<string, AsyncState<string>>();\n\n\t\t\t\treturn {\n\t\t\t\t\tqueryIcon: (\n\t\t\t\t\t\tapp: string,\n\t\t\t\t\t\ticonName: string,\n\t\t\t\t\t): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => AsyncState<string>] => [\n\t\t\t\t\t\t(callback): (() => void) =>\n\t\t\t\t\t\t\tOmnichannelRoomIcon.on(`${app}-${iconName}`, () => {\n\t\t\t\t\t\t\t\tsnapshots.set(`${app}-${iconName}`, extractSnapshot(app, iconName));\n\n\t\t\t\t\t\t\t\t// Then we call the callback (onStoreChange), signaling React to re-render\n\t\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t\t}),\n\n\t\t\t\t\t\t// No problem here, because it's return value is a cached in the snapshots map on subsequent calls\n\t\t\t\t\t\t(): AsyncState<string> => {\n\t\t\t\t\t\t\tlet snapshot = snapshots.get(`${app}-${iconName}`);\n\n\t\t\t\t\t\t\tif (!snapshot) {\n\t\t\t\t\t\t\t\tsnapshot = extractSnapshot(app, iconName);\n\t\t\t\t\t\t\t\tsnapshots.set(`${app}-${iconName}`, snapshot);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn snapshot;\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t};\n\t\t\t}, [])}\n\t\t>\n\t\t\t{createPortal(\n\t\t\t\t<svg\n\t\t\t\t\txmlns='http://www.w3.org/2000/svg'\n\t\t\t\t\txmlnsXlink='http://www.w3.org/1999/xlink'\n\t\t\t\t\tstyle={{ display: 'none' }}\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: svgIcons.join('') }}\n\t\t\t\t/>,\n\t\t\t\tdocument.body,\n\t\t\t\t'custom-icons',\n\t\t\t)}\n\t\t\t{children}\n\t\t</OmnichannelRoomIconContext.Provider>\n\t);\n};\n",null],"names":["module","export","OmnichannelRoomIconProvider","v","React","useCallback","useMemo","createPortal","useSyncExternalStore","AsyncStatePhase","OmnichannelRoomIconContext","OmnichannelRoomIcon","icons","Array","from","values","_ref","children","svgIcons","callback","on","createElement","Provider","value","extractSnapshot","app","iconName","icon","get","phase","RESOLVED","error","undefined","LOADING","snapshots","Map","queryIcon","set","snapshot","xmlns","xmlnsXlink","style","display","dangerouslySetInnerHTML","__html","join","document","body"],"mappings":"uBACAA,EAAOC,MAAK,CAAE,CAAAC,4BAAwB,WAAc,OAAAA,CAAA,CAAA,GAAAF,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAC,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAN,EAAAA,IAAAA,CAAAA,YAAAA,CAAAO,aAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAP,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAQ,qBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,6CAAAA,CAAAS,gBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAT,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAU,2BAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAV,EAAAA,IAAAA,CAAAA,6BAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAQ,EAAAA,CAAA,CAAA,EAAA,GASpD,IAToDP,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAShDC,EAAQC,MAAMC,IAAI,CAACH,EAAoBC,KAAK,CAACG,MAAM,IAE1Cb,EAAkC,SAAAc,CAAA,EAAiB,IAAdC,EAAQD,EAARC,QAAQ,CACnDC,EAAWV,EAChBH,EACC,SAACc,CAAQ,EAAA,OACRR,EAAoBS,EAAE,CAAC,SAAU,WAChCR,EAAQC,MAAMC,IAAI,CAACH,EAAoBC,KAAK,CAACG,MAAM,IACnDI,GACD,EAAE,EACH,EAAE,EAEH,WAAA,OAAgBP,CAAK,GAGtB,OACCR,EAAAiB,aAAA,CAACX,EAA2BY,QAAQ,CAAA,CACnCC,MAAOjB,EAAQ,WACd,IAAMkB,EAAkB,SAACC,CAAW,CAAEC,CAAgB,EACrD,IAAMC,EAAOhB,EAAoBiB,GAAG,CAACH,EAAKC,UAE1C,AAAIC,EACI,CACNE,MAAOpB,EAAgBqB,QAAQ,CAC/BP,MAAOI,EACPI,MAAOC,KAAAA,GAIF,CACNH,MAAOpB,EAAgBwB,OAAO,CAC9BV,MAAOS,KAAAA,EACPD,MAAOC,KAAAA,EAET,EAGME,EAAY,IAAIC,IAEtB,MAAO,CACNC,UAAW,SACVX,CAAW,CACXC,CAAgB,EAAA,MACmF,CACnG,SAACP,CAAQ,EAAA,OACRR,EAAoBS,EAAE,CAAIK,EAAG,IAAIC,EAAY,WAC5CQ,EAAUG,GAAG,CAAIZ,EAAG,IAAIC,EAAYF,EAAgBC,EAAKC,IAGzDP,GACD,EAAE,EAGH,WACC,IAAImB,EAAWJ,EAAUN,GAAG,CAAIH,EAAG,IAAIC,GAOvC,OALKY,IACJA,EAAWd,EAAgBC,EAAKC,GAChCQ,EAAUG,GAAG,CAAIZ,EAAG,IAAIC,EAAYY,IAG9BA,CACR,EACA,EAEH,EAAG,EAAE,CAAE,EAEN/B,EACAH,EAAAiB,aAAA,CAAA,MAAA,CACCkB,MAAM,6BACNC,WAAW,+BACXC,MAAO,CAAEC,QAAS,MAAM,EACxBC,wBAAyB,CAAEC,OAAQ1B,EAAS2B,IAAI,CAAC,GAAG,CAAG,GAExDC,SAASC,IAAI,CACb,gBAEA9B,EAGJ"}