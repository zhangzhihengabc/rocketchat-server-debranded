)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/components/Omnichannel/modals/ForwardChatModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport {\n\tField,\n\tFieldGroup,\n\tButton,\n\tTextAreaInput,\n\tModal,\n\tBox,\n\tPaginatedSelectFiltered,\n\tDivider,\n\tFieldLabel,\n\tFieldRow,\n} from '@rocket.chat/fuselage';\nimport { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\nimport { useEndpoint, useSetting, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { useRecordList } from '../../../hooks/lists/useRecordList';\nimport { AsyncStatePhase } from '../../../hooks/useAsyncState';\nimport AutoCompleteAgent from '../../AutoCompleteAgent';\nimport { useDepartmentsList } from '../hooks/useDepartmentsList';\n\nconst ForwardChatModal = ({\n\tonForward,\n\tonCancel,\n\troom,\n\t...props\n}: {\n\tonForward: (departmentId?: string, userId?: string, comment?: string) => Promise<void>;\n\tonCancel: () => void;\n\troom: IOmnichannelRoom;\n}): ReactElement => {\n\tconst t = useTranslation();\n\tconst getUserData = useEndpoint('GET', '/v1/users.info');\n\tconst idleAgentsAllowedForForwarding = useSetting('Livechat_enabled_when_agent_idle') as boolean;\n\n\tconst { getValues, handleSubmit, register, setFocus, setValue, watch } = useForm();\n\n\tuseEffect(() => {\n\t\tsetFocus('comment');\n\t}, [setFocus]);\n\n\tconst department = watch('department');\n\tconst username = watch('username');\n\n\tconst [departmentsFilter, setDepartmentsFilter] = useState<string | number | undefined>('');\n\tconst debouncedDepartmentsFilter = useDebouncedValue(departmentsFilter, 500);\n\n\tconst { itemsList: departmentsList, loadMoreItems: loadMoreDepartments } = useDepartmentsList(\n\t\tuseMemo(() => ({ filter: debouncedDepartmentsFilter as string, enabled: true }), [debouncedDepartmentsFilter]),\n\t);\n\tconst { phase: departmentsPhase, items: departments, itemCount: departmentsTotal } = useRecordList(departmentsList);\n\n\tconst endReached = useCallback(\n\t\t(start) => {\n\t\t\tif (departmentsPhase !== AsyncStatePhase.LOADING) {\n\t\t\t\tloadMoreDepartments(start, Math.min(50, departmentsTotal));\n\t\t\t}\n\t\t},\n\t\t[departmentsPhase, departmentsTotal, loadMoreDepartments],\n\t);\n\n\tconst onSubmit = useCallback(\n\t\tasync ({ department: departmentId, username, comment }) => {\n\t\t\tlet uid;\n\n\t\t\tif (username) {\n\t\t\t\tconst { user } = await getUserData({ username });\n\t\t\t\tuid = user?._id;\n\t\t\t}\n\n\t\t\tonForward(departmentId, uid, comment);\n\t\t},\n\t\t[getUserData, onForward],\n\t);\n\n\tuseEffect(() => {\n\t\tregister('department');\n\t\tregister('username');\n\t}, [register]);\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} />} {...props}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Icon name='baloon-arrow-top-right' />\n\t\t\t\t<Modal.Title>{t('Forward_chat')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t<FieldGroup>\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel>{t('Forward_to_department')}</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<PaginatedSelectFiltered\n\t\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\t\tfilter={departmentsFilter as string}\n\t\t\t\t\t\t\t\tsetFilter={setDepartmentsFilter}\n\t\t\t\t\t\t\t\toptions={departments}\n\t\t\t\t\t\t\t\tmaxWidth='100%'\n\t\t\t\t\t\t\t\tplaceholder={t('Select_an_option')}\n\t\t\t\t\t\t\t\tonChange={(value: string): void => {\n\t\t\t\t\t\t\t\t\tsetValue('department', value);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\tendReached={endReached}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t</Field>\n\t\t\t\t\t<Divider p={0} children={t('or')} />\n\t\t\t\t\t<Field>\n\t\t\t\t\t\t<FieldLabel>{t('Forward_to_user')}</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<AutoCompleteAgent\n\t\t\t\t\t\t\t\twithTitle\n\t\t\t\t\t\t\t\tonlyAvailable\n\t\t\t\t\t\t\t\tvalue={getValues().username}\n\t\t\t\t\t\t\t\texcludeId={room.servedBy?._id}\n\t\t\t\t\t\t\t\tshowIdleAgents={idleAgentsAllowedForForwarding}\n\t\t\t\t\t\t\t\tplaceholder={t('Username_name_email')}\n\t\t\t\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\t\t\t\tsetValue('username', value);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t</Field>\n\t\t\t\t\t<Field marginBlock={15}>\n\t\t\t\t\t\t<FieldLabel>\n\t\t\t\t\t\t\t{t('Leave_a_comment')}{' '}\n\t\t\t\t\t\t\t<Box is='span' color='annotation'>\n\t\t\t\t\t\t\t\t({t('Optional')})\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t<TextAreaInput data-qa-id='ForwardChatModalTextAreaInputComment' {...register('comment')} rows={8} flexGrow={1} />\n\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t</Field>\n\t\t\t\t</FieldGroup>\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button type='submit' disabled={!username && !department} primary>\n\t\t\t\t\t\t{t('Forward')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default ForwardChatModal;\n",null],"names":["_regeneratorRuntime","_extends","_slicedToArray","_objectWithoutProperties","Field","FieldGroup","Button","TextAreaInput","Modal","Box","PaginatedSelectFiltered","Divider","FieldLabel","FieldRow","useDebouncedValue","useEndpoint","useSetting","useTranslation","React","useCallback","useEffect","useMemo","useState","useForm","useRecordList","AsyncStatePhase","AutoCompleteAgent","useDepartmentsList","module","link","default","v","exportDefault","_ref","_room$servedBy","onForward","onCancel","room","props","_excluded","t","getUserData","idleAgentsAllowedForForwarding","_useForm","getValues","handleSubmit","register","setFocus","setValue","watch","department","username","_useState2","departmentsFilter","setDepartmentsFilter","debouncedDepartmentsFilter","_useDepartmentsList","filter","enabled","departmentsList","itemsList","loadMoreDepartments","loadMoreItems","_useRecordList","departmentsPhase","phase","departments","items","departmentsTotal","itemCount","endReached","start","LOADING","Math","min","onSubmit","_ref2","departmentId","comment","uid","user","async","_context","prev","next","awrap","_await$getUserData","sent","_id","stop","Promise","createElement","wrapperFunction","is","Header","Icon","name","Title","Close","onClick","Content","fontScale","withTitle","setFilter","options","maxWidth","placeholder","onChange","value","flexGrow","p","children","onlyAvailable","excludeId","servedBy","showIdleAgents","marginBlock","color","rows","Footer","FooterControllers","type","disabled","primary"],"mappings":"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"}