)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/hooks/useRoomList.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ILivechatInquiryRecord, IRoom, ISubscription } from '@rocket.chat/core-typings';\nimport { useDebouncedState } from '@rocket.chat/fuselage-hooks';\nimport { useUserPreference, useUserSubscriptions, useSetting } from '@rocket.chat/ui-contexts';\nimport { useEffect } from 'react';\n\nimport { useVideoConfIncomingCalls } from '../../contexts/VideoConfContext';\nimport { useOmnichannelEnabled } from '../../hooks/omnichannel/useOmnichannelEnabled';\nimport { useQueuedInquiries } from '../../hooks/omnichannel/useQueuedInquiries';\nimport { useQueryOptions } from './useQueryOptions';\n\nconst query = { open: { $ne: false } };\n\nconst emptyQueue: ILivechatInquiryRecord[] = [];\n\nexport const useRoomList = (): Array<ISubscription & IRoom> => {\n\tconst [roomList, setRoomList] = useDebouncedState<(ISubscription & IRoom)[]>([], 150);\n\n\tconst showOmnichannel = useOmnichannelEnabled();\n\tconst sidebarGroupByType = useUserPreference('sidebarGroupByType');\n\tconst favoritesEnabled = useUserPreference('sidebarShowFavorites');\n\tconst isDiscussionEnabled = useSetting('Discussion_enabled');\n\tconst sidebarShowUnread = useUserPreference('sidebarShowUnread');\n\n\tconst options = useQueryOptions();\n\n\tconst rooms = useUserSubscriptions(query, options);\n\n\tconst inquiries = useQueuedInquiries();\n\n\tconst incomingCalls = useVideoConfIncomingCalls();\n\n\tlet queue = emptyQueue;\n\tif (inquiries.enabled) {\n\t\tqueue = inquiries.queue;\n\t}\n\n\tuseEffect(() => {\n\t\tsetRoomList(() => {\n\t\t\tconst incomingCall = new Set();\n\t\t\tconst favorite = new Set();\n\t\t\tconst team = new Set();\n\t\t\tconst omnichannel = new Set();\n\t\t\tconst unread = new Set();\n\t\t\tconst channels = new Set();\n\t\t\tconst direct = new Set();\n\t\t\tconst discussion = new Set();\n\t\t\tconst conversation = new Set();\n\t\t\tconst onHold = new Set();\n\n\t\t\trooms.forEach((room) => {\n\t\t\t\tif (room.archived) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (incomingCalls.find((call) => call.rid === room.rid)) {\n\t\t\t\t\treturn incomingCall.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (sidebarShowUnread && (room.alert || room.unread) && !room.hideUnreadStatus) {\n\t\t\t\t\treturn unread.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (favoritesEnabled && room.f) {\n\t\t\t\t\treturn favorite.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (sidebarGroupByType && room.teamMain) {\n\t\t\t\t\treturn team.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (sidebarGroupByType && isDiscussionEnabled && room.prid) {\n\t\t\t\t\treturn discussion.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (room.t === 'c' || room.t === 'p') {\n\t\t\t\t\tchannels.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (room.t === 'l' && room.onHold) {\n\t\t\t\t\treturn showOmnichannel && onHold.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (room.t === 'l') {\n\t\t\t\t\treturn showOmnichannel && omnichannel.add(room);\n\t\t\t\t}\n\n\t\t\t\tif (room.t === 'd') {\n\t\t\t\t\tdirect.add(room);\n\t\t\t\t}\n\n\t\t\t\tconversation.add(room);\n\t\t\t});\n\n\t\t\tconst groups = new Map();\n\t\t\tincomingCall.size && groups.set('Incoming Calls', incomingCall);\n\t\t\tshowOmnichannel && inquiries.enabled && queue.length && groups.set('Incoming_Livechats', queue);\n\t\t\tshowOmnichannel && omnichannel.size && groups.set('Open_Livechats', omnichannel);\n\t\t\tshowOmnichannel && onHold.size && groups.set('On_Hold_Chats', onHold);\n\t\t\tsidebarShowUnread && unread.size && groups.set('Unread', unread);\n\t\t\tfavoritesEnabled && favorite.size && groups.set('Favorites', favorite);\n\t\t\tsidebarGroupByType && team.size && groups.set('Teams', team);\n\t\t\tsidebarGroupByType && isDiscussionEnabled && discussion.size && groups.set('Discussions', discussion);\n\t\t\tsidebarGroupByType && channels.size && groups.set('Channels', channels);\n\t\t\tsidebarGroupByType && direct.size && groups.set('Direct_Messages', direct);\n\t\t\t!sidebarGroupByType && groups.set('Conversations', conversation);\n\t\t\treturn [...groups.entries()].flatMap(([key, group]) => [key, ...group]);\n\t\t});\n\t}, [\n\t\trooms,\n\t\tshowOmnichannel,\n\t\tincomingCalls,\n\t\tinquiries.enabled,\n\t\tqueue,\n\t\tsidebarShowUnread,\n\t\tfavoritesEnabled,\n\t\tsidebarGroupByType,\n\t\tsetRoomList,\n\t\tisDiscussionEnabled,\n\t]);\n\n\treturn roomList;\n};\n",null],"names":["module","link","default","_toConsumableArray","_slicedToArray","export","useRoomList","useDebouncedState","useUserPreference","useUserSubscriptions","useSetting","useEffect","useVideoConfIncomingCalls","useOmnichannelEnabled","useQueuedInquiries","useQueryOptions","query","open","$ne","emptyQueue","_useDebouncedState2","roomList","setRoomList","showOmnichannel","sidebarGroupByType","favoritesEnabled","isDiscussionEnabled","sidebarShowUnread","rooms","inquiries","incomingCalls","queue","enabled","incomingCall","Set","favorite","team","omnichannel","unread","channels","direct","discussion","conversation","onHold","forEach","room","archived","find","call","rid","add","alert","hideUnreadStatus","f","teamMain","prid","t","groups","Map","size","set","length","entries","flatMap","_ref","_ref2","concat"],"mappings":"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"}