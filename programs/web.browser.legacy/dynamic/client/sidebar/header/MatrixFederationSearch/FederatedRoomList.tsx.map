)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/header/MatrixFederationSearch/FederatedRoomList.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Throbber, Box } from '@rocket.chat/fuselage';\nimport type { IFederationPublicRooms } from '@rocket.chat/rest-typings';\nimport { useSetModal, useEndpoint, useToastMessageDispatch, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation } from '@tanstack/react-query';\nimport type { VFC } from 'react';\nimport React from 'react';\nimport { Virtuoso } from 'react-virtuoso';\n\nimport ScrollableContentWrapper from '../../../components/ScrollableContentWrapper';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport FederatedRoomListEmptyPlaceholder from './FederatedRoomListEmptyPlaceholder';\nimport FederatedRoomListItem from './FederatedRoomListItem';\nimport { useInfiniteFederationSearchPublicRooms } from './useInfiniteFederationSearchPublicRooms';\n\ntype FederatedRoomListProps = {\n\tserverName: string;\n\troomName?: string;\n\tpageToken?: string;\n\tcount?: number;\n};\n\nconst FederatedRoomList: VFC<FederatedRoomListProps> = ({ serverName, roomName, count }) => {\n\tconst joinExternalPublicRoom = useEndpoint('POST', '/v1/federation/joinExternalPublicRoom');\n\n\tconst setModal = useSetModal();\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst { data, isLoading, isFetchingNextPage, fetchNextPage } = useInfiniteFederationSearchPublicRooms(serverName, roomName, count);\n\n\tconst { mutate: onClickJoin, isLoading: isLoadingMutation } = useMutation(\n\t\t['federation/joinExternalPublicRoom'],\n\t\tasync ({ id, pageToken }: IFederationPublicRooms) => {\n\t\t\treturn joinExternalPublicRoom({ externalRoomId: id as `!${string}:${string}`, roomName, pageToken });\n\t\t},\n\t\t{\n\t\t\tonSuccess: (_, data) => {\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tmessage: t('Your_request_to_join__roomName__has_been_made_it_could_take_up_to_15_minutes_to_be_processed', {\n\t\t\t\t\t\troomName: data.name,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t\tsetModal(null);\n\t\t\t},\n\t\t\tonError: (error, { id }) => {\n\t\t\t\tif (error instanceof Error && error.message === 'already-joined') {\n\t\t\t\t\tsetModal(null);\n\t\t\t\t\troomCoordinator.openRouteLink('c', { rid: id });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t},\n\t\t},\n\t);\n\n\tif (isLoading) {\n\t\treturn <Throbber />;\n\t}\n\n\tconst flattenedData = data?.pages.flatMap((page) => page.rooms);\n\treturn (\n\t\t<Box is='ul' overflow='hidden' height='356px' flexGrow={1} flexShrink={0} mi={-24}>\n\t\t\t<Virtuoso\n\t\t\t\tdata={flattenedData || []}\n\t\t\t\tcomputeItemKey={(index, room) => room?.id || index}\n\t\t\t\toverscan={4}\n\t\t\t\tcomponents={{\n\t\t\t\t\t// eslint-disable-next-line react/no-multi-comp\n\t\t\t\t\tFooter: () => (isFetchingNextPage ? <Throbber /> : null),\n\t\t\t\t\tScroller: ScrollableContentWrapper,\n\t\t\t\t\tEmptyPlaceholder: FederatedRoomListEmptyPlaceholder,\n\t\t\t\t}}\n\t\t\t\tendReached={isLoading || isFetchingNextPage ? () => undefined : () => fetchNextPage()}\n\t\t\t\titemContent={(_, room) => (\n\t\t\t\t\t<FederatedRoomListItem onClickJoin={() => onClickJoin(room)} {...room} disabled={isLoadingMutation} key={room.id} />\n\t\t\t\t)}\n\t\t\t/>\n\t\t</Box>\n\t);\n};\n\nexport default FederatedRoomList;\n",null],"names":["_extends","_regeneratorRuntime","Throbber","Box","useSetModal","useEndpoint","useToastMessageDispatch","useTranslation","useMutation","React","Virtuoso","ScrollableContentWrapper","roomCoordinator","FederatedRoomListEmptyPlaceholder","FederatedRoomListItem","useInfiniteFederationSearchPublicRooms","module","link","default","v","exportDefault","_ref","serverName","roomName","count","joinExternalPublicRoom","setModal","t","dispatchToastMessage","_useInfiniteFederatio","data","isLoading","isFetchingNextPage","fetchNextPage","_useMutation","_ref2","id","pageToken","async","_context","prev","next","abrupt","externalRoomId","stop","Promise","onSuccess","_","type","message","name","onError","error","_ref3","Error","openRouteLink","rid","onClickJoin","mutate","isLoadingMutation","createElement","flattenedData","pages","flatMap","page","rooms","is","overflow","height","flexGrow","flexShrink","mi","computeItemKey","index","room","overscan","components","Footer","Scroller","EmptyPlaceholder","endReached","itemContent","disabled","key"],"mappings":"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"}