)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/sidebar/header/MatrixFederationSearch/MatrixFederationManageServerModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Divider, Modal, ButtonGroup, Button, Field, TextInput, FieldLabel, FieldRow, FieldError, FieldHint } from '@rocket.chat/fuselage';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport { useSetModal, useTranslation, useEndpoint, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport type { VFC, FormEvent } from 'react';\nimport React, { useState } from 'react';\n\nimport MatrixFederationRemoveServerList from './MatrixFederationRemoveServerList';\nimport MatrixFederationSearch from './MatrixFederationSearch';\nimport { useMatrixServerList } from './useMatrixServerList';\n\ntype MatrixFederationAddServerModalProps = {\n\tonClickClose: () => void;\n};\n\nconst getErrorKey = (error: any): TranslationKey | undefined => {\n\tif (!error) {\n\t\treturn;\n\t}\n\tif (error.error === 'invalid-server-name') {\n\t\treturn 'Server_doesnt_exist';\n\t}\n\tif (error.error === 'invalid-server-name') {\n\t\treturn 'Server_already_added';\n\t}\n};\n\nconst MatrixFederationAddServerModal: VFC<MatrixFederationAddServerModalProps> = ({ onClickClose }) => {\n\tconst t = useTranslation();\n\tconst addMatrixServer = useEndpoint('POST', '/v1/federation/addServerByUser');\n\tconst [serverName, setServerName] = useState('');\n\tconst [errorKey, setErrorKey] = useState<TranslationKey | undefined>();\n\tconst setModal = useSetModal();\n\tconst queryClient = useQueryClient();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst {\n\t\tmutate: addServer,\n\t\tisLoading,\n\t\tisError,\n\t} = useMutation(['v1/federation/addServerByUser', serverName], () => addMatrixServer({ serverName }), {\n\t\tonSuccess: async () => {\n\t\t\tawait queryClient.invalidateQueries(['federation/listServersByUsers']);\n\t\t\tsetModal(<MatrixFederationSearch defaultSelectedServer={serverName} onClose={onClickClose} key={serverName} />);\n\t\t},\n\t\tonError: (error) => {\n\t\t\tconst errorKey = getErrorKey(error);\n\t\t\tif (!errorKey) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetErrorKey(errorKey);\n\t\t},\n\t});\n\n\tconst { data, isLoading: isLoadingServerList } = useMatrixServerList();\n\n\treturn (\n\t\t<Modal maxHeight='x600'>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Manage_servers')}</Modal.Title>\n\t\t\t\t<Modal.Close onClick={onClickClose} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Server_name')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\tvalue={serverName}\n\t\t\t\t\t\t\tonChange={(e: FormEvent<HTMLInputElement>) => {\n\t\t\t\t\t\t\t\tsetServerName(e.currentTarget.value);\n\t\t\t\t\t\t\t\tif (errorKey) {\n\t\t\t\t\t\t\t\t\tsetErrorKey(undefined);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tmie={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button onClick={() => addServer()} primary loading={isLoading}>\n\t\t\t\t\t\t\t{t('Add')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t\t{isError && errorKey && <FieldError>{t(errorKey)}</FieldError>}\n\t\t\t\t\t<FieldHint>{t('Federation_Example_matrix_server')}</FieldHint>\n\t\t\t\t</Field>\n\t\t\t\t<Divider mb={16} />\n\t\t\t\t{!isLoadingServerList && data?.servers && <MatrixFederationRemoveServerList servers={data.servers} />}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button onClick={onClickClose}>{t('Cancel')}</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\n\nexport default MatrixFederationAddServerModal;\n",null],"names":["_regeneratorRuntime","_slicedToArray","Divider","Modal","ButtonGroup","Button","Field","TextInput","FieldLabel","FieldRow","FieldHint","useSetModal","useTranslation","useEndpoint","useToastMessageDispatch","useMutation","useQueryClient","React","useState","MatrixFederationRemoveServerList","MatrixFederationSearch","useMatrixServerList","module","link","default","v","FieldError","exportDefault","_ref","onClickClose","t","addMatrixServer","_useState2","serverName","setServerName","_useState4","errorKey","setErrorKey","setModal","queryClient","dispatchToastMessage","_useMutation","onSuccess","async","_context","prev","next","awrap","invalidateQueries","createElement","defaultSelectedServer","onClose","key","stop","Promise","onError","error","type","message","addServer","mutate","isLoading","isError","_useMatrixServerList","data","isLoadingServerList","maxHeight","Header","Title","Close","onClick","Content","disabled","value","onChange","e","currentTarget","undefined","mie","primary","loading","mb","servers","Footer"],"mappings":"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"}