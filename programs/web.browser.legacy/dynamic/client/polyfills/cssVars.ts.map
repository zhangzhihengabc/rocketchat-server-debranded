)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/polyfills/cssVars.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { withDebouncing } from '../../lib/utils/highOrderFunctions';\n\ntype Variables = {\n\t[name: string]: (variables: Variables) => string;\n};\n\nconst findDeclarations = (code: string): [string, Variables[keyof Variables]][] =>\n\t(code.match(/(--[^:; ]+:..*?;)/g) ?? []).map((declaration) => {\n\t\tconst matches = /(.*?):\\s*(.*?)\\s*;/.exec(declaration);\n\n\t\tif (matches === null) {\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tconst [, name, value] = matches;\n\t\treturn [\n\t\t\tname,\n\t\t\tvalue.indexOf('var(') >= 0\n\t\t\t\t? (variables: Variables): string => value.replace(/var\\((--.*?)\\)/gm, (_, name) => variables[name]?.call(null, variables))\n\t\t\t\t: (): string => value,\n\t\t];\n\t});\n\nconst replaceReferences = (code: string, variables: Variables): string =>\n\tcode.replace(/var\\((--.*?)\\)/gm, (_, name) => variables[name]?.call(null, variables));\n\nlet cssVariablesElement: HTMLElement;\nconst originalCodes = new Map();\n\nconst update = withDebouncing({ wait: 100 })(() => {\n\tconst declarations = ([] as [string, Variables[keyof Variables]][]).concat(\n\t\t...Array.from(originalCodes.values(), findDeclarations),\n\t\tfindDeclarations(cssVariablesElement.innerHTML),\n\t);\n\n\tconst variables = Object.fromEntries(declarations);\n\n\toriginalCodes.forEach((originalCode, element) => {\n\t\tconst patchedCode = replaceReferences(originalCode, variables);\n\n\t\tlet patchedElement = element.nextElementSibling;\n\t\tif (!patchedElement || !patchedElement.classList.contains('patched-css-variables')) {\n\t\t\tpatchedElement = document.createElement('style');\n\t\t\tpatchedElement.type = 'text/css';\n\t\t\tpatchedElement.classList.add('patched-css-variables');\n\t\t\telement.insertAdjacentElement('afterend', patchedElement);\n\t\t}\n\n\t\tconst { sheet } = patchedElement;\n\t\twhile (sheet.cssRules.length > 0) {\n\t\t\tsheet.deleteRule(0);\n\t\t}\n\t\tsheet.insertRule(`@media all {${patchedCode}}`, 0);\n\t});\n});\n\nconst findAndPatchFromLinkElements = (): void => {\n\tArray.from(document.querySelectorAll('link[type=\"text/css\"].__meteor-css__')).forEach(async (linkElement) => {\n\t\tconst url = linkElement.getAttribute('href');\n\n\t\tif (url === null) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await fetch(url);\n\t\t\tconst code = await response.text();\n\t\t\toriginalCodes.set(linkElement, code);\n\t\t} catch (error) {\n\t\t\tconsole.warn(error);\n\t\t} finally {\n\t\t\tupdate();\n\t\t}\n\t});\n};\n\nconst waitAndInitialize = (): void => {\n\tif (document.readyState !== 'complete') {\n\t\trequestAnimationFrame(waitAndInitialize);\n\t\treturn;\n\t}\n\n\tconst element = document.getElementById('css-variables');\n\n\tif (element === null) {\n\t\trequestAnimationFrame(waitAndInitialize);\n\t\treturn;\n\t}\n\n\tcssVariablesElement = element;\n\n\tconst cssVariablesElementObserver = new MutationObserver(() => {\n\t\tupdate();\n\t});\n\n\tcssVariablesElementObserver.observe(cssVariablesElement, { childList: true });\n\n\tfindAndPatchFromLinkElements();\n};\n\n((): void => {\n\tif (window.CSS?.supports?.('(--foo: red)')) {\n\t\treturn;\n\t}\n\n\twaitAndInitialize();\n})();\n",null],"names":["module","link","default","v","_regeneratorRuntime","_toConsumableArray","_slicedToArray","withDebouncing","_window$CSS","_window$CSS$supports","cssVariablesElement","findDeclarations","code","_code$match","match","map","declaration","matches","exec","Error","_matches","name","value","indexOf","variables","replace","_","_variables$name","call","originalCodes","Map","update","wait","_ref","Object","fromEntries","concat","apply","Array","from","values","innerHTML","forEach","originalCode","element","patchedCode","_variables$name2","patchedElement","nextElementSibling","classList","contains","document","createElement","type","add","insertAdjacentElement","sheet","_patchedElement","cssRules","length","deleteRule","insertRule","findAndPatchFromLinkElements","querySelectorAll","linkElement","url","response","async","_context","prev","next","getAttribute","abrupt","awrap","fetch","sent","text","set","t0","console","warn","finish","stop","Promise","waitAndInitialize","readyState","requestAnimationFrame","getElementById","cssVariablesElementObserver","MutationObserver","observe","childList","window","CSS","supports"],"mappings":"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"}