)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/uikit/hooks/useUiKitView.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { UiKit } from '@rocket.chat/core-typings';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { extractInitialStateFromLayout } from '@rocket.chat/fuselage-ui-kit';\nimport type { Dispatch } from 'react';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { useUiKitActionManager } from './useUiKitActionManager';\n\nconst reduceValues = (\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } },\n\t{ actionId, payload }: { actionId: string; payload: { value: unknown; blockId?: string } },\n): { [actionId: string]: { value: unknown; blockId?: string } } => ({\n\t...values,\n\t[actionId]: payload,\n});\n\nconst getViewId = (view: UiKit.View): string => {\n\tif ('id' in view && typeof view.id === 'string') {\n\t\treturn view.id;\n\t}\n\n\tif ('viewId' in view && typeof view.viewId === 'string') {\n\t\treturn view.viewId;\n\t}\n\n\tthrow new Error('Invalid view');\n};\n\nconst getViewFromInteraction = (interaction: UiKit.ServerInteraction): UiKit.View | undefined => {\n\tif ('view' in interaction && typeof interaction.view === 'object') {\n\t\treturn interaction.view;\n\t}\n\n\tif (interaction.type === 'banner.open') {\n\t\treturn interaction;\n\t}\n\n\treturn undefined;\n};\n\ntype UseUiKitViewReturnType<TView extends UiKit.View> = {\n\tview: TView;\n\terrors?: { [field: string]: string }[];\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } };\n\tupdateValues: Dispatch<{ actionId: string; payload: { value: unknown; blockId?: string } }>;\n\tstate: {\n\t\t[blockId: string]: {\n\t\t\t[key: string]: unknown;\n\t\t};\n\t};\n};\n\nexport function useUiKitView<S extends UiKit.View>(initialView: S): UseUiKitViewReturnType<S> {\n\tconst [errors, setErrors] = useSafely(useState<{ [field: string]: string }[] | undefined>());\n\tconst [values, updateValues] = useSafely(useReducer(reduceValues, initialView.blocks, extractInitialStateFromLayout));\n\tconst [view, updateView] = useSafely(useState(initialView));\n\tconst actionManager = useUiKitActionManager();\n\n\tconst state = useMemo(() => {\n\t\treturn Object.entries(values).reduce<{ [blockId: string]: { [actionId: string]: unknown } }>((obj, [key, payload]) => {\n\t\t\tif (!payload?.blockId) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tconst { blockId, value } = payload;\n\t\t\tobj[blockId] = obj[blockId] || {};\n\t\t\tobj[blockId][key] = value;\n\n\t\t\treturn obj;\n\t\t}, {});\n\t}, [values]);\n\n\tconst viewId = getViewId(view);\n\n\tuseEffect(() => {\n\t\tconst handleUpdate = (interaction: UiKit.ServerInteraction): void => {\n\t\t\tif (interaction.type === 'errors') {\n\t\t\t\tsetErrors(interaction.errors);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateView((view) => ({ ...view, ...getViewFromInteraction(interaction) }));\n\t\t};\n\n\t\tactionManager.on(viewId, handleUpdate);\n\n\t\treturn (): void => {\n\t\t\tactionManager.off(viewId, handleUpdate);\n\t\t};\n\t}, [actionManager, setErrors, updateView, viewId]);\n\n\treturn { view, errors, values, updateValues, state };\n}\n",null],"names":["module","link","default","_slicedToArray","_typeof","_objectSpread","export","useUiKitView","useSafely","extractInitialStateFromLayout","useEffect","useMemo","useReducer","useState","useUiKitActionManager","reduceValues","values","_ref","_objectSpread2","actionId","payload","getViewId","view","id","viewId","Error","initialView","_useSafely2","errors","setErrors","_useSafely4","blocks","updateValues","_useSafely6","updateView","actionManager","state","Object","entries","reduce","obj","_ref2","_ref3","key","blockId","value","handleUpdate","interaction","type","on","off"],"mappings":"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"}