)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/hooks/roomActions/useDeleteRoom.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, RoomAdminFieldsType } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetModal, useToastMessageDispatch, useRouter, usePermission, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation } from '@tanstack/react-query';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport DeleteTeamModal from '../../teams/contextualBar/info/DeleteTeam';\n\nexport const useDeleteRoom = (room: IRoom | Pick<IRoom, RoomAdminFieldsType>, { reload }: { reload?: () => void } = {}) => {\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\tconst setModal = useSetModal();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst hasPermissionToDelete = usePermission(`delete-${room.t}`, room._id);\n\tconst canDeleteRoom = isRoomFederated(room) ? false : hasPermissionToDelete;\n\n\tconst isAdminRoute = router.getRouteName() === 'admin-rooms';\n\n\tconst deleteRoomEndpoint = useEndpoint('POST', '/v1/rooms.delete');\n\tconst deleteTeamEndpoint = useEndpoint('POST', '/v1/teams.delete');\n\n\tconst deleteRoomMutation = useMutation({\n\t\tmutationFn: deleteRoomEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Room_has_been_deleted') });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst deleteTeamMutation = useMutation({\n\t\tmutationFn: deleteTeamEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Team_has_been_deleted') });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst isDeleting = deleteTeamMutation.isLoading || deleteRoomMutation.isLoading;\n\n\tconst handleDelete = useMutableCallback(() => {\n\t\tconst handleDeleteTeam = async (roomsToRemove: IRoom['_id'][]) => {\n\t\t\tif (!room.teamId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdeleteTeamMutation.mutateAsync({ teamId: room.teamId, ...(roomsToRemove.length && { roomsToRemove }) });\n\t\t};\n\n\t\tif (room.teamMain && room.teamId) {\n\t\t\treturn setModal(<DeleteTeamModal onConfirm={handleDeleteTeam} onCancel={(): void => setModal(null)} teamId={room.teamId} />);\n\t\t}\n\n\t\tconst handleDeleteRoom = async () => {\n\t\t\tdeleteRoomMutation.mutateAsync({ roomId: room._id });\n\t\t};\n\n\t\tsetModal(\n\t\t\t<GenericModal variant='danger' onConfirm={handleDeleteRoom} onCancel={(): void => setModal(null)} confirmText={t('Yes_delete_it')}>\n\t\t\t\t{t('Delete_Room_Warning')}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\treturn { handleDelete, canDeleteRoom, isDeleting };\n};\n",null],"names":["module","link","default","_regeneratorRuntime","_objectSpread","export","useDeleteRoom","isRoomFederated","useMutableCallback","useSetModal","useToastMessageDispatch","useRouter","usePermission","useEndpoint","useTranslation","useMutation","v","React","GenericModal","DeleteTeamModal","room","_ref","arguments","length","undefined","reload","t","router","setModal","dispatchToastMessage","hasPermissionToDelete","_id","canDeleteRoom","isAdminRoute","getRouteName","deleteRoomEndpoint","deleteTeamEndpoint","deleteRoomMutation","mutationFn","onSuccess","type","message","navigate","onError","error","onSettled","deleteTeamMutation","isDeleting","isLoading","handleDelete","teamMain","teamId","createElement","onConfirm","roomsToRemove","async","_context","prev","next","abrupt","mutateAsync","stop","Promise","onCancel","variant","_context2","roomId","confirmText"],"mappings":"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"}