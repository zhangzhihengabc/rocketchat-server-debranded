)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/modal/uikit/ModalBlock.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { UiKit } from '@rocket.chat/core-typings';\nimport { Modal, AnimatedVisibility, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UiKitComponent, UiKitModal, modalParser } from '@rocket.chat/fuselage-ui-kit';\nimport type { LayoutBlock } from '@rocket.chat/ui-kit';\nimport { BlockContext } from '@rocket.chat/ui-kit';\nimport type { FormEventHandler, ReactElement } from 'react';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { FocusScope } from 'react-aria';\n\nimport { getURL } from '../../../../app/utils/client/getURL';\nimport { getButtonStyle } from './getButtonStyle';\n\nconst focusableElementsString = `\n\ta[href]:not([tabindex=\"-1\"]),\n\tarea[href]:not([tabindex=\"-1\"]),\n\tinput:not([disabled]):not([tabindex=\"-1\"]),\n\tselect:not([disabled]):not([tabindex=\"-1\"]),\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]),\n\tbutton:not([disabled]):not([tabindex=\"-1\"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex=\"-1\"]),\n\t[contenteditable]`;\n\nconst focusableElementsStringInvalid = `\n\ta[href]:not([tabindex=\"-1\"]):invalid,\n\tarea[href]:not([tabindex=\"-1\"]):invalid,\n\tinput:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tselect:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\ttextarea:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tbutton:not([disabled]):not([tabindex=\"-1\"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex=\"-1\"]):invalid,\n\t[contenteditable]:invalid`;\n\ntype ModalBlockParams = {\n\tview: UiKit.ModalView;\n\terrors: any;\n\tappId: string;\n\tonSubmit: FormEventHandler<HTMLElement>;\n\tonClose: () => void;\n\tonCancel: FormEventHandler<HTMLElement>;\n};\n\nconst isFocusable = (element: Element | null): element is HTMLElement =>\n\telement !== null && 'focus' in element && typeof element.focus === 'function';\n\nconst KeyboardCode = new Map<string, number>([\n\t['ENTER', 13],\n\t['ESC', 27],\n\t['TAB', 9],\n]);\n\nconst ModalBlock = ({ view, errors, onSubmit, onClose, onCancel }: ModalBlockParams): ReactElement => {\n\tconst id = `modal_id_${useUniqueId()}`;\n\tconst ref = useRef<HTMLElement>(null);\n\n\tuseEffect(() => {\n\t\tif (!ref.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (errors && Object.keys(errors).length) {\n\t\t\tconst element = ref.current.querySelector<HTMLElement>(focusableElementsStringInvalid);\n\t\t\telement?.focus();\n\t\t} else {\n\t\t\tconst element = ref.current.querySelector<HTMLElement>(focusableElementsString);\n\t\t\telement?.focus();\n\t\t}\n\t}, [errors]);\n\n\tconst previousFocus = useMemo(() => document.activeElement, []);\n\n\tuseEffect(\n\t\t() => () => {\n\t\t\tif (previousFocus && isFocusable(previousFocus)) {\n\t\t\t\treturn previousFocus.focus();\n\t\t\t}\n\t\t},\n\t\t[previousFocus],\n\t);\n\n\tconst handleKeyDown = useCallback(\n\t\t(event) => {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase KeyboardCode.get('ENTER'):\n\t\t\t\t\tif (event?.target?.nodeName !== 'TEXTAREA') {\n\t\t\t\t\t\treturn onSubmit(event);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\tcase KeyboardCode.get('ESC'):\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tonClose();\n\t\t\t\t\treturn;\n\t\t\t\tcase KeyboardCode.get('TAB'):\n\t\t\t\t\tif (!ref.current) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst elements = Array.from(ref.current.querySelectorAll(focusableElementsString)) as HTMLElement[];\n\t\t\t\t\tconst [first] = elements;\n\t\t\t\t\tconst last = elements.pop();\n\n\t\t\t\t\tif (!ref.current.contains(document.activeElement)) {\n\t\t\t\t\t\treturn first.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\t\tif (!first || first === document.activeElement) {\n\t\t\t\t\t\t\tlast?.focus();\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!last || last === document.activeElement) {\n\t\t\t\t\t\tfirst.focus();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[onClose, onSubmit],\n\t);\n\n\tuseEffect(() => {\n\t\tconst element = document.querySelector('#modal-root') as HTMLElement;\n\t\tconst container = element.querySelector('.rcx-modal__content') as HTMLElement;\n\t\tconst close = (e: Event) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tonClose();\n\t\t\treturn false;\n\t\t};\n\n\t\tconst ignoreIfNotContains = (e: Event) => {\n\t\t\tif (e.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!container.contains(e.target as HTMLElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn handleKeyDown(e);\n\t\t};\n\n\t\tdocument.addEventListener('keydown', ignoreIfNotContains);\n\t\telement.addEventListener('click', close);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', ignoreIfNotContains);\n\t\t\telement.removeEventListener('click', close);\n\t\t};\n\t}, [handleKeyDown, onClose]);\n\n\treturn (\n\t\t<AnimatedVisibility visibility={AnimatedVisibility.UNHIDING}>\n\t\t\t<FocusScope contain restoreFocus autoFocus>\n\t\t\t\t<Modal open id={id} ref={ref}>\n\t\t\t\t\t<Modal.Header>\n\t\t\t\t\t\t{view.showIcon ? <Modal.Thumb url={getURL(`/api/apps/${view.appId}/icon`)} /> : null}\n\t\t\t\t\t\t<Modal.Title>{modalParser.text(view.title, BlockContext.NONE, 0)}</Modal.Title>\n\t\t\t\t\t\t<Modal.Close tabIndex={-1} onClick={onClose} />\n\t\t\t\t\t</Modal.Header>\n\t\t\t\t\t<Modal.Content>\n\t\t\t\t\t\t<Box is='form' method='post' action='#' onSubmit={onSubmit}>\n\t\t\t\t\t\t\t<UiKitComponent render={UiKitModal} blocks={view.blocks as LayoutBlock[]} />\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Modal.Content>\n\t\t\t\t\t<Modal.Footer>\n\t\t\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t\t\t{view.close && (\n\t\t\t\t\t\t\t\t<Button danger={view.close.style === 'danger'} onClick={onCancel}>\n\t\t\t\t\t\t\t\t\t{modalParser.text(view.close.text, BlockContext.NONE, 0)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{view.submit && (\n\t\t\t\t\t\t\t\t<Button {...getButtonStyle(view.submit)} onClick={onSubmit}>\n\t\t\t\t\t\t\t\t\t{modalParser.text(view.submit.text, BlockContext.NONE, 1)}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Modal.FooterControllers>\n\t\t\t\t\t</Modal.Footer>\n\t\t\t\t</Modal>\n\t\t\t</FocusScope>\n\t\t</AnimatedVisibility>\n\t);\n};\n\nexport default ModalBlock;\n",null],"names":["module","link","default","_extends","Modal","v","AnimatedVisibility","Button","Box","useUniqueId","UiKitComponent","UiKitModal","modalParser","BlockContext","React","useCallback","useEffect","useMemo","useRef","FocusScope","getURL","getButtonStyle","focusableElementsString","KeyboardCode","Map","exportDefault","_ref","view","errors","onSubmit","onClose","onCancel","id","ref","current","Object","keys","length","element","querySelector","focus","previousFocus","document","activeElement","handleKeyDown","event","_event$target","keyCode","get","target","nodeName","stopPropagation","preventDefault","elements","Array","from","querySelectorAll","first","last","pop","contains","shiftKey","container","close","e","ignoreIfNotContains","addEventListener","removeEventListener","createElement","visibility","UNHIDING","contain","restoreFocus","autoFocus","open","Header","showIcon","Thumb","url","appId","Title","text","title","NONE","Close","tabIndex","onClick","Content","is","method","action","render","blocks","Footer","FooterControllers","danger","style","submit"],"mappings":"uBACSA,EAAOC,IAAA,CAAA,iCAAuC,CAAAC,QAAAA,SAAAA,CAAAA,EAAwBC,EAAAA,CAAA,CAAA,EAAA,GAA3CH,EAAWC,IAAE,CAAA,wBAAM,CAAAG,MAAwB,SAAAC,CAAA,EAAAD,EAAAA,CAAA,EAAAE,mBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,IAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAS,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAT,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAU,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAZ,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAa,aAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAb,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAK,CAAA,EAAAS,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAlB,EAAAA,IAAAA,CAAAA,aAAAA,CAAAmB,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAnB,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAoB,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAApB,EAAAA,IAAAA,CAAAA,mBAAAA,CAAAqB,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAY/E,IAZAlB,EAAAC,EAASE,EAAOC,EAAoBC,EAA2CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAYzEC,EAAuB,uVAsCvBC,EAAe,IAAIC,IAAoB,CAC5C,CAAC,QAAS,GAAG,CACb,CAAC,MAAO,GAAG,CACX,CAAC,MAAO,EAAE,CACV,EAtDDxB,EAAOyB,aAAS,CAwDG,SAAAC,CAAA,EAAkF,IAA/EC,EAAID,EAAJC,IAAI,CAAEC,EAAMF,EAANE,MAAM,CAAEC,EAAQH,EAARG,QAAQ,CAAEC,EAAOJ,EAAPI,OAAO,CAAEC,EAAQL,EAARK,QAAQ,CACxDC,EAAE,YAAevB,IACjBwB,EAAMf,EAAoB,MAEhCF,EAAU,WACT,GAAKiB,EAAIC,OAAO,EAIhB,GAAIN,GAAUO,OAAOC,IAAI,CAACR,GAAQS,MAAM,CAAE,CACzC,IAAMC,EAAUL,EAAIC,OAAO,CAACK,aAAa,CAzCR,+aA0CjCD,OAAAA,GAAAA,EAASE,KAAK,OACR,CACN,IAAMF,EAAUL,EAAIC,OAAO,CAACK,aAAa,CAAcjB,EACvDgB,OAAAA,GAAAA,EAASE,KAAK,IAEhB,EAAG,CAACZ,EAAO,EAEX,IAAMa,EAAgBxB,EAAQ,WAAA,OAAMyB,SAASC,aAAa,EAAE,EAAE,EAE9D3B,EACC,WAAA,OAAM,eA9BasB,EA+BlB,GAAIG,GA9BNH,AAAY,QADQA,EA+BeG,IA9Bf,UAAWH,GAAW,AAAyB,YAAzB,OAAOA,EAAQE,KAAK,CA+B3D,OAAOC,EAAcD,KAAK,EAE5B,CAAC,EACD,CAACC,EAAc,EAGhB,IAAMG,EAAgB7B,EACrB,SAAC8B,CAAK,EAAI,IAAAC,EACT,OAAQD,EAAME,OAAO,EACpB,KAAKxB,EAAayB,GAAG,CAAC,SACrB,GAAI,AAAAH,CAAAA,MAAAA,EAAK,KAAA,EAAA,AAAQ,OAARC,CAAAA,EAALD,EAAOI,MAAM,AAANA,GAAMH,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeI,QAAQ,AAARA,IAAa,WAC/B,OAAOrB,EAASgB,GAEjB,MACD,MAAKtB,EAAayB,GAAG,CAAC,OACrBH,EAAMM,eAAe,GACrBN,EAAMO,cAAc,GACpBtB,IACA,MACD,MAAKP,EAAayB,GAAG,CAAC,OACrB,GAAI,CAACf,EAAIC,OAAO,CACf,OAED,IAAMmB,EAAWC,MAAMC,IAAI,CAACtB,EAAIC,OAAO,CAACsB,gBAAgB,CAAClC,IAClDmC,EAASJ,CAAQ,CAAA,EAAA,CAClBK,EAAOL,EAASM,GAAG,GAEzB,GAAI,CAAC1B,EAAIC,OAAO,CAAC0B,QAAQ,CAAClB,SAASC,aAAa,EAC/C,OAAOc,EAAMjB,KAAK,GAGnB,GAAIK,EAAMgB,QAAQ,CAAE,CACdJ,GAASA,IAAUf,SAASC,aAAa,GAC7Ce,MAAAA,GAAAA,EAAMlB,KAAK,GACXK,EAAMM,eAAe,GACrBN,EAAMO,cAAc,IAErB,OAGIM,GAAQA,IAAShB,SAASC,aAAa,GAC3Cc,EAAMjB,KAAK,GACXK,EAAMM,eAAe,GACrBN,EAAMO,cAAc,GACpB,CAEJ,EACA,CAACtB,EAASD,EAAS,EAmCpB,OAhCAb,EAAU,WACT,IAAMsB,EAAUI,SAASH,aAAa,CAAC,eACjCuB,EAAYxB,EAAQC,aAAa,CAAC,uBAClCwB,EAAQ,SAACC,CAAQ,EACtB,GAAIA,EAAEf,MAAM,GAAKX,EAMjB,OAHA0B,EAAEZ,cAAc,GAChBY,EAAEb,eAAe,GACjBrB,IACO,CAAA,CACR,EAEMmC,EAAsB,SAACD,CAAQ,EACpC,GAAIA,EAAEf,MAAM,GAAKX,GAIZwB,EAAUF,QAAQ,CAACI,EAAEf,MAAqB,EAG/C,OAAOL,EAAcoB,EACtB,EAIA,OAFAtB,SAASwB,gBAAgB,CAAC,UAAWD,GACrC3B,EAAQ4B,gBAAgB,CAAC,QAASH,GAC3B,WACNrB,SAASyB,mBAAmB,CAAC,UAAWF,GACxC3B,EAAQ6B,mBAAmB,CAAC,QAASJ,EACtC,CACD,EAAG,CAACnB,EAAed,EAAQ,EAG1BhB,EAAAsD,aAAA,CAAC9D,EAAkB,CAAC+D,WAAY/D,EAAmBgE,QAAAA,AAAS,EAC3DxD,EAAAsD,aAAA,CAACjD,EAAU,CAACoD,QAAO,CAAA,EAACC,aAAY,CAAA,EAACC,UAAS,CAAA,CAAA,EACzC3D,EAAAsD,aAAA,CAAChE,EAAK,CAACsE,KAAI,CAAA,EAAC1C,GAAIA,EAAIC,IAAKA,CAAI,EAC5BnB,EAAAsD,aAAA,CAAChE,EAAMuE,MAAM,CAAA,KACXhD,EAAKiD,QAAQ,CAAG9D,EAAAsD,aAAA,CAAChE,EAAMyE,KAAK,CAAA,CAACC,IAAK1D,EAAM,aAAcO,EAAKoD,KAAK,CAAA,QAAS,GAAM,KAChFjE,EAAAsD,aAAA,CAAChE,EAAM4E,KAAK,CAAA,KAAEpE,EAAYqE,IAAI,CAACtD,EAAKuD,KAAK,CAAErE,EAAasE,IAAI,CAAE,IAC9DrE,EAAAsD,aAAA,CAAChE,EAAMgF,KAAK,CAAA,CAACC,SAAU,GAAIC,QAASxD,CAAQ,IAE7ChB,EAAAsD,aAAA,CAAChE,EAAMmF,OAAO,CAAA,KACbzE,EAAAsD,aAAA,CAAC5D,EAAG,CAACgF,GAAG,OAAOC,OAAO,OAAOC,OAAO,IAAI7D,SAAUA,CAAS,EAC1Df,EAAAsD,aAAA,CAAC1D,EAAc,CAACiF,OAAQhF,EAAYiF,OAAQjE,EAAKiE,MAAAA,AAAwB,KAG3E9E,EAAAsD,aAAA,CAAChE,EAAMyF,MAAM,CAAA,KACZ/E,EAAAsD,aAAA,CAAChE,EAAM0F,iBAAiB,CAAA,KACtBnE,EAAKoC,KAAK,EACVjD,EAAAsD,aAAA,CAAC7D,EAAM,CAACwF,OAAQpE,AAAqB,WAArBA,EAAKoC,KAAK,CAACiC,KAAK,CAAeV,QAASvD,CAAS,EAC/DnB,EAAYqE,IAAI,CAACtD,EAAKoC,KAAK,CAACkB,IAAI,CAAEpE,EAAasE,IAAI,CAAE,IAGvDxD,EAAKsE,MAAM,EACXnF,EAAAsD,aAAA,CAAC7D,EAAMJ,EAAA,CAAA,EAAKkB,EAAeM,EAAKsE,MAAM,EAAC,CAAEX,QAASzD,CAAS,GACzDjB,EAAYqE,IAAI,CAACtD,EAAKsE,MAAM,CAAChB,IAAI,CAAEpE,EAAasE,IAAI,CAAE,QAShE"}