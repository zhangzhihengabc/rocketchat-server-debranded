)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/root/MainLayout/RegisterUsername.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { TextInput, ButtonGroup, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { VerticalWizardLayout, Form } from '@rocket.chat/layout';\nimport { CustomFieldsForm } from '@rocket.chat/ui-client';\nimport {\n\tuseSetting,\n\tuseTranslation,\n\tuseLogout,\n\tuseEndpoint,\n\tuseUserId,\n\tuseToastMessageDispatch,\n\tuseAssetWithDarkModePath,\n\tuseMethod,\n\tuseAccountsCustomFields,\n} from '@rocket.chat/ui-contexts';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport React, { useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport MarkdownText from '../../../components/MarkdownText';\nimport { queryClient } from '../../../lib/queryClient';\n\ntype RegisterUsernamePayload = {\n\tusername: Exclude<IUser['username'], undefined>;\n} & IUser['customFields'];\n\nconst RegisterUsername = () => {\n\tconst t = useTranslation();\n\tconst uid = useUserId();\n\tconst logout = useLogout();\n\tconst formLabelId = useUniqueId();\n\tconst hideLogo = useSetting<boolean>('Layout_Login_Hide_Logo');\n\tconst customLogo = useAssetWithDarkModePath('logo');\n\tconst customBackground = useAssetWithDarkModePath('background');\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst customFields = useAccountsCustomFields();\n\n\tif (!uid) {\n\t\tthrow new Error('Invalid user');\n\t}\n\n\tconst setUsername = useMethod('setUsername');\n\tconst saveCustomFields = useMethod('saveCustomFields');\n\tconst usernameSuggestion = useEndpoint('GET', '/v1/users.getUsernameSuggestion');\n\tconst { data, isLoading } = useQuery(['suggestion'], async () => usernameSuggestion());\n\n\tconst {\n\t\tregister,\n\t\thandleSubmit,\n\t\tsetValue,\n\t\tgetValues,\n\t\tsetError,\n\t\tcontrol,\n\t\tformState: { errors },\n\t} = useForm<RegisterUsernamePayload>({\n\t\tmode: 'onBlur',\n\t});\n\n\tuseEffect(() => {\n\t\tif (data?.result && getValues('username') === '') {\n\t\t\tsetValue('username', data.result);\n\t\t}\n\t});\n\n\tconst registerUsernameMutation = useMutation({\n\t\tmutationFn: async (data: RegisterUsernamePayload) => {\n\t\t\tconst { username, ...customFields } = data;\n\t\t\treturn Promise.all([setUsername(username), saveCustomFields({ ...customFields })]);\n\t\t},\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Username_has_been_updated') });\n\t\t\tqueryClient.invalidateQueries(['users.info']);\n\t\t},\n\t\tonError: (error: any, { username }) => {\n\t\t\tif ([error.error, error.errorType].includes('error-blocked-username')) {\n\t\t\t\treturn setError('username', { type: 'error-blocked-username', message: t('error-blocked-username', { field: username }) });\n\t\t\t}\n\n\t\t\tif ([error.errorType].includes('error-field-unavailable')) {\n\t\t\t\treturn setError('username', { type: 'error-field-unavailable', message: t('error-field-unavailable', { field: username }) });\n\t\t\t}\n\n\t\t\tif ([error.errorType].includes('')) {\n\t\t\t\treturn setError('username', { type: 'username-invalid', message: t('Username_invalid') });\n\t\t\t}\n\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t});\n\n\treturn (\n\t\t<VerticalWizardLayout\n\t\t\tbackground={customBackground}\n\t\t\tlogo={!hideLogo && customLogo ? <Box is='img' maxHeight='x40' mi='neg-x8' src={customLogo} alt='Logo' /> : <></>}\n\t\t>\n\t\t\t<Form aria-labelledby={formLabelId} onSubmit={handleSubmit((data) => registerUsernameMutation.mutate(data))}>\n\t\t\t\t<Form.Header>\n\t\t\t\t\t<Form.Title id={formLabelId}>{t('Username_title')}</Form.Title>\n\t\t\t\t\t<Form.Subtitle>{t('Username_description')}</Form.Subtitle>\n\t\t\t\t</Form.Header>\n\t\t\t\t<Form.Container>\n\t\t\t\t\t{!isLoading && (\n\t\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t\t<FieldLabel id='username-label'>{t('Username')}</FieldLabel>\n\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t<TextInput aria-labelledby='username-label' {...register('username', { required: t('Username_cant_be_empty') })} />\n\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t{errors.username && (\n\t\t\t\t\t\t\t\t\t<FieldError>\n\t\t\t\t\t\t\t\t\t\t<MarkdownText content={errors.username.message} />\n\t\t\t\t\t\t\t\t\t</FieldError>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t</FieldGroup>\n\t\t\t\t\t)}\n\t\t\t\t\t{isLoading && t('Loading_suggestion')}\n\t\t\t\t\t<CustomFieldsForm formName='customFields' formControl={control} metadata={customFields} />\n\t\t\t\t</Form.Container>\n\t\t\t\t<Form.Footer>\n\t\t\t\t\t<ButtonGroup stretch vertical flexGrow={1}>\n\t\t\t\t\t\t<Button disabled={isLoading} type='submit' primary>\n\t\t\t\t\t\t\t{t('Use_this_username')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={logout}>{t('Logout')}</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Form.Footer>\n\t\t\t</Form>\n\t\t</VerticalWizardLayout>\n\t);\n};\n\nexport default RegisterUsername;\n",null],"names":["_extends","_objectSpread","_objectWithoutProperties","_regeneratorRuntime","TextInput","ButtonGroup","Button","FieldGroup","Field","FieldLabel","FieldRow","FieldError","Box","useUniqueId","VerticalWizardLayout","Form","CustomFieldsForm","useSetting","useTranslation","useLogout","useEndpoint","useUserId","useToastMessageDispatch","useAssetWithDarkModePath","useMethod","useAccountsCustomFields","useQuery","useMutation","React","useEffect","useForm","MarkdownText","queryClient","module","link","default","v","exportDefault","t","uid","logout","formLabelId","hideLogo","customLogo","customBackground","dispatchToastMessage","customFields","Error","setUsername","saveCustomFields","usernameSuggestion","_useQuery","async","_context","prev","next","abrupt","stop","Promise","data","isLoading","_useForm","mode","register","handleSubmit","setValue","getValues","setError","control","errors","formState","result","registerUsernameMutation","mutationFn","username","_context2","_excluded","all","onSuccess","type","message","invalidateQueries","onError","error","_ref","errorType","includes","field","createElement","background","logo","is","maxHeight","mi","src","alt","Fragment","onSubmit","mutate","Header","Title","id","Subtitle","Container","required","content","formName","formControl","metadata","Footer","stretch","vertical","flexGrow","disabled","primary","onClick"],"mappings":"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"}