)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/setupWizard/steps/RegisterServerStep.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { RegisterServerPage, RegisterOfflinePage } from '@rocket.chat/onboarding-ui';\nimport { useEndpoint, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport type { ReactElement, ComponentProps } from 'react';\nimport React, { useState } from 'react';\n\nimport { useInvalidateLicense } from '../../../hooks/useLicense';\nimport { dispatchToastMessage } from '../../../lib/toast';\nimport { useSetupWizardContext } from '../contexts/SetupWizardContext';\n\nconst SERVER_OPTIONS = {\n\tREGISTERED: 'REGISTERED',\n\tOFFLINE: 'OFFLINE',\n};\n\nconst RegisterServerStep = (): ReactElement => {\n\tconst t = useTranslation();\n\tconst { currentStep, goToNextStep, setSetupWizardData, registerServer, maxSteps, completeSetupWizard, saveAgreementData } =\n\t\tuseSetupWizardContext();\n\tconst [serverOption, setServerOption] = useState(SERVER_OPTIONS.REGISTERED);\n\tconst invalidateLicenseQuery = useInvalidateLicense();\n\n\tconst handleRegister: ComponentProps<typeof RegisterServerPage>['onSubmit'] = async (data: {\n\t\temail: string;\n\t\tagreement: boolean;\n\t\tupdates: boolean;\n\t\tresend?: boolean;\n\t}) => {\n\t\tgoToNextStep();\n\t\tsetSetupWizardData((prevState) => ({ ...prevState, serverData: data }));\n\t\tawait registerServer(data);\n\t};\n\n\tconst registerManually = useEndpoint('POST', '/v1/cloud.manualRegister');\n\tconst registerPreIntent = useEndpoint('POST', '/v1/cloud.registerPreIntent');\n\tconst getWorkspaceRegisterData = useMethod('cloud:getWorkspaceRegisterData');\n\n\tconst { data: clientKey } = useQuery(['setupWizard/clientKey'], async () => getWorkspaceRegisterData(), {\n\t\tstaleTime: Infinity,\n\t});\n\n\tconst {\n\t\tdata: offline,\n\t\tisLoading,\n\t\tisError,\n\t} = useQuery(['setupWizard/registerIntent'], async () => registerPreIntent(), {\n\t\tstaleTime: Infinity,\n\t\tselect: (data) => data.offline,\n\t});\n\n\tconst { mutate } = useMutation<null, unknown, string>(\n\t\t['setupWizard/confirmOfflineRegistration'],\n\t\tasync (token) => registerManually({ cloudBlob: token }),\n\t\t{\n\t\t\tonSuccess: () => {\n\t\t\t\tinvalidateLicenseQuery(100);\n\t\t\t\tcompleteSetupWizard();\n\t\t\t},\n\t\t\tonError: () => {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Cloud_register_error') });\n\t\t\t},\n\t\t},\n\t);\n\n\tconst handleConfirmOffline: ComponentProps<typeof RegisterOfflinePage>['onSubmit'] = async ({ token, agreement }) => {\n\t\tawait saveAgreementData(agreement);\n\t\tmutate(token);\n\t};\n\n\tif (serverOption === SERVER_OPTIONS.OFFLINE) {\n\t\treturn (\n\t\t\t<RegisterOfflinePage\n\t\t\t\ttermsHref='https://rocket.chat/terms'\n\t\t\t\tpolicyHref='https://rocket.chat/privacy'\n\t\t\t\tclientKey={clientKey || ''}\n\t\t\t\tonCopySecurityCode={(): void => dispatchToastMessage({ type: 'success', message: t('Copied') })}\n\t\t\t\tonBackButtonClick={(): void => setServerOption(SERVER_OPTIONS.REGISTERED)}\n\t\t\t\tonSubmit={handleConfirmOffline}\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<RegisterServerPage\n\t\t\tonClickRegisterOffline={(): void => setServerOption(SERVER_OPTIONS.OFFLINE)}\n\t\t\tstepCount={maxSteps}\n\t\t\tonSubmit={handleRegister}\n\t\t\tcurrentStep={currentStep}\n\t\t\toffline={isError || (!isLoading && offline)}\n\t\t/>\n\t);\n};\n\nexport default RegisterServerStep;\n",null],"names":["module","link","default","_regeneratorRuntime","_objectSpread","_slicedToArray","RegisterServerPage","RegisterOfflinePage","useEndpoint","useMethod","useTranslation","useMutation","useQuery","v","React","useState","useInvalidateLicense","dispatchToastMessage","useSetupWizardContext","SERVER_OPTIONS","REGISTERED","OFFLINE","exportDefault","t","_useSetupWizardContex","currentStep","goToNextStep","setSetupWizardData","registerServer","maxSteps","completeSetupWizard","saveAgreementData","_useState2","serverOption","setServerOption","invalidateLicenseQuery","registerManually","registerPreIntent","getWorkspaceRegisterData","clientKey","_useQuery","async","_context2","prev","next","abrupt","stop","Promise","staleTime","Infinity","data","_useQuery2","_context3","select","offline","isLoading","isError","mutate","_useMutation","token","_context4","cloudBlob","onSuccess","onError","type","message","createElement","termsHref","policyHref","onCopySecurityCode","onBackButtonClick","onSubmit","_ref","agreement","_context5","awrap","onClickRegisterOffline","stepCount","_context","prevState","serverData"],"mappings":"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"}