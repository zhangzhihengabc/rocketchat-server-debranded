)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/directory/chats/contextualBar/RoomEdit/RoomEdit.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ILivechatVisitor, IOmnichannelRoom, Serialized } from '@rocket.chat/core-typings';\nimport { Field, FieldLabel, FieldRow, TextInput, ButtonGroup, Button } from '@rocket.chat/fuselage';\nimport { CustomFieldsForm } from '@rocket.chat/ui-client';\nimport { useToastMessageDispatch, useTranslation, useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useQueryClient } from '@tanstack/react-query';\nimport React, { useCallback } from 'react';\nimport { useController, useForm } from 'react-hook-form';\n\nimport { hasAtLeastOnePermission } from '../../../../../../../app/authorization/client';\nimport { useOmnichannelPriorities } from '../../../../../../../ee/client/omnichannel/hooks/useOmnichannelPriorities';\nimport { ContextualbarFooter, ContextualbarScrollableContent } from '../../../../../../components/Contextualbar';\nimport Tags from '../../../../../../components/Omnichannel/Tags';\nimport { SlaPoliciesSelect, PrioritiesSelect } from '../../../../additionalForms';\nimport { FormSkeleton } from '../../../components/FormSkeleton';\nimport { useCustomFieldsMetadata } from '../../../hooks/useCustomFieldsMetadata';\nimport { useSlaPolicies } from '../../../hooks/useSlaPolicies';\n\ntype RoomEditProps = {\n\troom: Serialized<IOmnichannelRoom>;\n\tvisitor: Serialized<ILivechatVisitor>;\n\treload?: () => void;\n\treloadInfo?: () => void;\n\tonClose: () => void;\n};\n\nconst ROOM_INTIAL_VALUE = {\n\ttopic: '',\n\ttags: [],\n\tlivechatData: {},\n\tslaId: '',\n};\n\nconst getInitialValuesRoom = (room: Serialized<IOmnichannelRoom>) => {\n\tconst { topic, tags, livechatData, slaId, priorityId } = room ?? ROOM_INTIAL_VALUE;\n\n\treturn {\n\t\ttopic: topic ?? '',\n\t\ttags: tags ?? [],\n\t\tlivechatData: livechatData ?? {},\n\t\tslaId: slaId ?? '',\n\t\tpriorityId: priorityId ?? '',\n\t};\n};\n\nfunction RoomEdit({ room, visitor, reload, reloadInfo, onClose }: RoomEditProps) {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst queryClient = useQueryClient();\n\tconst canViewCustomFields = hasAtLeastOnePermission(['view-livechat-room-customfields', 'edit-livechat-room-customfields']);\n\n\tconst saveRoom = useEndpoint('POST', '/v1/livechat/room.saveInfo');\n\n\tconst { data: slaPolicies, isInitialLoading: isSlaPoliciesLoading } = useSlaPolicies();\n\tconst { data: customFieldsMetadata, isInitialLoading: isCustomFieldsLoading } = useCustomFieldsMetadata({\n\t\tscope: 'room',\n\t\tenabled: canViewCustomFields,\n\t});\n\tconst { data: priorities, isLoading: isPrioritiesLoading } = useOmnichannelPriorities();\n\n\tconst {\n\t\tregister,\n\t\tcontrol,\n\t\tformState: { isDirty: isFormDirty, isValid: isFormValid, isSubmitting },\n\t\thandleSubmit,\n\t} = useForm({\n\t\tmode: 'onChange',\n\t\tdefaultValues: getInitialValuesRoom(room),\n\t});\n\n\tconst { field: tagsField } = useController({ control, name: 'tags' });\n\tconst { field: slaIdField } = useController({ control, name: 'slaId' });\n\tconst { field: priorityIdField } = useController({ control, name: 'priorityId' });\n\n\tconst handleSave = useCallback(\n\t\tasync (data) => {\n\t\t\tif (!isFormValid) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { topic, tags, livechatData, slaId, priorityId } = data;\n\n\t\t\tconst guestData = {\n\t\t\t\t_id: visitor._id,\n\t\t\t};\n\n\t\t\tconst roomData = {\n\t\t\t\t_id: room._id,\n\t\t\t\ttopic,\n\t\t\t\ttags: tags.sort(),\n\t\t\t\tlivechatData,\n\t\t\t\tpriorityId,\n\t\t\t\t...(slaId && { slaId }),\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tawait saveRoom({ guestData, roomData });\n\t\t\t\tawait queryClient.invalidateQueries(['/v1/rooms.info', room._id]);\n\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Saved') });\n\t\t\t\treload?.();\n\t\t\t\treloadInfo?.();\n\t\t\t\tonClose();\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t},\n\t\t[dispatchToastMessage, isFormValid, onClose, queryClient, reload, reloadInfo, room._id, saveRoom, t, visitor._id],\n\t);\n\n\tif (isCustomFieldsLoading || isSlaPoliciesLoading || isPrioritiesLoading) {\n\t\treturn (\n\t\t\t<ContextualbarScrollableContent>\n\t\t\t\t<FormSkeleton />\n\t\t\t</ContextualbarScrollableContent>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent is='form' onSubmit={handleSubmit(handleSave)}>\n\t\t\t\t{canViewCustomFields && customFieldsMetadata && (\n\t\t\t\t\t<CustomFieldsForm formName='livechatData' formControl={control} metadata={customFieldsMetadata} />\n\t\t\t\t)}\n\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Topic')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput {...register('topic')} flexGrow={1} />\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\n\t\t\t\t<Field>\n\t\t\t\t\t<Tags tags={tagsField.value} handler={tagsField.onChange} department={room.departmentId} />\n\t\t\t\t</Field>\n\n\t\t\t\t{SlaPoliciesSelect && !!slaPolicies?.length && (\n\t\t\t\t\t<SlaPoliciesSelect label={t('SLA_Policy')} value={slaIdField.value} options={slaPolicies} onChange={slaIdField.onChange} />\n\t\t\t\t)}\n\n\t\t\t\t{PrioritiesSelect && !!priorities?.length && (\n\t\t\t\t\t<PrioritiesSelect label={t('Priority')} value={priorityIdField.value} options={priorities} onChange={priorityIdField.onChange} />\n\t\t\t\t)}\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button flexGrow={1} onClick={onClose}>\n\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t<Button\n\t\t\t\t\t\tmie='none'\n\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\tonClick={handleSubmit(handleSave)}\n\t\t\t\t\t\tloading={isSubmitting}\n\t\t\t\t\t\tdisabled={!isFormValid || !isFormDirty}\n\t\t\t\t\t\tprimary\n\t\t\t\t\t>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n}\n\nexport default RoomEdit;\n",null],"names":["module","link","default","v","_regeneratorRuntime","_extends","_objectSpread","Field","FieldLabel","FieldRow","TextInput","ButtonGroup","Button","CustomFieldsForm","useToastMessageDispatch","useTranslation","useEndpoint","useQueryClient","React","useCallback","useController","useForm","hasAtLeastOnePermission","useOmnichannelPriorities","ContextualbarFooter","ContextualbarScrollableContent","Tags","SlaPoliciesSelect","PrioritiesSelect","FormSkeleton","useCustomFieldsMetadata","useSlaPolicies","ROOM_INTIAL_VALUE","topic","tags","livechatData","slaId","getInitialValuesRoom","room","_ref","priorityId","exportDefault","_ref2","visitor","reload","reloadInfo","onClose","t","dispatchToastMessage","queryClient","canViewCustomFields","saveRoom","_useSlaPolicies","slaPolicies","data","isSlaPoliciesLoading","isInitialLoading","_useCustomFieldsMetad","scope","enabled","customFieldsMetadata","isCustomFieldsLoading","_useOmnichannelPriori","priorities","isPrioritiesLoading","isLoading","_useForm","mode","defaultValues","register","control","_useForm$formState","formState","isFormDirty","isDirty","isFormValid","isValid","isSubmitting","handleSubmit","tagsField","_useController","name","field","slaIdField","_useController2","priorityIdField","_useController3","handleSave","guestData","roomData","async","_context","prev","next","abrupt","_id","sort","awrap","invalidateQueries","type","message","t0","stop","Promise","createElement","Fragment","is","onSubmit","formName","formControl","metadata","flexGrow","value","handler","onChange","department","departmentId","length","label","options","stretch","onClick","mie","loading","disabled","primary"],"mappings":"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"}