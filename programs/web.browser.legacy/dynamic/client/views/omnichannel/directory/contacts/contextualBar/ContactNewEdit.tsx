function module(e,n,t){t.link("@babel/runtime/regenerator",{default:function(e){a=e}},0),t.link("@babel/runtime/helpers/extends",{default:function(e){r=e}},1),t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){l=e}},2),t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){o=e}},3),t.link("@rocket.chat/fuselage",{Field:function(e){i=e},FieldLabel:function(e){u=e},FieldRow:function(e){s=e},FieldError:function(e){c=e},TextInput:function(e){m=e},ButtonGroup:function(e){d=e},Button:function(e){f=e},ContextualbarContent:function(e){p=e}},0),t.link("@rocket.chat/ui-client",{CustomFieldsForm:function(e){v=e}},1),t.link("@rocket.chat/ui-contexts",{useToastMessageDispatch:function(e){h=e},useEndpoint:function(e){k=e},useTranslation:function(e){E=e}},2),t.link("@tanstack/react-query",{useQueryClient:function(e){b=e}},3),t.link("react",{default:function(e){x=e},useState:function(e){g=e},useEffect:function(e){F=e}},4),t.link("react-hook-form",{useForm:function(e){w=e}},5),t.link("../../../../../../app/authorization/client",{hasAtLeastOnePermission:function(e){y=e}},6),t.link("../../../../../../lib/emailValidator",{validateEmail:function(e){C=e}},7),t.link("../../../../../components/Contextualbar",{ContextualbarScrollableContent:function(e){S=e},ContextualbarFooter:function(e){T=e}},8),t.link("../../../../../lib/utils/createToken",{createToken:function(e){_=e}},9),t.link("../../../additionalForms",{ContactManager:function(e){G=e}},10),t.link("../../components/FormSkeleton",{FormSkeleton:function(e){P=e}},11),t.link("../../hooks/useCustomFieldsMetadata",{useCustomFieldsMetadata:function(e){M=e}},12);var a,r,l,o,i,u,s,c,m,d,f,p,v,h,k,E,b,x,g,F,w,y,C,S,T,_,G,P,M,D={token:"",name:"",email:"",phone:"",username:"",customFields:{}},V=function(e){if(!e)return D;var n,t,a=null!==(n=e.contact)&&void 0!==n?n:{},r=a.name,l=a.token,o=a.phone,i=a.visitorEmails,u=a.livechatData,s=a.contactManager;return{token:null!=l?l:"",name:null!=r?r:"",email:i?i[0].address:"",phone:o?o[0].phoneNumber:"",customFields:null!=u?u:{},username:null!==(t=null==s?void 0:s.username)&&void 0!==t?t:""}};t.exportDefault(function(e){var n,t,D,N,q,I,L=e.id,A=e.data,B=e.close,O=E(),Q=h(),j=b(),z=function(){return y(["view-livechat-room-customfields","edit-livechat-room-customfields"])},K=o(g("no-agent-selected"),2),R=K[0],H=K[1],J=k("POST","/v1/omnichannel/contact"),U=k("GET","/v1/omnichannel/contact.search"),W=k("GET","/v1/users.info"),X=M({scope:"visitor",enabled:z()}),Y=X.data,Z=X.isInitialLoading,$=V(A),ee=$.username,en=w({mode:"onChange",reValidateMode:"onChange",defaultValues:$}),et=en.register,ea=en.formState,er=ea.errors,el=ea.isValid,eo=ea.isDirty,ei=ea.isSubmitting,eu=en.control,es=en.setValue,ec=en.handleSubmit,em=en.setError;F(function(){ee&&W({username:ee}).then(function(e){H(e.user._id)})},[W,ee]);var ed=function(e,n){var t,r,l,o=arguments;return a.async(function(i){for(;;)switch(i.prev=i.next){case 0:if(!((!(o.length>2)||void 0===o[2]||o[2])&&!n||n===$[e])){i.next=3;break}return i.abrupt("return",!0);case 3:return(t={})[e]=n,r=t,i.next=6,a.awrap(U(r));case 6:return l=i.sent.contact,i.abrupt("return",!l||l._id===L);case 9:case"end":return i.stop()}},null,null,null,Promise)},ef=function(){var e,n,t,r,l,o,i,u=arguments;return a.async(function(s){for(;;)switch(s.prev=s.next){case 0:return t=void 0===(n=(e=u.length>0&&void 0!==u[0]?u[0]:{}).phone)?"":n,l=void 0===(r=e.email)?"":r,s.next=3,a.awrap(ed("email",l));case 3:return o=s.sent,s.next=6,a.awrap(ed("phone",t));case 6:return i=s.sent,o||em("email",{message:O("Email_already_exists")}),i||em("phone",{message:O("Phone_already_exists")}),s.abrupt("return",o&&i);case 10:case"end":return s.stop()}},null,null,null,Promise)},ep=function(e){var n,t,r,o,i,u;return a.async(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.awrap(ef(e));case 2:if(s.sent){s.next=4;break}return s.abrupt("return");case 4:return n=e.name,t=e.phone,r=e.email,o=e.customFields,i=e.username,u=l(l({name:n,phone:t,email:r,customFields:o,token:e.token||_()},i&&{contactManager:{username:i}}),L&&{_id:L}),s.prev=6,s.next=9,a.awrap(J(u));case 9:return Q({type:"success",message:O("Saved")}),s.next=12,a.awrap(j.invalidateQueries({queryKey:["current-contacts"]}));case 12:B(),s.next=18;break;case 15:s.prev=15,s.t0=s.catch(6),Q({type:"error",message:s.t0});case 18:case"end":return s.stop()}},null,null,[[6,15]],Promise)};return Z?x.createElement(p,null,x.createElement(P,null)):x.createElement(x.Fragment,null,x.createElement(S,{is:"form",onSubmit:ec(ep)},x.createElement(i,null,x.createElement(u,null,O("Name"),"*"),x.createElement(s,null,x.createElement(m,r({},et("name",{validate:function(e){return!!e.trim()||O("The_field_is_required",O("Name"))}}),{error:null===(n=er.name)||void 0===n?void 0:n.message,flexGrow:1}))),x.createElement(c,null,null===(t=er.name)||void 0===t?void 0:t.message)),x.createElement(i,null,x.createElement(u,null,O("Email")),x.createElement(s,null,x.createElement(m,r({},et("email",{validate:function(e){return!e||e===$.email||!!C(e)||O("error-invalid-email-address")}}),{error:null===(D=er.email)||void 0===D?void 0:D.message,flexGrow:1}))),x.createElement(c,null,null===(N=er.email)||void 0===N?void 0:N.message)),x.createElement(i,null,x.createElement(u,null,O("Phone")),x.createElement(s,null,x.createElement(m,r({},et("phone"),{error:null===(q=er.phone)||void 0===q?void 0:q.message,flexGrow:1}))),x.createElement(c,null,null===(I=er.phone)||void 0===I?void 0:I.message)),z()&&x.createElement(v,{formName:"customFields",formControl:eu,metadata:void 0===Y?[]:Y}),x.createElement(G,{value:R,handler:function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(H(e),"no-agent-selected"!==e){n.next=4;break}return es("username","",{shouldDirty:!0}),n.abrupt("return");case 4:return n.next=6,a.awrap(W({userId:e}));case 6:es("username",n.sent.user.username||"",{shouldDirty:!0});case 9:case"end":return n.stop()}},null,null,null,Promise)}})),x.createElement(T,null,x.createElement(d,{stretch:!0},x.createElement(f,{flexGrow:1,onClick:B},O("Cancel")),x.createElement(f,{mie:"none",type:"submit",onClick:ec(ep),flexGrow:1,loading:ei,disabled:!el||!eo,primary:!0},O("Save")))))})}
//# sourceMappingURL=/dynamic/client/views/omnichannel/directory/contacts/contextualBar/4939bb3abe7389986830523d0bab2e77d18c7097.map
