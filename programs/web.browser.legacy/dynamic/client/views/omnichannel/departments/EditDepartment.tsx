function module(e,n,t){function a(e,n){return e||n}t.link("@babel/runtime/regenerator",{default:function(e){l=e}},0),t.link("@babel/runtime/helpers/extends",{default:function(e){r=e}},1),t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){o=e}},2),t.link("@rocket.chat/fuselage",{FieldGroup:function(e){i=e},Field:function(e){u=e},FieldLabel:function(e){s=e},FieldRow:function(e){c=e},FieldError:function(e){m=e},TextInput:function(e){d=e},Box:function(e){f=e},Icon:function(e){g=e},Divider:function(e){h=e},ToggleSwitch:function(e){p=e},TextAreaInput:function(e){v=e},ButtonGroup:function(e){E=e},Button:function(e){_=e},PaginatedSelectFiltered:function(e){b=e}},0),t.link("@rocket.chat/fuselage-hooks",{useDebouncedValue:function(e){C=e},useMutableCallback:function(e){w=e},useUniqueId:function(e){T=e}},1),t.link("@rocket.chat/ui-contexts",{useToastMessageDispatch:function(e){x=e},useRoute:function(e){D=e},useMethod:function(e){k=e},useEndpoint:function(e){S=e},useTranslation:function(e){F=e}},2),t.link("@tanstack/react-query",{useQueryClient:function(e){M=e}},3),t.link("react",{default:function(e){q=e},useMemo:function(e){I=e},useState:function(e){y=e}},4),t.link("react-hook-form",{Controller:function(e){O=e},useForm:function(e){R=e}},5),t.link("../../../../ee/client/hooks/useHasLicenseModule",{useHasLicenseModule:function(e){L=e}},6),t.link("../../../../lib/emailValidator",{validateEmail:function(e){N=e}},7),t.link("../../../components/AutoCompleteDepartment",{default:function(e){A=e}},8),t.link("../../../components/Page",{default:function(e){B=e}},9),t.link("../../../hooks/lists/useRecordList",{useRecordList:function(e){G=e}},10),t.link("../../../hooks/useRoomsList",{useRoomsList:function(e){P=e}},11),t.link("../../../lib/asyncState",{AsyncStatePhase:function(e){Q=e}},12),t.link("../additionalForms",{EeTextInput:function(e){H=e},EeTextAreaInput:function(e){V=e},EeNumberInput:function(e){W=e},DepartmentForwarding:function(e){z=e},DepartmentBusinessHours:function(e){U=e}},13),t.link("./DepartmentAgentsTable/DepartmentAgentsTable",{default:function(e){j=e}},14),t.link("./DepartmentTags",{DepartmentTags:function(e){J=e}},15);var l,r,o,i,u,s,c,m,d,f,g,h,p,v,E,_,b,C,w,T,x,D,k,S,F,M,q,I,y,O,R,L,N,A,B,G,P,Q,H,V,W,z,U,j,J,K=function(e){var n,t,a=e.department,l=e.agents,r=e.allowedToForwardData;return{name:(null==a?void 0:a.name)||"",email:(null==a?void 0:a.email)||"",description:(null==a?void 0:a.description)||"",enabled:!!(null!=a&&a.enabled),maxNumberSimultaneousChat:null==a?void 0:a.maxNumberSimultaneousChat,showOnRegistration:!!(null!=a&&a.showOnRegistration),showOnOfflineForm:!!(null!=a&&a.showOnOfflineForm),abandonedRoomsCloseCustomMessage:(null==a?void 0:a.abandonedRoomsCloseCustomMessage)||"",requestTagBeforeClosingChat:!!(null!=a&&a.requestTagBeforeClosingChat),offlineMessageChannelName:(null==a?void 0:a.offlineMessageChannelName)||"",visitorInactivityTimeoutInSeconds:null==a?void 0:a.visitorInactivityTimeoutInSeconds,waitingQueueMessage:(null==a?void 0:a.waitingQueueMessage)||"",departmentsAllowedToForward:(null==r?void 0:null===(n=r.departments)||void 0===n?void 0:n.map(function(e){return{label:e.name,value:e._id}}))||[],fallbackForwardDepartment:(null==a?void 0:a.fallbackForwardDepartment)||"",chatClosingTags:null!==(t=null==a?void 0:a.chatClosingTags)&&void 0!==t?t:[],agentList:l||[]}};t.exportDefault(function(e){var n,t,a,X,Y,Z=e.data,$=e.id,ee=e.title,en=e.allowedToForwardData,et=F(),ea=D("omnichannel-departments"),el=M(),er=Z||{},eo=er.department,ei=er.agents,eu=L("livechat-enterprise"),es=K({department:eo,agents:void 0===ei?[]:ei,allowedToForwardData:en}),ec=R({mode:"onChange",defaultValues:es}),em=ec.register,ed=ec.control,ef=ec.handleSubmit,eg=ec.watch,eh=ec.formState,ep=eh.errors,ev=eh.isValid,eE=eh.isDirty,e_=eh.isSubmitting,eb=eg("requestTagBeforeClosingChat"),eC=o(y(""),2),ew=eC[0],eT=eC[1],ex=C(ew,500),eD=P(I(function(){return{text:ex}},[ex])),ek=eD.itemsList,eS=eD.loadMoreItems,eF=G(ek),eM=eF.phase,eq=eF.items,eI=eF.itemCount,ey=k("livechat:saveDepartment"),eO=S("POST","/v1/livechat/department/:_id/agents",{_id:$||""}),eR=x(),eL=w(function(e){var n,t,a,r,o,i,u,s,c,m,d,f,g,h,p,v,E,_;return l.async(function(b){for(;;)switch(b.prev=b.next){case 0:if(n=e.agentList,t=e.enabled,a=e.name,r=e.description,o=e.showOnRegistration,i=e.showOnOfflineForm,u=e.email,s=e.chatClosingTags,c=e.offlineMessageChannelName,m=e.maxNumberSimultaneousChat,d=e.visitorInactivityTimeoutInSeconds,f=e.abandonedRoomsCloseCustomMessage,g=e.waitingQueueMessage,h=e.departmentsAllowedToForward,p=e.fallbackForwardDepartment,v={enabled:t,name:a,description:r,showOnRegistration:o,showOnOfflineForm:i,requestTagBeforeClosingChat:eb,email:u,chatClosingTags:s,offlineMessageChannelName:c,maxNumberSimultaneousChat:m,visitorInactivityTimeoutInSeconds:d,abandonedRoomsCloseCustomMessage:f,waitingQueueMessage:g,departmentsAllowedToForward:null==h?void 0:h.map(function(e){return e.value}),fallbackForwardDepartment:p},b.prev=2,!$){b.next=13;break}return E=es.agentList,_={upsert:n.filter(function(e){return!E.some(function(n){return n._id===e._id&&e.count===n.count&&e.order===n.order})}),remove:E.filter(function(e){return!n.some(function(n){return e._id===n._id})})},b.next=8,l.awrap(ey($,v,[]));case 8:if(!(_.upsert.length>0||_.remove.length>0)){b.next=11;break}return b.next=11,l.awrap(eO(_));case 11:b.next=15;break;case 13:return b.next=15,l.awrap(ey(null!=$?$:null,v,n));case 15:el.invalidateQueries(["/v1/livechat/department/:_id",$]),eR({type:"success",message:et("Saved")}),ea.push({}),b.next=23;break;case 20:b.prev=20,b.t0=b.catch(2),eR({type:"error",message:b.t0});case 23:case"end":return b.stop()}},null,null,[[2,20]],Promise)}),eN=w(function(){ea.push({})}),eA=T();return q.createElement(B,{flexDirection:"row"},q.createElement(B,null,q.createElement(B.Header,{title:ee},q.createElement(E,null,q.createElement(_,{icon:"back",onClick:eN},et("Back")),q.createElement(_,{type:"submit",form:eA,primary:!0,disabled:!(ev&&eE),loading:e_},et("Save")))),q.createElement(B.ScrollableContentWithShadow,null,q.createElement(i,{w:"full",alignSelf:"center",maxWidth:"x600",id:eA,is:"form",autoComplete:"off",onSubmit:ef(eL)},q.createElement(u,null,q.createElement(f,{display:"flex","data-qa":"DepartmentEditToggle-Enabled",flexDirection:"row"},q.createElement(s,null,et("Enabled")),q.createElement(c,null,q.createElement(p,r({flexGrow:1},em("enabled")))))),q.createElement(u,null,q.createElement(s,null,et("Name"),"*"),q.createElement(c,null,q.createElement(d,r({"data-qa":"DepartmentEditTextInput-Name",flexGrow:1,error:null===(n=ep.name)||void 0===n?void 0:n.message,placeholder:et("Name")},em("name",{required:et("The_field_is_required","name")})))),ep.name&&q.createElement(m,null,null===(t=ep.name)||void 0===t?void 0:t.message)),q.createElement(u,null,q.createElement(s,null,et("Description")),q.createElement(c,null,q.createElement(v,r({"data-qa":"DepartmentEditTextInput-Description",flexGrow:1,placeholder:et("Description")},em("description"))))),q.createElement(u,null,q.createElement(f,{"data-qa":"DepartmentEditToggle-ShowOnRegistrationPage",display:"flex",flexDirection:"row"},q.createElement(s,null,et("Show_on_registration_page")),q.createElement(c,null,q.createElement(p,r({flexGrow:1},em("showOnRegistration")))))),q.createElement(u,null,q.createElement(s,null,et("Email"),"*"),q.createElement(c,null,q.createElement(d,r({"data-qa":"DepartmentEditTextInput-Email",flexGrow:1,error:null===(a=ep.email)||void 0===a?void 0:a.message,addon:q.createElement(g,{name:"mail",size:"x20"}),placeholder:et("Email")},em("email",{required:et("The_field_is_required","email"),validate:function(e){return N(e)||et("error-invalid-email-address")}})))),ep.email&&q.createElement(m,null,null===(X=ep.email)||void 0===X?void 0:X.message)),q.createElement(u,null,q.createElement(f,{display:"flex","data-qa":"DepartmentEditToggle-ShowOnOfflinePage",flexDirection:"row"},q.createElement(s,null,et("Show_on_offline_page")),q.createElement(c,null,q.createElement(p,r({flexGrow:1},em("showOnOfflineForm")))))),q.createElement(u,null,q.createElement(s,null,et("Livechat_DepartmentOfflineMessageToChannel")),q.createElement(c,null,q.createElement(O,{control:ed,name:"offlineMessageChannelName",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(b,{"data-qa":"DepartmentSelect-LivechatDepartmentOfflineMessageToChannel",value:t,onChange:a,flexShrink:0,filter:ew,setFilter:eT,options:eq,placeholder:et("Channel_name"),endReached:eM===Q.LOADING?function(){}:function(e){return eS(e,Math.min(50,eI))},"aria-busy":ew!==ex})}}))),q.createElement(u,null,q.createElement(O,{control:ed,name:"maxNumberSimultaneousChat",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(W,{value:t,handler:a,label:"Max_number_of_chats_per_agent",placeholder:"Max_number_of_chats_per_agent_description"})}})),q.createElement(u,null,q.createElement(O,{control:ed,name:"visitorInactivityTimeoutInSeconds",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(W,{value:t,handler:a,label:"How_long_to_wait_to_consider_visitor_abandonment_in_seconds",placeholder:"Number_in_seconds"})}})),q.createElement(u,null,q.createElement(O,{control:ed,name:"abandonedRoomsCloseCustomMessage",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(H,{value:t,handler:a,label:"Livechat_abandoned_rooms_closed_custom_message",placeholder:"Enter_a_custom_message"})}})),q.createElement(u,null,q.createElement(O,{control:ed,name:"waitingQueueMessage",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(V,{value:t,handler:a,label:"Waiting_queue_message",placeholder:"Waiting_queue_message"})}})),z&&q.createElement(u,null,q.createElement(O,{control:ed,name:"departmentsAllowedToForward",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(z,{departmentId:null!=$?$:"",value:t,handler:a,label:"List_of_departments_for_forward"})}})),eu&&q.createElement(u,null,q.createElement(s,null,et("Fallback_forward_department")),q.createElement(O,{control:ed,name:"fallbackForwardDepartment",render:function(e){var n=e.field,t=n.value,a=n.onChange;return q.createElement(A,{haveNone:!0,excludeDepartmentId:null==eo?void 0:eo._id,value:t,onChange:a,onlyMyDepartments:!0,showArchived:!0})}})),q.createElement(u,null,q.createElement(f,{display:"flex","data-qa":"DiscussionToggle-RequestTagBeforeCLosingChat",flexDirection:"row"},q.createElement(s,null,et("Request_tag_before_closing_chat")),q.createElement(c,null,q.createElement(p,r({"data-qa":"DiscussionToggle-RequestTagBeforeCLosingChat",flexGrow:1},em("requestTagBeforeClosingChat")))))),eb&&q.createElement(u,null,q.createElement(s,{alignSelf:"stretch"},et("Conversation_closing_tags"),"*"),q.createElement(O,{control:ed,name:"chatClosingTags",rules:{required:et("The_field_is_required","tags")},render:function(e){var n,t=e.field,a=t.value,l=t.onChange;return q.createElement(J,{value:a,onChange:l,error:null===(n=ep.chatClosingTags)||void 0===n?void 0:n.message})}}),ep.chatClosingTags&&q.createElement(m,null,null===(Y=ep.chatClosingTags)||void 0===Y?void 0:Y.message)),q.createElement(u,null,q.createElement(U,{bhId:null==eo?void 0:eo.businessHourId})),q.createElement(h,{mb:16}),q.createElement(u,null,q.createElement(s,{mb:4},et("Agents"),":"),q.createElement(f,{display:"flex",flexDirection:"column",height:"50vh"},q.createElement(j,{control:ed,register:em})))))))})}
//# sourceMappingURL=/dynamic/client/views/omnichannel/departments/935381aa590d628110e478ad49780099017c549b.map
