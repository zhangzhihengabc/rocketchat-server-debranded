)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/omnichannel/customFields/CustomFieldsTable.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Pagination } from '@rocket.chat/fuselage';\nimport { useDebouncedValue, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useEndpoint, useRouter } from '@rocket.chat/ui-contexts';\nimport { useQuery, hashQueryKey } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport React, { useMemo, useState, useEffect } from 'react';\n\nimport FilterByText from '../../../components/FilterByText';\nimport GenericNoResults from '../../../components/GenericNoResults';\nimport {\n\tGenericTable,\n\tGenericTableHeader,\n\tGenericTableHeaderCell,\n\tGenericTableRow,\n\tGenericTableCell,\n\tGenericTableBody,\n\tGenericTableLoadingTable,\n} from '../../../components/GenericTable';\nimport { usePagination } from '../../../components/GenericTable/hooks/usePagination';\nimport { useSort } from '../../../components/GenericTable/hooks/useSort';\nimport RemoveCustomFieldButton from './RemoveCustomFieldButton';\n\nconst CustomFieldsTable = ({ reload }: { reload: MutableRefObject<() => void> }) => {\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\tconst [filter, setFilter] = useState('');\n\tconst debouncedFilter = useDebouncedValue(filter, 500);\n\n\tconst { current, itemsPerPage, setItemsPerPage: onSetItemsPerPage, setCurrent: onSetCurrent, ...paginationProps } = usePagination();\n\tconst { sortBy, sortDirection, setSort } = useSort<'_id' | 'label' | 'scope' | 'visibility'>('_id');\n\n\tconst handleAddNew = useMutableCallback(() => router.navigate('/omnichannel/customfields/new'));\n\tconst onRowClick = useMutableCallback((id) => () => router.navigate(`/omnichannel/customfields/edit/${id}`));\n\n\tconst query = useMemo(\n\t\t() => ({\n\t\t\ttext: debouncedFilter,\n\t\t\tsort: `{ \"${sortBy}\": ${sortDirection === 'asc' ? 1 : -1} }`,\n\t\t\t...(itemsPerPage && { count: itemsPerPage }),\n\t\t\t...(current && { offset: current }),\n\t\t}),\n\t\t[debouncedFilter, itemsPerPage, current, sortBy, sortDirection],\n\t);\n\n\tconst getCustomFields = useEndpoint('GET', '/v1/livechat/custom-fields');\n\tconst { data, isSuccess, isLoading, refetch } = useQuery(['livechat-customFields', query, debouncedFilter], async () =>\n\t\tgetCustomFields(query),\n\t);\n\n\tconst [defaultQuery] = useState(hashQueryKey([query]));\n\tconst queryHasChanged = defaultQuery !== hashQueryKey([query]);\n\n\tuseEffect(() => {\n\t\treload.current = refetch;\n\t}, [reload, refetch]);\n\treload.current = refetch;\n\n\tconst headers = (\n\t\t<>\n\t\t\t<GenericTableHeaderCell key='field' direction={sortDirection} active={sortBy === '_id'} onClick={setSort} sort='_id'>\n\t\t\t\t{t('Field')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell key='label' direction={sortDirection} active={sortBy === 'label'} onClick={setSort} sort='label'>\n\t\t\t\t{t('Label')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell key='scope' direction={sortDirection} active={sortBy === 'scope'} onClick={setSort} sort='scope'>\n\t\t\t\t{t('Scope')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tkey='visibility'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'visibility'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='visibility'\n\t\t\t>\n\t\t\t\t{t('Visibility')}\n\t\t\t</GenericTableHeaderCell>\n\t\t\t<GenericTableHeaderCell key='remove' w='x60'>\n\t\t\t\t{t('Remove')}\n\t\t\t</GenericTableHeaderCell>\n\t\t</>\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{((isSuccess && data?.customFields.length > 0) || queryHasChanged) && <FilterByText onChange={({ text }) => setFilter(text)} />}\n\t\t\t{isLoading && (\n\t\t\t\t<GenericTable>\n\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t<GenericTableLoadingTable headerCells={5} />\n\t\t\t\t\t</GenericTableBody>\n\t\t\t\t</GenericTable>\n\t\t\t)}\n\t\t\t{isSuccess && data.customFields.length === 0 && queryHasChanged && <GenericNoResults />}\n\t\t\t{isSuccess && data.customFields.length === 0 && !queryHasChanged && (\n\t\t\t\t<GenericNoResults\n\t\t\t\t\ticon='file-sheets'\n\t\t\t\t\ttitle={t('No_custom_fields_yet')}\n\t\t\t\t\tdescription={t('No_custom_fields_yet_description')}\n\t\t\t\t\tbuttonAction={handleAddNew}\n\t\t\t\t\tbuttonTitle={t('Create_custom_field')}\n\t\t\t\t\tlinkHref='https://go.rocket.chat/omnichannel-docs'\n\t\t\t\t\tlinkText={t('Learn_more_about_custom_fields')}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{isSuccess && data.customFields.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t<GenericTable data-qa='GenericTableCustomFieldsInfoBody' aria-busy={filter !== debouncedFilter} aria-live='assertive'>\n\t\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t\t{data.customFields.map(({ label, _id, scope, visibility }) => (\n\t\t\t\t\t\t\t\t<GenericTableRow key={_id} tabIndex={0} role='link' onClick={onRowClick(_id)} action qa-user-id={_id}>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{_id}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{label}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{scope === 'visitor' ? t('Visitor') : t('Room')}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<GenericTableCell withTruncatedText>{visibility === 'visible' ? t('Visible') : t('Hidden')}</GenericTableCell>\n\t\t\t\t\t\t\t\t\t<RemoveCustomFieldButton _id={_id} reload={refetch} />\n\t\t\t\t\t\t\t\t</GenericTableRow>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</GenericTableBody>\n\t\t\t\t\t</GenericTable>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tdivider\n\t\t\t\t\t\tcurrent={current}\n\t\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\t\tcount={data.total || 0}\n\t\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t\t\t{...paginationProps}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</>\n\t);\n};\n\nexport default CustomFieldsTable;\n",null],"names":["_regeneratorRuntime","_extends","_objectSpread","_objectWithoutProperties","_slicedToArray","Pagination","useDebouncedValue","useMutableCallback","useTranslation","useEndpoint","useRouter","useQuery","hashQueryKey","React","useMemo","useState","useEffect","FilterByText","GenericNoResults","GenericTable","GenericTableHeader","GenericTableHeaderCell","GenericTableRow","GenericTableCell","GenericTableBody","GenericTableLoadingTable","usePagination","useSort","RemoveCustomFieldButton","module","link","default","v","exportDefault","_ref","reload","t","router","_useState2","filter","setFilter","debouncedFilter","_usePagination","current","itemsPerPage","onSetItemsPerPage","setItemsPerPage","onSetCurrent","setCurrent","paginationProps","_excluded","_useSort","sortBy","sortDirection","setSort","handleAddNew","navigate","onRowClick","id","query","text","sort","count","offset","getCustomFields","_useQuery","async","_context","prev","next","abrupt","stop","Promise","data","isSuccess","isLoading","refetch","queryHasChanged","defaultQuery","_useState4","headers","createElement","Fragment","key","direction","active","onClick","w","customFields","length","onChange","_ref2","headerCells","icon","title","description","buttonAction","buttonTitle","linkHref","linkText","map","_ref3","label","_id","scope","visibility","tabIndex","role","action","withTruncatedText","divider","total"],"mappings":"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"}