)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/account/profile/AccountProfilePage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { ButtonGroup, Button, Box } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { SHA256 } from '@rocket.chat/sha256';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport {\n\tuseSetModal,\n\tuseToastMessageDispatch,\n\tuseUser,\n\tuseLogout,\n\tuseEndpoint,\n\tuseTranslation,\n\tuseSetting,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useCallback } from 'react';\nimport { FormProvider, useForm } from 'react-hook-form';\n\nimport ConfirmOwnerChangeModal from '../../../components/ConfirmOwnerChangeModal';\nimport Page from '../../../components/Page';\nimport { useAllowPasswordChange } from '../security/useAllowPasswordChange';\nimport AccountProfileForm from './AccountProfileForm';\nimport ActionConfirmModal from './ActionConfirmModal';\nimport { getProfileInitialValues } from './getProfileInitialValues';\n\n// TODO: enforce useMutation\nconst AccountProfilePage = (): ReactElement => {\n\tconst t = useTranslation();\n\tconst user = useUser();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst setModal = useSetModal();\n\tconst logout = useLogout();\n\tconst [loggingOut, setLoggingOut] = useState(false);\n\n\tconst erasureType = useSetting('Message_ErasureType');\n\tconst allowDeleteOwnAccount = useSetting('Accounts_AllowDeleteOwnAccount');\n\tconst { hasLocalPassword } = useAllowPasswordChange();\n\n\tconst methods = useForm({\n\t\tdefaultValues: getProfileInitialValues(user),\n\t\tmode: 'onBlur',\n\t});\n\n\tconst {\n\t\treset,\n\t\tformState: { isDirty, isSubmitting },\n\t} = methods;\n\n\tconst logoutOtherClients = useEndpoint('POST', '/v1/users.logoutOtherClients');\n\tconst deleteOwnAccount = useEndpoint('POST', '/v1/users.deleteOwnAccount');\n\n\tconst handleLogoutOtherLocations = useCallback(async () => {\n\t\tsetLoggingOut(true);\n\t\ttry {\n\t\t\tawait logoutOtherClients();\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'success',\n\t\t\t\tmessage: t('Logged_out_of_other_clients_successfully'),\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t\tsetLoggingOut(false);\n\t}, [logoutOtherClients, dispatchToastMessage, t]);\n\n\tconst handleConfirmOwnerChange = useCallback(\n\t\t(passwordOrUsername, shouldChangeOwner, shouldBeRemoved) => {\n\t\t\tconst handleConfirm = async (): Promise<void> => {\n\t\t\t\ttry {\n\t\t\t\t\tawait deleteOwnAccount({ password: SHA256(passwordOrUsername), confirmRelinquish: true });\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_has_been_deleted') });\n\t\t\t\t\tsetModal(null);\n\t\t\t\t\tlogout();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn setModal(() => (\n\t\t\t\t<ConfirmOwnerChangeModal\n\t\t\t\t\tonConfirm={handleConfirm}\n\t\t\t\t\tonCancel={() => setModal(null)}\n\t\t\t\t\tcontentTitle={t(`Delete_User_Warning_${erasureType}` as TranslationKey)}\n\t\t\t\t\tconfirmText={t('Delete')}\n\t\t\t\t\tshouldChangeOwner={shouldChangeOwner}\n\t\t\t\t\tshouldBeRemoved={shouldBeRemoved}\n\t\t\t\t/>\n\t\t\t));\n\t\t},\n\t\t[erasureType, setModal, t, deleteOwnAccount, dispatchToastMessage, logout],\n\t);\n\n\tconst handleDeleteOwnAccount = useCallback(async () => {\n\t\tconst handleConfirm = async (passwordOrUsername: string): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait deleteOwnAccount({ password: SHA256(passwordOrUsername) });\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_has_been_deleted') });\n\t\t\t\tlogout();\n\t\t\t} catch (error: any) {\n\t\t\t\tif (error.error === 'user-last-owner') {\n\t\t\t\t\tconst { shouldChangeOwner, shouldBeRemoved } = error.details;\n\t\t\t\t\treturn handleConfirmOwnerChange(passwordOrUsername, shouldChangeOwner, shouldBeRemoved);\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t};\n\n\t\treturn setModal(() => <ActionConfirmModal onConfirm={handleConfirm} onCancel={() => setModal(null)} isPassword={hasLocalPassword} />);\n\t}, [dispatchToastMessage, hasLocalPassword, setModal, handleConfirmOwnerChange, deleteOwnAccount, logout, t]);\n\n\tconst profileFormId = useUniqueId();\n\n\treturn (\n\t\t<Page>\n\t\t\t<Page.Header title={t('Profile')} />\n\t\t\t<Page.ScrollableContentWithShadow>\n\t\t\t\t<Box maxWidth='600px' w='full' alignSelf='center'>\n\t\t\t\t\t<FormProvider {...methods}>\n\t\t\t\t\t\t<AccountProfileForm id={profileFormId} />\n\t\t\t\t\t</FormProvider>\n\t\t\t\t\t<ButtonGroup stretch mb={12}>\n\t\t\t\t\t\t<Button onClick={handleLogoutOtherLocations} flexGrow={0} loading={loggingOut}>\n\t\t\t\t\t\t\t{t('Logout_Others')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{allowDeleteOwnAccount && (\n\t\t\t\t\t\t\t<Button icon='trash' danger onClick={handleDeleteOwnAccount}>\n\t\t\t\t\t\t\t\t{t('Delete_my_account')}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t\t<Page.Footer isDirty={isDirty}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button disabled={!isDirty} onClick={() => reset(getProfileInitialValues(user))}>\n\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tform={profileFormId}\n\t\t\t\t\t\tdata-qa='AccountProfilePageSaveButton'\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\tdisabled={!isDirty || loggingOut}\n\t\t\t\t\t\tloading={isSubmitting}\n\t\t\t\t\t\ttype='submit'\n\t\t\t\t\t>\n\t\t\t\t\t\t{t('Save_changes')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Footer>\n\t\t</Page>\n\t);\n};\n\nexport default AccountProfilePage;\n",null],"names":["_regeneratorRuntime","_slicedToArray","ButtonGroup","Button","Box","useUniqueId","SHA256","useSetModal","useToastMessageDispatch","useUser","useLogout","useEndpoint","useTranslation","useSetting","React","useState","useCallback","FormProvider","useForm","ConfirmOwnerChangeModal","Page","useAllowPasswordChange","AccountProfileForm","ActionConfirmModal","getProfileInitialValues","module","link","default","v","exportDefault","t","user","dispatchToastMessage","setModal","logout","_useState2","loggingOut","setLoggingOut","erasureType","allowDeleteOwnAccount","hasLocalPassword","_useAllowPasswordChan","methods","defaultValues","mode","reset","_methods$formState","formState","isDirty","isSubmitting","logoutOtherClients","deleteOwnAccount","handleLogoutOtherLocations","async","_context","prev","next","awrap","type","message","t0","stop","Promise","handleConfirmOwnerChange","passwordOrUsername","shouldChangeOwner","shouldBeRemoved","handleConfirm","_context2","password","confirmRelinquish","createElement","onConfirm","onCancel","contentTitle","confirmText","handleDeleteOwnAccount","_context4","_callee3","_error$details","_callee3$","_context3","error","details","abrupt","isPassword","profileFormId","Header","title","ScrollableContentWithShadow","maxWidth","w","alignSelf","id","stretch","mb","onClick","flexGrow","loading","icon","danger","Footer","disabled","form","primary"],"mappings":"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"}