)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/hooks/useFilteredApps.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { PaginatedResult } from '@rocket.chat/rest-typings';\nimport type { ContextType } from 'react';\nimport { useMemo } from 'react';\n\nimport type { AppsContext } from '../../../contexts/AppsContext';\nimport type { AsyncState } from '../../../lib/asyncState';\nimport { AsyncStatePhase } from '../../../lib/asyncState';\nimport { filterAppsByCategories } from '../helpers/filterAppsByCategories';\nimport { filterAppsByDisabled } from '../helpers/filterAppsByDisabled';\nimport { filterAppsByEnabled } from '../helpers/filterAppsByEnabled';\nimport { filterAppsByEnterprise } from '../helpers/filterAppsByEnterprise';\nimport { filterAppsByFree } from '../helpers/filterAppsByFree';\nimport { filterAppsByPaid } from '../helpers/filterAppsByPaid';\nimport { filterAppsByText } from '../helpers/filterAppsByText';\nimport { sortAppsByAlphabeticalOrInverseOrder } from '../helpers/sortAppsByAlphabeticalOrInverseOrder';\nimport { sortAppsByClosestOrFarthestModificationDate } from '../helpers/sortAppsByClosestOrFarthestModificationDate';\nimport type { App } from '../types';\n\nexport type appsDataType = ContextType<typeof AppsContext>['installedApps'] | ContextType<typeof AppsContext>['marketplaceApps'];\n\nexport const useFilteredApps = ({\n\tappsData,\n\ttext,\n\tcurrent,\n\titemsPerPage,\n\tcategories = [],\n\tpurchaseType,\n\tsortingMethod,\n\tstatus,\n\tcontext,\n}: {\n\tappsData: appsDataType;\n\ttext: string;\n\tcurrent: number;\n\titemsPerPage: number;\n\tcategories: string[];\n\tpurchaseType: string;\n\tisEnterpriseOnly?: boolean;\n\tsortingMethod: string;\n\tstatus: string;\n\tcontext?: string;\n}): AsyncState<\n\t{ items: App[] } & { shouldShowSearchText: boolean } & PaginatedResult & { allApps: App[] } & { totalAppsLength: number }\n> => {\n\tconst value = useMemo(() => {\n\t\tif (appsData.value === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { apps } = appsData.value;\n\t\tconst fallback = (apps: App[]) => apps;\n\n\t\tconst sortingMethods: Record<string, (apps: App[]) => App[]> = {\n\t\t\turf: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => (secondApp?.appRequestStats?.totalUnseen || 0) - (firstApp?.appRequestStats?.totalUnseen || 0)),\n\t\t\turl: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => (firstApp?.appRequestStats?.totalUnseen || 0) - (secondApp?.appRequestStats?.totalUnseen || 0)),\n\t\t\taz: (apps: App[]) => apps.sort((firstApp, secondApp) => sortAppsByAlphabeticalOrInverseOrder(firstApp.name, secondApp.name)),\n\t\t\tza: (apps: App[]) => apps.sort((firstApp, secondApp) => sortAppsByAlphabeticalOrInverseOrder(secondApp.name, firstApp.name)),\n\t\t\tmru: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => sortAppsByClosestOrFarthestModificationDate(firstApp.modifiedAt, secondApp.modifiedAt)),\n\t\t\tlru: (apps: App[]) =>\n\t\t\t\tapps.sort((firstApp, secondApp) => sortAppsByClosestOrFarthestModificationDate(secondApp.modifiedAt, firstApp.modifiedAt)),\n\t\t};\n\n\t\tconst filterByPurchaseType: Record<string, (apps: App[]) => App[]> = {\n\t\t\tall: fallback,\n\t\t\tpaid: (apps: App[]) => apps.filter(filterAppsByPaid),\n\t\t\tpremium: (apps: App[]) => apps.filter(filterAppsByEnterprise),\n\t\t\tfree: (apps: App[]) => apps.filter(filterAppsByFree),\n\t\t};\n\n\t\tconst filterByStatus: Record<string, (apps: App[]) => App[]> = {\n\t\t\tall: fallback,\n\t\t\tenabled: (apps: App[]) => apps.filter(filterAppsByEnabled),\n\t\t\tdisabled: (apps: App[]) => apps.filter(filterAppsByDisabled),\n\t\t};\n\n\t\tconst filterByContext: Record<string, (apps: App[]) => App[]> = {\n\t\t\texplore: fallback,\n\t\t\tinstalled: fallback,\n\t\t\tprivate: fallback,\n\t\t\tpremium: (apps: App[]) => apps.filter(({ categories }) => categories.includes('Premium')),\n\t\t\trequested: (apps: App[]) => apps.filter(({ appRequestStats, installed }) => Boolean(appRequestStats) && !installed),\n\t\t};\n\n\t\ttype appsFilterFunction = (apps: App[]) => App[];\n\t\tconst pipeAppsFilter =\n\t\t\t(...functions: appsFilterFunction[]) =>\n\t\t\t(initialValue: App[]) =>\n\t\t\t\tfunctions.reduce((currentAppsList, currentFilterFunction) => currentFilterFunction(currentAppsList), initialValue);\n\n\t\tconst filtered = pipeAppsFilter(\n\t\t\tcontext ? filterByContext[context] : fallback,\n\t\t\tfilterByPurchaseType[purchaseType],\n\t\t\tfilterByStatus[status],\n\t\t\tcategories.length ? (apps: App[]) => apps.filter((app) => filterAppsByCategories(app, categories)) : fallback,\n\t\t\ttext ? (apps: App[]) => apps.filter(({ name }) => filterAppsByText(name, text)) : fallback,\n\t\t\tsortingMethods[sortingMethod],\n\t\t)(apps);\n\n\t\tconst shouldShowSearchText = !!text;\n\t\tconst total = filtered.length;\n\t\tconst offset = current > total ? 0 : current;\n\t\tconst end = current + itemsPerPage;\n\t\tconst slice = filtered.slice(offset, end);\n\n\t\treturn {\n\t\t\titems: slice,\n\t\t\toffset,\n\t\t\ttotal: filtered.length,\n\t\t\ttotalAppsLength: apps.length,\n\t\t\tcount: slice.length,\n\t\t\tshouldShowSearchText,\n\t\t\tallApps: filtered,\n\t\t};\n\t}, [appsData.value, sortingMethod, purchaseType, status, categories, text, context, current, itemsPerPage]);\n\n\tif (appsData.phase === AsyncStatePhase.RESOLVED) {\n\t\tif (!value) {\n\t\t\tthrow new Error('useFilteredApps - Unexpected state');\n\t\t}\n\t\treturn {\n\t\t\t...appsData,\n\t\t\tvalue,\n\t\t};\n\t}\n\n\tif (appsData.phase === AsyncStatePhase.UPDATING) {\n\t\tthrow new Error('useFilteredApps - Unexpected state');\n\t}\n\n\treturn {\n\t\t...appsData,\n\t\tvalue: undefined,\n\t};\n};\n",null],"names":["module","link","default","_objectSpread","export","useFilteredApps","useMemo","AsyncStatePhase","filterAppsByCategories","filterAppsByDisabled","filterAppsByEnabled","filterAppsByEnterprise","filterAppsByFree","filterAppsByPaid","filterAppsByText","sortAppsByAlphabeticalOrInverseOrder","sortAppsByClosestOrFarthestModificationDate","_ref","appsData","text","current","itemsPerPage","_ref$categories","categories","purchaseType","sortingMethod","status","context","value","undefined","apps","fallback","filtered","pipeAppsFilter","_len","arguments","length","functions","Array","_key","initialValue","reduce","currentAppsList","currentFilterFunction","filterByContext","explore","installed","premium","filter","_ref2","includes","requested","_ref3","appRequestStats","Boolean","filterByPurchaseType","all","paid","free","filterByStatus","enabled","disabled","app","_ref4","name","sortingMethods","urf","sort","firstApp","secondApp","_secondApp$appRequest","_firstApp$appRequestS","totalUnseen","url","_firstApp$appRequestS2","_secondApp$appRequest2","az","za","mru","modifiedAt","lru","shouldShowSearchText","offset","end","slice","items","total","totalAppsLength","count","allApps","phase","RESOLVED","Error","UPDATING"],"mappings":"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"}