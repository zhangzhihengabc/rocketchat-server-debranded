)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/hooks/useAppInfo.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\nimport { useState, useEffect, useContext } from 'react';\n\nimport type { ISettings } from '../../../../ee/client/apps/@types/IOrchestrator';\nimport { AppClientOrchestratorInstance } from '../../../../ee/client/apps/orchestrator';\nimport { AppsContext } from '../../../contexts/AppsContext';\nimport type { AppInfo } from '../definitions/AppInfo';\n\nconst getBundledInApp = async (app: App): Promise<App['bundledIn']> => {\n\tconst { bundledIn = [] } = app;\n\n\treturn Promise.all(\n\t\tbundledIn.map(async (bundle) => {\n\t\t\tconst apps = await AppClientOrchestratorInstance.getAppsOnBundle(bundle.bundleId);\n\t\t\tbundle.apps = apps.slice(0, 4);\n\t\t\treturn bundle;\n\t\t}),\n\t);\n};\n\nexport const useAppInfo = (appId: string, context: string): AppInfo | undefined => {\n\tconst { installedApps, marketplaceApps, privateApps } = useContext(AppsContext);\n\n\tconst [appData, setAppData] = useState<AppInfo>();\n\n\tconst getSettings = useEndpoint('GET', '/apps/:id/settings', { id: appId });\n\tconst getScreenshots = useEndpoint('GET', '/apps/:id/screenshots', { id: appId });\n\tconst getApis = useEndpoint('GET', '/apps/:id/apis', { id: appId });\n\tconst getBundledIn = useEndpoint('GET', '/apps/:id', { id: appId });\n\n\tuseEffect(() => {\n\t\tconst fetchAppInfo = async (): Promise<void> => {\n\t\t\tif ((!marketplaceApps.value?.apps?.length && !installedApps.value?.apps.length && !privateApps.value?.apps.length) || !appId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet appResult: App | undefined;\n\t\t\tconst marketplaceAppsContexts = ['explore', 'premium', 'requested'];\n\n\t\t\tif (marketplaceAppsContexts.includes(context)) appResult = marketplaceApps.value?.apps.find((app) => app.id === appId);\n\n\t\t\tif (context === 'private') appResult = privateApps.value?.apps.find((app) => app.id === appId);\n\n\t\t\tif (context === 'installed') appResult = installedApps.value?.apps.find((app) => app.id === appId);\n\n\t\t\tif (!appResult) return;\n\n\t\t\tconst [settings, apis, screenshots, bundledIn] = await Promise.all([\n\t\t\t\tgetSettings().catch(() => ({\n\t\t\t\t\tsettings: {},\n\t\t\t\t})),\n\t\t\t\tgetApis().catch(() => ({\n\t\t\t\t\tapis: [],\n\t\t\t\t})),\n\t\t\t\tgetScreenshots().catch(() => ({\n\t\t\t\t\tscreenshots: [],\n\t\t\t\t})),\n\t\t\t\tappResult.marketplace === false\n\t\t\t\t\t? []\n\t\t\t\t\t: getBundledIn({\n\t\t\t\t\t\t\tmarketplace: 'true',\n\t\t\t\t\t\t\tupdate: 'true',\n\t\t\t\t\t\t\tappVersion: appId,\n\t\t\t\t\t  })\n\t\t\t\t\t\t\t.then(({ app }: any) => {\n\t\t\t\t\t\t\t\t(appResult as App).tosLink = app.tosLink;\n\t\t\t\t\t\t\t\t(appResult as App).privacyLink = app.privacyLink;\n\t\t\t\t\t\t\t\treturn getBundledInApp(app);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => ({\n\t\t\t\t\t\t\t\tsettings: {},\n\t\t\t\t\t\t\t})),\n\t\t\t]);\n\n\t\t\tsetAppData({\n\t\t\t\t...appResult,\n\t\t\t\tbundledIn: bundledIn as App['bundledIn'],\n\t\t\t\tsettings: settings.settings as ISettings,\n\t\t\t\tapis: apis ? apis.apis : [],\n\t\t\t\tscreenshots: screenshots ? screenshots.screenshots : [],\n\t\t\t});\n\t\t};\n\n\t\tfetchAppInfo();\n\t}, [appId, context, getApis, getBundledIn, getScreenshots, getSettings, installedApps, marketplaceApps, privateApps.value?.apps]);\n\n\treturn appData;\n};\n",null],"names":["module","link","default","_objectSpread","_slicedToArray","_regeneratorRuntime","export","useAppInfo","useEndpoint","useState","useEffect","useContext","AppClientOrchestratorInstance","AppsContext","getBundledInApp","app","_app$bundledIn","bundledIn","async","_context2","prev","next","abrupt","Promise","all","map","_callee","bundle","apps","_callee$","_context","awrap","getAppsOnBundle","bundleId","sent","slice","stop","appId","context","_privateApps$value3","_useContext","installedApps","marketplaceApps","privateApps","_useState2","appData","setAppData","getSettings","id","getScreenshots","getApis","getBundledIn","_marketplaceApps$valu","_marketplaceApps$valu2","_installedApps$value","_privateApps$value","_marketplaceApps$valu3","_privateApps$value2","_installedApps$value2","appResult","_await$Promise$all2","settings","apis","screenshots","_context3","value","length","marketplaceAppsContexts","includes","find","catch","marketplace","update","appVersion","then","_ref","tosLink","privacyLink"],"mappings":"uBACSA,EAAaC,IAAM,CAAA,uCAA2B,CAAAC,QAAAA,SAAAA,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAAE,EAAAA,CAAA,CAAA,EAAA,GAAAJ,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAAG,EAAAA,CAAA,CAAA,EAAA,GAAvDL,EAAOM,MAAE,CAAA,CAAAC,WAAa,WAAM,OAAAA,CAA0B,CAAC,GAAAP,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAQ,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,QAAAA,CAAAS,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAX,EAAAA,IAAAA,CAAAA,0CAAAA,CAAAY,8BAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAZ,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAa,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQvD,IARAV,EAAuDC,EAAAC,EAAAG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAQjDC,EAAkB,SAAOC,CAAQ,EAAA,IAAAC,EAAAC,EAAA,OAAAZ,EAAAa,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAChB,OAAdJ,EAASD,AAAA,KAAA,IADqBA,CAAAA,EACXD,EAAnBE,SAAS,AAATA,EAAY,EAAE,CAAAD,EAAAG,EAAAG,MAAA,CAAA,SAEfC,QAAQC,GAAG,CACjBP,EAAUQ,GAAG,CAAC,SAAAC,EAAOC,CAAM,EAAA,IAAAC,EAAA,OAAAvB,EAAAa,KAAA,CAAA,SAAAW,EAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAV,IAAA,CAAAU,EAAAT,IAAA,EAAA,KAAA,EAAA,OAAAS,EAAAT,IAAA,CAAA,EAAAhB,EAAA0B,KAAA,CACPnB,EAA8BoB,eAAe,CAACL,EAAOM,QAAQ,EAAC,MAAA,EAClD,OADzBL,EAAIE,EAAAI,IAAA,CACVP,EAAOC,IAAI,CAAGA,EAAKO,KAAK,CAAC,EAAG,GAAGL,EAAAR,MAAA,CAAA,SACxBK,EAAM,MAAA,EAAA,IAAA,MAAA,OAAAG,EAAAM,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAb,QAAA,IAEd,MAAA,EAAA,IAAA,MAAA,OAAAJ,EAAAiB,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAb,QAAA,EAGWhB,EAAa,SAAC8B,CAAa,CAAEC,CAAe,EACxD,IADiFC,EACjFC,EAAwD7B,EAAWE,GAA3D4B,EAAaD,EAAbC,aAAa,CAAEC,EAAeF,EAAfE,eAAe,CAAEC,EAAWH,EAAXG,WAAW,CAEFC,EAAAxC,EAAnBK,IAAmB,GAA1CoC,EAAOD,CAAA,CAAA,EAAA,CAAEE,EAAUF,CAAA,CAAA,EAAA,CAEpBG,EAAcvC,EAAY,MAAO,qBAAsB,CAAEwC,GAAIX,CAAK,GAClEY,EAAiBzC,EAAY,MAAO,wBAAyB,CAAEwC,GAAIX,CAAK,GACxEa,EAAU1C,EAAY,MAAO,iBAAkB,CAAEwC,GAAIX,CAAK,GAC1Dc,EAAe3C,EAAY,MAAO,YAAa,CAAEwC,GAAIX,CAAK,GA0DhE,OAxDA3B,EAAU,eACY0C,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA9C,EAAAZ,EAAAa,KAAA,CAAA,SAAA8C,CAAA,EAAA,OAAA,OAAAA,EAAA5C,IAAA,CAAA4C,EAAA3C,IAAA,EAAA,KAAA,EAAA,GAAA,CACf,CAAA,CAAA,CAAA,AAAsB,OAAtB+B,CAAAA,EAACV,EAAgBuB,KAAK,AAALA,GAAKb,AAAA,KAAA,IAAAA,GAAA,AAAM,OAANC,CAAAA,EAArBD,EAAuBxB,IAAI,AAAJA,GAAIyB,AAAA,KAAA,IAAAA,GAA3BA,EAA6Ba,MAAM,AAANA,GAAU,CAAA,CAAA,AAAoB,OAApBZ,CAAAA,EAACb,EAAcwB,KAAK,AAALA,GAAKX,AAAA,KAAA,IAAAA,GAAnBA,EAAqB1B,IAAI,CAACsC,MAAM,AAANA,GAAU,CAAA,CAAA,AAAkB,OAAlBX,CAAAA,EAACZ,EAAYsB,KAAK,AAALA,GAAKV,AAAA,KAAA,IAAAA,GAAjBA,EAAmB3B,IAAI,CAACsC,MAAM,AAANA,GAAW,CAAC7B,CAAAA,EAAK,CAAA2B,EAAA3C,IAAA,CAAA,EAAA,KAAA,CAAA,OAAA2C,EAAA1C,MAAA,CAAA,SAAA,MAAA,EAWzB,GAJ/F6C,AAF4B,CAAC,UAAW,UAAW,YAAY,CAEvCC,QAAQ,CAAC9B,IAAUqB,CAAAA,EAAS,AAAwB,OAAxBH,CAAAA,EAAGd,EAAgBuB,KAAK,AAALA,GAAKT,AAAA,KAAA,IAAAA,EAAA,KAAA,EAArBA,EAAuB5B,IAAI,CAACyC,IAAI,CAAC,SAACtD,CAAG,EAAA,OAAKA,EAAIiC,EAAE,GAAKX,CAAK,EAAA,EAErG,YAAZC,GAAuBqB,CAAAA,EAAS,AAAoB,OAApBF,CAAAA,EAAGd,EAAYsB,KAAK,AAALA,GAAKR,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAjBA,EAAmB7B,IAAI,CAACyC,IAAI,CAAC,SAACtD,CAAG,EAAA,OAAKA,EAAIiC,EAAE,GAAKX,CAAK,EAAA,EAE7E,cAAZC,GAAyBqB,CAAAA,EAAS,AAAsB,OAAtBD,CAAAA,EAAGjB,EAAcwB,KAAK,AAALA,GAAKP,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAnBA,EAAqB9B,IAAI,CAACyC,IAAI,CAAC,SAACtD,CAAG,EAAA,OAAKA,EAAIiC,EAAE,GAAKX,CAAK,EAAA,EAE5FsB,EAAS,CAAAK,EAAA3C,IAAA,CAAA,EAAA,KAAA,CAAA,OAAA2C,EAAA1C,MAAA,CAAA,SAAA,MAAA,EAAA,OAAA0C,EAAA3C,IAAA,CAAA,GAAAhB,EAAA0B,KAAA,CAEyCR,QAAQC,GAAG,CAAC,CAClEuB,IAAcuB,KAAK,CAAC,WAAA,MAAO,CAC1BT,SAAU,CAAA,EACV,GACDX,IAAUoB,KAAK,CAAC,WAAA,MAAO,CACtBR,KAAM,EAAA,CACN,GACDb,IAAiBqB,KAAK,CAAC,WAAA,MAAO,CAC7BP,YAAa,EAAA,CACb,GACDJ,AAA0B,CAAA,IAA1BA,EAAUY,WAAW,CAClB,EAAE,CACFpB,EAAa,CACboB,YAAa,OACbC,OAAQ,OACRC,WAAYpC,IAEXqC,IAAI,CAAC,SAAAC,CAAA,EAAiB,IAAd5D,EAAG4D,EAAH5D,GAAG,CAGX,OAFC4C,EAAkBiB,OAAO,CAAG7D,EAAI6D,OAAO,CACvCjB,EAAkBkB,WAAW,CAAG9D,EAAI8D,WAAW,CACzC/D,EAAgBC,EACxB,GACCuD,KAAK,CAAC,WAAA,MAAO,CACbT,SAAU,CAAA,EACV,GACJ,EAAC,MAAA,GAzBKA,EAAQD,AAyBbA,CAAAA,EAAAxD,EAAA4D,EAAA9B,IAAA,CAAA,EAAA,CAzBa,CAAA,EAAA,CAAE4B,EAAIF,CAAA,CAAA,EAAA,CAAEG,EAAWH,CAAA,CAAA,EAAA,CAAE3C,EAAS2C,CAAA,CAAA,EAAA,CA2B7Cd,EAAU3C,EAAAA,EAAA,CAAA,EACNwD,GAAS,CAAA,EAAA,CACZ1C,UAAWA,EACX4C,SAAUA,EAASA,QAAqB,CACxCC,KAAMA,EAAOA,EAAKA,IAAI,CAAG,EAAE,CAC3BC,YAAaA,EAAcA,EAAYA,WAAW,CAAG,EAAA,AAAE,GACrD,MAAA,GAAA,IAAA,MAAA,OAAAC,EAAA5B,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAb,QAIL,EAAG,CAACc,EAAOC,EAASY,EAASC,EAAcF,EAAgBF,EAAaN,EAAeC,EAAe,AAAmB,OAAnBH,CAAAA,EAAEI,EAAYsB,KAAK,AAALA,GAAK1B,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAjBA,EAAmBX,IAAI,CAAC,EAEzHiB,CACR"}