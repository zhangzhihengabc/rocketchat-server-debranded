)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/helpers.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport type { App } from '@rocket.chat/core-typings';\nimport semver from 'semver';\n\n// import { t } from '../../../app/utils/client';\nimport { t } from '../../../app/utils/lib/i18n';\nimport { appErroredStatuses } from './helpers/appErroredStatuses';\n\nexport const appEnabledStatuses = [AppStatus.AUTO_ENABLED, AppStatus.MANUALLY_ENABLED];\n\nexport type Actions = 'update' | 'install' | 'purchase' | 'request';\n\ntype appButtonResponseProps = {\n\taction: Actions;\n\ticon?: 'reload' | 'warning';\n\tlabel: 'Update' | 'Install' | 'Subscribe' | 'See Pricing' | 'Try now' | 'Buy' | 'Request' | 'Requested';\n};\n\nexport type appStatusSpanResponseProps = {\n\ttype?: 'failed' | 'warning';\n\ticon?: 'warning' | 'checkmark-circled' | 'check';\n\tlabel:\n\t\t| 'Config Needed'\n\t\t| 'Failed'\n\t\t| 'Disabled'\n\t\t| 'Disabled*'\n\t\t| 'Trial period'\n\t\t| 'Enabled'\n\t\t| 'Enabled*'\n\t\t| 'Incompatible'\n\t\t| 'request'\n\t\t| 'requests'\n\t\t| 'Requested';\n\ttooltipText?: string;\n};\n\ntype appButtonPropsType = App & { isAdminUser: boolean; endUserRequested: boolean };\n\nexport const appButtonProps = ({\n\tinstalled,\n\tversion,\n\tmarketplaceVersion,\n\tisPurchased,\n\tprice,\n\tpurchaseType,\n\tsubscriptionInfo,\n\tpricingPlans,\n\tisEnterpriseOnly,\n\tversionIncompatible,\n\tisAdminUser,\n\t// TODO: Unify this two variables\n\trequestedEndUser,\n\tendUserRequested,\n}: appButtonPropsType): appButtonResponseProps | undefined => {\n\tif (!isAdminUser) {\n\t\tif (requestedEndUser || endUserRequested) {\n\t\t\treturn {\n\t\t\t\taction: 'request',\n\t\t\t\tlabel: 'Requested',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'request',\n\t\t\tlabel: 'Request',\n\t\t};\n\t}\n\n\tconst canUpdate = installed && version && marketplaceVersion && semver.lt(version, marketplaceVersion);\n\tif (canUpdate) {\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'update',\n\t\t\t\ticon: 'warning',\n\t\t\t\tlabel: 'Update',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'update',\n\t\t\ticon: 'reload',\n\t\t\tlabel: 'Update',\n\t\t};\n\t}\n\n\tif (installed) {\n\t\treturn;\n\t}\n\n\tconst canDownload = isPurchased;\n\tif (canDownload) {\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'install',\n\t\t\t\ticon: 'warning',\n\t\t\t\tlabel: 'Install',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'install',\n\t\t\tlabel: 'Install',\n\t\t};\n\t}\n\n\tconst canSubscribe = purchaseType === 'subscription' && !subscriptionInfo.status;\n\tif (canSubscribe) {\n\t\tconst cannotTry = pricingPlans.every((currentPricingPlan) => currentPricingPlan.trialDays === 0);\n\t\tconst isTierBased = pricingPlans.every((currentPricingPlan) => currentPricingPlan.tiers && currentPricingPlan.tiers.length > 0);\n\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t\ticon: 'warning',\n\t\t\t};\n\t\t}\n\n\t\tif (cannotTry || isEnterpriseOnly) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Subscribe',\n\t\t\t};\n\t\t}\n\n\t\tif (isTierBased) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'See Pricing',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Try now',\n\t\t};\n\t}\n\n\tconst canBuy = price > 0;\n\tif (canBuy) {\n\t\tif (versionIncompatible) {\n\t\t\treturn {\n\t\t\t\taction: 'purchase',\n\t\t\t\tlabel: 'Buy',\n\t\t\t\ticon: 'warning',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Buy',\n\t\t};\n\t}\n\n\tif (versionIncompatible) {\n\t\treturn {\n\t\t\taction: 'purchase',\n\t\t\tlabel: 'Install',\n\t\t\ticon: 'warning',\n\t\t};\n\t}\n\n\treturn {\n\t\taction: 'purchase',\n\t\tlabel: 'Install',\n\t};\n};\n\nexport const appIncompatibleStatusProps = (): appStatusSpanResponseProps => ({\n\ticon: 'check',\n\tlabel: 'Incompatible',\n\ttooltipText: t('App_version_incompatible_tooltip'),\n});\n\nexport const appStatusSpanProps = (\n\t{ installed, status, subscriptionInfo, appRequestStats, migrated }: App,\n\tisEnterprise?: boolean,\n\tcontext?: string,\n\tisAppDetailsPage?: boolean,\n): appStatusSpanResponseProps | undefined => {\n\tconst isEnabled = status && appEnabledStatuses.includes(status);\n\n\tif (installed) {\n\t\tif (isEnabled) {\n\t\t\treturn migrated && !isEnterprise\n\t\t\t\t? {\n\t\t\t\t\t\tlabel: 'Enabled*',\n\t\t\t\t\t\ttooltipText: t('Grandfathered_app'),\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\tlabel: 'Enabled',\n\t\t\t\t  };\n\t\t}\n\n\t\treturn migrated && !isEnterprise\n\t\t\t? {\n\t\t\t\t\tlabel: 'Disabled*',\n\t\t\t\t\ttooltipText: t('Grandfathered_app'),\n\t\t\t  }\n\t\t\t: {\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\tlabel: 'Disabled',\n\t\t\t  };\n\t}\n\n\tconst isFailed = status && appErroredStatuses.includes(status);\n\tif (isFailed) {\n\t\treturn {\n\t\t\ttype: 'failed',\n\t\t\ticon: 'warning',\n\t\t\tlabel: status === AppStatus.INVALID_SETTINGS_DISABLED ? 'Config Needed' : 'Failed',\n\t\t};\n\t}\n\n\tconst isOnTrialPeriod = subscriptionInfo && subscriptionInfo.status === 'trialing';\n\tif (isOnTrialPeriod) {\n\t\treturn {\n\t\t\ticon: 'checkmark-circled',\n\t\t\tlabel: 'Trial period',\n\t\t};\n\t}\n\n\tif (context === 'requested' && appRequestStats) {\n\t\tif (isAppDetailsPage) {\n\t\t\treturn {\n\t\t\t\tlabel: 'Requested',\n\t\t\t};\n\t\t}\n\n\t\tif (appRequestStats.totalUnseen) {\n\t\t\treturn {\n\t\t\t\tlabel: appRequestStats.totalUnseen > 1 ? 'requests' : 'request',\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tlabel: appRequestStats.totalSeen > 1 ? 'requests' : 'request',\n\t\t};\n\t}\n};\n\nexport const appMultiStatusProps = (\n\tapp: App,\n\tisAppDetailsPage: boolean,\n\tcontext: string,\n\tisEnterprise: boolean,\n): appStatusSpanResponseProps[] => {\n\tconst status = appStatusSpanProps(app, isEnterprise, context, isAppDetailsPage);\n\tconst statuses = [];\n\n\tif (app?.versionIncompatible !== undefined && !isAppDetailsPage) {\n\t\tstatuses.push(appIncompatibleStatusProps());\n\t}\n\n\tif (status) {\n\t\tstatuses.push(status);\n\t}\n\n\treturn statuses;\n};\n",null],"names":["module","export","appEnabledStatuses","appButtonProps","appIncompatibleStatusProps","appStatusSpanProps","appMultiStatusProps","AppStatus","v","semver","t","appErroredStatuses","AUTO_ENABLED","MANUALLY_ENABLED","_ref","installed","version","marketplaceVersion","isPurchased","price","purchaseType","subscriptionInfo","pricingPlans","isEnterpriseOnly","versionIncompatible","isAdminUser","requestedEndUser","endUserRequested","action","label","lt","icon","status","cannotTry","every","currentPricingPlan","trialDays","isTierBased","tiers","length","tooltipText","_ref2","isEnterprise","context","isAppDetailsPage","appRequestStats","migrated","isEnabled","includes","type","INVALID_SETTINGS_DISABLED","totalUnseen","totalSeen","app","statuses","undefined","push"],"mappings":"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"}