)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/AppDetailsPage/AppDetailsPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ISetting } from '@rocket.chat/apps-engine/definition/settings';\nimport type { App } from '@rocket.chat/core-typings';\nimport { Button, ButtonGroup, Box } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useRouteParameter, useToastMessageDispatch, usePermission, useRouter } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useCallback, useRef } from 'react';\n\nimport type { ISettings } from '../../../../ee/client/apps/@types/IOrchestrator';\nimport { AppClientOrchestratorInstance } from '../../../../ee/client/apps/orchestrator';\nimport Page from '../../../components/Page';\nimport { handleAPIError } from '../helpers/handleAPIError';\nimport { useAppInfo } from '../hooks/useAppInfo';\nimport AppDetailsPageHeader from './AppDetailsPageHeader';\nimport AppDetailsPageLoading from './AppDetailsPageLoading';\nimport AppDetailsPageTabs from './AppDetailsPageTabs';\nimport AppDetails from './tabs/AppDetails';\nimport AppLogs from './tabs/AppLogs';\nimport AppReleases from './tabs/AppReleases';\nimport AppRequests from './tabs/AppRequests/AppRequests';\nimport AppSecurity from './tabs/AppSecurity/AppSecurity';\nimport AppSettings from './tabs/AppSettings';\n\nconst AppDetailsPage = ({ id }: { id: App['id'] }): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst router = useRouter();\n\n\tconst [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n\tconst [isSaving, setIsSaving] = useState(false);\n\n\tconst settingsRef = useRef<Record<string, ISetting['value']>>({});\n\tconst isAdminUser = usePermission('manage-apps');\n\n\tconst tab = useRouteParameter('tab');\n\tconst context = useRouteParameter('context');\n\n\tconst appData = useAppInfo(id, context || '');\n\n\tconst handleReturn = useMutableCallback((): void => {\n\t\tif (!context) {\n\t\t\treturn;\n\t\t}\n\n\t\trouter.navigate({\n\t\t\tname: 'marketplace',\n\t\t\tparams: { context, page: 'list' },\n\t\t});\n\t});\n\n\tconst { installed, settings, privacyPolicySummary, permissions, tosLink, privacyLink, name } = appData || {};\n\n\tconst isSecurityVisible = Boolean(privacyPolicySummary || permissions || tosLink || privacyLink);\n\n\tconst saveAppSettings = useCallback(async () => {\n\t\tconst { current } = settingsRef;\n\t\tsetIsSaving(true);\n\t\ttry {\n\t\t\tawait AppClientOrchestratorInstance.setAppSettings(\n\t\t\t\tid,\n\t\t\t\t(Object.values(settings || {}) as ISetting[]).map((value) => ({\n\t\t\t\t\t...value,\n\t\t\t\t\tvalue: current?.[value.id],\n\t\t\t\t})),\n\t\t\t);\n\n\t\t\tdispatchToastMessage({ type: 'success', message: `${name} settings saved succesfully` });\n\t\t} catch (e: any) {\n\t\t\thandleAPIError(e);\n\t\t}\n\t\tsetIsSaving(false);\n\t}, [dispatchToastMessage, id, name, settings]);\n\n\treturn (\n\t\t<Page flexDirection='column' h='full'>\n\t\t\t<Page.Header title={t('App_Info')} onClickBack={handleReturn}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t{installed && isAdminUser && (\n\t\t\t\t\t\t<Button primary disabled={!hasUnsavedChanges} loading={isSaving} onClick={saveAppSettings}>\n\t\t\t\t\t\t\t{t('Save_changes')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.ScrollableContentWithShadow pi={24} pbs={24} pbe={0} h='full'>\n\t\t\t\t<Box w='full' alignSelf='center' h='full' display='flex' flexDirection='column'>\n\t\t\t\t\t{!appData && <AppDetailsPageLoading />}\n\t\t\t\t\t{appData && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<AppDetailsPageHeader app={appData} />\n\t\t\t\t\t\t\t<AppDetailsPageTabs\n\t\t\t\t\t\t\t\tcontext={context || ''}\n\t\t\t\t\t\t\t\tinstalled={installed}\n\t\t\t\t\t\t\t\tisSecurityVisible={isSecurityVisible}\n\t\t\t\t\t\t\t\tsettings={settings}\n\t\t\t\t\t\t\t\ttab={tab}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{Boolean(!tab || tab === 'details') && <AppDetails app={appData} />}\n\t\t\t\t\t\t\t{tab === 'requests' && <AppRequests id={id} isAdminUser={isAdminUser} />}\n\t\t\t\t\t\t\t{tab === 'security' && isSecurityVisible && (\n\t\t\t\t\t\t\t\t<AppSecurity\n\t\t\t\t\t\t\t\t\tprivacyPolicySummary={privacyPolicySummary}\n\t\t\t\t\t\t\t\t\tappPermissions={permissions}\n\t\t\t\t\t\t\t\t\ttosLink={tosLink}\n\t\t\t\t\t\t\t\t\tprivacyLink={privacyLink}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{tab === 'releases' && <AppReleases id={id} />}\n\t\t\t\t\t\t\t{Boolean(tab === 'settings' && settings && Object.values(settings).length) && (\n\t\t\t\t\t\t\t\t<AppSettings\n\t\t\t\t\t\t\t\t\tsettings={settings || ({} as ISettings)}\n\t\t\t\t\t\t\t\t\tsetHasUnsavedChanges={setHasUnsavedChanges}\n\t\t\t\t\t\t\t\t\tsettingsRef={settingsRef}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{tab === 'logs' && <AppLogs id={id} />}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</Box>\n\t\t\t</Page.ScrollableContentWithShadow>\n\t\t</Page>\n\t);\n};\n\nexport default AppDetailsPage;\n",null],"names":["_regeneratorRuntime","_objectSpread","_slicedToArray","Button","ButtonGroup","Box","useMutableCallback","useTranslation","useRouteParameter","useToastMessageDispatch","usePermission","useRouter","React","useState","useCallback","useRef","AppClientOrchestratorInstance","Page","handleAPIError","useAppInfo","AppDetailsPageHeader","AppDetailsPageLoading","AppDetailsPageTabs","AppDetails","AppLogs","AppReleases","AppRequests","AppSecurity","AppSettings","module","link","default","v","exportDefault","_ref","id","t","dispatchToastMessage","router","_useState2","hasUnsavedChanges","setHasUnsavedChanges","_useState4","isSaving","setIsSaving","settingsRef","isAdminUser","tab","context","appData","handleReturn","navigate","name","params","page","_ref2","installed","settings","privacyPolicySummary","permissions","tosLink","privacyLink","isSecurityVisible","Boolean","saveAppSettings","current","async","_context","prev","next","awrap","setAppSettings","Object","values","map","value","type","message","t0","stop","Promise","createElement","flexDirection","h","Header","title","onClickBack","primary","disabled","loading","onClick","ScrollableContentWithShadow","pi","pbs","pbe","w","alignSelf","display","Fragment","app","appPermissions","length"],"mappings":"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"}