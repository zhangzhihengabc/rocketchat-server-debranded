)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/AppDetailsPage/tabs/AppRequests/AppRequests.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { Box, Pagination, States, StatesSubtitle, StatesTitle } from '@rocket.chat/fuselage';\nimport { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation } from '@tanstack/react-query';\nimport type { ReactElement, SetStateAction } from 'react';\nimport React, { useState, useEffect } from 'react';\n\nimport { useAppsReload } from '../../../../../contexts/hooks/useAppsReload';\nimport { queryClient } from '../../../../../lib/queryClient';\nimport { useAppRequests } from '../../../hooks/useAppRequests';\nimport AppRequestItem from './AppRequestItem';\nimport AppRequestsLoading from './AppRequestsLoading';\n\ntype itemsPerPage = 25 | 50 | 100;\n\nconst AppRequests = ({ id, isAdminUser }: { id: App['id']; isAdminUser: boolean }): ReactElement => {\n\tconst [limit, setLimit] = useState<itemsPerPage>(25);\n\tconst [offset, setOffset] = useState<number>(0);\n\n\tconst paginatedAppRequests = useAppRequests(id, limit, offset);\n\tconst t = useTranslation();\n\n\tconst onSetItemsPerPage = (itemsPerPageOption: SetStateAction<itemsPerPage>) => setLimit(itemsPerPageOption);\n\tconst onSetCurrent = (currentItemsOption: SetStateAction<number>) => setOffset(currentItemsOption);\n\n\tconst reloadApps = useAppsReload();\n\tconst markSeen = useEndpoint('POST', '/apps/app-request/markAsSeen');\n\tconst markAppRequestsAsSeen = useMutation({\n\t\tmutationKey: ['mark-app-requests-as-seen'],\n\t\tmutationFn: (unseenRequests: Array<string>) => markSeen({ unseenRequests }),\n\t\tretry: false,\n\t});\n\tuseEffect(() => {\n\t\treturn () => {\n\t\t\tif (isAdminUser && paginatedAppRequests.isSuccess) {\n\t\t\t\tconst unseenRequests = paginatedAppRequests.data.data.filter(({ seen }) => !seen).map(({ id }) => id);\n\n\t\t\t\tif (unseenRequests.length) {\n\t\t\t\t\tmarkAppRequestsAsSeen.mutate(unseenRequests, {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tqueryClient.refetchQueries({ queryKey: ['app-requests-stats'] });\n\t\t\t\t\t\t\treloadApps();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [isAdminUser, paginatedAppRequests.isSuccess, paginatedAppRequests?.data, reloadApps]);\n\n\tif (paginatedAppRequests.isLoading) {\n\t\treturn (\n\t\t\t<Box w='full' maxWidth='x608' marginInline='auto' pbs={36}>\n\t\t\t\t<AppRequestsLoading />\n\t\t\t</Box>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Box h='full' display='flex' flexDirection='column'>\n\t\t\t<Box w='full' maxWidth='x608' marginInline='auto' pbs={36} flexGrow='1'>\n\t\t\t\t{paginatedAppRequests.isSuccess && paginatedAppRequests.data.data?.length ? (\n\t\t\t\t\tpaginatedAppRequests.data.data.map((request) => (\n\t\t\t\t\t\t<AppRequestItem\n\t\t\t\t\t\t\tkey={request.id}\n\t\t\t\t\t\t\tseen={request.seen}\n\t\t\t\t\t\t\tname={request.requester.name}\n\t\t\t\t\t\t\tcreatedDate={request.createdDate}\n\t\t\t\t\t\t\tmessage={request.message}\n\t\t\t\t\t\t\tusername={request.requester.username}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))\n\t\t\t\t) : (\n\t\t\t\t\t<States>\n\t\t\t\t\t\t<StatesTitle>{t('No_requests')}</StatesTitle>\n\t\t\t\t\t\t<StatesSubtitle>{t('App_requests_by_workspace')}</StatesSubtitle>\n\t\t\t\t\t</States>\n\t\t\t\t)}\n\t\t\t</Box>\n\t\t\t{paginatedAppRequests.isSuccess && paginatedAppRequests.data.data?.length && (\n\t\t\t\t<Pagination\n\t\t\t\t\tdivider\n\t\t\t\t\tcount={paginatedAppRequests.data.meta.total}\n\t\t\t\t\titemsPerPage={paginatedAppRequests.data.meta.limit}\n\t\t\t\t\tcurrent={paginatedAppRequests.data.meta.offset}\n\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AppRequests;\n",null],"names":["_slicedToArray","Box","Pagination","States","StatesSubtitle","StatesTitle","useEndpoint","useTranslation","useMutation","React","useState","useEffect","useAppsReload","queryClient","useAppRequests","AppRequestItem","AppRequestsLoading","module","link","default","v","exportDefault","_ref","_paginatedAppRequests","_paginatedAppRequests2","id","isAdminUser","_useState2","limit","setLimit","_useState4","offset","setOffset","paginatedAppRequests","t","reloadApps","markSeen","markAppRequestsAsSeen","mutationKey","mutationFn","unseenRequests","retry","isSuccess","data","filter","_ref2","seen","map","_ref3","length","mutate","onSuccess","refetchQueries","queryKey","isLoading","createElement","w","maxWidth","marginInline","pbs","h","display","flexDirection","flexGrow","request","key","name","requester","createdDate","message","username","divider","count","meta","total","itemsPerPage","current","onSetItemsPerPage","itemsPerPageOption","onSetCurrent","currentItemsOption"],"mappings":"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"}