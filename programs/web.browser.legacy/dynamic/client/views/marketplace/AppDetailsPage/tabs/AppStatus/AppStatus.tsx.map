)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/marketplace/AppDetailsPage/tabs/AppStatus/AppStatus.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { Box, Button, Throbber, Tag, Margins } from '@rocket.chat/fuselage';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport { useRouteParameter, usePermission, useSetModal, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useState, memo } from 'react';\nimport semver from 'semver';\n\nimport { useIsEnterprise } from '../../../../../hooks/useIsEnterprise';\nimport type { appStatusSpanResponseProps } from '../../../helpers';\nimport { appButtonProps, appMultiStatusProps } from '../../../helpers';\nimport { marketplaceActions } from '../../../helpers/marketplaceActions';\nimport type { AppInstallationHandlerParams } from '../../../hooks/useAppInstallationHandler';\nimport { useAppInstallationHandler } from '../../../hooks/useAppInstallationHandler';\nimport AppStatusPriceDisplay from './AppStatusPriceDisplay';\n\ntype AppStatusProps = {\n\tapp: App;\n\tshowStatus?: boolean;\n\tisAppDetailsPage: boolean;\n\tinstalled?: boolean;\n};\n\nconst AppStatus = ({ app, showStatus = true, isAppDetailsPage, installed, ...props }: AppStatusProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst [endUserRequested, setEndUserRequested] = useState(false);\n\tconst [loading, setLoading] = useSafely(useState(false));\n\tconst [isAppPurchased, setPurchased] = useSafely(useState(!!app?.isPurchased));\n\tconst setModal = useSetModal();\n\tconst isAdminUser = usePermission('manage-apps');\n\tconst context = useRouteParameter('context');\n\n\tconst { price, purchaseType, pricingPlans } = app;\n\n\tconst button = appButtonProps({ ...app, isAdminUser, endUserRequested });\n\tconst isAppRequestsPage = context === 'requested';\n\tconst shouldShowPriceDisplay = isAppDetailsPage && button && !app.isEnterpriseOnly;\n\tconst canUpdate = installed && app?.version && app?.marketplaceVersion && semver.lt(app?.version, app?.marketplaceVersion);\n\n\tconst { data } = useIsEnterprise();\n\tconst isEnterprise = data?.isEnterprise ?? false;\n\n\tconst statuses = appMultiStatusProps(app, isAppDetailsPage, context || '', isEnterprise);\n\n\tconst totalSeenRequests = app?.appRequestStats?.totalSeen;\n\tconst totalUnseenRequests = app?.appRequestStats?.totalUnseen;\n\n\tconst action = button?.action;\n\n\tconst confirmAction = useCallback<AppInstallationHandlerParams['onSuccess']>(\n\t\tasync (action, permissionsGranted) => {\n\t\t\tif (action !== 'request') {\n\t\t\t\tsetPurchased(true);\n\t\t\t\tawait marketplaceActions[action]({ ...app, permissionsGranted });\n\t\t\t} else {\n\t\t\t\tsetEndUserRequested(true);\n\t\t\t}\n\n\t\t\tsetLoading(false);\n\t\t},\n\t\t[app, setLoading, setPurchased],\n\t);\n\n\tconst cancelAction = useCallback(() => {\n\t\tsetLoading(false);\n\t\tsetModal(null);\n\t}, [setLoading, setModal]);\n\n\tconst appInstallationHandler = useAppInstallationHandler({\n\t\tapp,\n\t\taction: action || 'purchase',\n\t\tisAppPurchased,\n\t\tonDismiss: cancelAction,\n\t\tonSuccess: confirmAction,\n\t});\n\n\tconst handleAcquireApp = useCallback(() => {\n\t\tsetLoading(true);\n\t\tappInstallationHandler();\n\t}, [appInstallationHandler, setLoading]);\n\n\t// @TODO we should refactor this to not use the label to determine the variant\n\tconst getStatusVariant = (status: appStatusSpanResponseProps) => {\n\t\tif (isAppRequestsPage && totalUnseenRequests && (status.label === 'request' || status.label === 'requests')) {\n\t\t\treturn 'primary';\n\t\t}\n\n\t\tif (isAppRequestsPage && status.label === 'Requested') {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// includes() here because the label can be 'Disabled' or 'Disabled*'\n\t\tif (status.label.includes('Disabled')) {\n\t\t\treturn 'secondary-danger';\n\t\t}\n\n\t\treturn undefined;\n\t};\n\n\tconst handleAppRequestsNumber = (status: appStatusSpanResponseProps) => {\n\t\tif ((status.label === 'request' || status.label === 'requests') && !installed && isAppRequestsPage) {\n\t\t\tlet numberOfRequests = 0;\n\n\t\t\tif (totalUnseenRequests >= 0) {\n\t\t\t\tnumberOfRequests += totalUnseenRequests;\n\t\t\t}\n\n\t\t\tif (totalSeenRequests >= 0) {\n\t\t\t\tnumberOfRequests += totalSeenRequests;\n\t\t\t}\n\n\t\t\treturn numberOfRequests;\n\t\t}\n\n\t\treturn null;\n\t};\n\n\treturn (\n\t\t<Box {...props} display='flex' alignItems='center' mie={8}>\n\t\t\t{button && isAppDetailsPage && (!installed || canUpdate) && (\n\t\t\t\t<Box\n\t\t\t\t\tdisplay='flex'\n\t\t\t\t\tflexDirection='row'\n\t\t\t\t\talignItems='center'\n\t\t\t\t\tjustifyContent='center'\n\t\t\t\t\tborderRadius='x4'\n\t\t\t\t\tinvisible={!showStatus && !loading}\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={!loading && button.icon ? button.icon : undefined}\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\tsmall\n\t\t\t\t\t\tdisabled={loading || (action === 'request' && (app?.requestedEndUser || endUserRequested))}\n\t\t\t\t\t\tonClick={handleAcquireApp}\n\t\t\t\t\t\tmie={8}\n\t\t\t\t\t>\n\t\t\t\t\t\t{loading && <Throbber inheritColor />}\n\t\t\t\t\t\t{!loading && t(button.label.replace(' ', '_') as TranslationKey)}\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t{shouldShowPriceDisplay && !installed && (\n\t\t\t\t\t\t<AppStatusPriceDisplay purchaseType={purchaseType} pricingPlans={pricingPlans} price={price} showType={false} />\n\t\t\t\t\t)}\n\t\t\t\t</Box>\n\t\t\t)}\n\n\t\t\t{statuses?.map((status, index) => (\n\t\t\t\t<Margins inlineEnd={8} key={index}>\n\t\t\t\t\t<Tag variant={getStatusVariant(status)} title={status.tooltipText ? status.tooltipText : ''}>\n\t\t\t\t\t\t{handleAppRequestsNumber(status)} {t(`${status.label}` as TranslationKey)}\n\t\t\t\t\t</Tag>\n\t\t\t\t</Margins>\n\t\t\t))}\n\t\t</Box>\n\t);\n};\n\nexport default memo(AppStatus);\n",null],"names":["_regeneratorRuntime","_extends","_objectSpread","_slicedToArray","_objectWithoutProperties","Box","Button","Throbber","Tag","Margins","useSafely","useRouteParameter","usePermission","useSetModal","useTranslation","React","useCallback","useState","memo","semver","useIsEnterprise","appButtonProps","appMultiStatusProps","marketplaceActions","useAppInstallationHandler","AppStatusPriceDisplay","module","link","default","v","exportDefault","_ref","_data$isEnterprise","_app$appRequestStats","_app$appRequestStats2","app","_ref$showStatus","showStatus","isAppDetailsPage","installed","props","_excluded","t","_useState2","endUserRequested","setEndUserRequested","_useSafely2","loading","setLoading","_useSafely4","isPurchased","isAppPurchased","setPurchased","setModal","isAdminUser","context","price","purchaseType","pricingPlans","button","isAppRequestsPage","shouldShowPriceDisplay","isEnterpriseOnly","canUpdate","version","marketplaceVersion","lt","data","_useIsEnterprise","statuses","isEnterprise","totalSeenRequests","appRequestStats","totalSeen","totalUnseenRequests","totalUnseen","action","confirmAction","permissionsGranted","async","_context","prev","next","awrap","stop","Promise","appInstallationHandler","onDismiss","onSuccess","handleAcquireApp","handleAppRequestsNumber","status","label","numberOfRequests","createElement","display","alignItems","mie","flexDirection","justifyContent","borderRadius","invisible","icon","undefined","primary","small","disabled","requestedEndUser","onClick","inheritColor","replace","showType","map","index","inlineEnd","key","variant","includes","title","tooltipText"],"mappings":"2BACAA,EAA4EC,EAAAC,EAAAC,EAAAC,EAA5EC,EAAOC,EAAOC,EAAQC,EAAAC,EAAsDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,wDAAtDC,EAAQC,IAAK,CAAA,6BAAiB,CAAAC,QAAAA,SAAwBC,CAAAA,EAAA7B,EAAAA,CAAA,CAAA,EAAA,GAAA0B,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAA3B,EAAAA,CAAA,CAAA,EAAA,GAAAyB,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAA1B,EAAAA,CAAA,CAAA,EAAA,GAAAwB,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAAzB,EAAAA,CAAA,CAAA,EAAA,GAAAuB,EAAAA,IAAAA,CAAAA,iDAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAAxB,EAAAA,CAAA,CAAA,EAAA,GAAzCsB,EAAEC,IAAS,CAAA,wBAAM,CAAAtB,IAAwB,SAAAwB,CAAA,EAAAxB,EAAAA,CAAA,EAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,IAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAiB,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAhB,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAgB,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAf,kBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,cAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAd,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,KAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,SAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAV,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAN,gBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,mBAAAA,CAAAL,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,oBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAH,mBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,2CAAAA,CAAAF,0BAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,0BAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAJ,EAAAA,CAAA,CAAA,EAAA,GAA5EC,EAAOI,aAAa,CA6JLZ,EAtIG,SAAAa,CAAA,EAAoG,IAAAC,EAAAC,EAAAC,EAAjGC,EAAGJ,EAAHI,GAAG,CAAAC,EAAAL,EAAEM,UAAU,CAASC,EAAgBP,EAAhBO,gBAAgB,CAAEC,EAASR,EAATQ,SAAS,CAAKC,EAAKpC,EAAA2B,EAAAU,GAC3EC,EAAI5B,IACqD6B,EAAAxC,EAAfc,EAAS,CAAA,GAAM,GAAxD2B,EAAgBD,CAAA,CAAA,EAAA,CAAEE,EAAmBF,CAAA,CAAA,EAAA,CACYG,EAAA3C,EAA1BO,EAAUO,EAAS,CAAA,IAAO,GAAjD8B,EAAOD,CAAA,CAAA,EAAA,CAAEE,EAAUF,CAAA,CAAA,EAAA,CACoDG,EAAA9C,EAAvCO,EAAUO,EAAS,CAAC,CAACkB,CAAAA,MAAAA,GAAAA,EAAKe,WAAW,AAAXA,IAAa,GAAvEC,EAAcF,CAAA,CAAA,EAAA,CAAEG,EAAYH,CAAA,CAAA,EAAA,CAC7BI,EAAWxC,IACXyC,EAAc1C,EAAc,eAC5B2C,EAAU5C,EAAkB,WAE1B6C,EAAsCrB,EAAtCqB,KAAK,CAAEC,EAA+BtB,EAA/BsB,YAAY,CAAEC,EAAiBvB,EAAjBuB,YAAY,CAEnCC,EAAStC,EAAcnB,EAAAA,EAAA,CAAA,EAAMiC,GAAG,CAAA,EAAA,CAAEmB,YAAAA,EAAaV,iBAAAA,CAAgB,IAC/DgB,EAAoBL,AAAY,cAAZA,EACpBM,EAAyBvB,GAAoBqB,GAAU,CAACxB,EAAI2B,gBAAgB,CAC5EC,GAAYxB,GAAaJ,CAAAA,MAAAA,EAAG,KAAA,EAAHA,EAAK6B,OAAO,AAAPA,GAAW7B,CAAAA,MAAAA,EAAG,KAAA,EAAHA,EAAK8B,kBAAkB,AAAlBA,GAAsB9C,EAAO+C,EAAE,CAAC/B,MAAAA,EAAG,KAAA,EAAHA,EAAK6B,OAAO,CAAE7B,MAAAA,EAAG,KAAA,EAAHA,EAAK8B,kBAAkB,EAEjHE,GAAIC,AAAKhD,IAAT+C,IAAI,CAGNE,GAAW/C,EAAoBa,EAAKG,EAAkBiB,GAAW,GAFrD,AAAqB,OAArBvB,CAAAA,EAAGmC,MAAAA,GAAI,KAAA,EAAJA,GAAMG,YAAY,AAAZA,GAAYtC,AAAA,KAAA,IAAAA,GAAAA,GAIjCuC,GAAoBpC,MAAAA,EAAG,KAAA,EAAA,AAAiB,OAAjBF,CAAAA,EAAHE,EAAKqC,eAAe,AAAfA,GAAevC,AAAA,KAAA,IAAAA,EAAA,KAAA,EAApBA,EAAsBwC,SAAS,CACnDC,GAAsBvC,MAAAA,EAAG,KAAA,EAAA,AAAiB,OAAjBD,CAAAA,EAAHC,EAAKqC,eAAe,AAAfA,GAAetC,AAAA,KAAA,IAAAA,EAAA,KAAA,EAApBA,EAAsByC,WAAW,CAEvDC,GAASjB,MAAAA,EAAM,KAAA,EAANA,EAAQiB,MAAM,CAEvBC,GAAgB7D,EACrB,SAAO4D,CAAM,CAAEE,CAAkB,EAAA,OAAA9E,EAAA+E,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,GAAA,CAC5BN,CAAAA,AAAW,YAAXA,CAAW,EAAS,CAAAI,EAAAE,IAAA,CAAA,EAAA,KAAA,CACJ,OAAnB9B,EAAa,CAAA,GAAM4B,EAAAE,IAAA,CAAA,EAAAlF,EAAAmF,KAAA,CACb5D,CAAkB,CAACqD,EAAO,CAAA1E,EAAAA,EAAA,CAAA,EAAMiC,GAAG,CAAA,EAAA,CAAE2C,mBAAAA,CAAkB,IAAG,MAAA,EAAAE,EAAAE,IAAA,CAAA,EAAA,KAAA,MAAA,EAEhErC,EAAoB,CAAA,EAAM,MAAA,EAG3BG,EAAW,CAAA,EAAO,MAAA,EAAA,IAAA,MAAA,OAAAgC,EAAAI,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAEnB,CAAClD,EAAKa,EAAYI,EAAa,EAQ1BkC,GAAyB9D,EAA0B,CACxDW,IAAAA,EACAyC,OAAQA,IAAU,WAClBzB,eAAAA,EACAoC,UAToBvE,EAAY,WAChCgC,EAAW,CAAA,GACXK,EAAS,KACV,EAAG,CAACL,EAAYK,EAAS,EAOxBmC,UAAWX,KAGNY,GAAmBzE,EAAY,WACpCgC,EAAW,CAAA,GACXsC,IACD,EAAG,CAACA,GAAwBtC,EAAW,EAoBjC0C,GAA0B,SAACC,CAAkC,EAClE,GAAI,AAACA,CAAAA,AAAiB,YAAjBA,EAAOC,KAAK,EAAkBD,AAAiB,aAAjBA,EAAOC,KAAK,AAAK,GAAe,CAACrD,GAAaqB,EAAmB,CACnG,IAAIiC,EAAmB,EAUvB,OARInB,IAAuB,GAC1BmB,CAAAA,GAAoBnB,EAAAA,EAGjBH,IAAqB,GACxBsB,CAAAA,GAAoBtB,EAAAA,EAGdsB,EAGR,OAAO,IACR,EAEA,OACC9E,EAAA+E,aAAA,CAACzF,EAAGJ,EAAA,CAAA,EAAKuC,EAAK,CAAEuD,QAAQ,OAAOC,WAAW,SAASC,IAAK,CAAE,GACxDtC,GAAUrB,GAAqB,CAAA,CAACC,GAAawB,EAAAA,GAC7ChD,EAAA+E,aAAA,CAACzF,EAAG,CACH0F,QAAQ,OACRG,cAAc,MACdF,WAAW,SACXG,eAAe,SACfC,aAAa,KACbC,UAAW,CAvGoBjE,CAAAA,AAAA,KAAA,IAAAA,GAAOA,CAAA,GAuGZ,CAACW,CAAQ,EAEnChC,EAAA+E,aAAA,CAACxF,EAAM,CACNgG,KAAM,CAACvD,GAAWY,EAAO2C,IAAI,CAAG3C,EAAO2C,IAAI,CAAGC,KAAAA,EAC9CC,QAAO,CAAA,EACPC,MAAK,CAAA,EACLC,SAAU3D,GAAY6B,AAAW,YAAXA,IAAyB,CAAA,AAAAzC,CAAAA,MAAAA,EAAG,KAAA,EAAHA,EAAKwE,gBAAgB,AAAhBA,GAAoB/D,CAAAA,EACxEgE,QAASnB,GACTQ,IAAK,CAAE,EAENlD,GAAWhC,EAAA+E,aAAA,CAACvF,EAAQ,CAACsG,aAAY,CAAA,CAAA,GACjC,CAAC9D,GAAWL,EAAEiB,EAAOiC,KAAK,CAACkB,OAAO,CAAC,IAAK,OAGzCjD,GAA0B,CAACtB,GAC3BxB,EAAA+E,aAAA,CAACrE,EAAqB,CAACgC,aAAcA,EAAcC,aAAcA,EAAcF,MAAOA,EAAOuD,SAAU,CAAA,CAAM,IAK/G1C,MAAAA,GAAQ,KAAA,EAARA,GAAU2C,GAAG,CAAC,SAACrB,CAAM,CAAEsB,CAAK,EAAA,OAC5BlG,EAAA+E,aAAA,CAACrF,EAAO,CAACyG,UAAW,EAAGC,IAAKF,CAAM,EACjClG,EAAA+E,aAAA,CAACtF,EAAG,CAAC4G,QAjER,AAAIxD,GAAqBc,IAAwBiB,CAAAA,AAAiB,YAAjBA,AAiEfA,EAjEsBC,KAAK,EAAkBD,AAAiB,aAAjBA,AAiE7CA,EAjEoDC,KAAK,AAAK,EACxF,UAGJhC,GAAqB+B,AAAiB,cAAjBA,AA6DSA,EA7DFC,KAAK,CACpC,KAAA,EAIGD,AAwD8BA,EAxDvBC,KAAK,CAACyB,QAAQ,CAAC,YAClB,0BAuDmCC,MAAO3B,EAAO4B,WAAW,CAAG5B,EAAO4B,WAAW,CAAG,EAAG,EAC1F7B,GAAwBC,GAAS,IAACjD,EAAC,GAAIiD,EAAOC,KAAK,GAE5C,GAId"}