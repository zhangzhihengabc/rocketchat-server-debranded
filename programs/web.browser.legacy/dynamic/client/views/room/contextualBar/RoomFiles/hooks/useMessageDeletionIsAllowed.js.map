)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/RoomFiles/hooks/useMessageDeletionIsAllowed.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useSetting, usePermission } from '@rocket.chat/ui-contexts';\nimport { useCallback } from 'react';\n\nimport { getDifference, MINUTES } from '../lib/getDifference';\n\nexport const useMessageDeletionIsAllowed = (rid, uid) => {\n\tconst canForceDelete = usePermission('force-delete-message', rid);\n\tconst deletionIsEnabled = useSetting('Message_AllowDeleting');\n\tconst userHasPermissonToDeleteAny = usePermission('delete-message', rid);\n\tconst userHasPermissonToDeleteOwn = usePermission('delete-own-message');\n\tconst bypassBlockTimeLimit = usePermission('bypass-time-limit-edit-and-delete');\n\tconst blockDeleteInMinutes = useSetting('Message_AllowDeleting_BlockDeleteInMinutes');\n\n\tconst isDeletionAllowed = (() => {\n\t\tif (canForceDelete) {\n\t\t\treturn () => true;\n\t\t}\n\n\t\tif (!deletionIsEnabled) {\n\t\t\treturn () => false;\n\t\t}\n\n\t\tif (!userHasPermissonToDeleteAny && !userHasPermissonToDeleteOwn) {\n\t\t\treturn () => false;\n\t\t}\n\n\t\tconst checkTimeframe =\n\t\t\t!bypassBlockTimeLimit && blockDeleteInMinutes !== 0\n\t\t\t\t? ({ ts }) => {\n\t\t\t\t\t\tif (!ts) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentTsDiff = getDifference(new Date(), new Date(ts), MINUTES);\n\n\t\t\t\t\t\treturn currentTsDiff < blockDeleteInMinutes;\n\t\t\t\t  }\n\t\t\t\t: () => true;\n\n\t\tif (userHasPermissonToDeleteAny) {\n\t\t\treturn checkTimeframe;\n\t\t}\n\n\t\tconst isOwn = ({ uid: owner }) => owner === uid;\n\n\t\treturn (msg) => isOwn(msg) && checkTimeframe(msg);\n\t})();\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\treturn useCallback(isDeletionAllowed, [\n\t\tcanForceDelete,\n\t\tdeletionIsEnabled,\n\t\tuserHasPermissonToDeleteAny,\n\t\tuserHasPermissonToDeleteOwn,\n\t\tblockDeleteInMinutes,\n\t]);\n};\n",null],"names":["module","export","useMessageDeletionIsAllowed","link","useSetting","v","usePermission","useCallback","getDifference","MINUTES","rid","uid","canForceDelete","deletionIsEnabled","userHasPermissonToDeleteAny","userHasPermissonToDeleteOwn","bypassBlockTimeLimit","blockDeleteInMinutes","checkTimeframe","_ref","ts","currentTsDiff","Date","msg","isOwn","_ref2"],"mappings":"uBAAAA,EAAOC,MAAM,CAAC,CAACC,4BAA4B,WAAW,OAAOA,CAA2B,CAAC,GAAgCF,EAAOG,IAAI,CAAC,2BAA2B,CAACC,WAAW,SAASC,CAAC,EAAED,EAAWC,CAAC,EAAEC,cAAc,SAASD,CAAC,EAAEC,EAAcD,CAAC,CAAC,EAAE,GAAmBL,EAAOG,IAAI,CAAC,QAAQ,CAACI,YAAY,SAASF,CAAC,EAAEE,EAAYF,CAAC,CAAC,EAAE,GAA6BL,EAAOG,IAAI,CAAC,uBAAuB,CAACK,cAAc,SAASH,CAAC,EAAEG,EAAcH,CAAC,EAAEI,QAAQ,SAASJ,CAAC,EAAEI,EAAQJ,CAAC,CAAC,EAAE,GAKvc,IALyFD,EAAWE,EAA8IC,EAAgFC,EAAcC,EAK1UP,EAA8B,SAACQ,CAAG,CAAEC,CAAG,EACnD,IAAMC,EAAiBN,EAAc,uBAAwBI,GACvDG,EAAoBT,EAAW,yBAC/BU,EAA8BR,EAAc,iBAAkBI,GAC9DK,EAA8BT,EAAc,sBAC5CU,EAAuBV,EAAc,qCACrCW,EAAuBb,EAAW,8CAsCxC,OAAOG,EApCoB,WAC1B,GAAIK,EACH,OAAO,WAAA,MAAM,CAAA,CAAI,EAGlB,GAAI,CAACC,GAID,CAACC,GAA+B,CAACC,EAHpC,OAAO,WAAA,MAAM,CAAA,CAAK,EAOnB,IAAMG,EACL,AAACF,GAAwBC,AAAyB,IAAzBA,EAUtB,WAAA,MAAM,CAAA,CAAI,EATV,SAAAE,CAAA,EAAY,IAATC,EAAED,EAAFC,EAAE,OACL,EAAKA,GAMEC,AAFeb,EAAc,IAAIc,KAAQ,IAAIA,KAAKF,GAAKX,GAEvCQ,CACvB,SAGJ,AAAIH,EACII,EAKD,SAACK,CAAG,EAAA,OAAKC,AAFWC,AAELF,EAFLZ,GAAG,GAAwBA,GAEdO,EAAeK,EAAI,CAClD,IAGsC,CACrCX,EACAC,EACAC,EACAC,EACAE,EACA,CACF"}