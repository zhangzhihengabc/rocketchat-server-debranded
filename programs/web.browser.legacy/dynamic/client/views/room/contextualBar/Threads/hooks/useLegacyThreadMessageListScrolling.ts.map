)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Threads/hooks/useLegacyThreadMessageListScrolling.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { isEditedMessage } from '@rocket.chat/core-typings';\nimport { useUser } from '@rocket.chat/ui-contexts';\nimport type { ScrollValues } from 'rc-scrollbars';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { callbacks } from '../../../../../../lib/callbacks';\nimport { useRoom } from '../../../contexts/RoomContext';\n\nexport const useLegacyThreadMessageListScrolling = (mainMessage: IMessage) => {\n\tconst listWrapperRef = useRef<HTMLDivElement>(null);\n\tconst listRef = useRef<HTMLElement>(null);\n\n\tconst atBottomRef = useRef(true);\n\n\tconst onScroll = useCallback(({ scrollHeight, scrollTop, clientHeight }: ScrollValues) => {\n\t\tatBottomRef.current = scrollTop >= scrollHeight - clientHeight;\n\t}, []);\n\n\tconst sendToBottomIfNecessary = useCallback(() => {\n\t\tif (atBottomRef.current === true) {\n\t\t\tconst listWrapper = listWrapperRef.current;\n\n\t\t\tlistWrapper?.scrollTo(30, listWrapper.scrollHeight);\n\t\t}\n\t}, []);\n\n\tconst room = useRoom();\n\tconst user = useUser();\n\n\tuseEffect(() => {\n\t\tcallbacks.add(\n\t\t\t'streamNewMessage',\n\t\t\t(msg: IMessage) => {\n\t\t\t\tif (room._id !== msg.rid || isEditedMessage(msg) || msg.tmid !== mainMessage._id) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (msg.u._id === user?._id) {\n\t\t\t\t\tatBottomRef.current = true;\n\t\t\t\t\tsendToBottomIfNecessary();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcallbacks.priority.MEDIUM,\n\t\t\t`thread-scroll-${room._id}`,\n\t\t);\n\n\t\treturn () => {\n\t\t\tcallbacks.remove('streamNewMessage', `thread-scroll-${room._id}`);\n\t\t};\n\t}, [room._id, sendToBottomIfNecessary, user?._id, mainMessage._id]);\n\n\tuseEffect(() => {\n\t\tconst observer = new ResizeObserver(() => {\n\t\t\tsendToBottomIfNecessary();\n\t\t});\n\n\t\tif (listWrapperRef.current) observer.observe(listWrapperRef.current);\n\t\tif (listRef.current) observer.observe(listRef.current);\n\n\t\treturn () => {\n\t\t\tobserver.disconnect();\n\t\t};\n\t}, [sendToBottomIfNecessary]);\n\n\treturn { listWrapperRef, listRef, requestScrollToBottom: sendToBottomIfNecessary, onScroll };\n};\n",null],"names":["module","export","useLegacyThreadMessageListScrolling","isEditedMessage","useUser","useCallback","useEffect","useRef","callbacks","useRoom","mainMessage","listWrapperRef","listRef","atBottomRef","onScroll","_ref","scrollHeight","scrollTop","clientHeight","current","sendToBottomIfNecessary","listWrapper","scrollTo","room","user","add","msg","_id","rid","tmid","u","priority","MEDIUM","remove","observer","ResizeObserver","observe","disconnect","requestScrollToBottom"],"mappings":"uBACAA,EAAOC,MAAE,CAAA,CAAAC,oCAAuB,WAA4B,OAAAA,CAAA,CAAA,GAAAF,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAG,gBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAI,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAJ,EAAAA,IAAAA,CAAAA,QAAAA,CAAAK,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAP,EAAAA,IAAAA,CAAAA,kCAAAA,CAAAQ,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAS,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQrD,IARqDN,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAQ/CP,EAAsC,SAACQ,CAAqB,EACxE,IAAMC,EAAiBJ,EAAuB,MACxCK,EAAUL,EAAoB,MAE9BM,EAAcN,EAAO,CAAA,GAErBO,EAAWT,EAAY,SAAAU,CAAA,EAA4D,IAAzDC,EAAYD,EAAZC,YAAY,CAAEC,EAASF,EAATE,SAAS,CAAEC,EAAYH,EAAZG,YAAY,AACpEL,CAAAA,EAAYM,OAAO,CAAGF,GAAaD,EAAeE,CACnD,EAAG,EAAE,EAECE,EAA0Bf,EAAY,WAC3C,GAAIQ,AAAwB,CAAA,IAAxBA,EAAYM,OAAO,CAAW,CACjC,IAAME,EAAcV,EAAeQ,OAAO,AAE1CE,OAAAA,GAAAA,EAAaC,QAAQ,CAAC,GAAID,EAAYL,YAAY,EAEpD,EAAG,EAAE,EAECO,EAAOd,IACPe,EAAOpB,IAqCb,OAnCAE,EAAU,WAiBT,OAhBAE,EAAUiB,GAAG,CACZ,mBACA,SAACC,CAAa,EACTH,EAAKI,GAAG,GAAKD,EAAIE,GAAG,EAAIzB,EAAgBuB,IAAQA,EAAIG,IAAI,GAAKnB,EAAYiB,GAAG,EAI5ED,EAAII,CAAC,CAACH,GAAG,GAAKH,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,AAAHA,IACvBd,EAAYM,OAAO,CAAG,CAAA,EACtBC,IAEF,EACAZ,EAAUuB,QAAQ,CAACC,MAAM,CAAA,iBACRT,EAAKI,GAAG,EAGnB,WACNnB,EAAUyB,MAAM,CAAC,mBAAkB,iBAAmBV,EAAKI,GAAG,CAC/D,CACD,EAAG,CAACJ,EAAKI,GAAG,CAAEP,EAAyBI,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,CAAEjB,EAAYiB,GAAG,CAAC,EAElErB,EAAU,WACT,IAAM4B,EAAW,IAAIC,eAAe,WACnCf,GACD,GAKA,OAHIT,EAAeQ,OAAO,EAAEe,EAASE,OAAO,CAACzB,EAAeQ,OAAO,EAC/DP,EAAQO,OAAO,EAAEe,EAASE,OAAO,CAACxB,EAAQO,OAAO,EAE9C,WACNe,EAASG,UAAU,EACpB,CACD,EAAG,CAACjB,EAAwB,EAErB,CAAET,eAAAA,EAAgBC,QAAAA,EAAS0B,sBAAuBlB,EAAyBN,SAAAA,CAAQ,CAC3F"}