)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Threads/components/ThreadChat.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, IThreadMainMessage } from '@rocket.chat/core-typings';\nimport { isEditedMessage } from '@rocket.chat/core-typings';\nimport { Box, CheckBox, Field, FieldLabel, FieldRow } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport React, { useState, useEffect, useCallback } from 'react';\n\nimport { callbacks } from '../../../../../../lib/callbacks';\nimport { ContextualbarContent } from '../../../../../components/Contextualbar';\nimport MessageListErrorBoundary from '../../../MessageList/MessageListErrorBoundary';\nimport DropTargetOverlay from '../../../body/DropTargetOverlay';\nimport { useFileUploadDropTarget } from '../../../body/hooks/useFileUploadDropTarget';\nimport ComposerContainer from '../../../composer/ComposerContainer';\nimport RoomComposer from '../../../composer/RoomComposer/RoomComposer';\nimport { useChat } from '../../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../../contexts/RoomContext';\nimport { useRoomToolbox } from '../../../contexts/RoomToolboxContext';\nimport ThreadMessageList from './ThreadMessageList';\n\ntype ThreadChatProps = {\n\tmainMessage: IThreadMainMessage;\n};\n\nconst ThreadChat = ({ mainMessage }: ThreadChatProps) => {\n\tconst [fileUploadTriggerProps, fileUploadOverlayProps] = useFileUploadDropTarget();\n\n\tconst sendToChannelPreference = useUserPreference<'always' | 'never' | 'default'>('alsoSendThreadToChannel');\n\n\tconst [sendToChannel, setSendToChannel] = useState(() => {\n\t\tswitch (sendToChannelPreference) {\n\t\t\tcase 'always':\n\t\t\t\treturn true;\n\t\t\tcase 'never':\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn !mainMessage.tcount;\n\t\t}\n\t});\n\n\tconst handleSend = useCallback((): void => {\n\t\tif (sendToChannelPreference === 'default') {\n\t\t\tsetSendToChannel(false);\n\t\t}\n\t}, [sendToChannelPreference]);\n\n\tconst { closeTab } = useRoomToolbox();\n\n\tconst handleComposerEscape = useCallback((): void => {\n\t\tcloseTab();\n\t}, [closeTab]);\n\n\tconst chat = useChat();\n\n\tconst handleNavigateToPreviousMessage = useCallback((): void => {\n\t\tchat?.messageEditing.toPreviousMessage();\n\t}, [chat?.messageEditing]);\n\n\tconst handleNavigateToNextMessage = useCallback((): void => {\n\t\tchat?.messageEditing.toNextMessage();\n\t}, [chat?.messageEditing]);\n\n\tconst handleUploadFiles = useCallback(\n\t\t(files: readonly File[]): void => {\n\t\t\tchat?.flows.uploadFiles(files);\n\t\t},\n\t\t[chat?.flows],\n\t);\n\n\tconst room = useRoom();\n\tconst readThreads = useMethod('readThreads');\n\tuseEffect(() => {\n\t\tcallbacks.add(\n\t\t\t'streamNewMessage',\n\t\t\t(msg: IMessage) => {\n\t\t\t\tif (room._id !== msg.rid || isEditedMessage(msg) || msg.tmid !== mainMessage._id) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treadThreads(mainMessage._id);\n\t\t\t},\n\t\t\tcallbacks.priority.MEDIUM,\n\t\t\t`thread-${room._id}`,\n\t\t);\n\n\t\treturn () => {\n\t\t\tcallbacks.remove('streamNewMessage', `thread-${room._id}`);\n\t\t};\n\t}, [mainMessage._id, readThreads, room._id]);\n\n\tconst subscription = useRoomSubscription();\n\tconst sendToChannelID = useUniqueId();\n\tconst t = useTranslation();\n\n\treturn (\n\t\t<ContextualbarContent flexShrink={1} flexGrow={1} paddingInline={0} {...fileUploadTriggerProps}>\n\t\t\t<DropTargetOverlay {...fileUploadOverlayProps} />\n\t\t\t<Box is='section' display='flex' flexDirection='column' flexGrow={1} flexShrink={1} flexBasis='auto' height='full'>\n\t\t\t\t<MessageListErrorBoundary>\n\t\t\t\t\t<ThreadMessageList mainMessage={mainMessage} />\n\t\t\t\t</MessageListErrorBoundary>\n\n\t\t\t\t<RoomComposer>\n\t\t\t\t\t<ComposerContainer\n\t\t\t\t\t\ttmid={mainMessage._id}\n\t\t\t\t\t\tsubscription={subscription}\n\t\t\t\t\t\tonSend={handleSend}\n\t\t\t\t\t\tonEscape={handleComposerEscape}\n\t\t\t\t\t\tonNavigateToPreviousMessage={handleNavigateToPreviousMessage}\n\t\t\t\t\t\tonNavigateToNextMessage={handleNavigateToNextMessage}\n\t\t\t\t\t\tonUploadFiles={handleUploadFiles}\n\t\t\t\t\t\ttshow={sendToChannel}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldRow marginBlock={8}>\n\t\t\t\t\t\t\t\t<CheckBox\n\t\t\t\t\t\t\t\t\tid={sendToChannelID}\n\t\t\t\t\t\t\t\t\tchecked={sendToChannel}\n\t\t\t\t\t\t\t\t\tonChange={() => setSendToChannel((checked) => !checked)}\n\t\t\t\t\t\t\t\t\tname='alsoSendThreadToChannel'\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<FieldLabel htmlFor={sendToChannelID} color='annotation' fontScale='p2'>\n\t\t\t\t\t\t\t\t\t{t('Also_send_to_channel')}\n\t\t\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</ComposerContainer>\n\t\t\t\t</RoomComposer>\n\t\t\t</Box>\n\t\t</ContextualbarContent>\n\t);\n};\n\nexport default ThreadChat;\n",null],"names":["_extends","_slicedToArray","isEditedMessage","Box","CheckBox","Field","FieldLabel","FieldRow","useUniqueId","useMethod","useTranslation","useUserPreference","React","useState","useEffect","useCallback","callbacks","ContextualbarContent","MessageListErrorBoundary","DropTargetOverlay","useFileUploadDropTarget","ComposerContainer","RoomComposer","useChat","useRoom","useRoomSubscription","useRoomToolbox","ThreadMessageList","module","default","v","link","exportDefault","_ref","mainMessage","_useFileUploadDropTar2","fileUploadTriggerProps","fileUploadOverlayProps","sendToChannelPreference","_useState2","tcount","sendToChannel","setSendToChannel","handleSend","closeTab","_useRoomToolbox","handleComposerEscape","chat","handleNavigateToPreviousMessage","messageEditing","toPreviousMessage","handleNavigateToNextMessage","toNextMessage","handleUploadFiles","files","flows","uploadFiles","room","readThreads","add","msg","_id","rid","tmid","priority","MEDIUM","remove","subscription","sendToChannelID","t","createElement","flexShrink","flexGrow","paddingInline","is","display","flexDirection","flexBasis","height","onSend","onEscape","onNavigateToPreviousMessage","onNavigateToNextMessage","onUploadFiles","tshow","marginBlock","id","checked","onChange","name","htmlFor","color","fontScale"],"mappings":"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"}