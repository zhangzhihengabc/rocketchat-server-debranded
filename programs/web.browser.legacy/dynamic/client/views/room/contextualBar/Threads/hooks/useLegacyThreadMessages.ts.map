)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/Threads/hooks/useLegacyThreadMessages.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IThreadMessage, IThreadMainMessage } from '@rocket.chat/core-typings';\nimport { isThreadMessage } from '@rocket.chat/core-typings';\nimport { useMethod } from '@rocket.chat/ui-contexts';\nimport { useEffect, useState, useCallback } from 'react';\n\nimport { Messages } from '../../../../../../app/models/client';\nimport { upsertMessageBulk } from '../../../../../../app/ui-utils/client/lib/RoomHistoryManager';\nimport { useReactiveValue } from '../../../../../hooks/useReactiveValue';\n\nexport const useLegacyThreadMessages = (\n\ttmid: IThreadMainMessage['_id'],\n): {\n\tmessages: Array<IThreadMessage | IThreadMainMessage>;\n\tloading: boolean;\n} => {\n\tconst messages = useReactiveValue(\n\t\tuseCallback(() => {\n\t\t\treturn Messages.find(\n\t\t\t\t{\n\t\t\t\t\t$or: [{ tmid }, { _id: tmid }],\n\t\t\t\t\t_hidden: { $ne: true },\n\t\t\t\t\ttmid,\n\t\t\t\t\t_id: { $ne: tmid },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tcollapsed: 0,\n\t\t\t\t\t\tthreadMsg: 0,\n\t\t\t\t\t\trepliesCount: 0,\n\t\t\t\t\t},\n\t\t\t\t\tsort: { ts: 1 },\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.fetch()\n\t\t\t\t.filter(isThreadMessage);\n\t\t}, [tmid]),\n\t);\n\n\tconst [loading, setLoading] = useState(false);\n\n\tconst getThreadMessages = useMethod('getThreadMessages');\n\n\tuseEffect(() => {\n\t\tsetLoading(true);\n\t\tgetThreadMessages({ tmid }).then((messages) => {\n\t\t\tupsertMessageBulk({ msgs: messages }, Messages);\n\t\t\tsetLoading(false);\n\t\t});\n\t}, [getThreadMessages, tmid]);\n\n\treturn { messages, loading };\n};\n",null],"names":["module","link","default","_slicedToArray","export","useLegacyThreadMessages","isThreadMessage","useMethod","useEffect","useState","useCallback","Messages","upsertMessageBulk","useReactiveValue","tmid","messages","find","$or","_id","_hidden","$ne","fields","collapsed","threadMsg","repliesCount","sort","ts","fetch","filter","_useState2","loading","setLoading","getThreadMessages","then","msgs"],"mappings":"uBACSA,EAAiBC,IAAAA,CAAAA,uCAAkC,CAAAC,QAAAA,SAAAA,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAA5DH,EAAOI,MAAE,CAAA,CAAAC,wBAAuB,WAAA,OAAAA,CAA4B,CAAA,GAAAL,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAM,gBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAN,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAO,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAP,EAAAA,IAAAA,CAAAA,QAAAA,CAAAQ,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAV,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAW,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAX,EAAAA,IAAAA,CAAAA,+DAAAA,CAAAY,kBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAZ,EAAAA,IAAAA,CAAAA,wCAAAA,CAAAa,iBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQrD,IARPV,EAA4DG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAQ/CR,EAA0B,SACtCS,CAA+B,EAK/B,IAAMC,EAAWF,EAChBH,EAAY,WACX,OAAOC,EAASK,IAAI,CACnB,CACCC,IAAK,CAAC,CAAEH,KAAAA,CAAI,EAAI,CAAEI,IAAKJ,CAAI,EAAG,CAC9BK,QAAS,CAAEC,IAAK,CAAA,CAAI,EACpBN,KAAAA,EACAI,IAAK,CAAEE,IAAKN,CAAI,GAEjB,CACCO,OAAQ,CACPC,UAAW,EACXC,UAAW,EACXC,aAAc,GAEfC,KAAM,CAAEC,GAAI,CAAC,IAGbC,KAAK,GACLC,MAAM,CAACtB,EACV,EAAG,CAACQ,EAAK,GAGmCe,EAAA1B,EAAfM,EAAS,CAAA,GAAM,GAAtCqB,EAAOD,CAAA,CAAA,EAAA,CAAEE,EAAUF,CAAA,CAAA,EAAA,CAEpBG,EAAoBzB,EAAU,qBAUpC,OARAC,EAAU,WACTuB,EAAW,CAAA,GACXC,EAAkB,CAAElB,KAAAA,CAAI,GAAImB,IAAI,CAAC,SAAClB,CAAQ,EACzCH,EAAkB,CAAEsB,KAAMnB,CAAQ,EAAIJ,GACtCoB,EAAW,CAAA,EACZ,EACD,EAAG,CAACC,EAAmBlB,EAAK,EAErB,CAAEC,SAAAA,EAAUe,QAAAA,CAAO,CAC3B"}