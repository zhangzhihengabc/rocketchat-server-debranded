)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/MessageSearchTab/components/MessageSearch.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, MessageDivider } from '@rocket.chat/fuselage';\nimport { useSetting, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { Fragment, memo, useState } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\n\nimport { MessageTypes } from '../../../../../../app/ui-utils/client';\nimport { ContextualbarEmptyContent } from '../../../../../components/Contextualbar';\nimport ScrollableContentWrapper from '../../../../../components/ScrollableContentWrapper';\nimport RoomMessage from '../../../../../components/message/variants/RoomMessage';\nimport SystemMessage from '../../../../../components/message/variants/SystemMessage';\nimport { useFormatDate } from '../../../../../hooks/useFormatDate';\nimport MessageListErrorBoundary from '../../../MessageList/MessageListErrorBoundary';\nimport { isMessageNewDay } from '../../../MessageList/lib/isMessageNewDay';\nimport MessageListProvider from '../../../MessageList/providers/MessageListProvider';\nimport LoadingMessagesIndicator from '../../../body/LoadingMessagesIndicator';\nimport { useRoomSubscription } from '../../../contexts/RoomContext';\nimport { useMessageSearchQuery } from '../hooks/useMessageSearchQuery';\n\ntype MessageSearchProps = {\n\tsearchText: string;\n\tglobalSearch: boolean;\n};\n\nconst MessageSearch = ({ searchText, globalSearch }: MessageSearchProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst formatDate = useFormatDate();\n\tconst pageSize = useSetting<number>('PageSize') ?? 10;\n\tconst [limit, setLimit] = useState(pageSize);\n\tconst showUserAvatar = !!useUserPreference<boolean>('displayAvatars');\n\n\tconst subscription = useRoomSubscription();\n\tconst messageSearchQuery = useMessageSearchQuery({ searchText, limit, globalSearch });\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' flexGrow={1} flexShrink={1} flexBasis={0}>\n\t\t\t{messageSearchQuery.data && (\n\t\t\t\t<>\n\t\t\t\t\t{messageSearchQuery.data.length === 0 && <ContextualbarEmptyContent title={t('No_results_found')} />}\n\t\t\t\t\t{messageSearchQuery.data.length > 0 && (\n\t\t\t\t\t\t<MessageListErrorBoundary>\n\t\t\t\t\t\t\t<MessageListProvider>\n\t\t\t\t\t\t\t\t<Box is='section' display='flex' flexDirection='column' flexGrow={1} flexShrink={1} flexBasis='auto' height='full'>\n\t\t\t\t\t\t\t\t\t<Virtuoso\n\t\t\t\t\t\t\t\t\t\ttotalCount={messageSearchQuery.data.length}\n\t\t\t\t\t\t\t\t\t\toverscan={25}\n\t\t\t\t\t\t\t\t\t\tdata={messageSearchQuery.data}\n\t\t\t\t\t\t\t\t\t\tcomponents={{ Scroller: ScrollableContentWrapper }}\n\t\t\t\t\t\t\t\t\t\titemContent={(index, message) => {\n\t\t\t\t\t\t\t\t\t\t\tconst previous = messageSearchQuery.data[index - 1];\n\n\t\t\t\t\t\t\t\t\t\t\tconst newDay = isMessageNewDay(message, previous);\n\n\t\t\t\t\t\t\t\t\t\t\tconst system = MessageTypes.isSystemMessage(message);\n\n\t\t\t\t\t\t\t\t\t\t\tconst unread = subscription?.tunread?.includes(message._id) ?? false;\n\t\t\t\t\t\t\t\t\t\t\tconst mention = subscription?.tunreadUser?.includes(message._id) ?? false;\n\t\t\t\t\t\t\t\t\t\t\tconst all = subscription?.tunreadGroup?.includes(message._id) ?? false;\n\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<Fragment key={message._id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{newDay && <MessageDivider>{formatDate(message.ts)}</MessageDivider>}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t{system ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<SystemMessage message={message} showUserAvatar={showUserAvatar} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<RoomMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage={message}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsequential={false}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunread={unread}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmention={mention}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tall={all}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext='search'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsearchText={searchText}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowUserAvatar={showUserAvatar}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tendReached={() => {\n\t\t\t\t\t\t\t\t\t\t\tsetLimit((limit) => limit + pageSize);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t\t</MessageListProvider>\n\t\t\t\t\t\t</MessageListErrorBoundary>\n\t\t\t\t\t)}\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{searchText && messageSearchQuery.isLoading && <LoadingMessagesIndicator />}\n\t\t</Box>\n\t);\n};\n\nexport default memo(MessageSearch);\n",null],"names":["_slicedToArray","Box","MessageDivider","useSetting","useTranslation","useUserPreference","React","Fragment","memo","useState","Virtuoso","MessageTypes","ContextualbarEmptyContent","ScrollableContentWrapper","RoomMessage","SystemMessage","useFormatDate","MessageListErrorBoundary","isMessageNewDay","MessageListProvider","LoadingMessagesIndicator","useRoomSubscription","useMessageSearchQuery","module","default","link","v","exportDefault","_ref","_useSetting","searchText","globalSearch","t","formatDate","pageSize","_useState2","limit","setLimit","showUserAvatar","subscription","messageSearchQuery","createElement","display","flexDirection","flexGrow","flexShrink","flexBasis","data","length","title","is","height","totalCount","overscan","components","Scroller","itemContent","index","message","_subscription$tunread","_subscription$tunread2","_subscription$tunread3","_subscription$tunread4","_subscription$tunread5","_subscription$tunread6","newDay","system","isSystemMessage","unread","tunread","includes","_id","mention","tunreadUser","all","tunreadGroup","key","ts","sequential","context","endReached","isLoading"],"mappings":"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"}