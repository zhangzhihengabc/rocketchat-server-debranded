)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isTeamRoom } from '@rocket.chat/core-typings';\nimport { useMutableCallback, useDebouncedValue, useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useUserRoom, useAtLeastOnePermission, useUser, usePermission, useUserSubscription } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport * as Federation from '../../../../lib/federation/Federation';\nimport { useMembersList } from '../../../hooks/useMembersList';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport UserInfoWithData from '../UserInfo';\nimport AddUsers from './AddUsers';\nimport InviteUsers from './InviteUsers';\nimport RoomMembers from './RoomMembers';\n\nenum ROOM_MEMBERS_TABS {\n\tINFO = 'user-info',\n\tINVITE = 'invite-users',\n\tADD = 'add-users',\n\tLIST = 'users-list',\n}\n\ntype validRoomType = 'd' | 'p' | 'c';\n\nconst RoomMembersWithData = ({ rid }: { rid: IRoom['_id'] }): ReactElement => {\n\tconst user = useUser();\n\tconst room = useUserRoom(rid);\n\tconst { closeTab } = useRoomToolbox();\n\tconst [type, setType] = useLocalStorage<'online' | 'all'>('members-list-type', 'online');\n\tconst [text, setText] = useState('');\n\tconst subscription = useUserSubscription(rid);\n\n\tconst isTeam = room && isTeamRoom(room);\n\tconst isDirect = room && isDirectMessageRoom(room);\n\tconst hasPermissionToCreateInviteLinks = usePermission('create-invite-links', rid);\n\tconst isFederated = room && isRoomFederated(room);\n\n\tconst canCreateInviteLinks =\n\t\troom && user && isFederated ? Federation.canCreateInviteLinks(user, room, subscription) : hasPermissionToCreateInviteLinks;\n\n\tconst [state, setState] = useState<{ tab: ROOM_MEMBERS_TABS; userId?: IUser['_id'] }>({\n\t\ttab: ROOM_MEMBERS_TABS.LIST,\n\t\tuserId: undefined,\n\t});\n\n\tconst debouncedText = useDebouncedValue(text, 800);\n\n\tconst { data, fetchNextPage, isLoading, refetch, hasNextPage } = useMembersList(\n\t\tuseMemo(() => ({ rid, type, limit: 50, debouncedText, roomType: room?.t as validRoomType }), [rid, type, debouncedText, room?.t]),\n\t);\n\n\tconst hasPermissionToAddUsers = useAtLeastOnePermission(\n\t\tuseMemo(() => [room?.t === 'p' ? 'add-user-to-any-p-room' : 'add-user-to-any-c-room', 'add-user-to-joined-room'], [room?.t]),\n\t\trid,\n\t);\n\n\tconst canAddUsers = room && user && isFederated ? Federation.isEditableByTheUser(user, room, subscription) : hasPermissionToAddUsers;\n\n\tconst handleTextChange = useCallback((event) => {\n\t\tsetText(event.currentTarget.value);\n\t}, []);\n\n\tconst openUserInfo = useMutableCallback((e) => {\n\t\tconst { userid } = e.currentTarget.dataset;\n\t\tsetState({\n\t\t\ttab: ROOM_MEMBERS_TABS.INFO,\n\t\t\tuserId: userid,\n\t\t});\n\t});\n\n\tconst openInvite = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.INVITE });\n\t});\n\n\tconst openAddUser = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.ADD });\n\t});\n\n\tconst handleBack = useCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.LIST });\n\t}, [setState]);\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INFO && state.userId) {\n\t\treturn <UserInfoWithData rid={rid} uid={state.userId} onClose={closeTab} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INVITE) {\n\t\treturn <InviteUsers rid={rid} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.ADD) {\n\t\treturn <AddUsers rid={rid} onClickBack={handleBack} reload={refetch} />;\n\t}\n\n\treturn (\n\t\t<RoomMembers\n\t\t\trid={rid}\n\t\t\tisTeam={isTeam}\n\t\t\tisDirect={isDirect}\n\t\t\tloading={isLoading}\n\t\t\ttype={type}\n\t\t\ttext={text}\n\t\t\tsetText={handleTextChange}\n\t\t\tsetType={setType}\n\t\t\tmembers={data?.pages?.flatMap((page) => page.members) ?? []}\n\t\t\ttotal={data?.pages[data.pages.length - 1].total ?? 0}\n\t\t\tonClickClose={closeTab}\n\t\t\tonClickView={openUserInfo}\n\t\t\tloadMoreItems={hasNextPage ? fetchNextPage : () => undefined}\n\t\t\treload={refetch}\n\t\t\tonClickInvite={canCreateInviteLinks && canAddUsers ? openInvite : undefined}\n\t\t\tonClickAdd={canAddUsers ? openAddUser : undefined}\n\t\t/>\n\t);\n};\n\nexport default RoomMembersWithData;\n",null],"names":["ROOM_MEMBERS_TABS","_slicedToArray","isRoomFederated","isDirectMessageRoom","isTeamRoom","useMutableCallback","useDebouncedValue","useLocalStorage","useUserRoom","useAtLeastOnePermission","useUser","usePermission","useUserSubscription","React","useCallback","useMemo","useState","Federation","useMembersList","useRoomToolbox","UserInfoWithData","AddUsers","InviteUsers","RoomMembers","module","link","default","v","exportDefault","_ref","_data$pages$flatMap","_data$pages","_data$pages$total","rid","user","room","closeTab","_useRoomToolbox","_useLocalStorage2","type","setType","_useState2","text","setText","subscription","isTeam","isDirect","hasPermissionToCreateInviteLinks","isFederated","canCreateInviteLinks","_useState4","tab","LIST","userId","undefined","state","setState","debouncedText","_useMembersList","limit","roomType","t","data","fetchNextPage","isLoading","refetch","hasNextPage","hasPermissionToAddUsers","canAddUsers","isEditableByTheUser","handleTextChange","event","currentTarget","value","openUserInfo","e","userid","dataset","INFO","openInvite","INVITE","openAddUser","ADD","handleBack","createElement","uid","onClose","onClickBack","reload","loading","members","pages","flatMap","page","total","length","onClickClose","onClickView","loadMoreItems","onClickInvite","onClickAdd"],"mappings":"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"}