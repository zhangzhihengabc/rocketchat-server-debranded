)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/contextualBar/OTR/OTRWithData.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useUserId } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useEffect, useMemo } from 'react';\n\nimport OTR from '../../../../../app/otr/client/OTR';\nimport { OtrRoomState } from '../../../../../app/otr/lib/OtrRoomState';\nimport { usePresence } from '../../../../hooks/usePresence';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport { useRoom } from '../../contexts/RoomContext';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport OTRComponent from './OTR';\n\nconst OTRWithData = (): ReactElement => {\n\tconst uid = useUserId();\n\tconst room = useRoom();\n\tconst { closeTab } = useRoomToolbox();\n\tconst otr = useMemo(() => {\n\t\tif (!uid) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn OTR.getInstanceByRoomId(uid, room._id);\n\t}, [uid, room._id]);\n\tconst otrState = useReactiveValue(useCallback(() => (otr ? otr.getState() : OtrRoomState.ERROR), [otr]));\n\tconst peerUserPresence = usePresence(otr?.getPeerId());\n\tconst userStatus = peerUserPresence?.status;\n\tconst peerUsername = peerUserPresence?.username;\n\tconst isOnline = !['offline', 'loading'].includes(userStatus || '');\n\n\tconst handleStart = (): void => {\n\t\totr?.handshake();\n\t};\n\n\tconst handleEnd = (): void => {\n\t\totr?.end();\n\t};\n\n\tconst handleReset = (): void => {\n\t\totr?.reset();\n\t\totr?.handshake(true);\n\t};\n\n\tuseEffect(() => {\n\t\tif (otrState !== OtrRoomState.ESTABLISHING) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\totr?.setState(OtrRoomState.TIMEOUT);\n\t\t}, 10000);\n\n\t\treturn (): void => {\n\t\t\tclearTimeout(timeout);\n\t\t};\n\t}, [otr, otrState]);\n\n\treturn (\n\t\t<OTRComponent\n\t\t\tisOnline={isOnline}\n\t\t\tonClickClose={closeTab}\n\t\t\tonClickStart={handleStart}\n\t\t\tonClickEnd={handleEnd}\n\t\t\tonClickRefresh={handleReset}\n\t\t\totrState={otrState}\n\t\t\tpeerUsername={peerUsername}\n\t\t/>\n\t);\n};\n\nexport default OTRWithData;\n",null],"names":["useUserId","React","useCallback","useEffect","useMemo","OTR","OtrRoomState","usePresence","useReactiveValue","useRoom","useRoomToolbox","OTRComponent","module","link","v","exportDefault","uid","room","closeTab","_useRoomToolbox","otr","getInstanceByRoomId","_id","otrState","getState","ERROR","peerUserPresence","getPeerId","userStatus","status","peerUsername","username","isOnline","includes","ESTABLISHING","timeout","setTimeout","setState","TIMEOUT","clearTimeout","createElement","onClickClose","onClickStart","handshake","onClickEnd","end","onClickRefresh","reset"],"mappings":"uBAYA,IAZAA,EAAqDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5CC,EAAWC,IAAA,CAAM,2BAA2B,CAAAb,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAE,CAAA,EAAAb,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,oCAAAA,CAAA,QAAA,SAAAE,CAAA,EAAAT,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,0CAAAA,CAAAN,aAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,gCAAAA,CAAAL,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,qCAAAA,CAAAJ,iBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAH,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,oCAAAA,CAAAF,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAE,CAAA,EAAAH,EAAAA,CAAA,CAAA,EAAA,GAArDC,EAAOG,aAAa,CAYA,WACnB,IAAMC,EAAMhB,IACNiB,EAAOR,IACLS,EAAQC,AAAKT,IAAbQ,QAAQ,CACVE,EAAMhB,EAAQ,WACnB,GAAKY,EAIL,OAAOX,EAAIgB,mBAAmB,CAACL,EAAKC,EAAKK,GAAG,CAC7C,EAAG,CAACN,EAAKC,EAAKK,GAAG,CAAC,EACZC,EAAWf,EAAiBN,EAAY,WAAA,OAAOkB,EAAMA,EAAII,QAAQ,GAAKlB,EAAamB,KAAK,EAAG,CAACL,EAAI,GAChGM,EAAmBnB,EAAYa,MAAAA,EAAG,KAAA,EAAHA,EAAKO,SAAS,IAC7CC,EAAaF,MAAAA,EAAgB,KAAA,EAAhBA,EAAkBG,MAAM,CACrCC,EAAeJ,MAAAA,EAAgB,KAAA,EAAhBA,EAAkBK,QAAQ,CACzCC,EAAW,CAAC,CAAC,UAAW,UAAU,CAACC,QAAQ,CAACL,GAAc,IA6BhE,OAdAzB,EAAU,WACT,GAAIoB,IAAajB,EAAa4B,YAAY,EAI1C,IAAMC,EAAUC,WAAW,WAC1BhB,MAAAA,GAAAA,EAAKiB,QAAQ,CAAC/B,EAAagC,OAAO,CACnC,EAAG,KAEH,OAAO,WACNC,aAAaJ,EACd,EACD,EAAG,CAACf,EAAKG,EAAS,EAGjBtB,EAAAuC,aAAA,CAAC7B,EAAY,CACZqB,SAAUA,EACVS,aAAcvB,EACdwB,aA/BkB,WACnBtB,MAAAA,GAAAA,EAAKuB,SAAS,EACf,EA8BEC,WA5BgB,WACjBxB,MAAAA,GAAAA,EAAKyB,GAAG,EACT,EA2BEC,eAzBkB,WACnB1B,MAAAA,GAAAA,EAAK2B,KAAK,GACV3B,MAAAA,GAAAA,EAAKuB,SAAS,CAAC,CAAA,EAChB,EAuBEpB,SAAUA,EACVO,aAAcA,CAAa,EAG9B"}