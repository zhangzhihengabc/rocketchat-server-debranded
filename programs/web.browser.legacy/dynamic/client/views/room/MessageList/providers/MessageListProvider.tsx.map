)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/MessageList/providers/MessageListProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { isMessageReactionsNormalized, isThreadMainMessage } from '@rocket.chat/core-typings';\nimport { useLayout, useUser, useUserPreference, useSetting, useEndpoint, useSearchParameter } from '@rocket.chat/ui-contexts';\nimport type { VFC, ReactNode } from 'react';\nimport React, { useMemo, memo } from 'react';\n\nimport { getRegexHighlight, getRegexHighlightUrl } from '../../../../../app/highlight-words/client/helper';\nimport type { MessageListContextValue } from '../../../../components/message/list/MessageListContext';\nimport { MessageListContext } from '../../../../components/message/list/MessageListContext';\nimport AttachmentProvider from '../../../../providers/AttachmentProvider';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../contexts/RoomContext';\nimport { useAutoTranslate } from '../hooks/useAutoTranslate';\nimport { useKatex } from '../hooks/useKatex';\nimport { useLoadSurroundingMessages } from '../hooks/useLoadSurroundingMessages';\n\ntype MessageListProviderProps = {\n\tchildren: ReactNode;\n\tscrollMessageList?: MessageListContextValue['scrollMessageList'];\n\tattachmentDimension?: {\n\t\twidth?: number;\n\t\theight?: number;\n\t};\n};\n\nconst MessageListProvider: VFC<MessageListProviderProps> = ({ children, scrollMessageList, attachmentDimension }) => {\n\tconst room = useRoom();\n\n\tif (!room) {\n\t\tthrow new Error('Room not found');\n\t}\n\n\tconst reactToMessage = useEndpoint('POST', '/v1/chat.react');\n\tconst user = useUser();\n\tconst uid = user?._id;\n\tconst username = user?.username;\n\tconst subscription = useRoomSubscription();\n\n\tconst { isMobile } = useLayout();\n\n\tconst showRealName = Boolean(useSetting('UI_Use_Real_Name'));\n\tconst showColors = useSetting('HexColorPreview_Enabled') as boolean;\n\n\tconst displayRolesGlobal = Boolean(useSetting('UI_DisplayRoles'));\n\tconst hideRolesPreference = Boolean(!useUserPreference<boolean>('hideRoles') && !isMobile);\n\tconst showRoles = displayRolesGlobal && hideRolesPreference;\n\tconst showUsername = Boolean(!useUserPreference<boolean>('hideUsernames') && !isMobile);\n\tconst highlights = useUserPreference<string[]>('highlights');\n\n\tconst { showAutoTranslate, autoTranslateLanguage } = useAutoTranslate(subscription);\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\n\tconst hasSubscription = Boolean(subscription);\n\tconst msgParameter = useSearchParameter('msg');\n\n\tuseLoadSurroundingMessages(msgParameter);\n\n\tconst chat = useChat();\n\n\tconst context: MessageListContextValue = useMemo(\n\t\t() => ({\n\t\t\tshowColors,\n\t\t\tuseReactionsFilter: (message: IMessage): ((reaction: string) => string[]) => {\n\t\t\t\tconst { reactions } = message;\n\t\t\t\treturn !showRealName\n\t\t\t\t\t? (reaction: string): string[] =>\n\t\t\t\t\t\t\treactions?.[reaction]?.usernames.filter((user) => user !== username).map((username) => `@${username}`) || []\n\t\t\t\t\t: (reaction: string): string[] => {\n\t\t\t\t\t\t\tif (!reactions?.[reaction]) {\n\t\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!isMessageReactionsNormalized(message)) {\n\t\t\t\t\t\t\t\treturn message.reactions?.[reaction]?.usernames.filter((user) => user !== username).map((username) => `@${username}`) || [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!username) {\n\t\t\t\t\t\t\t\treturn message.reactions[reaction].names;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst index = message.reactions[reaction].usernames.indexOf(username);\n\t\t\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t\t\treturn message.reactions[reaction].names;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn message.reactions[reaction].names.splice(index, 1);\n\t\t\t\t\t  };\n\t\t\t},\n\t\t\tuseUserHasReacted: username\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(reaction): boolean =>\n\t\t\t\t\t\t\tBoolean(message.reactions?.[reaction].usernames.includes(username))\n\t\t\t\t: () => (): boolean => false,\n\t\t\tuseShowFollowing: uid\n\t\t\t\t? ({ message }): boolean => Boolean(message.replies && message.replies.indexOf(uid) > -1 && !isThreadMainMessage(message))\n\t\t\t\t: (): boolean => false,\n\t\t\tautoTranslateLanguage,\n\t\t\tuseShowTranslated: showAutoTranslate,\n\t\t\tuseShowStarred: hasSubscription\n\t\t\t\t? ({ message }): boolean => Boolean(Array.isArray(message.starred) && message.starred.find((star) => star._id === uid))\n\t\t\t\t: (): boolean => false,\n\t\t\tuseMessageDateFormatter:\n\t\t\t\t() =>\n\t\t\t\t(date: Date): string =>\n\t\t\t\t\tdate.toLocaleString(),\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tscrollMessageList,\n\t\t\tjumpToMessageParam: msgParameter,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntaxEnabled: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntaxEnabled: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t\thighlights: highlights\n\t\t\t\t?.map((str) => str.trim())\n\t\t\t\t.map((highlight) => ({\n\t\t\t\t\thighlight,\n\t\t\t\t\tregex: getRegexHighlight(highlight),\n\t\t\t\t\turlRegex: getRegexHighlightUrl(highlight),\n\t\t\t\t})),\n\n\t\t\tuseOpenEmojiPicker: uid\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(e): void => {\n\t\t\t\t\t\t\te.nativeEvent.stopImmediatePropagation();\n\t\t\t\t\t\t\tchat?.emojiPicker.open(e.currentTarget, (emoji: string) => reactToMessage({ messageId: message._id, reaction: emoji }));\n\t\t\t\t\t\t}\n\t\t\t\t: () => (): void => undefined,\n\t\t}),\n\t\t[\n\t\t\tusername,\n\t\t\tuid,\n\t\t\tshowAutoTranslate,\n\t\t\thasSubscription,\n\t\t\tautoTranslateLanguage,\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tkatexEnabled,\n\t\t\tkatexDollarSyntaxEnabled,\n\t\t\tkatexParenthesisSyntaxEnabled,\n\t\t\thighlights,\n\t\t\treactToMessage,\n\t\t\tshowColors,\n\t\t\tmsgParameter,\n\t\t\tscrollMessageList,\n\t\t\tchat?.emojiPicker,\n\t\t],\n\t);\n\n\treturn (\n\t\t<AttachmentProvider width={attachmentDimension?.width} height={attachmentDimension?.height}>\n\t\t\t<MessageListContext.Provider value={context}>{children}</MessageListContext.Provider>\n\t\t</AttachmentProvider>\n\t);\n};\n\nexport default memo(MessageListProvider);\n",null],"names":["_objectSpread","isMessageReactionsNormalized","isThreadMainMessage","useLayout","useUser","useUserPreference","useSetting","useEndpoint","useSearchParameter","React","useMemo","memo","getRegexHighlight","getRegexHighlightUrl","MessageListContext","AttachmentProvider","useChat","useRoom","useRoomSubscription","useAutoTranslate","useKatex","useLoadSurroundingMessages","module","default","v","link","exportDefault","_ref","children","scrollMessageList","attachmentDimension","Error","reactToMessage","user","uid","_id","username","subscription","isMobile","_useLayout","showRealName","Boolean","showColors","displayRolesGlobal","hideRolesPreference","showRoles","showUsername","highlights","_useAutoTranslate","showAutoTranslate","autoTranslateLanguage","_useKatex","katexEnabled","katexDollarSyntaxEnabled","katexParenthesisSyntaxEnabled","hasSubscription","msgParameter","chat","context","useReactionsFilter","message","reactions","reaction","_message$reactions","_message$reactions$re","usernames","filter","map","names","index","indexOf","splice","_reactions$reaction","useUserHasReacted","_message$reactions2","includes","useShowFollowing","_ref2","replies","useShowTranslated","useShowStarred","_ref3","Array","isArray","starred","find","star","useMessageDateFormatter","date","toLocaleString","jumpToMessageParam","katex","dollarSyntaxEnabled","parenthesisSyntaxEnabled","str","trim","highlight","regex","urlRegex","useOpenEmojiPicker","e","nativeEvent","stopImmediatePropagation","emojiPicker","open","currentTarget","emoji","messageId","createElement","width","height","Provider","value"],"mappings":"uBAyBA,IAxBAA,EAAAC,EAASC,EAAqFC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAArFC,EAAAA,IAAAA,CAAAA,uCAAyD,CAAAC,QAAAA,SAAAA,CAAAA,EAAAvB,EAA4BwB,CAAA,CAAA,EAAA,GAAvDF,EAAqBG,IAAAA,CAAAA,4BAAiC,CAACxB,6BAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,oBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAoB,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAnB,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,kBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,mBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAc,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAE,CAAA,EAAAf,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,KAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,mDAAAA,CAAAV,kBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,qBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,yDAAAA,CAAAR,mBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,2CAAAA,CAAA,QAAA,SAAAE,CAAA,EAAAT,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAN,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAL,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,oBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAH,iBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,oBAAAA,CAAAF,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,sCAAAA,CAAAD,2BAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,IAA9FC,EAAOI,aAAE,CA4JMf,EApI4C,SAAAgB,CAAA,EAAyD,IAAtDC,EAAQD,EAARC,QAAQ,CAAEC,EAAiBF,EAAjBE,iBAAiB,CAAEC,EAAmBH,EAAnBG,mBAAmB,CAG7G,GAAI,CAFSb,IAGZ,MAAM,AAAIc,MAAM,kBAGjB,IAAMC,EAAiBzB,EAAY,OAAQ,kBACrC0B,EAAO7B,IACP8B,EAAMD,MAAAA,EAAI,KAAA,EAAJA,EAAME,GAAG,CACfC,EAAWH,MAAAA,EAAI,KAAA,EAAJA,EAAMG,QAAQ,CACzBC,EAAenB,IAEboB,EAAQC,AAAKpC,IAAbmC,QAAQ,CAEVE,EAAeC,CAAAA,CAAQnC,EAAW,oBAClCoC,EAAapC,EAAW,2BAExBqC,EAAqBF,CAAAA,CAAQnC,EAAW,mBACxCsC,EAAsBH,CAAAA,CAAQ,CAAA,CAACpC,EAA2B,cAAgB,CAACiC,CAAAA,EAC3EO,EAAYF,GAAsBC,EAClCE,EAAeL,CAAAA,CAAQ,CAAA,CAACpC,EAA2B,kBAAoB,CAACiC,CAAAA,EACxES,EAAa1C,EAA4B,cAE/C2C,EAAqD7B,EAAiBkB,GAA9DY,EAAiBD,EAAjBC,iBAAiB,CAAEC,EAAqBF,EAArBE,qBAAqB,CAChDC,EAAkF/B,IAA1EgC,EAAYD,EAAZC,YAAY,CAAEC,EAAwBF,EAAxBE,wBAAwB,CAAEC,EAA6BH,EAA7BG,6BAA6B,CAEvEC,EAAkBd,CAAAA,CAAQJ,EAC1BmB,EAAehD,EAAmB,OAExCa,EAA2BmC,GAE3B,IAAMC,EAAOzC,IAEP0C,EAAmChD,EACxC,WAAA,OAAAV,EAAAA,EAAA,CACC0C,WAAAA,EACAiB,mBAAoB,SAACC,CAAiB,EACrC,IAAQC,EAAcD,EAAdC,SAAS,CACjB,OAAO,AAACrB,EAGL,SAACsB,CAAgB,EACjB,GAAI,CAACD,CAAAA,MAAAA,GAAAA,CAAS,CAAGC,EAAS,AAAD,EACxB,MAAO,EAAE,CAEV,GAAI,CAAC7D,EAA6B2D,GAAU,CAAA,IAAAG,EAAAC,EAC3C,MAAO,CAAA,AAAiB,OAAjBD,CAAAA,EAAAH,EAAQC,SAAS,AAATA,GAASE,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAA,AAAY,OAAZC,CAAAA,EAAjBD,CAAA,CAAoBD,EAAS,AAAD,GAACE,AAAA,KAAA,IAAAA,EAAA,KAAA,EAA7BA,EAA+BC,SAAS,CAACC,MAAM,CAAC,SAACjC,CAAI,EAAA,OAAKA,IAASG,CAAQ,GAAE+B,GAAG,CAAC,SAAC/B,CAAQ,EAAA,MAAA,IAASA,CAAQ,EAAE,GAAK,EAAE,CAE5H,GAAI,CAACA,EACJ,OAAOwB,EAAQC,SAAS,CAACC,EAAS,CAACM,KAAK,CAEzC,IAAMC,EAAQT,EAAQC,SAAS,CAACC,EAAS,CAACG,SAAS,CAACK,OAAO,CAAClC,UAC5D,AAAIiC,AAAU,KAAVA,EACIT,EAAQC,SAAS,CAACC,EAAS,CAACM,KAAK,CAGlCR,EAAQC,SAAS,CAACC,EAAS,CAACM,KAAK,CAACG,MAAM,CAACF,EAAO,EACvD,EAlBA,SAACP,CAAgB,EAAA,IAAAU,EAAA,MACjB,AAAAX,CAAAA,MAAAA,EAAS,KAAA,EAAA,AAAY,OAAZW,CAAAA,EAATX,CAAS,CAAGC,EAAS,AAAD,GAACU,AAAA,KAAA,IAAAA,EAAA,KAAA,EAArBA,EAAuBP,SAAS,CAACC,MAAM,CAAC,SAACjC,CAAI,EAAA,OAAKA,IAASG,CAAQ,GAAE+B,GAAG,CAAC,SAAC/B,CAAQ,EAAA,MAAA,IAASA,CAAQ,EAAE,GAAK,EAAE,CAkBhH,EACAqC,kBAAmBrC,EAChB,SAACwB,CAAO,EAAA,OACR,SAACE,CAAQ,EAAA,IAAAY,EAAA,MACRjC,CAAAA,CAAO,CAAA,AAAkB,OAAlBiC,CAAAA,EAACd,EAAQC,SAAS,AAATA,GAASa,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAjBA,CAAA,CAAoBZ,EAAS,CAACG,SAAS,CAACU,QAAQ,CAACvC,EAAQ,CAAE,CAAA,EACpE,WAAA,OAAM,WAAA,MAAe,CAAA,CAAK,CAAA,EAC7BwC,iBAAkB1C,EACf,SAAA2C,CAAA,EAAA,IAAGjB,EAAOiB,EAAPjB,OAAO,CAAA,MAAgBnB,CAAAA,CAAQmB,CAAAA,EAAQkB,OAAO,EAAIlB,EAAQkB,OAAO,CAACR,OAAO,CAACpC,GAAO,IAAM,CAAChC,EAAoB0D,EAAO,CAAE,EACxH,WAAA,MAAe,CAAA,CAAK,EACvBV,sBAAAA,EACA6B,kBAAmB9B,EACnB+B,eAAgBzB,EACb,SAAA0B,CAAA,EAAA,IAAGrB,EAAOqB,EAAPrB,OAAO,CAAA,MAAgBnB,CAAAA,CAAQyC,CAAAA,MAAMC,OAAO,CAACvB,EAAQwB,OAAO,GAAKxB,EAAQwB,OAAO,CAACC,IAAI,CAAC,SAACC,CAAI,EAAA,OAAKA,EAAKnD,GAAG,GAAKD,CAAG,EAAA,CAAE,EACrH,WAAA,MAAe,CAAA,CAAK,EACvBqD,wBACC,WAAA,OACA,SAACC,CAAU,EAAA,OACVA,EAAKC,cAAc,EAAE,CAAA,EACvB5C,UAAAA,EACAL,aAAAA,EACAM,aAAAA,EACAjB,kBAAAA,EACA6D,mBAAoBlC,CAAY,EAC5BJ,GAAgB,CACnBuC,MAAO,CACNC,oBAAqBvC,EACrBwC,yBAA0BvC,KAE3B,CAAA,EAAA,CACDP,WAAYA,MAAAA,EAAU,KAAA,EAAVA,EACToB,GAAG,CAAC,SAAC2B,CAAG,EAAA,OAAKA,EAAIC,IAAI,EAAE,GACxB5B,GAAG,CAAC,SAAC6B,CAAS,EAAA,MAAM,CACpBA,UAAAA,EACAC,MAAOrF,EAAkBoF,GACzBE,SAAUrF,EAAqBmF,GAC/B,GAEFG,mBAAoBjE,EACjB,SAAC0B,CAAO,EAAA,OACR,SAACwC,CAAC,EACDA,EAAEC,WAAW,CAACC,wBAAwB,GACtC7C,MAAAA,GAAAA,EAAM8C,WAAW,CAACC,IAAI,CAACJ,EAAEK,aAAa,CAAE,SAACC,CAAa,EAAA,OAAK1E,EAAe,CAAE2E,UAAW/C,EAAQzB,GAAG,CAAE2B,SAAU4C,CAAK,EAAG,EACvH,CAAC,EACD,WAAA,OAAM,WAAqB,CAAA,CAAA,EAAA,EAE/B,CACCtE,EACAF,EACAe,EACAM,EACAL,EACAL,EACAL,EACAM,EACAM,EACAC,EACAC,EACAP,EACAf,EACAU,EACAc,EACA3B,EACA4B,MAAAA,EAAI,KAAA,EAAJA,EAAM8C,WAAW,CACjB,EAGF,OACC9F,EAAAmG,aAAA,CAAC7F,EAAkB,CAAC8F,MAAO/E,MAAAA,EAAmB,KAAA,EAAnBA,EAAqB+E,KAAM,CAACC,OAAQhF,MAAAA,EAAmB,KAAA,EAAnBA,EAAqBgF,MAAAA,AAAO,EAC1FrG,EAAAmG,aAAA,CAAC9F,EAAmBiG,QAAQ,CAAA,CAACC,MAAOtD,CAAQ,EAAE9B,GAGjD"}