function module(e,n,t){var o,i,r,a,s,l,u,c,d,m,f,g,v,p,k,E,h,M,_,b,R,w,L,C,y,T,x,N,S,F,P,A,U,B,O,D,H,I,j,G,J,q,Q,W,$,z,Y,K,X,V,Z,ee,en,et,eo,ei,er,ea,es;t.link("@babel/runtime/helpers/extends",{default:function(e){o=e}},0),t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},1),t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},2),t.link("@rocket.chat/core-typings",{isEditedMessage:function(e){a=e}},0),t.link("@rocket.chat/ui-contexts",{usePermission:function(e){s=e},useRole:function(e){l=e},useRouter:function(e){u=e},useSearchParameter:function(e){c=e},useSetting:function(e){d=e},useTranslation:function(e){m=e},useUser:function(e){f=e},useUserPreference:function(e){g=e}},1),t.link("react",{default:function(e){v=e},memo:function(e){p=e},useCallback:function(e){k=e},useEffect:function(e){E=e},useMemo:function(e){h=e},useRef:function(e){M=e},useState:function(e){_=e}},2),t.link("use-sync-external-store/shim",{useSyncExternalStore:function(e){b=e}},3),t.link("../../../../app/models/client",{ChatMessage:function(e){R=e},RoomRoles:function(e){w=e}},4),t.link("../../../../app/ui-utils/client",{RoomHistoryManager:function(e){L=e}},5),t.link("../../../../app/ui/client/views/app/lib/scrolling",{isAtBottom:function(e){C=e}},6),t.link("../../../../lib/callbacks",{callbacks:function(e){y=e}},7),t.link("../../../../lib/isTruthy",{isTruthy:function(e){T=e}},8),t.link("../../../../lib/utils/highOrderFunctions",{withDebouncing:function(e){x=e},withThrottling:function(e){N=e}},9),t.link("../../../components/ScrollableContentWrapper",{default:function(e){S=e}},10),t.link("../../../hooks/useEmbeddedLayout",{useEmbeddedLayout:function(e){F=e}},11),t.link("../../../hooks/useReactiveQuery",{useReactiveQuery:function(e){P=e}},12),t.link("../../../lib/RoomManager",{RoomManager:function(e){A=e}},13),t.link("../../../lib/rooms/roomCoordinator",{roomCoordinator:function(e){U=e}},14),t.link("../../../lib/utils/setMessageJumpQueryStringParameter",{setMessageJumpQueryStringParameter:function(e){B=e}},15),t.link("../Announcement",{default:function(e){O=e}},16),t.link("../MessageList/MessageList",{MessageList:function(e){D=e}},17),t.link("../MessageList/MessageListErrorBoundary",{default:function(e){H=e}},18),t.link("../composer/ComposerContainer",{default:function(e){I=e}},19),t.link("../composer/RoomComposer/RoomComposer",{default:function(e){j=e}},20),t.link("../contexts/ChatContext",{useChat:function(e){G=e}},21),t.link("../contexts/RoomContext",{useRoom:function(e){J=e},useRoomSubscription:function(e){q=e},useRoomMessages:function(e){Q=e}},22),t.link("../contexts/RoomToolboxContext",{useRoomToolbox:function(e){W=e}},23),t.link("../hooks/useScrollMessageList",{useScrollMessageList:function(e){$=e}},24),t.link("./DropTargetOverlay",{default:function(e){z=e}},25),t.link("./JumpToRecentMessageButton",{default:function(e){Y=e}},26),t.link("./LeaderBar",{default:function(e){K=e}},27),t.link("./LoadingMessagesIndicator",{default:function(e){X=e}},28),t.link("./RetentionPolicyWarning",{default:function(e){V=e}},29),t.link("./RoomForeword/RoomForeword",{default:function(e){Z=e}},30),t.link("./UnreadMessagesIndicator",{default:function(e){ee=e}},31),t.link("./UploadProgressIndicator",{default:function(e){en=e}},32),t.link("./hooks/useFileUploadDropTarget",{useFileUploadDropTarget:function(e){et=e}},33),t.link("./hooks/useGoToHomeOnRemoved",{useGoToHomeOnRemoved:function(e){eo=e}},34),t.link("./hooks/useReadMessageWindowEvents",{useReadMessageWindowEvents:function(e){ei=e}},35),t.link("./hooks/useRestoreScrollPosition",{useRestoreScrollPosition:function(e){er=e}},36),t.link("./hooks/useRetentionPolicy",{useRetentionPolicy:function(e){ea=e}},37),t.link("./hooks/useUnreadMessages",{useUnreadMessages:function(e){es=e}},38),t.exportDefault(p(function(){var e=m(),n=F(),t=J(),p=f(),el=W(),eu=l("admin"),ec=q(),ed=r(_(),2),em=ed[0],ef=ed[1],eg=r(_(!1),2),ev=eg[0],ep=eg[1],ek=r(_(!1),2),eE=ek[0],eh=ek[1],eM=g("hideFlexTab")||void 0,e_=g("hideUsernames"),eb=g("displayAvatars"),eR=M(null),ew=M(null),eL=M(!0),eC=M(0),ey=G();if(!ey)throw Error("No ChatContext provided");var eT=r(et(),2),ex=eT[0],eN=eT[1],eS=k(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=eR.current;return!!n&&!!C(n,e)&&(eh(!1),!0)},[]),eF=$(eR),eP=k(function(){eF(function(e){return{left:30,top:null==e?void 0:e.scrollHeight}}),eh(!1)},[eF]),eA=k(function(){!0===eL.current&&eP()},[eP]),eU=k(function(){eL.current=eS(100)},[eS]),eB=k(function(){var e;eL.current=!0,eA(),null===(e=ey.composer)||void 0===e||e.focus()},[ey,eA]),eO=k(function(){eL.current=!0,L.clear(t._id),L.getMoreIfIsEmpty(t._id)},[t._id]),eD=r(es(t),2),eH=eD[0],eI=eD[1],ej=b(ey.uploads.subscribe,ey.uploads.get),eG=Q(),eJ=eG.hasMorePreviousMessages,eq=eG.hasMoreNextMessages,eQ=eG.isLoadingMoreMessages,eW=d("Accounts_AllowAnonymousRead"),e$=s("preview-c-room"),ez=!!ec,eY=h(function(){return!!t&&"c"!==t.t||!0===eW||!!e$||ez},[eW,e$,t,ez]),eK=d("UI_Use_Real_Name"),eX=P(["rooms",t._id,"leader",{not:null==p?void 0:p._id}],function(){var e=w.findOne({rid:t._id,roles:"leader","u._id":{$ne:null==p?void 0:p._id}});return e?i(i({},e.u),{},{name:eK&&e.u.name||e.u.username}):null}).data,eV=k(function(e,n){n&&(null==ey||ey.userCard.open(n)(e))},[null==ey?void 0:ey.userCard]),eZ=k(function(){var e,n=t._id,o=L.getRoom(n).firstUnread,i=null==o?void 0:o.get();i||(i=R.findOne({rid:n,ts:{$gt:null==eH?void 0:eH.since}},{sort:{ts:1},limit:1})),i&&(B(null===(e=i)||void 0===e?void 0:e._id),eI(0))},[t._id,null==eH?void 0:eH.since,eI]),e0=k(function(){ey.readStateManager.markAsRead(),eI(0)},[ey.readStateManager,eI]),e1=k(function(e){ey.uploads.cancel(e)},[ey]),e2=ea(t);eo(t,null==p?void 0:p._id),E(function(){return y.add("streamNewMessage",function(e){if(!(t._id!==e.rid||a(e))&&!e.tmid){if(e.u._id===(null==p?void 0:p._id)){eP();return}eS()||eh(!0)}},y.priority.MEDIUM,t._id),function(){y.remove("streamNewMessage",t._id)}},[eS,t._id,eP,null==p?void 0:p._id]),E(function(){var e,n=null===(e=eR.current)||void 0===e?void 0:e.querySelector("ul");if(n){var t=new ResizeObserver(function(){eA()});return t.observe(n),function(){null==t||t.disconnect()}}},[eA]);var e3=u(),e5=h(function(){return x({wait:500})(function(){ey.readStateManager.attemptMarkAsRead()})},[ey.readStateManager]);E(function(){return e3.subscribeToRouteChange(function(){var e=e3.getRouteName();e&&U.isRouteNameKnown(e)&&e5()})},[e5,t._id,e3,ez,null==ec?void 0:ec.alert,null==ec?void 0:ec.unread]),E(function(){if(!ez){eI(0);return}eI(R.find({rid:t._id,ts:{$lte:em,$gt:null==ec?void 0:ec.ls}}).count())},[em,t._id,eI,ez,null==ec?void 0:ec.ls]),E(function(){if(!(null!=eH&&eH.count))return e5()},[e5,t._id,null==eH?void 0:eH.count]),E(function(){var e=eR.current;if(e){var n=function(){var e,n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=ew.current;if(o){var i=o.getBoundingClientRect().left+window.pageXOffset,r=o.getBoundingClientRect().top+window.pageYOffset,a=parseFloat(getComputedStyle(o).width);if(null!==(e=n="rtl"===document.dir?document.elementFromPoint(i+a-1,r+t+1):document.elementFromPoint(i+1,r+t+1))&&void 0!==e&&e.classList.contains("rcx-message")||null!=n&&n.classList.contains("rcx-message--sequential"))return n}},o=N({wait:300})(function(){Tracker.afterFlush(function(){var e=n(0)||n(20)||n(40);if(!e){eI(0);return}var t=R.findOne(e.id);if(!t){eI(0);return}ef(t.ts)})}),i=N({wait:100})(function(e){var n,o=null===(n=ew.current)||void 0===n?void 0:n.querySelector(".room-leader");o&&(e.target.scrollTop<eC.current?ep(!1):!1===eS(100)&&e.target.scrollTop>parseFloat(getComputedStyle(o).height)&&ep(!0)),eC.current=e.target.scrollTop;var i=e.target.clientHeight,r=L.isLoading(t._id),a=L.hasMore(t._id),s=L.hasMoreNext(t._id);(!1===r&&!0===a||!0===s)&&(!0===a&&eC.current<=i/3?L.getMore(t._id):!0===s&&Math.ceil(eC.current)>=e.target.scrollHeight-i&&L.getMoreNext(t._id,eL))});return e.addEventListener("scroll",o),e.addEventListener("scroll",i),function(){e.removeEventListener("scroll",o),e.removeEventListener("scroll",i)}}},[eS,t._id,eI]),E(function(){var e=eR.current;if(e){var n=A.getStore(t._id),o=N({wait:30})(function(){null==n||n.update({scroll:e.scrollTop,atBottom:C(e,50)})}),i=function(){null!=n&&n.scroll&&!n.atBottom?e.scrollTop=n.scroll:eP(),e.removeEventListener("MessageGroup",i)};return e.addEventListener("scroll",o),e.addEventListener("MessageGroup",i),function(){e.removeEventListener("MessageGroup",i),e.removeEventListener("scroll",o)}}},[t._id,eP]),er(t._id,eF,eP),E(function(){var e,n,t=eR.current;if(t){var o=N({wait:100})(function(){eU()}),i=function(){eL.current=!1},r=function(){eU(),e=setTimeout(function(){return eU()},1e3),n=setTimeout(function(){return eU()},2e3)};return t.addEventListener("scroll",o),function(){e&&clearTimeout(e),n&&clearTimeout(n),t.removeEventListener("mousewheel",o),t.removeEventListener("wheel",o),t.removeEventListener("scroll",o),t.removeEventListener("touchstart",i),t.removeEventListener("touchend",r)}}},[eU]);var e4=k(function(){eA()},[eA]),e6=k(function(){ey.messageEditing.toPreviousMessage()},[ey.messageEditing]),e7=k(function(){ey.messageEditing.toNextMessage()},[ey.messageEditing]),e8=k(function(e){ey.flows.uploadFiles(e)},[ey]),e9=c("reply");E(function(){e9&&ey.data.getMessageByID(e9).then(function(e){var n;e&&(null===(n=ey.composer)||void 0===n||n.quoteMessage(e))})},[ey.data,ey.composer,e9]),E(function(){ey.uploads.wipeFailedOnes()},[ey]);var ne=k(function(e){var n=function(e){return!!e&&(!!(e instanceof HTMLButtonElement||"button"===e.getAttribute("role")||e instanceof HTMLAnchorElement||"link"===e.getAttribute("role"))||n(e.parentElement))};n(e.target)||el.closeTab()},[el]);return ei(),v.createElement(v.Fragment,null,!n&&t.announcement&&v.createElement(O,{announcement:t.announcement,announcementDetails:void 0}),v.createElement("div",{className:"main-content-flex"},v.createElement("section",{className:"messages-container flex-tab-main-content "+(eu?"admin":""),id:"chat-window-"+t._id,"aria-label":e("Channel"),onClick:eM&&ne},v.createElement("div",{className:"messages-container-wrapper"},v.createElement("div",o({className:"messages-container-main"},ex),v.createElement(z,eN),v.createElement("div",{className:["container-bars",(eH||ej.length)&&"show"].filter(T).join(" ")},eH&&v.createElement(ee,{count:eH.count,since:eH.since,onJumpButtonClick:eZ,onMarkAsReadButtonClick:e0}),ej.map(function(e){return v.createElement(en,{key:e.id,id:e.id,name:e.name,percentage:e.percentage,error:e.error instanceof Error?e.error.message:void 0,onClose:e1})})),v.createElement("div",{ref:ew,className:["messages-box",eX&&!ev&&"has-leader"].filter(T).join(" ")},v.createElement(Y,{visible:eE,onClick:eB,text:e("New_messages")}),v.createElement(Y,{visible:eq,onClick:eO,text:e("Jump_to_recent_messages")}),eY?null:v.createElement("div",{className:"content room-not-found error-color"},v.createElement("div",null,e("You_must_join_to_view_messages_in_this_channel"))),eX?v.createElement(K,{_id:eX._id,username:eX.username,name:eX.name,visible:!ev,onAvatarClick:eV}):null,v.createElement("div",{className:["wrapper",eq&&"has-more-next",e_&&"hide-usernames",!eb&&"hide-avatar"].filter(T).join(" ")},v.createElement(H,null,v.createElement(S,{ref:eR},v.createElement("ul",{className:"messages-list","aria-live":"polite","aria-busy":eQ},eY?v.createElement(v.Fragment,null,eJ?v.createElement("li",{className:"load-more"},eQ?v.createElement(X,null):null):v.createElement("li",{className:"start color-info-font-color"},e2?v.createElement(V,e2):null,v.createElement(Z,{user:p,room:t}))):null,v.createElement(D,{rid:t._id,scrollMessageList:eF}),eq?v.createElement("li",{className:"load-more"},eQ?v.createElement(X,null):null):null))))),v.createElement(j,null,v.createElement(I,{subscription:ec,onResize:e4,onNavigateToPreviousMessage:e6,onNavigateToNextMessage:e7,onUploadFiles:e8})))))))}))}
//# sourceMappingURL=/dynamic/client/views/room/body/a6fc8913a678b0444a923614d69f96530365194d.map
