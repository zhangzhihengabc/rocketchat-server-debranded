)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/body/hooks/useFileUploadDropTarget.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetting, useTranslation, useUser } from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport type React from 'react';\nimport { useCallback, useMemo } from 'react';\n\nimport { useIsRoomOverMacLimit } from '../../../../hooks/omnichannel/useIsRoomOverMacLimit';\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\nimport { roomCoordinator } from '../../../../lib/rooms/roomCoordinator';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom } from '../../contexts/RoomContext';\nimport { useDropTarget } from './useDropTarget';\n\nexport const useFileUploadDropTarget = (): readonly [\n\tfileUploadTriggerProps: {\n\t\tonDragEnter: (event: React.DragEvent<Element>) => void;\n\t},\n\tfileUploadOverlayProps: {\n\t\tvisible: boolean;\n\t\tonDismiss: () => void;\n\t\tenabled: boolean;\n\t\treason?: ReactNode;\n\t},\n] => {\n\tconst room = useRoom();\n\tconst { triggerProps, overlayProps } = useDropTarget();\n\n\tconst isRoomOverMacLimit = useIsRoomOverMacLimit(room);\n\n\tconst t = useTranslation();\n\n\tconst fileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\n\tconst user = useUser();\n\tconst fileUploadAllowedForUser = useReactiveValue(\n\t\tuseCallback(() => !roomCoordinator.readOnly(room._id, { username: user?.username }), [room._id, user?.username]),\n\t);\n\n\tconst chat = useChat();\n\n\tconst onFileDrop = useMutableCallback(async (files: File[]) => {\n\t\tconst { mime } = await import('../../../../../app/utils/lib/mimeTypes');\n\n\t\tconst uploads = Array.from(files).map((file) => {\n\t\t\tObject.defineProperty(file, 'type', { value: mime.lookup(file.name) });\n\t\t\treturn file;\n\t\t});\n\n\t\tchat?.flows.uploadFiles(uploads);\n\t});\n\n\tconst allOverlayProps = useMemo(() => {\n\t\tif (!fileUploadEnabled || isRoomOverMacLimit) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\treason: t('FileUpload_Disabled'),\n\t\t\t\t...overlayProps,\n\t\t\t} as const;\n\t\t}\n\n\t\tif (!fileUploadAllowedForUser) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\treason: t('error-not-allowed'),\n\t\t\t\t...overlayProps,\n\t\t\t} as const;\n\t\t}\n\n\t\treturn {\n\t\t\tenabled: true,\n\t\t\tonFileDrop,\n\t\t\t...overlayProps,\n\t\t} as const;\n\t}, [fileUploadAllowedForUser, fileUploadEnabled, isRoomOverMacLimit, onFileDrop, overlayProps, t]);\n\n\treturn [triggerProps, allOverlayProps] as const;\n};\n",null],"names":["module","default","_objectSpread","_regeneratorRuntime","export","useFileUploadDropTarget","useMutableCallback","useSetting","useTranslation","useUser","useCallback","useMemo","useIsRoomOverMacLimit","useReactiveValue","roomCoordinator","useChat","useRoom","useDropTarget","room","_useDropTarget","triggerProps","overlayProps","isRoomOverMacLimit","t","fileUploadEnabled","user","fileUploadAllowedForUser","readOnly","_id","username","chat","onFileDrop","files","mime","uploads","async","_context","prev","next","awrap","dynamicImport","_await$module$dynamic","sent","Array","from","map","file","Object","defineProperty","value","lookup","name","flows","uploadFiles","stop","Promise","enabled","reason"],"mappings":"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"}