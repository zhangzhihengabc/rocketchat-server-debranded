)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/body/hooks/useRetentionPolicy.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IRoomWithRetentionPolicy } from '@rocket.chat/core-typings';\nimport { useSetting } from '@rocket.chat/ui-contexts';\n\nconst hasRetentionPolicy = (room: IRoom & { retention?: any }): room is IRoomWithRetentionPolicy =>\n\t'retention' in room && room.retention !== undefined;\n\ntype RetentionPolicySettings = {\n\tenabled: boolean;\n\tfilesOnly: boolean;\n\tdoNotPrunePinned: boolean;\n\tappliesToChannels: boolean;\n\tmaxAgeChannels: number;\n\tappliesToGroups: boolean;\n\tmaxAgeGroups: number;\n\tappliesToDMs: boolean;\n\tmaxAgeDMs: number;\n};\n\nconst isActive = (room: IRoom, { enabled, appliesToChannels, appliesToGroups, appliesToDMs }: RetentionPolicySettings): boolean => {\n\tif (!enabled) {\n\t\treturn false;\n\t}\n\n\tif (hasRetentionPolicy(room) && room.retention.enabled !== undefined) {\n\t\treturn room.retention.enabled;\n\t}\n\n\tswitch (room.t) {\n\t\tcase 'c':\n\t\t\treturn appliesToChannels;\n\t\tcase 'p':\n\t\t\treturn appliesToGroups;\n\t\tcase 'd':\n\t\t\treturn appliesToDMs;\n\t}\n\n\treturn false;\n};\n\nconst extractFilesOnly = (room: IRoom, { filesOnly }: RetentionPolicySettings): boolean => {\n\tif (hasRetentionPolicy(room) && room.retention.overrideGlobal) {\n\t\treturn room.retention.filesOnly;\n\t}\n\n\treturn filesOnly;\n};\n\nconst extractExcludePinned = (room: IRoom, { doNotPrunePinned }: RetentionPolicySettings): boolean => {\n\tif (hasRetentionPolicy(room) && room.retention.overrideGlobal) {\n\t\treturn room.retention.excludePinned;\n\t}\n\n\treturn doNotPrunePinned;\n};\n\nconst getMaxAge = (room: IRoom, { maxAgeChannels, maxAgeGroups, maxAgeDMs }: RetentionPolicySettings): number => {\n\tif (hasRetentionPolicy(room) && room.retention.overrideGlobal) {\n\t\treturn room.retention.maxAge;\n\t}\n\n\tif (room.t === 'c') {\n\t\treturn maxAgeChannels;\n\t}\n\tif (room.t === 'p') {\n\t\treturn maxAgeGroups;\n\t}\n\tif (room.t === 'd') {\n\t\treturn maxAgeDMs;\n\t}\n\n\treturn -Infinity;\n};\n\nexport const useRetentionPolicy = (\n\troom: IRoom | undefined,\n):\n\t| {\n\t\t\tfilesOnly: boolean;\n\t\t\texcludePinned: boolean;\n\t\t\tmaxAge: number;\n\t  }\n\t| undefined => {\n\tconst settings = {\n\t\tenabled: useSetting('RetentionPolicy_Enabled') as boolean,\n\t\tfilesOnly: useSetting('RetentionPolicy_FilesOnly') as boolean,\n\t\tdoNotPrunePinned: useSetting('RetentionPolicy_DoNotPrunePinned') as boolean,\n\t\tappliesToChannels: useSetting('RetentionPolicy_AppliesToChannels') as boolean,\n\t\tmaxAgeChannels: useSetting('RetentionPolicy_MaxAge_Channels') as number,\n\t\tappliesToGroups: useSetting('RetentionPolicy_AppliesToGroups') as boolean,\n\t\tmaxAgeGroups: useSetting('RetentionPolicy_MaxAge_Groups') as number,\n\t\tappliesToDMs: useSetting('RetentionPolicy_AppliesToDMs') as boolean,\n\t\tmaxAgeDMs: useSetting('RetentionPolicy_MaxAge_DMs') as number,\n\t} as const;\n\n\tif (!room || !isActive(room, settings)) {\n\t\treturn undefined;\n\t}\n\n\treturn {\n\t\tfilesOnly: extractFilesOnly(room, settings),\n\t\texcludePinned: extractExcludePinned(room, settings),\n\t\tmaxAge: getMaxAge(room, settings) * 24 * 60 * 60 * 1000,\n\t};\n};\n",null],"names":["module","export","useRetentionPolicy","useSetting","hasRetentionPolicy","room","undefined","retention","isActive","_ref","enabled","appliesToChannels","appliesToGroups","appliesToDMs","t","extractFilesOnly","_ref2","filesOnly","overrideGlobal","extractExcludePinned","_ref3","doNotPrunePinned","excludePinned","getMaxAge","_ref4","maxAgeChannels","maxAgeGroups","maxAgeDMs","maxAge","Infinity","settings"],"mappings":"uBACAA,EAAOC,MAAE,CAAA,CAAAC,mBAAkB,WAAA,OAAAA,CAA2B,CAAA,GAAAF,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAG,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAEtD,IAFsDA,EAEhDC,EAAqB,SAACC,CAAiC,EAAA,MAC5D,cAAeA,GAAQA,AAAmBC,KAAAA,IAAnBD,EAAKE,SAAS,AAAc,EAc9CC,EAAW,SAACH,CAAW,CAAAI,CAAA,EAAqG,IAAjGC,EAAOD,EAAPC,OAAO,CAAEC,EAAiBF,EAAjBE,iBAAiB,CAAEC,EAAeH,EAAfG,eAAe,CAAEC,EAAYJ,EAAZI,YAAY,CACzF,GAAI,CAACH,EACJ,MAAO,CAAA,EAGR,GAAIN,EAAmBC,IAASA,AAA2BC,KAAAA,IAA3BD,EAAKE,SAAS,CAACG,OAAO,CACrD,OAAOL,EAAKE,SAAS,CAACG,OAAO,CAG9B,OAAQL,EAAKS,CAAC,EACb,IAAK,IACJ,OAAOH,CACR,KAAK,IACJ,OAAOC,CACR,KAAK,IACJ,OAAOC,CAAa,CAGtB,MAAO,CAAA,CACR,EAEME,EAAmB,SAACV,CAAW,CAAAW,CAAA,EAAqD,IAAjDC,EAASD,EAATC,SAAS,QACjD,AAAIb,EAAmBC,IAASA,EAAKE,SAAS,CAACW,cAAc,CACrDb,EAAKE,SAAS,CAACU,SAAS,CAGzBA,CACR,EAEME,EAAuB,SAACd,CAAW,CAAAe,CAAA,EAA4D,IAAxDC,EAAgBD,EAAhBC,gBAAgB,QAC5D,AAAIjB,EAAmBC,IAASA,EAAKE,SAAS,CAACW,cAAc,CACrDb,EAAKE,SAAS,CAACe,aAAa,CAG7BD,CACR,EAEME,EAAY,SAAClB,CAAW,CAAAmB,CAAA,EAAkF,IAA9EC,EAAcD,EAAdC,cAAc,CAAEC,EAAYF,EAAZE,YAAY,CAAEC,EAASH,EAATG,SAAS,QACxE,AAAIvB,EAAmBC,IAASA,EAAKE,SAAS,CAACW,cAAc,CACrDb,EAAKE,SAAS,CAACqB,MAAM,CAGzBvB,AAAW,MAAXA,EAAKS,CAAC,CACFW,EAEJpB,AAAW,MAAXA,EAAKS,CAAC,CACFY,EAEJrB,AAAW,MAAXA,EAAKS,CAAC,CACFa,EAGD,CAACE,GACT,EAEa3B,EAAqB,SACjCG,CAAuB,EAQvB,IAAMyB,EAAW,CAChBpB,QAASP,EAAW,2BACpBc,UAAWd,EAAW,6BACtBkB,iBAAkBlB,EAAW,oCAC7BQ,kBAAmBR,EAAW,qCAC9BsB,eAAgBtB,EAAW,mCAC3BS,gBAAiBT,EAAW,mCAC5BuB,aAAcvB,EAAW,iCACzBU,aAAcV,EAAW,gCACzBwB,UAAWxB,EAAW,+BAGvB,GAAI,AAACE,GAASG,EAASH,EAAMyB,GAI7B,MAAO,CACNb,UAAWF,EAAiBV,EAAMyB,GAClCR,cAAeH,EAAqBd,EAAMyB,GAC1CF,OAAQL,MAAAA,EAAUlB,EAAMyB,GAE1B"}