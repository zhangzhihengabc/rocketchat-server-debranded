)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/hooks/useUserInfoActions/actions/useMuteUserAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport {\n\tuseAllPermissions,\n\tusePermission,\n\tuseSetModal,\n\tuseMethod,\n\tuseToastMessageDispatch,\n\tuseTranslation,\n\tuseUserRoom,\n\tuseUserSubscription,\n} from '@rocket.chat/ui-contexts';\nimport React, { useMemo } from 'react';\n\nimport GenericModal from '../../../../../components/GenericModal';\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\n\nconst getUserIsMuted = (\n\tuser: Pick<IUser, '_id' | 'username'>,\n\troom: IRoom | undefined,\n\tuserCanPostReadonly: boolean,\n): boolean | undefined => {\n\tif (room?.ro) {\n\t\tif (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username ?? '') !== -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (userCanPostReadonly) {\n\t\t\treturn Array.isArray(room.muted) && room.muted.indexOf(user.username ?? '') !== -1;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\treturn room && Array.isArray(room.muted) && room.muted.indexOf(user.username ?? '') > -1;\n};\n\nexport const useMuteUserAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\n\tconst t = useTranslation();\n\tconst room = useUserRoom(rid);\n\tconst userCanMute = usePermission('mute-user', rid);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\tconst closeModal = useMutableCallback(() => setModal(null));\n\tconst otherUserCanPostReadonly = useAllPermissions(\n\t\tuseMemo(() => ['post-readonly'], []),\n\t\trid,\n\t);\n\tconst userSubscription = useUserSubscription(rid);\n\n\tconst isMuted = getUserIsMuted(user, room, otherUserCanPostReadonly);\n\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\n\n\tif (!room) {\n\t\tthrow Error('Room not provided');\n\t}\n\n\tconst { roomCanMute } = getRoomDirectives({ room, showingUserId: user._id, userSubscription });\n\n\tconst mutedMessage = isMuted ? 'User__username__unmuted_in_room__roomName__' : 'User__username__muted_in_room__roomName__';\n\n\tconst muteUser = useMethod(isMuted ? 'unmuteUserInRoom' : 'muteUserInRoom');\n\n\tconst muteUserOption = useMemo(() => {\n\t\tconst action = (): Promise<void> | void => {\n\t\t\tconst onConfirm = async (): Promise<void> => {\n\t\t\t\ttry {\n\t\t\t\t\tif (!user.username) {\n\t\t\t\t\t\tthrow new Error('User without username');\n\t\t\t\t\t}\n\n\t\t\t\t\tawait muteUser({ rid, username: user.username });\n\n\t\t\t\t\treturn dispatchToastMessage({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tmessage: t(mutedMessage, {\n\t\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\t\troomName,\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\t\t\t\t} catch (error: unknown) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t} finally {\n\t\t\t\t\tcloseModal();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (isMuted) {\n\t\t\t\treturn onConfirm();\n\t\t\t}\n\n\t\t\treturn setModal(\n\t\t\t\t<GenericModal variant='danger' confirmText={t('Yes_mute_user')} onClose={closeModal} onCancel={closeModal} onConfirm={onConfirm}>\n\t\t\t\t\t{t('The_user_wont_be_able_to_type_in_s', roomName)}\n\t\t\t\t</GenericModal>,\n\t\t\t);\n\t\t};\n\n\t\treturn roomCanMute && userCanMute\n\t\t\t? {\n\t\t\t\t\tcontent: t(isMuted ? 'Unmute_user' : 'Mute_user'),\n\t\t\t\t\ticon: isMuted ? ('mic' as const) : ('mic-off' as const),\n\t\t\t\t\tonClick: action,\n\t\t\t\t\ttype: 'management' as UserInfoActionType,\n\t\t\t  }\n\t\t\t: undefined;\n\t}, [\n\t\tcloseModal,\n\t\tmutedMessage,\n\t\tdispatchToastMessage,\n\t\tisMuted,\n\t\tmuteUser,\n\t\trid,\n\t\troomCanMute,\n\t\troomName,\n\t\tsetModal,\n\t\tt,\n\t\tuser.username,\n\t\tuserCanMute,\n\t]);\n\n\treturn muteUserOption;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","export","useMuteUserAction","useMutableCallback","escapeHTML","useAllPermissions","usePermission","useSetModal","useMethod","useToastMessageDispatch","useTranslation","useUserRoom","useUserSubscription","v","React","useMemo","GenericModal","roomCoordinator","getRoomDirectives","getUserIsMuted","user","room","userCanPostReadonly","_user$username3","_user$username","_user$username2","ro","Array","isArray","unmuted","indexOf","username","muted","rid","t","userCanMute","dispatchToastMessage","setModal","closeModal","otherUserCanPostReadonly","userSubscription","isMuted","roomName","getRoomName","Error","roomCanMute","_getRoomDirectives","showingUserId","_id","mutedMessage","muteUser","content","icon","onClick","onConfirm","async","_context","prev","next","awrap","abrupt","type","message","t0","finish","stop","Promise","createElement","variant","confirmText","onClose","onCancel","undefined"],"mappings":"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"}