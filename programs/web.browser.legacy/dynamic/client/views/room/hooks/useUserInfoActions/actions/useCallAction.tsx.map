)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/hooks/useUserInfoActions/actions/useCallAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useTranslation, useUserRoom, useUserId, useUserSubscriptionByName } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\n\nimport { closeUserCard } from '../../../../../../app/ui/client/lib/userCard';\nimport { useVideoConfDispatchOutgoing, useVideoConfIsCalling, useVideoConfIsRinging } from '../../../../../contexts/VideoConfContext';\nimport { VideoConfManager } from '../../../../../lib/VideoConfManager';\nimport { useVideoConfWarning } from '../../../contextualBar/VideoConference/hooks/useVideoConfWarning';\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\n\nexport const useCallAction = (user: Pick<IUser, '_id' | 'username'>): UserInfoAction | undefined => {\n\tconst t = useTranslation();\n\tconst usernameSubscription = useUserSubscriptionByName(user.username ?? '');\n\tconst room = useUserRoom(usernameSubscription?.rid || '');\n\n\tconst dispatchWarning = useVideoConfWarning();\n\tconst dispatchPopup = useVideoConfDispatchOutgoing();\n\tconst isCalling = useVideoConfIsCalling();\n\tconst isRinging = useVideoConfIsRinging();\n\tconst ownUserId = useUserId();\n\n\tconst videoCallOption = useMemo(() => {\n\t\tconst action = async (): Promise<void> => {\n\t\t\tif (isCalling || isRinging || !room) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait VideoConfManager.loadCapabilities();\n\t\t\t\tcloseUserCard();\n\t\t\t\tdispatchPopup({ rid: room._id });\n\t\t\t} catch (error: any) {\n\t\t\t\tdispatchWarning(error.error);\n\t\t\t}\n\t\t};\n\n\t\treturn room && !isRoomFederated(room) && user._id !== ownUserId\n\t\t\t? {\n\t\t\t\t\tcontent: t('Start_call'),\n\t\t\t\t\ticon: 'phone' as const,\n\t\t\t\t\tonClick: action,\n\t\t\t\t\ttype: 'communication' as UserInfoActionType,\n\t\t\t  }\n\t\t\t: undefined;\n\t}, [t, room, dispatchPopup, dispatchWarning, isCalling, isRinging, ownUserId, user._id]);\n\n\treturn videoCallOption;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","export","useCallAction","isRoomFederated","useTranslation","useUserRoom","useUserId","useUserSubscriptionByName","useMemo","closeUserCard","useVideoConfDispatchOutgoing","useVideoConfIsCalling","useVideoConfIsRinging","VideoConfManager","useVideoConfWarning","user","_user$username","t","usernameSubscription","username","room","rid","dispatchWarning","dispatchPopup","isCalling","isRinging","ownUserId","_id","content","icon","onClick","async","_context","prev","next","abrupt","awrap","loadCapabilities","t0","error","stop","Promise","type","undefined"],"mappings":"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"}