)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/hooks/useUserInfoActions/actions/useChangeOwnerAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription, useSetModal, useUser } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useMemo } from 'react';\n\nimport GenericModal from '../../../../../components/GenericModal';\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\n\nconst getWarningModalForFederatedRooms = (\n\tcloseModalFn: () => void,\n\thandleConfirmFn: () => void,\n\ttitle: string,\n\tconfirmText: string,\n\tbodyText: string,\n): ReactElement => (\n\t<GenericModal\n\t\tvariant='warning'\n\t\tonClose={closeModalFn}\n\t\tonConfirm={handleConfirmFn}\n\t\tonCancel={closeModalFn}\n\t\ttitle={title}\n\t\tconfirmText={confirmText}\n\t>\n\t\t{bodyText}\n\t</GenericModal>\n);\n\n// TODO: Remove endpoint concatenation\nexport const useChangeOwnerAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\n\tconst t = useTranslation();\n\tconst room = useUserRoom(rid);\n\tconst { _id: uid } = user;\n\tconst userCanSetOwner = usePermission('set-owner', rid);\n\tconst isOwner = useUserHasRoomRole(uid, rid, 'owner');\n\tconst userSubscription = useUserSubscription(rid);\n\tconst setModal = useSetModal();\n\tconst { _id: loggedUserId = '' } = useUser() || {};\n\tconst loggedUserIsOwner = useUserHasRoomRole(loggedUserId, rid, 'owner');\n\tconst closeModal = useCallback(() => setModal(null), [setModal]);\n\n\tif (!room) {\n\t\tthrow Error('Room not provided');\n\t}\n\n\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\n\tconst { roomCanSetOwner } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\n\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\n\n\tconst changeOwnerEndpoint = isOwner ? 'removeOwner' : 'addOwner';\n\tconst changeOwnerMessage = isOwner ? 'User__username__removed_from__room_name__owners' : 'User__username__is_now_an_owner_of__room_name_';\n\n\tconst changeOwner = useEndpointAction('POST', `${endpointPrefix}.${changeOwnerEndpoint}` as const, {\n\t\tsuccessMessage: t(changeOwnerMessage, { username: user.username, room_name: roomName }),\n\t});\n\n\tconst handleConfirm = useCallback(() => {\n\t\tchangeOwner({ roomId: rid, userId: uid });\n\t\tcloseModal();\n\t}, [changeOwner, rid, uid, closeModal]);\n\n\tconst handleChangeOwner = useCallback(\n\t\t({ userId }) => {\n\t\t\tif (!isRoomFederated(room)) {\n\t\t\t\treturn changeOwner({ roomId: rid, userId: uid });\n\t\t\t}\n\t\t\tconst changingOwnRole = userId === loggedUserId;\n\n\t\t\tif (changingOwnRole && loggedUserIsOwner) {\n\t\t\t\treturn setModal(() =>\n\t\t\t\t\tgetWarningModalForFederatedRooms(\n\t\t\t\t\t\tcloseModal,\n\t\t\t\t\t\thandleConfirm,\n\t\t\t\t\t\tt('Federation_Matrix_losing_privileges'),\n\t\t\t\t\t\tt('Yes_continue'),\n\t\t\t\t\t\tt('Federation_Matrix_losing_privileges_warning'),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!changingOwnRole && loggedUserIsOwner) {\n\t\t\t\treturn setModal(() =>\n\t\t\t\t\tgetWarningModalForFederatedRooms(\n\t\t\t\t\t\tcloseModal,\n\t\t\t\t\t\thandleConfirm,\n\t\t\t\t\t\tt('Warning'),\n\t\t\t\t\t\tt('Yes_continue'),\n\t\t\t\t\t\tt('Federation_Matrix_giving_same_permission_warning'),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tchangeOwner({ roomId: rid, userId: uid });\n\t\t},\n\t\t[setModal, loggedUserId, loggedUserIsOwner, t, rid, uid, changeOwner, closeModal, handleConfirm, room],\n\t);\n\n\tconst changeOwnerAction = useMutableCallback(async () => handleChangeOwner({ roomId: rid, userId: uid }));\n\tconst changeOwnerOption = useMemo(\n\t\t() =>\n\t\t\t(isRoomFederated(room) && roomCanSetOwner) || (!isRoomFederated(room) && roomCanSetOwner && userCanSetOwner)\n\t\t\t\t? {\n\t\t\t\t\t\tcontent: t(isOwner ? 'Remove_as_owner' : 'Set_as_owner'),\n\t\t\t\t\t\ticon: 'shield-check' as const,\n\t\t\t\t\t\tonClick: changeOwnerAction,\n\t\t\t\t\t\ttype: 'privileges' as UserInfoActionType,\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\t[changeOwnerAction, roomCanSetOwner, userCanSetOwner, isOwner, t, room],\n\t);\n\n\treturn changeOwnerOption;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","export","useChangeOwnerAction","isRoomFederated","useMutableCallback","escapeHTML","useTranslation","usePermission","useUserRoom","useUserSubscription","useSetModal","useUser","v","React","useCallback","useMemo","GenericModal","useEndpointAction","roomCoordinator","getRoomDirectives","useUserHasRoomRole","getWarningModalForFederatedRooms","closeModalFn","handleConfirmFn","title","confirmText","bodyText","createElement","variant","onClose","onConfirm","onCancel","user","rid","t","room","uid","_id","userCanSetOwner","isOwner","userSubscription","setModal","_ref$_id","_ref","loggedUserId","loggedUserIsOwner","closeModal","Error","endpointPrefix","roomCanSetOwner","_getRoomDirectives","showingUserId","roomName","getRoomName","changeOwner","successMessage","username","room_name","handleConfirm","roomId","userId","handleChangeOwner","_ref2","changingOwnRole","changeOwnerAction","async","_context","prev","next","abrupt","stop","Promise","content","icon","onClick","type","undefined"],"mappings":"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"}