)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/hooks/useUserInfoActions/actions/useRemoveUserAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { usePermission, useSetModal, useTranslation, useUser, useUserRoom, useUserSubscription } from '@rocket.chat/ui-contexts';\nimport React, { useMemo } from 'react';\n\nimport GenericModal from '../../../../../components/GenericModal';\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\nimport * as Federation from '../../../../../lib/federation/Federation';\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\nimport RemoveUsersModal from '../../../../teams/contextualBar/members/RemoveUsersModal';\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\nimport type { UserInfoAction } from '../useUserInfoActions';\n\n// TODO: Remove endpoint concatenation\nexport const useRemoveUserAction = (\n\tuser: Pick<IUser, '_id' | 'username'>,\n\trid: IRoom['_id'],\n\treload?: () => void,\n): UserInfoAction | undefined => {\n\tconst t = useTranslation();\n\tconst room = useUserRoom(rid);\n\tconst currentUser = useUser();\n\tconst subscription = useUserSubscription(rid);\n\n\tconst { _id: uid } = user;\n\n\tif (!room) {\n\t\tthrow Error('Room not provided');\n\t}\n\n\tconst hasPermissionToRemove = usePermission('remove-user', rid);\n\tconst userCanRemove = isRoomFederated(room)\n\t\t? Federation.isEditableByTheUser(currentUser || undefined, room, subscription)\n\t\t: hasPermissionToRemove;\n\tconst setModal = useSetModal();\n\tconst closeModal = useMutableCallback(() => setModal(null));\n\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\n\n\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\n\tconst { roomCanRemove } = getRoomDirectives({ room, showingUserId: uid, userSubscription: subscription });\n\n\tconst removeFromTeam = useEndpointAction('POST', '/v1/teams.removeMember', {\n\t\tsuccessMessage: t('User_has_been_removed_from_team'),\n\t});\n\tconst removeFromRoom = useEndpointAction('POST', `${endpointPrefix}.kick`, {\n\t\tsuccessMessage: t('User_has_been_removed_from_s', roomName),\n\t});\n\n\tconst removeUserOptionAction = useMutableCallback(() => {\n\t\tconst handleRemoveFromTeam = async (rooms: IRoom[]): Promise<void> => {\n\t\t\tif (room.teamId) {\n\t\t\t\tconst roomKeys = Object.keys(rooms);\n\t\t\t\tawait removeFromTeam({\n\t\t\t\t\tteamId: room.teamId,\n\t\t\t\t\tuserId: uid,\n\t\t\t\t\t...(roomKeys.length && { rooms: roomKeys }),\n\t\t\t\t});\n\t\t\t\tcloseModal();\n\t\t\t\treload?.();\n\t\t\t}\n\t\t};\n\n\t\tconst handleRemoveFromRoom = async (rid: IRoom['_id'], uid: IUser['_id']): Promise<void> => {\n\t\t\tawait removeFromRoom({ roomId: rid, userId: uid });\n\t\t\tcloseModal();\n\t\t\treload?.();\n\t\t};\n\n\t\tif (room.teamMain && room.teamId) {\n\t\t\treturn setModal(\n\t\t\t\t<RemoveUsersModal teamId={room?.teamId} userId={uid} onClose={closeModal} onCancel={closeModal} onConfirm={handleRemoveFromTeam} />,\n\t\t\t);\n\t\t}\n\n\t\tsetModal(\n\t\t\t<GenericModal\n\t\t\t\tvariant='danger'\n\t\t\t\tconfirmText={t('Yes_remove_user')}\n\t\t\t\tonClose={closeModal}\n\t\t\t\tonCancel={closeModal}\n\t\t\t\tonConfirm={(): Promise<void> => handleRemoveFromRoom(rid, uid)}\n\t\t\t>\n\t\t\t\t{t('The_user_will_be_removed_from_s', roomName)}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\tconst removeUserOption = useMemo(\n\t\t() =>\n\t\t\troomCanRemove && userCanRemove\n\t\t\t\t? {\n\t\t\t\t\t\tcontent: room?.teamMain ? t('Remove_from_team') : t('Remove_from_room'),\n\t\t\t\t\t\ticon: 'cross' as const,\n\t\t\t\t\t\tonClick: removeUserOptionAction,\n\t\t\t\t\t\ttype: 'moderation' as const,\n\t\t\t\t\t\tvariant: 'danger' as const,\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\t[room, roomCanRemove, userCanRemove, removeUserOptionAction, t],\n\t);\n\n\treturn removeUserOption;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","_objectSpread","export","useRemoveUserAction","isRoomFederated","useMutableCallback","escapeHTML","usePermission","useSetModal","useTranslation","useUser","useUserRoom","useUserSubscription","v","React","useMemo","GenericModal","useEndpointAction","Federation","roomCoordinator","RemoveUsersModal","getRoomDirectives","user","rid","reload","t","room","currentUser","subscription","uid","_id","Error","hasPermissionToRemove","userCanRemove","isEditableByTheUser","undefined","setModal","closeModal","roomName","getRoomName","endpointPrefix","roomCanRemove","_getRoomDirectives","showingUserId","userSubscription","removeFromTeam","successMessage","removeFromRoom","removeUserOptionAction","teamMain","teamId","createElement","userId","onClose","onCancel","onConfirm","rooms","roomKeys","async","_context","prev","next","Object","keys","awrap","length","stop","Promise","variant","confirmText","_context2","roomId","content","icon","onClick","type"],"mappings":"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"}