)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/webdav/SaveToWebdavModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { MessageAttachment, IWebdavAccount } from '@rocket.chat/core-typings';\nimport type { SelectOption } from '@rocket.chat/fuselage';\nimport { Modal, Box, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Select, Throbber } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod, useToastMessageDispatch, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\n\nimport { useEndpointData } from '../../../hooks/useEndpointData';\nimport { getWebdavServerName } from '../../../lib/getWebdavServerName';\n\ntype SaveToWebdavModalProps = {\n\tonClose: () => void;\n\tdata: {\n\t\tattachment: MessageAttachment;\n\t\turl: string;\n\t};\n};\n\nconst SaveToWebdavModal = ({ onClose, data }: SaveToWebdavModalProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst uploadFileToWebdav = useMethod('uploadFileToWebdav');\n\tconst fileRequest = useRef<XMLHttpRequest | null>(null);\n\tconst accountIdField = useUniqueId();\n\n\tconst {\n\t\tcontrol,\n\t\thandleSubmit,\n\t\tformState: { errors },\n\t} = useForm<{ accountId: string }>();\n\n\tconst { value } = useEndpointData('/v1/webdav.getMyAccounts');\n\n\tconst accountsOptions: SelectOption[] = useMemo(() => {\n\t\tif (value?.accounts) {\n\t\t\treturn value.accounts.map(({ _id, ...current }) => [_id, getWebdavServerName(current)]);\n\t\t}\n\n\t\treturn [];\n\t}, [value?.accounts]);\n\n\tuseEffect(() => fileRequest.current?.abort, []);\n\n\tconst handleSaveFile = ({ accountId }: { accountId: IWebdavAccount['_id'] }): void => {\n\t\tsetIsLoading(true);\n\n\t\tconst {\n\t\t\turl,\n\t\t\tattachment: { title },\n\t\t} = data;\n\n\t\tfileRequest.current = new XMLHttpRequest();\n\t\tfileRequest.current.open('GET', url, true);\n\t\tfileRequest.current.responseType = 'arraybuffer';\n\t\tfileRequest.current.onload = async (): Promise<void> => {\n\t\t\tconst arrayBuffer = fileRequest.current?.response;\n\t\t\tif (arrayBuffer) {\n\t\t\t\tconst fileData = new Uint8Array(arrayBuffer);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (!title) {\n\t\t\t\t\t\tthrow new Error('File name is required');\n\t\t\t\t\t}\n\t\t\t\t\tconst response = await uploadFileToWebdav(accountId, fileData, title);\n\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\tthrow new Error(response.message ? t(response.message) : 'Error uploading file');\n\t\t\t\t\t}\n\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t} finally {\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfileRequest.current.send(null);\n\t};\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(handleSaveFile)} {...props} />}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Save_To_Webdav')}</Modal.Title>\n\t\t\t\t<Modal.Close title={t('Close')} onClick={onClose} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content>\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<Box alignItems='center' display='flex' justifyContent='center' minHeight='x32'>\n\t\t\t\t\t\t<Throbber />\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{!isLoading && (\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel>{t('Select_a_webdav_server')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\t\t\tname='accountId'\n\t\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\t\trules={{ required: true }}\n\t\t\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t<Select {...field} options={accountsOptions} id={accountIdField} placeholder={t('Select_an_option')} />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t{errors.accountId && <FieldError>{t('Field_required')}</FieldError>}\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onClose}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button primary type='submit' loading={isLoading}>\n\t\t\t\t\t\t{t('Save_To_Webdav')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\nexport default SaveToWebdavModal;\n",null],"names":["_regeneratorRuntime","_extends","_objectWithoutProperties","_slicedToArray","Modal","Box","Button","FieldGroup","Field","FieldLabel","FieldRow","FieldError","Select","Throbber","useUniqueId","useMethod","useToastMessageDispatch","useTranslation","React","useState","useMemo","useEffect","useRef","useForm","Controller","useEndpointData","getWebdavServerName","module","link","default","v","exportDefault","_ref","onClose","data","t","_useState2","isLoading","setIsLoading","dispatchToastMessage","uploadFileToWebdav","fileRequest","accountIdField","_useForm","control","handleSubmit","errors","formState","value","_useEndpointData","accountsOptions","accounts","map","_ref2","_id","_excluded","_fileRequest$current","current","abort","handleSaveFile","_ref3","accountId","url","title","attachment","XMLHttpRequest","open","responseType","onload","_fileRequest$current2","arrayBuffer","fileData","response","async","_context","prev","next","Uint8Array","Error","awrap","sent","success","message","abrupt","type","t0","finish","stop","Promise","send","createElement","wrapperFunction","props","is","onSubmit","Header","Title","Close","onClick","Content","alignItems","display","justifyContent","minHeight","name","rules","required","render","_ref4","field","options","id","placeholder","Footer","FooterControllers","primary","loading"],"mappings":"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"}