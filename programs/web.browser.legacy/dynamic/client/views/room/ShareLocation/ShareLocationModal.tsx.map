)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/ShareLocation/ShareLocationModal.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { useEndpoint, useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport MapView from '../../../components/message/content/location/MapView';\nimport { getGeolocationPermission } from './getGeolocationPermission';\nimport { getGeolocationPosition } from './getGeolocationPosition';\n\ntype ShareLocationModalProps = {\n\trid: IRoom['_id'];\n\ttmid: IMessage['tmid'];\n\tonClose: () => void;\n};\n\nconst ShareLocationModal = ({ rid, tmid, onClose }: ShareLocationModalProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToast = useToastMessageDispatch();\n\tconst { data: permissionData, isLoading: permissionLoading } = useQuery(['geolocationPermission'], getGeolocationPermission);\n\tconst { data: positionData } = useQuery(['geolocationPosition', permissionData], async () => {\n\t\tif (permissionLoading || permissionData === 'prompt' || permissionData === 'denied') {\n\t\t\treturn;\n\t\t}\n\t\treturn getGeolocationPosition();\n\t});\n\n\tconst queryClient = useQueryClient();\n\n\tconst sendMessage = useEndpoint('POST', '/v1/chat.sendMessage');\n\n\tconst onConfirm = (): void => {\n\t\tif (!positionData) {\n\t\t\tthrow new Error('Failed to load position');\n\t\t}\n\t\ttry {\n\t\t\tsendMessage({\n\t\t\t\tmessage: {\n\t\t\t\t\trid,\n\t\t\t\t\ttmid,\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [positionData.coords.longitude, positionData.coords.latitude],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToast({ type: 'error', message: error });\n\t\t} finally {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\tconst onConfirmRequestLocation = async (): Promise<void> => {\n\t\ttry {\n\t\t\tconst position = await getGeolocationPosition();\n\t\t\tqueryClient.setQueryData(['geolocationPosition', 'granted'], position);\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], 'granted');\n\t\t} catch (e) {\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], () => getGeolocationPermission);\n\t\t}\n\t};\n\n\tif (permissionLoading || permissionData === 'prompt') {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('You_will_be_asked_for_permissions')}\n\t\t\t\tconfirmText={t('Continue')}\n\t\t\t\tonConfirm={onConfirmRequestLocation}\n\t\t\t\tonClose={onClose}\n\t\t\t\tonCancel={onClose}\n\t\t\t/>\n\t\t);\n\t}\n\n\tif (permissionData === 'denied' || !positionData) {\n\t\treturn (\n\t\t\t<GenericModal title={t('Cannot_share_your_location')} confirmText={t('Ok')} onConfirm={onClose} onClose={onClose}>\n\t\t\t\t{t('The_necessary_browser_permissions_for_location_sharing_are_not_granted')}\n\t\t\t</GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal title={t('Share_Location_Title')} confirmText={t('Share')} onConfirm={onConfirm} onClose={onClose} onCancel={onClose}>\n\t\t\t<MapView latitude={positionData.coords.latitude} longitude={positionData.coords.longitude} />\n\t\t</GenericModal>\n\t);\n};\n\nexport default ShareLocationModal;\n",null],"names":["_regeneratorRuntime","useEndpoint","useTranslation","useToastMessageDispatch","useQuery","useQueryClient","React","GenericModal","MapView","getGeolocationPermission","getGeolocationPosition","module","default","v","link","exportDefault","_ref","rid","tmid","onClose","t","dispatchToast","_useQuery","permissionData","data","permissionLoading","isLoading","positionData","_useQuery2","async","_context","prev","next","abrupt","stop","Promise","queryClient","sendMessage","createElement","title","confirmText","onConfirm","position","_context2","awrap","sent","setQueryData","t0","onCancel","Error","message","location","type","coordinates","coords","longitude","latitude","error"],"mappings":"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"}