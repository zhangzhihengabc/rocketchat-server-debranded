)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/composer/messageBox/MessageBoxActionsToolbar/actions/FileUploadAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Option, OptionContent, OptionIcon } from '@rocket.chat/fuselage';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport { useTranslation, useSetting } from '@rocket.chat/ui-contexts';\nimport type { ChangeEvent, AllHTMLAttributes } from 'react';\nimport React, { useRef } from 'react';\n\nimport type { ChatAPI } from '../../../../../../lib/chats/ChatAPI';\nimport { useChat } from '../../../../contexts/ChatContext';\n\ntype FileUploadActionProps = {\n\tcollapsed?: boolean;\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n} & Omit<AllHTMLAttributes<HTMLButtonElement>, 'is'>;\n\nconst FileUploadAction = ({ collapsed, chatContext, disabled, ...props }: FileUploadActionProps) => {\n\tconst t = useTranslation();\n\tconst fileUploadEnabled = useSetting('FileUpload_Enabled');\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\tconst chat = useChat() ?? chatContext;\n\n\tconst resetFileInput = () => {\n\t\tif (!fileInputRef.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tfileInputRef.current.value = '';\n\t};\n\n\tconst handleUploadChange = async (e: ChangeEvent<HTMLInputElement>) => {\n\t\tconst { mime } = await import('../../../../../../../app/utils/lib/mimeTypes');\n\t\tconst filesToUpload = Array.from(e.target.files ?? []).map((file) => {\n\t\t\tObject.defineProperty(file, 'type', {\n\t\t\t\tvalue: mime.lookup(file.name),\n\t\t\t});\n\t\t\treturn file;\n\t\t});\n\t\tchat?.flows.uploadFiles(filesToUpload, resetFileInput);\n\t};\n\n\tconst handleUpload = () => {\n\t\tfileInputRef.current?.click();\n\t};\n\n\tif (collapsed) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Option\n\t\t\t\t\t{...((!fileUploadEnabled || disabled) && { title: t('Not_Available') })}\n\t\t\t\t\tdisabled={!fileUploadEnabled || disabled}\n\t\t\t\t\tonClick={handleUpload}\n\t\t\t\t>\n\t\t\t\t\t<OptionIcon name='clip' />\n\t\t\t\t\t<OptionContent>{t('File')}</OptionContent>\n\t\t\t\t</Option>\n\t\t\t\t<input ref={fileInputRef} type='file' onChange={handleUploadChange} multiple style={{ display: 'none' }} />\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<MessageComposerAction\n\t\t\t\tdata-qa-id='file-upload'\n\t\t\t\ticon='clip'\n\t\t\t\tdisabled={!fileUploadEnabled || disabled}\n\t\t\t\tonClick={handleUpload}\n\t\t\t\ttitle={t('File')}\n\t\t\t\t{...props}\n\t\t\t/>\n\t\t\t<input ref={fileInputRef} type='file' onChange={handleUploadChange} multiple style={{ display: 'none' }} />\n\t\t</>\n\t);\n};\n\nexport default FileUploadAction;\n",null],"names":["_regeneratorRuntime","_extends","_objectWithoutProperties","Option","OptionContent","OptionIcon","MessageComposerAction","useTranslation","useSetting","React","useRef","useChat","module","link","default","v","exportDefault","_ref","_useChat","collapsed","chatContext","disabled","props","_excluded","t","fileUploadEnabled","fileInputRef","chat","resetFileInput","current","value","handleUploadChange","e","_e$target$files","mime","filesToUpload","async","_context","prev","next","awrap","dynamicImport","_await$module$dynamic","sent","Array","from","target","files","map","file","Object","defineProperty","lookup","name","flows","uploadFiles","stop","Promise","handleUpload","_fileInputRef$current","click","createElement","Fragment","title","onClick","ref","type","onChange","multiple","style","display","icon"],"mappings":"2BAAAA,EAA0EC,EAAAC,EAA1EC,EAASC,EAAQC,EAAyDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,2CAAzDC,EAAaC,IAAE,CAAA,6BAAkB,CAAAC,QAAwB,SAAAC,CAAA,EAAAf,EAAAA,CAAA,CAAA,EAAA,GAAAY,EAAAA,IAAAA,CAAAA,iCAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAAb,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,iDAAAA,CAAAE,QAAAA,SAAAA,CAAAA,EAAAZ,EAAAA,CAAA,CAAA,EAAA,GAA1CU,EAAUC,IAAE,CAAA,wBAAM,CAAuBV,OAAC,SAAAY,CAAA,EAAAZ,EAAAA,CAAA,EAAAC,cAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAN,sBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAL,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,WAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAN,EAAAA,CAAA,EAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,mCAAAA,CAAAD,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAA1EC,EAAOI,aAAU,CAcQ,SAAAC,CAAA,EAA0E,IAAAC,EAAvEC,EAASF,EAATE,SAAS,CAAEC,EAAWH,EAAXG,WAAW,CAAEC,EAAQJ,EAARI,QAAQ,CAAKC,EAAKpB,EAAAe,EAAAM,GAC/DC,EAAIjB,IACJkB,EAAoBjB,EAAW,sBAC/BkB,EAAehB,EAAyB,MACxCiB,EAAI,AAAY,OAAZT,CAAAA,EAAGP,GAAO,GAAEO,AAAA,KAAA,IAAAA,EAAAA,EAAIE,EAEpBQ,EAAiB,WACjBF,EAAaG,OAAO,EAIzBH,CAAAA,EAAaG,OAAO,CAACC,KAAK,CAAG,EAAA,CAC9B,EAEMC,EAAqB,SAAOC,CAAgC,MAAAC,EAAAC,EAAAC,EAAA,OAAAnC,EAAAoC,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,OAAAF,EAAAE,IAAA,CAAA,EAAAvC,EAAAwC,KAAA,CAC1C5B,EAAA6B,aAAA,CAAO,gDAA+C,MAAA,EAArEP,EAAIQ,AAAiEL,EAAAM,IAAA,CAArET,IAAI,CACNC,EAAgBS,MAAMC,IAAI,CAAA,AAAe,OAAfZ,CAAAA,EAACD,EAAEc,MAAM,CAACC,KAAK,AAALA,GAAKd,AAAA,KAAA,IAAAA,EAAAA,EAAI,EAAE,EAAEe,GAAG,CAAC,SAACC,CAAI,EAI/D,OAHAC,OAAOC,cAAc,CAACF,EAAM,OAAQ,CACnCnB,MAAOI,EAAKkB,MAAM,CAACH,EAAKI,IAAI,IAEtBJ,CACR,GACAtB,MAAAA,GAAAA,EAAM2B,KAAK,CAACC,WAAW,CAACpB,EAAeP,EAAgB,MAAA,EAAA,IAAA,MAAA,OAAAS,EAAAmB,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAGlDC,EAAe,WAAK,IAAAC,CACzB,AAAoB,QAApBA,CAAAA,EAAAjC,EAAaG,OAAO,AAAPA,GAAO8B,AAAA,KAAA,IAAAA,GAApBA,EAAsBC,KAAK,EAC5B,SAEA,AAAIzC,EAEFV,EAAAoD,aAAA,CAAApD,EAAAqD,QAAA,CAAA,KACCrD,EAAAoD,aAAA,CAAC1D,EAAMF,EAAA,CAAA,EACD,AAAC,CAAA,CAACwB,GAAqBJ,CAAAA,GAAa,CAAE0C,MAAOvC,EAAE,gBAAgB,EAAE,CACtEH,SAAU,CAACI,GAAqBJ,EAChC2C,QAASN,CAAa,GAEtBjD,EAAAoD,aAAA,CAACxD,EAAU,CAACgD,KAAK,MAAM,GACvB5C,EAAAoD,aAAA,CAACzD,EAAa,KAAEoB,EAAE,UAEnBf,EAAAoD,aAAA,CAAA,QAAA,CAAOI,IAAKvC,EAAcwC,KAAK,OAAOC,SAAUpC,EAAoBqC,SAAQ,CAAA,EAACC,MAAO,CAAEC,QAAS,MAAM,CAAG,IAM1G7D,EAAAoD,aAAA,CAAApD,EAAAqD,QAAA,CAAA,KACCrD,EAAAoD,aAAA,CAACvD,EAAqBL,EAAA,CACrB,aAAW,cACXsE,KAAK,OACLlD,SAAU,CAACI,GAAqBJ,EAChC2C,QAASN,EACTK,MAAOvC,EAAE,OAAQ,EACbF,IAELb,EAAAoD,aAAA,CAAA,QAAA,CAAOI,IAAKvC,EAAcwC,KAAK,OAAOC,SAAUpC,EAAoBqC,SAAQ,CAAA,EAACC,MAAO,CAAEC,QAAS,MAAM,CAAG,GAG3G"}