)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/room/composer/messageBox/MessageBoxActionsToolbar/actions/VideoMessageAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Option, OptionIcon, OptionContent } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport { useTranslation, useSetting } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes } from 'react';\nimport React, { useEffect, useMemo } from 'react';\n\nimport { VideoRecorder } from '../../../../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../../../../lib/chats/ChatAPI';\nimport { useChat } from '../../../../contexts/ChatContext';\nimport { useMediaActionTitle } from '../../hooks/useMediaActionTitle';\nimport { useMediaPermissions } from '../../hooks/useMediaPermissions';\n\ntype VideoMessageActionProps = {\n\tcollapsed?: boolean;\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n} & Omit<AllHTMLAttributes<HTMLButtonElement>, 'is'>;\n\nconst VideoMessageAction = ({ collapsed, chatContext, disabled, ...props }: VideoMessageActionProps) => {\n\tconst t = useTranslation();\n\tconst isFileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\n\tconst isVideoRecorderEnabled = useSetting('Message_VideoRecorderEnabled') as boolean;\n\tconst fileUploadMediaTypeBlackList = useSetting('FileUpload_MediaTypeBlackList') as string;\n\tconst fileUploadMediaTypeWhiteList = useSetting('FileUpload_MediaTypeWhiteList') as string;\n\tconst [isPermissionDenied, setIsPermissionDenied] = useMediaPermissions('camera');\n\n\tconst isAllowed = useMemo(\n\t\t() =>\n\t\t\tBoolean(\n\t\t\t\t!isPermissionDenied &&\n\t\t\t\t\tnavigator.mediaDevices &&\n\t\t\t\t\twindow.MediaRecorder &&\n\t\t\t\t\tisFileUploadEnabled &&\n\t\t\t\t\tisVideoRecorderEnabled &&\n\t\t\t\t\t!fileUploadMediaTypeBlackList?.match(/video\\/webm|video\\/\\*/i) &&\n\t\t\t\t\t(!fileUploadMediaTypeWhiteList || fileUploadMediaTypeWhiteList.match(/video\\/webm|video\\/\\*/i)) &&\n\t\t\t\t\tBoolean(VideoRecorder.getSupportedMimeTypes()),\n\t\t\t),\n\t\t[fileUploadMediaTypeBlackList, fileUploadMediaTypeWhiteList, isFileUploadEnabled, isPermissionDenied, isVideoRecorderEnabled],\n\t);\n\n\tconst getMediaActionTitle = useMediaActionTitle('video', isPermissionDenied, isFileUploadEnabled, isVideoRecorderEnabled, isAllowed);\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleOpenVideoMessage = () => {\n\t\tif (!chat?.composer?.recordingVideo.get()) {\n\t\t\tchat?.composer?.setRecordingVideo(true);\n\t\t}\n\t};\n\n\tconst handleDenyVideo = useMutableCallback((isDenied) => {\n\t\tif (isDenied) {\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t}\n\n\t\tsetIsPermissionDenied(isDenied);\n\t});\n\n\tuseEffect(() => {\n\t\thandleDenyVideo(isPermissionDenied);\n\t}, [handleDenyVideo, isPermissionDenied]);\n\n\tif (collapsed) {\n\t\treturn (\n\t\t\t<Option title={getMediaActionTitle} disabled={!isAllowed || disabled} onClick={handleOpenVideoMessage}>\n\t\t\t\t<OptionIcon name='video' />\n\t\t\t\t<OptionContent>{t('Video_message')}</OptionContent>\n\t\t\t</Option>\n\t\t);\n\t}\n\n\treturn (\n\t\t<MessageComposerAction\n\t\t\tdata-qa-id='video-message'\n\t\t\ticon='video'\n\t\t\tdisabled={!isAllowed || disabled}\n\t\t\tonClick={handleOpenVideoMessage}\n\t\t\ttitle={getMediaActionTitle}\n\t\t\t{...props}\n\t\t/>\n\t);\n};\n\nexport default VideoMessageAction;\n",null],"names":["_extends","_slicedToArray","_objectWithoutProperties","Option","OptionIcon","OptionContent","useMutableCallback","MessageComposerAction","useTranslation","useSetting","React","useEffect","useMemo","VideoRecorder","useChat","useMediaActionTitle","useMediaPermissions","module","link","default","v","exportDefault","_ref","_useChat","collapsed","chatContext","disabled","props","_excluded","t","isFileUploadEnabled","isVideoRecorderEnabled","fileUploadMediaTypeBlackList","fileUploadMediaTypeWhiteList","_useMediaPermissions2","isPermissionDenied","setIsPermissionDenied","isAllowed","Boolean","navigator","mediaDevices","window","MediaRecorder","match","getSupportedMimeTypes","getMediaActionTitle","chat","handleOpenVideoMessage","_chat$composer","_chat$composer2","composer","recordingVideo","get","setRecordingVideo","handleDenyVideo","isDenied","_chat$composer3","createElement","title","onClick","name","icon"],"mappings":"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"}