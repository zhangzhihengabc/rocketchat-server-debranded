)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/cloud/CloudAnnouncementsRegion.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { BannerPlatform } from '@rocket.chat/core-typings';\nimport { useEndpoint, useStream, useUserId } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport React, { useEffect } from 'react';\n\nimport CloudAnnouncementHandler from './CloudAnnouncementHandler';\n\nconst CloudAnnouncementsRegion = () => {\n\tconst uid = useUserId();\n\n\tconst getAnnouncements = useEndpoint('GET', '/v1/banners');\n\n\tconst { isSuccess, data: announcements } = useQuery({\n\t\tqueryKey: ['cloud', 'announcements'],\n\t\tqueryFn: () => getAnnouncements({ platform: BannerPlatform.Web }),\n\t\tselect: (data) => data.banners,\n\t\tenabled: !!uid,\n\t\tstaleTime: 0,\n\t\trefetchInterval: 1000 * 60 * 60 * 24,\n\t});\n\n\tconst subscribeToNotifyLoggedIn = useStream('notify-logged');\n\tconst subscribeToNotifyUser = useStream('notify-user');\n\tconst queryClient = useQueryClient();\n\n\tuseEffect(() => {\n\t\tif (!uid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst unsubscribeFromBannerChanged = subscribeToNotifyLoggedIn('banner-changed', async () => {\n\t\t\tqueryClient.invalidateQueries(['cloud', 'announcements']);\n\t\t});\n\n\t\tconst unsubscribeBanners = subscribeToNotifyUser(`${uid}/banners`, async () => {\n\t\t\tqueryClient.invalidateQueries(['cloud', 'announcements']);\n\t\t});\n\n\t\treturn () => {\n\t\t\tunsubscribeFromBannerChanged();\n\t\t\tunsubscribeBanners();\n\t\t};\n\t}, [subscribeToNotifyLoggedIn, uid, subscribeToNotifyUser, queryClient]);\n\n\tif (!isSuccess) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{announcements.map((announcement) => (\n\t\t\t\t<CloudAnnouncementHandler key={announcement._id} {...announcement} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n\nexport default CloudAnnouncementsRegion;\n",null],"names":["_extends","_regeneratorRuntime","BannerPlatform","useEndpoint","useStream","useUserId","useQuery","useQueryClient","React","useEffect","CloudAnnouncementHandler","module","default","link","v","exportDefault","uid","getAnnouncements","_useQuery","queryKey","queryFn","platform","Web","select","data","banners","enabled","staleTime","refetchInterval","isSuccess","announcements","subscribeToNotifyLoggedIn","subscribeToNotifyUser","queryClient","unsubscribeFromBannerChanged","async","_context","prev","next","invalidateQueries","stop","Promise","unsubscribeBanners","_context2","createElement","Fragment","map","announcement","key","_id"],"mappings":"uBAOA,IAPAA,EAA2DC,EAA3DC,EAA2DC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAlDC,EAAAA,IAAc,CAAE,iCAAiC,CAACC,QAAAA,SAAAA,CAAAA,EAAAZ,EAAAA,CAAA,CAAA,EAAA,GAAAW,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAC,QAAAA,SAAAA,CAAAA,EAAAX,EAAAA,CAAA,CAAA,EAAA,GAAlDU,EAAgBE,IAAA,CAAM,4BAA4B,CAAAX,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAS,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAR,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAL,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAN,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,6BAAAA,CAAA,QAAA,SAAAG,CAAA,EAAAJ,EAAAA,CAAA,CAAA,EAAA,GAA3DC,EAAOI,aAAE,CAOwB,WAChC,IAAMC,EAAMX,IAENY,EAAmBd,EAAY,MAAO,eAE5Ce,EAA2CZ,EAAS,CACnDa,SAAU,CAAC,QAAS,gBAAgB,CACpCC,QAAS,WAAA,OAAMH,EAAiB,CAAEI,SAAUnB,EAAeoB,GAAAA,AAAG,EAAG,EACjEC,OAAQ,SAACC,CAAI,EAAA,OAAKA,EAAKC,OAAO,EAC9BC,QAAS,CAAC,CAACV,EACXW,UAAW,EACXC,gBAAiB,QANVC,EAASX,EAATW,SAAS,CAAQC,EAAaZ,EAAnBM,IAAI,CASjBO,EAA4B3B,EAAU,iBACtC4B,EAAwB5B,EAAU,eAClC6B,EAAc1B,UAqBpB,CAnBAE,EAAU,WACT,GAAKO,GAIL,IAAMkB,EAA+BH,EAA0B,iBAAkB,WAAA,OAAA9B,EAAAkC,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAChFL,EAAYM,iBAAiB,CAAC,CAAC,QAAS,gBAAgB,CAAE,MAAA,EAAA,IAAA,MAAA,OAAAH,EAAAI,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,GAGrDC,EAAqBV,EAAyBhB,EAAG,WAAY,WAAA,OAAAf,EAAAkC,KAAA,CAAA,SAAAQ,CAAA,EAAA,OAAA,OAAAA,EAAAN,IAAA,CAAAM,EAAAL,IAAA,EAAA,KAAA,EAClEL,EAAYM,iBAAiB,CAAC,CAAC,QAAS,gBAAgB,CAAE,MAAA,EAAA,IAAA,MAAA,OAAAI,EAAAH,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,GAG3D,OAAO,WACNP,IACAQ,GACD,EACD,EAAG,CAACX,EAA2Bf,EAAKgB,EAAuBC,EAAY,EAElEJ,GAKJrB,EAAAoC,aAAA,CAAApC,EAAAqC,QAAA,CAAA,KACEf,EAAcgB,GAAG,CAAC,SAACC,CAAY,EAAA,OAC/BvC,EAAAoC,aAAA,CAAClC,EAAwBV,EAAA,CAACgD,IAAKD,EAAaE,GAAAA,AAAI,EAAKF,GAAgB,IANhE,IAUT"}