)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/meet/MeetPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Button, Box, Flex } from '@rocket.chat/fuselage';\nimport { useRouteParameter, useSearchParameter, useTranslation } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport React, { useEffect, useState, useCallback } from 'react';\n\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport UserAvatar from '../../components/avatar/UserAvatar';\nimport { useEmbeddedLayout } from '../../hooks/useEmbeddedLayout';\nimport NotFoundPage from '../notFound/NotFoundPage';\nimport PageLoading from '../root/PageLoading';\nimport CallPage from './CallPage';\nimport './styles.css';\n\nconst MeetPage = () => {\n\tconst t = useTranslation();\n\tconst [isRoomMember, setIsRoomMember] = useState(false);\n\tconst [status, setStatus] = useState(null);\n\tconst [visitorId, setVisitorId] = useState(null);\n\tconst roomId = useRouteParameter('rid');\n\tconst visitorToken = useSearchParameter('token');\n\tconst isLayoutEmbedded = useEmbeddedLayout();\n\tconst [visitorName, setVisitorName] = useState('');\n\tconst [agentName, setAgentName] = useState('');\n\tconst [callStartTime, setCallStartTime] = useState(undefined);\n\n\tconst isMobileDevice = (): boolean => window.innerWidth <= 450;\n\tconst closeCallTab = (): void => window.close();\n\n\tconst setupCallForVisitor = useCallback(async () => {\n\t\tif (!visitorToken || !roomId) {\n\t\t\tthrow new Error('Missing parameters');\n\t\t}\n\n\t\tconst room = (await sdk.rest.get('/v1/livechat/room', {\n\t\t\ttoken: visitorToken,\n\t\t\trid: roomId,\n\t\t})) as any;\n\t\tif (room?.room?.v?.token === visitorToken) {\n\t\t\tsetVisitorId(room.room.v._id);\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [visitorToken, roomId]);\n\n\tconst setupCallForAgent = useCallback(async () => {\n\t\tif (!roomId) {\n\t\t\tthrow new Error('Missing parameters');\n\t\t}\n\n\t\tconst room = (await sdk.rest.get('/v1/rooms.info', { roomId })) as any;\n\t\tif (room?.room?.servedBy?._id === Meteor.userId()) {\n\t\t\tsetVisitorName(room.room.fname);\n\t\t\troom?.room?.responseBy?.username ? setAgentName(room.room.responseBy.username) : setAgentName(room.room.servedBy.username);\n\t\t\tsetStatus(room?.room?.callStatus || 'ended');\n\t\t\tsetCallStartTime(room.room.webRtcCallStartTime);\n\t\t\treturn setIsRoomMember(true);\n\t\t}\n\t}, [roomId]);\n\n\tuseEffect(() => {\n\t\tif (visitorToken) {\n\t\t\tsetupCallForVisitor();\n\t\t\treturn;\n\t\t}\n\t\tsetupCallForAgent();\n\t}, [setupCallForAgent, setupCallForVisitor, visitorToken]);\n\n\tif (status === null) {\n\t\treturn <PageLoading />;\n\t}\n\n\tif (!isRoomMember) {\n\t\treturn <NotFoundPage />;\n\t}\n\n\tif (status === 'ended') {\n\t\treturn (\n\t\t\t<Flex.Container direction='column' justifyContent='center'>\n\t\t\t\t<Box width='full' minHeight='sh' alignItems='center' backgroundColor='dark' overflow='hidden' position='relative'>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: '5%',\n\t\t\t\t\t\t\tright: '2%',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName='Self_Video'\n\t\t\t\t\t\tbackgroundColor='dark'\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? visitorName : agentName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize={isMobileDevice() ? 'x32' : 'x48'}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box\n\t\t\t\t\t\tposition='absolute'\n\t\t\t\t\t\tzIndex={1}\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttop: isMobileDevice() ? '30%' : '20%',\n\t\t\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\t\t\tjustifyContent: 'center',\n\t\t\t\t\t\t\tflexDirection: 'column',\n\t\t\t\t\t\t}}\n\t\t\t\t\t\talignItems='center'\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tusername={visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t\tclassName='rcx-message__avatar'\n\t\t\t\t\t\t\tsize='x124'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<p style={{ color: 'white', fontSize: 16, margin: 15 }}>Call Ended!</p>\n\t\t\t\t\t\t<p\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\t\tfontSize: isMobileDevice() ? 15 : 22,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{visitorToken ? agentName : visitorName}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Box position='absolute' alignItems='center' style={{ bottom: '20%' }}>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ticon='cross'\n\t\t\t\t\t\t\tsquare\n\t\t\t\t\t\t\ttitle={t('Close_Window')}\n\t\t\t\t\t\t\tonClick={closeCallTab}\n\t\t\t\t\t\t\tbackgroundColor='dark'\n\t\t\t\t\t\t\tborderColor='extra-dark'\n\t\t\t\t\t\t></Button>\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t</Flex.Container>\n\t\t);\n\t}\n\n\treturn (\n\t\t<CallPage\n\t\t\troomId={roomId}\n\t\t\tstatus={status}\n\t\t\tvisitorToken={visitorToken}\n\t\t\tvisitorId={visitorId}\n\t\t\tsetStatus={setStatus}\n\t\t\tvisitorName={visitorName}\n\t\t\tagentName={agentName}\n\t\t\tisLayoutEmbedded={isLayoutEmbedded}\n\t\t\tcallStartTime={callStartTime}\n\t\t/>\n\t);\n};\n\nexport default MeetPage;\n",null],"names":["_regeneratorRuntime","_slicedToArray","Button","Box","Flex","useRouteParameter","useSearchParameter","useTranslation","Meteor","React","useEffect","useState","useCallback","sdk","UserAvatar","useEmbeddedLayout","NotFoundPage","PageLoading","CallPage","module","link","default","v","exportDefault","t","_useState2","isRoomMember","setIsRoomMember","_useState4","status","setStatus","_useState6","visitorId","setVisitorId","roomId","visitorToken","isLayoutEmbedded","_useState8","visitorName","setVisitorName","_useState10","agentName","setAgentName","_useState12","undefined","callStartTime","setCallStartTime","isMobileDevice","window","innerWidth","setupCallForVisitor","_room$room","_room$room$v","room","_room$room2","_room$room2$responseB","_room$room3","async","_context","prev","next","Error","awrap","rest","get","token","rid","sent","_id","fname","responseBy","username","servedBy","callStatus","webRtcCallStartTime","abrupt","stop","Promise","setupCallForAgent","_room$room4","_room$room4$servedBy","_room$room5","_room$room5$responseB","_room$room6","_context2","userId","createElement","Container","direction","justifyContent","width","minHeight","alignItems","backgroundColor","overflow","position","style","top","right","className","display","margin","size","zIndex","flexDirection","color","fontSize","bottom","icon","square","title","onClick","close","borderColor"],"mappings":"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"}