)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/users/hooks/useDeleteUserAction.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\nimport {\n\tuseSetModal,\n\tuseToastMessageDispatch,\n\tuseRoute,\n\tuseSetting,\n\tusePermission,\n\tuseEndpoint,\n\tuseTranslation,\n} from '@rocket.chat/ui-contexts';\nimport React, { useMemo } from 'react';\n\nimport GenericModal from '../../../../components/GenericModal';\nimport type { Action } from '../../../hooks/useActionSpread';\nimport { useConfirmOwnerChanges } from './useConfirmOwnerChanges';\n\nexport const useDeleteUserAction = (userId: IUser['_id'], onChange: () => void, onReload: () => void): Action | undefined => {\n\tconst t = useTranslation();\n\tconst setModal = useSetModal();\n\tconst userRoute = useRoute('admin-users');\n\tconst canDeleteUser = usePermission('delete-user');\n\tconst erasureType = useSetting('Message_ErasureType');\n\tconst confirmOwnerChanges = useConfirmOwnerChanges();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst handleDeletedUser = (): void => {\n\t\tsetModal();\n\t\tuserRoute.push({});\n\t\tonReload();\n\t};\n\n\tconst deleteUserQuery = useMemo(() => ({ userId, confirmRelinquish: false }), [userId]);\n\tconst deleteUserEndpoint = useEndpoint('POST', '/v1/users.delete');\n\n\tconst deleteUser = (): Promise<void> =>\n\t\tconfirmOwnerChanges(\n\t\t\tasync (confirm = false) => {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tdeleteUserQuery.confirmRelinquish = confirm;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait deleteUserEndpoint(deleteUserQuery);\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('User_has_been_deleted') });\n\t\t\t\t\thandleDeletedUser();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontentTitle: t(`Delete_User_Warning_${erasureType}` as TranslationKey),\n\t\t\t\tconfirmText: t('Delete'),\n\t\t\t},\n\t\t\tonChange,\n\t\t);\n\n\tconst confirmDeleteUser = useMutableCallback(() => {\n\t\tsetModal(\n\t\t\t<GenericModal variant='danger' onConfirm={deleteUser} onCancel={(): void => setModal()} confirmText={t('Delete')}>\n\t\t\t\t{t(`Delete_User_Warning_${erasureType}` as TranslationKey)}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\treturn canDeleteUser\n\t\t? {\n\t\t\t\ticon: 'trash',\n\t\t\t\tlabel: t('Delete'),\n\t\t\t\taction: confirmDeleteUser,\n\t\t  }\n\t\t: undefined;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","export","useDeleteUserAction","useMutableCallback","useSetModal","useToastMessageDispatch","useRoute","useSetting","usePermission","useEndpoint","useTranslation","v","React","useMemo","GenericModal","useConfirmOwnerChanges","userId","onChange","onReload","t","setModal","userRoute","canDeleteUser","erasureType","confirmOwnerChanges","dispatchToastMessage","handleDeletedUser","push","deleteUserQuery","confirmRelinquish","deleteUserEndpoint","deleteUser","confirm","_args","arguments","async","_context","prev","next","length","undefined","awrap","type","message","t0","stop","Promise","contentTitle","confirmText","confirmDeleteUser","createElement","variant","onConfirm","onCancel","icon","label","action"],"mappings":"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"}