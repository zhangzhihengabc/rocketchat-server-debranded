)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/users/UsersTable/UsersTable.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Pagination } from '@rocket.chat/fuselage';\nimport { useMediaQuery, useDebouncedValue, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { useEndpoint, useRoute, useToastMessageDispatch, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport type { ReactElement, MutableRefObject } from 'react';\nimport React, { useRef, useMemo, useState, useEffect } from 'react';\n\nimport FilterByText from '../../../../components/FilterByText';\nimport GenericNoResults from '../../../../components/GenericNoResults';\nimport {\n\tGenericTable,\n\tGenericTableHeader,\n\tGenericTableHeaderCell,\n\tGenericTableBody,\n\tGenericTableLoadingTable,\n} from '../../../../components/GenericTable';\nimport { usePagination } from '../../../../components/GenericTable/hooks/usePagination';\nimport { useSort } from '../../../../components/GenericTable/hooks/useSort';\nimport UsersTableRow from './UsersTableRow';\n\ntype UsersTableProps = {\n\treload: MutableRefObject<() => void>;\n};\n\n// TODO: Missing error state\nconst UsersTable = ({ reload }: UsersTableProps): ReactElement | null => {\n\tconst t = useTranslation();\n\tconst usersRoute = useRoute('admin-users');\n\tconst mediaQuery = useMediaQuery('(min-width: 1024px)');\n\tconst [text, setText] = useState('');\n\n\tconst { current, itemsPerPage, setItemsPerPage, setCurrent, ...paginationProps } = usePagination();\n\tconst { sortBy, sortDirection, setSort } = useSort<'name' | 'username' | 'emails.address' | 'status'>('name');\n\n\tconst searchTerm = useDebouncedValue(text, 500);\n\tconst prevSearchTerm = useRef<string>('');\n\n\tconst query = useDebouncedValue(\n\t\tuseMemo(() => {\n\t\t\tif (searchTerm !== prevSearchTerm.current) {\n\t\t\t\tsetCurrent(0);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tfields: JSON.stringify({\n\t\t\t\t\tname: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\temails: 1,\n\t\t\t\t\troles: 1,\n\t\t\t\t\tstatus: 1,\n\t\t\t\t\tavatarETag: 1,\n\t\t\t\t\tactive: 1,\n\t\t\t\t}),\n\t\t\t\tquery: JSON.stringify({\n\t\t\t\t\t$or: [\n\t\t\t\t\t\t{ 'emails.address': { $regex: escapeRegExp(searchTerm), $options: 'i' } },\n\t\t\t\t\t\t{ username: { $regex: escapeRegExp(searchTerm), $options: 'i' } },\n\t\t\t\t\t\t{ name: { $regex: escapeRegExp(searchTerm), $options: 'i' } },\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tsort: `{ \"${sortBy}\": ${sortDirection === 'asc' ? 1 : -1} }`,\n\t\t\t\tcount: itemsPerPage,\n\t\t\t\toffset: searchTerm === prevSearchTerm.current ? current : 0,\n\t\t\t};\n\t\t}, [searchTerm, sortBy, sortDirection, itemsPerPage, current, setCurrent]),\n\t\t500,\n\t);\n\n\tconst getUsers = useEndpoint('GET', '/v1/users.list');\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst { data, isLoading, error, isSuccess, refetch } = useQuery(\n\t\t['users', query],\n\t\tasync () => {\n\t\t\tconst users = await getUsers(query);\n\t\t\treturn users;\n\t\t},\n\t\t{\n\t\t\tonError: (error) => {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t},\n\t\t},\n\t);\n\n\tuseEffect(() => {\n\t\treload.current = refetch;\n\t}, [reload, refetch]);\n\n\tuseEffect(() => {\n\t\tprevSearchTerm.current = searchTerm;\n\t}, [searchTerm]);\n\n\tconst handleClick = useMutableCallback((id): void =>\n\t\tusersRoute.push({\n\t\t\tcontext: 'info',\n\t\t\tid,\n\t\t}),\n\t);\n\n\tconst headers = useMemo(\n\t\t() => [\n\t\t\t<GenericTableHeaderCell w='x200' key='name' direction={sortDirection} active={sortBy === 'name'} onClick={setSort} sort='name'>\n\t\t\t\t{t('Name')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\tmediaQuery && (\n\t\t\t\t<GenericTableHeaderCell\n\t\t\t\t\tw='x140'\n\t\t\t\t\tkey='username'\n\t\t\t\t\tdirection={sortDirection}\n\t\t\t\t\tactive={sortBy === 'username'}\n\t\t\t\t\tonClick={setSort}\n\t\t\t\t\tsort='username'\n\t\t\t\t>\n\t\t\t\t\t{t('Username')}\n\t\t\t\t</GenericTableHeaderCell>\n\t\t\t),\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tw='x120'\n\t\t\t\tkey='email'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'emails.address'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='emails.address'\n\t\t\t>\n\t\t\t\t{t('Email')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\tmediaQuery && (\n\t\t\t\t<GenericTableHeaderCell w='x120' key='roles' onClick={setSort}>\n\t\t\t\t\t{t('Roles')}\n\t\t\t\t</GenericTableHeaderCell>\n\t\t\t),\n\t\t\t<GenericTableHeaderCell w='x100' key='status' direction={sortDirection} active={sortBy === 'status'} onClick={setSort} sort='status'>\n\t\t\t\t{t('Status')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t],\n\t\t[mediaQuery, setSort, sortBy, sortDirection, t],\n\t);\n\n\tif (error) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<FilterByText autoFocus placeholder={t('Search_Users')} onChange={({ text }): void => setText(text)} />\n\t\t\t{isLoading && (\n\t\t\t\t<GenericTable>\n\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t<GenericTableBody>{isLoading && <GenericTableLoadingTable headerCells={5} />}</GenericTableBody>\n\t\t\t\t</GenericTable>\n\t\t\t)}\n\t\t\t{data?.users && data.count > 0 && isSuccess && (\n\t\t\t\t<>\n\t\t\t\t\t<GenericTable>\n\t\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t\t{data?.users.map((user) => (\n\t\t\t\t\t\t\t\t<UsersTableRow key={user._id} onClick={handleClick} mediaQuery={mediaQuery} user={user} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</GenericTableBody>\n\t\t\t\t\t</GenericTable>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tdivider\n\t\t\t\t\t\tcurrent={current}\n\t\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\t\tcount={data?.total || 0}\n\t\t\t\t\t\tonSetItemsPerPage={setItemsPerPage}\n\t\t\t\t\t\tonSetCurrent={setCurrent}\n\t\t\t\t\t\t{...paginationProps}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{isSuccess && data?.count === 0 && <GenericNoResults />}\n\t\t</>\n\t);\n};\n\nexport default UsersTable;\n",null],"names":["_regeneratorRuntime","_extends","_objectWithoutProperties","_slicedToArray","Pagination","useMediaQuery","useDebouncedValue","useMutableCallback","escapeRegExp","useEndpoint","useRoute","useToastMessageDispatch","useTranslation","useQuery","React","useRef","useMemo","useState","useEffect","FilterByText","GenericNoResults","GenericTable","GenericTableHeader","GenericTableHeaderCell","GenericTableBody","GenericTableLoadingTable","usePagination","useSort","UsersTableRow","module","link","default","v","exportDefault","_ref","reload","t","usersRoute","mediaQuery","_useState2","text","setText","_usePagination","current","itemsPerPage","setItemsPerPage","setCurrent","paginationProps","_excluded","_useSort","sortBy","sortDirection","setSort","searchTerm","prevSearchTerm","query","fields","JSON","stringify","name","username","emails","roles","status","avatarETag","active","$or","$regex","$options","sort","count","offset","getUsers","dispatchToastMessage","_useQuery","users","async","_context","prev","next","awrap","sent","abrupt","stop","Promise","onError","error","type","message","data","isLoading","isSuccess","refetch","handleClick","id","push","context","headers","createElement","w","key","direction","onClick","Fragment","autoFocus","placeholder","onChange","_ref2","headerCells","map","user","_id","divider","total","onSetItemsPerPage","onSetCurrent"],"mappings":"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"}