)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/moderation/ModerationConsoleTable.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Pagination, Field, FieldLabel, FieldRow } from '@rocket.chat/fuselage';\nimport { useDebouncedValue, useMediaQuery, useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useEndpoint, useToastMessageDispatch, useRoute, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useQuery } from '@tanstack/react-query';\nimport type { FC } from 'react';\nimport React, { useMemo, useState } from 'react';\n\nimport FilterByText from '../../../components/FilterByText';\nimport GenericNoResults from '../../../components/GenericNoResults';\nimport {\n\tGenericTable,\n\tGenericTableLoadingTable,\n\tGenericTableHeaderCell,\n\tGenericTableBody,\n\tGenericTableHeader,\n} from '../../../components/GenericTable';\nimport { usePagination } from '../../../components/GenericTable/hooks/usePagination';\nimport { useSort } from '../../../components/GenericTable/hooks/useSort';\nimport ModerationConsoleTableRow from './ModerationConsoleTableRow';\nimport DateRangePicker from './helpers/DateRangePicker';\n\n// TODO: Missing error state\nconst ModerationConsoleTable: FC = () => {\n\tconst [text, setText] = useState('');\n\tconst moderationRoute = useRoute('moderation-console');\n\tconst t = useTranslation();\n\tconst isDesktopOrLarger = useMediaQuery('(min-width: 1024px)');\n\n\tconst { sortBy, sortDirection, setSort } = useSort<'reports.ts' | 'reports.message.u.username' | 'reports.description' | 'count'>(\n\t\t'reports.ts',\n\t);\n\tconst { current, itemsPerPage, setItemsPerPage: onSetItemsPerPage, setCurrent: onSetCurrent, ...paginationProps } = usePagination();\n\n\tconst [dateRange, setDateRange] = useState<{ start: string | null; end: string | null }>({\n\t\tstart: '',\n\t\tend: '',\n\t});\n\tconst { start, end } = dateRange;\n\n\tconst query = useDebouncedValue(\n\t\tuseMemo(\n\t\t\t() => ({\n\t\t\t\tselector: text,\n\t\t\t\tsort: JSON.stringify({ [sortBy]: sortDirection === 'asc' ? 1 : -1 }),\n\t\t\t\tcount: itemsPerPage,\n\t\t\t\toffset: current,\n\t\t\t\t...(end && { latest: `${new Date(end).toISOString().slice(0, 10)}T23:59:59.999Z` }),\n\t\t\t\t...(start && { oldest: `${new Date(start).toISOString().slice(0, 10)}T00:00:00.000Z` }),\n\t\t\t}),\n\t\t\t[current, end, itemsPerPage, sortBy, sortDirection, start, text],\n\t\t),\n\t\t500,\n\t);\n\n\tconst getReports = useEndpoint('GET', '/v1/moderation.reportsByUsers');\n\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst { data, isLoading, isSuccess } = useQuery(['moderation.reports', query], async () => getReports(query), {\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tkeepPreviousData: true,\n\t});\n\n\tconst handleClick = useMutableCallback((id): void => {\n\t\tmoderationRoute.push({\n\t\t\tcontext: 'info',\n\t\t\tid,\n\t\t});\n\t});\n\n\t// header sequence would be: name, reportedMessage, room, postdate, reports, actions\n\tconst headers = useMemo(\n\t\t() => [\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tkey='name'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'reports.message.u.username'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='reports.message.u.username'\n\t\t\t>\n\t\t\t\t{t('Name')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\tisDesktopOrLarger && (\n\t\t\t\t<GenericTableHeaderCell\n\t\t\t\t\tw='x140'\n\t\t\t\t\tkey='username'\n\t\t\t\t\tdirection={sortDirection}\n\t\t\t\t\tactive={sortBy === 'reports.message.u.username'}\n\t\t\t\t\tonClick={setSort}\n\t\t\t\t\tsort='reports.message.u.username'\n\t\t\t\t>\n\t\t\t\t\t{t('Username')}\n\t\t\t\t</GenericTableHeaderCell>\n\t\t\t),\n\t\t\t<GenericTableHeaderCell\n\t\t\t\tkey='reportedMessage'\n\t\t\t\tdirection={sortDirection}\n\t\t\t\tactive={sortBy === 'reports.description'}\n\t\t\t\tonClick={setSort}\n\t\t\t\tsort='reports.description'\n\t\t\t>\n\t\t\t\t{t('Moderation_Reported_message')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='room' direction={sortDirection}>\n\t\t\t\t{t('Room')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='postdate' direction={sortDirection} active={sortBy === 'reports.ts'} onClick={setSort} sort='reports.ts'>\n\t\t\t\t{t('Moderation_Report_date')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='reports' direction={sortDirection} active={sortBy === 'count'} onClick={setSort} sort='count'>\n\t\t\t\t{t('Moderation_Report_plural')}\n\t\t\t</GenericTableHeaderCell>,\n\t\t\t<GenericTableHeaderCell key='actions' width='x48' />,\n\t\t],\n\t\t[sortDirection, sortBy, setSort, t, isDesktopOrLarger],\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FilterByText autoFocus placeholder={t('Search')} onChange={({ text }): void => setText(text)} />\n\t\t\t<Field alignSelf='stretch'>\n\t\t\t\t<FieldLabel>{t('Date')}</FieldLabel>\n\t\t\t\t<FieldRow>\n\t\t\t\t\t<DateRangePicker display='flex' flexGrow={1} onChange={setDateRange} />\n\t\t\t\t</FieldRow>\n\t\t\t</Field>\n\t\t\t{isLoading && (\n\t\t\t\t<GenericTable>\n\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t<GenericTableBody>{isLoading && <GenericTableLoadingTable headerCells={6} />}</GenericTableBody>\n\t\t\t\t</GenericTable>\n\t\t\t)}\n\t\t\t{isSuccess && data.reports.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t<GenericTable>\n\t\t\t\t\t\t<GenericTableHeader>{headers}</GenericTableHeader>\n\t\t\t\t\t\t<GenericTableBody>\n\t\t\t\t\t\t\t{data.reports.map((report) => (\n\t\t\t\t\t\t\t\t<ModerationConsoleTableRow\n\t\t\t\t\t\t\t\t\tkey={report.userId}\n\t\t\t\t\t\t\t\t\treport={report}\n\t\t\t\t\t\t\t\t\tonClick={handleClick}\n\t\t\t\t\t\t\t\t\tisDesktopOrLarger={isDesktopOrLarger}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</GenericTableBody>\n\t\t\t\t\t</GenericTable>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tcurrent={current}\n\t\t\t\t\t\tdivider\n\t\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\t\tcount={data?.total || 0}\n\t\t\t\t\t\tonSetItemsPerPage={onSetItemsPerPage}\n\t\t\t\t\t\tonSetCurrent={onSetCurrent}\n\t\t\t\t\t\t{...paginationProps}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{isSuccess && data.reports.length === 0 && <GenericNoResults />}\n\t\t</>\n\t);\n};\n\nexport default ModerationConsoleTable;\n",null],"names":["_regeneratorRuntime","_extends","_objectSpread","_objectWithoutProperties","_slicedToArray","Pagination","Field","FieldLabel","FieldRow","useDebouncedValue","useMediaQuery","useMutableCallback","useEndpoint","useToastMessageDispatch","useRoute","useTranslation","useQuery","React","useMemo","useState","FilterByText","GenericNoResults","GenericTable","GenericTableLoadingTable","GenericTableHeaderCell","GenericTableBody","GenericTableHeader","usePagination","useSort","ModerationConsoleTableRow","DateRangePicker","module","link","default","v","exportDefault","_useState2","text","setText","moderationRoute","t","isDesktopOrLarger","_useSort","sortBy","sortDirection","setSort","_usePagination","current","itemsPerPage","onSetItemsPerPage","setItemsPerPage","onSetCurrent","setCurrent","paginationProps","_excluded","_useState4","start","end","dateRange","setDateRange","query","_JSON$stringify","selector","sort","JSON","stringify","count","offset","latest","Date","toISOString","slice","oldest","getReports","dispatchToastMessage","_useQuery","async","_context","prev","next","abrupt","stop","Promise","onError","error","type","message","keepPreviousData","data","isLoading","isSuccess","handleClick","id","push","context","headers","createElement","key","direction","active","onClick","w","width","Fragment","autoFocus","placeholder","onChange","_ref","alignSelf","display","flexGrow","headerCells","reports","length","map","report","userId","divider","total"],"mappings":"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"}