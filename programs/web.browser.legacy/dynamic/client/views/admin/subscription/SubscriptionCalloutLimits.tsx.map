)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/subscription/SubscriptionCalloutLimits.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { LicenseBehavior } from '@rocket.chat/core-typings';\nimport { Callout } from '@rocket.chat/fuselage';\nimport { validateWarnLimit } from '@rocket.chat/license/src/validation/validateLimit';\nimport { ExternalLink } from '@rocket.chat/ui-client';\nimport React from 'react';\nimport { Trans, useTranslation } from 'react-i18next';\n\nimport { useLicense } from '../../../hooks/useLicense';\nimport { useCheckoutUrl } from './hooks/useCheckoutUrl';\n\nexport const SubscriptionCalloutLimits = () => {\n\tconst manageSubscriptionUrl = useCheckoutUrl();\n\n\tconst { t } = useTranslation();\n\tconst result = useLicense({ loadValues: true });\n\n\tif (result.isLoading || result.isError) {\n\t\treturn null;\n\t}\n\n\tconst { license, limits } = result.data;\n\n\tif (!license || !limits) {\n\t\treturn null;\n\t}\n\n\tconst keyLimits = Object.keys(limits) as Array<keyof typeof limits>;\n\n\t// Get the rule with the highest limit that applies to this key\n\n\tconst rules = keyLimits\n\t\t.map((key) => {\n\t\t\tconst rule = license.limits[key]\n\t\t\t\t?.filter((limit) => validateWarnLimit(limit.max, limits[key].value ?? 0, limit.behavior))\n\t\t\t\t.sort((a, b) => b.max - a.max)[0];\n\n\t\t\tif (!rule) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (rule.max === 0) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (rule.max === -1) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn [key, rule.behavior];\n\t\t})\n\t\t.filter(Boolean) as Array<[keyof typeof limits, LicenseBehavior]>;\n\n\tif (!rules.length) {\n\t\treturn null;\n\t}\n\n\t// Group by behavior\n\tconst groupedRules = rules.reduce((acc, [key, behavior]) => {\n\t\tif (!acc[behavior]) {\n\t\t\tacc[behavior] = [];\n\t\t}\n\n\t\tacc[behavior].push(key);\n\n\t\treturn acc;\n\t}, {} as Record<LicenseBehavior, (keyof typeof limits)[]>);\n\n\tconst { prevent_action, disable_modules, invalidate_license, start_fair_policy } = groupedRules;\n\n\tconst map = (key: keyof typeof limits) => t(`subscription.callout.${key}`);\n\n\treturn (\n\t\t<>\n\t\t\t{start_fair_policy && (\n\t\t\t\t<Callout type='warning' title={t('subscription.callout.servicesDisruptionsMayOccur')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsReached' count={start_fair_policy.length}>\n\t\t\t\t\t\tYour workspace reached the <>{{ val: start_fair_policy.map(map) }}</> limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'start_fair_policy',\n\t\t\t\t\t\t\t\tlimits: start_fair_policy.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\t\t\t{prevent_action && (\n\t\t\t\t<Callout type='danger' title={t('subscription.callout.servicesDisruptionsOccurring')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsExceeded' count={prevent_action.length}>\n\t\t\t\t\t\tYour workspace exceeded the <>{{ val: prevent_action.map(map) }}</> license limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'prevent_action',\n\t\t\t\t\t\t\t\tlimits: prevent_action.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\n\t\t\t{disable_modules && (\n\t\t\t\t<Callout type='danger' title={t('subscription.callout.capabilitiesDisabled')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsExceeded' count={disable_modules.length}>\n\t\t\t\t\t\tYour workspace exceeded the <>{{ val: disable_modules.map(map) }}</> license limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'disable_modules',\n\t\t\t\t\t\t\t\tlimits: disable_modules.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\n\t\t\t{invalidate_license && (\n\t\t\t\t<Callout type='danger' title={t('subscription.callout.allPremiumCapabilitiesDisabled')} m={8}>\n\t\t\t\t\t<Trans i18nKey='subscription.callout.description.limitsExceeded' count={disable_modules.length}>\n\t\t\t\t\t\tYour workspace exceeded the <>{{ val: invalidate_license.map(map) }}</> license limit.\n\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\tto={manageSubscriptionUrl({\n\t\t\t\t\t\t\t\ttarget: 'callout',\n\t\t\t\t\t\t\t\taction: 'invalidate_license',\n\t\t\t\t\t\t\t\tlimits: invalidate_license.join(','),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tManage your subscription\n\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\tto increase limits.\n\t\t\t\t\t</Trans>\n\t\t\t\t</Callout>\n\t\t\t)}\n\t\t</>\n\t);\n};\n",null],"names":["module","link","default","_slicedToArray","export","SubscriptionCalloutLimits","Callout","validateWarnLimit","ExternalLink","v","React","Trans","useTranslation","useLicense","useCheckoutUrl","manageSubscriptionUrl","t","_useTranslation","result","loadValues","isLoading","isError","_result$data","data","license","limits","rules","keyLimits","Object","keys","map","key","_license$limits$key","rule","filter","limit","_limits$key$value","max","value","behavior","sort","a","b","Boolean","length","groupedRules","reduce","acc","_ref","_ref2","push","prevent_action","disable_modules","invalidate_license","start_fair_policy","createElement","Fragment","type","title","m","i18nKey","count","val","to","target","action","join"],"mappings":"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"}