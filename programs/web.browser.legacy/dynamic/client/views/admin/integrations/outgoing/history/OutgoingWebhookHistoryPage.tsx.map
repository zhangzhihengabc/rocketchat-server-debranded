)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/integrations/outgoing/history/OutgoingWebhookHistoryPage.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Button, ButtonGroup, Pagination } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useRouteParameter, useMethod, useTranslation, useEndpoint, useRouter } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ComponentProps } from 'react';\nimport React, { useMemo, useState, useEffect } from 'react';\n\nimport { sdk } from '../../../../../../app/utils/client/lib/SDKClient';\nimport { usePagination } from '../../../../../components/GenericTable/hooks/usePagination';\nimport Page from '../../../../../components/Page';\nimport ScrollableContentWrapper from '../../../../../components/ScrollableContentWrapper';\nimport HistoryContent from './HistoryContent';\n\nconst OutgoingWebhookHistoryPage = (props: ComponentProps<typeof Page>) => {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\n\tconst { itemsPerPage, setItemsPerPage, current, setCurrent, itemsPerPageLabel, showingResultsLabel } = usePagination();\n\n\tconst [mounted, setMounted] = useState(false);\n\tconst [total, setTotal] = useState(0);\n\n\tconst clearIntegrationHistory = useMethod('clearIntegrationHistory');\n\n\tconst id = useRouteParameter('id') as string;\n\n\tconst query = useMemo(\n\t\t() => ({\n\t\t\tid,\n\t\t\tcount: itemsPerPage,\n\t\t\toffset: current,\n\t\t}),\n\t\t[id, itemsPerPage, current],\n\t);\n\n\tconst fetchHistory = useEndpoint('GET', '/v1/integrations.history');\n\n\tconst queryKey = useMemo(() => ['integrations/history', id, itemsPerPage, current], [id, itemsPerPage, current]);\n\n\tconst queryClient = useQueryClient();\n\n\ttype HistoryData = Awaited<ReturnType<typeof fetchHistory>>;\n\n\tconst { data, isLoading, refetch } = useQuery(\n\t\tqueryKey,\n\t\tasync () => {\n\t\t\tconst result = fetchHistory(query);\n\t\t\tsetMounted(true);\n\t\t\treturn result;\n\t\t},\n\t\t{\n\t\t\tcacheTime: 99999,\n\t\t\tstaleTime: 99999,\n\t\t},\n\t);\n\n\tconst handleClearHistory = async (): Promise<void> => {\n\t\ttry {\n\t\t\tawait clearIntegrationHistory(id);\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Integration_History_Cleared') });\n\t\t\trefetch();\n\t\t\tsetMounted(false);\n\t\t} catch (e) {\n\t\t\tdispatchToastMessage({ type: 'error', message: e });\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tif (mounted) {\n\t\t\treturn sdk.stream('integrationHistory', [id], (integration) => {\n\t\t\t\tif (integration.type === 'inserted') {\n\t\t\t\t\tsetTotal((total) => total + 1);\n\t\t\t\t\tqueryClient.setQueryData<HistoryData>(queryKey, (oldData): HistoryData | undefined => {\n\t\t\t\t\t\tif (!oldData || !integration.data) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...oldData,\n\t\t\t\t\t\t\thistory: [integration.data as unknown as HistoryData['history'][number]].concat(oldData.history),\n\t\t\t\t\t\t\ttotal: oldData.total + 1,\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (integration.type === 'updated') {\n\t\t\t\t\tqueryClient.setQueryData<HistoryData>(queryKey, (oldData): HistoryData | undefined => {\n\t\t\t\t\t\tif (!oldData) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst index = oldData.history.findIndex(({ _id }) => _id === id);\n\t\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tObject.assign(oldData.history[index], integration.diff);\n\t\t\t\t\t\treturn { ...oldData };\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (integration.type === 'removed') {\n\t\t\t\t\trefetch();\n\t\t\t\t}\n\t\t\t}).stop;\n\t\t}\n\t}, [id, mounted, queryClient, queryKey, refetch]);\n\n\treturn (\n\t\t<Page flexDirection='column' {...props}>\n\t\t\t<Page.Header title={t('Integration_Outgoing_WebHook_History')}>\n\t\t\t\t<ButtonGroup>\n\t\t\t\t\t<Button icon='back' onClick={() => router.navigate(`/admin/integrations/edit/outgoing/${id}`)}>\n\t\t\t\t\t\t{t('Back')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button icon='trash' danger onClick={handleClearHistory} disabled={total === 0}>\n\t\t\t\t\t\t{t('clear_history')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</Page.Header>\n\t\t\t<Page.Content>\n\t\t\t\t<ScrollableContentWrapper>\n\t\t\t\t\t<HistoryContent key='historyContent' data={data?.history || []} isLoading={isLoading} />\n\t\t\t\t</ScrollableContentWrapper>\n\t\t\t\t<Pagination\n\t\t\t\t\tcurrent={current}\n\t\t\t\t\titemsPerPage={itemsPerPage}\n\t\t\t\t\titemsPerPageLabel={itemsPerPageLabel}\n\t\t\t\t\tshowingResultsLabel={showingResultsLabel}\n\t\t\t\t\tcount={data?.total || 0}\n\t\t\t\t\tonSetItemsPerPage={setItemsPerPage}\n\t\t\t\t\tonSetCurrent={setCurrent}\n\t\t\t\t/>\n\t\t\t</Page.Content>\n\t\t</Page>\n\t);\n};\n\nexport default OutgoingWebhookHistoryPage;\n",null],"names":["_regeneratorRuntime","_extends","_objectSpread","_slicedToArray","Button","ButtonGroup","Pagination","useToastMessageDispatch","useRouteParameter","useMethod","useTranslation","useEndpoint","useRouter","useQuery","useQueryClient","React","useMemo","useState","useEffect","sdk","usePagination","Page","ScrollableContentWrapper","HistoryContent","module","link","default","v","exportDefault","props","dispatchToastMessage","t","router","_usePagination","itemsPerPage","setItemsPerPage","current","setCurrent","itemsPerPageLabel","showingResultsLabel","_useState2","mounted","setMounted","_useState4","total","setTotal","clearIntegrationHistory","id","query","count","offset","fetchHistory","queryKey","queryClient","_useQuery","result","async","_context","prev","next","abrupt","stop","Promise","cacheTime","staleTime","data","isLoading","refetch","stream","integration","type","setQueryData","oldData","history","concat","index","findIndex","_ref","_id","Object","assign","diff","createElement","flexDirection","Header","title","icon","onClick","navigate","danger","_context2","awrap","message","t0","disabled","Content","key","onSetItemsPerPage","onSetCurrent"],"mappings":"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"}