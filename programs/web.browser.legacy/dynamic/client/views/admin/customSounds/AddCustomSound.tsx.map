)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/customSounds/AddCustomSound.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Field, FieldLabel, FieldRow, TextInput, Box, Icon, Margins, Button, ButtonGroup } from '@rocket.chat/fuselage';\nimport { useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, FormEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\n\nimport { ContextualbarScrollableContent, ContextualbarFooter } from '../../../components/Contextualbar';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\ntype AddCustomSoundProps = {\n\tgoToNew: (_id: string) => () => void;\n\tclose: () => void;\n\tonChange: () => void;\n};\n\nconst AddCustomSound = ({ goToNew, close, onChange, ...props }: AddCustomSoundProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [name, setName] = useState('');\n\tconst [sound, setSound] = useState<{ name: string }>();\n\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\tconst saveAction = useCallback(\n\t\tasync (name, soundFile): Promise<string | undefined> => {\n\t\t\tconst soundData = createSoundData(soundFile, name);\n\t\t\tconst validation = validate(soundData, soundFile) as Array<Parameters<typeof t>[0]>;\n\n\t\t\tvalidation.forEach((error) => {\n\t\t\t\tthrow new Error(t('error-the-field-is-required', { field: t(error) }));\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst soundId = await insertOrUpdateSound(soundData);\n\n\t\t\t\tif (!soundId) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\tconst reader = new FileReader();\n\t\t\t\treader.readAsBinaryString(soundFile);\n\t\t\t\treader.onloadend = (): void => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tuploadCustomSound(reader.result as string, soundFile.type, {\n\t\t\t\t\t\t\t...soundData,\n\t\t\t\t\t\t\t_id: soundId,\n\t\t\t\t\t\t\trandom: Math.round(Math.random() * 1000),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t(typeof error === 'string' || error instanceof Error) && dispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treturn soundId;\n\t\t\t} catch (error) {\n\t\t\t\t(typeof error === 'string' || error instanceof Error) && dispatchToastMessage({ type: 'error', message: error });\n\t\t\t}\n\t\t},\n\t\t[dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\ttry {\n\t\t\tconst result = await saveAction(name, sound);\n\t\t\tif (result) {\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Saved_Successfully') });\n\t\t\t}\n\t\t\tresult && goToNew(result);\n\t\t\tonChange();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent {...props}>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Name')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\t\tonChange={(e: FormEvent<HTMLInputElement>): void => setName(e.currentTarget.value)}\n\t\t\t\t\t\t\tplaceholder={t('Name')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel alignSelf='stretch'>{t('Sound_File_mp3')}</FieldLabel>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t\t{/* FIXME: replace to IconButton */}\n\t\t\t\t\t\t\t<Button square onClick={clickUpload}>\n\t\t\t\t\t\t\t\t<Icon name='upload' size='x20' />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{sound?.name || t('None')}\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t</Field>\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button mie={4} onClick={close}>\n\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button primary onClick={handleSave} disabled={name === ''}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n};\n\nexport default AddCustomSound;\n",null],"names":["_regeneratorRuntime","_objectSpread","_slicedToArray","_objectWithoutProperties","Field","FieldLabel","FieldRow","TextInput","Box","Icon","Margins","Button","ButtonGroup","useToastMessageDispatch","useMethod","useTranslation","React","useState","useCallback","ContextualbarScrollableContent","ContextualbarFooter","useFileInput","validate","createSoundData","module","link","default","v","exportDefault","_ref","goToNew","close","onChange","props","_excluded","t","dispatchToastMessage","_useState2","name","setName","_useState4","sound","setSound","uploadCustomSound","insertOrUpdateSound","clickUpload","_useFileInput2","soundFile","saveAction","soundData","soundId","reader","async","_context","prev","next","validation","forEach","error","Error","field","awrap","sent","abrupt","undefined","type","message","FileReader","readAsBinaryString","onloadend","result","_id","random","Math","round","t0","stop","Promise","handleSave","_context2","createElement","Fragment","value","e","currentTarget","placeholder","alignSelf","display","flexDirection","mbs","inline","square","onClick","size","stretch","mie","primary","disabled"],"mappings":"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"}