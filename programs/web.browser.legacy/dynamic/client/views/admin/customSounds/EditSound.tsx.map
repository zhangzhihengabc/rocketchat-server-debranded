)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/views/admin/customSounds/EditSound.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Button, ButtonGroup, Margins, TextInput, Field, FieldLabel, FieldRow, IconButton } from '@rocket.chat/fuselage';\nimport { useSetModal, useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, SyntheticEvent } from 'react';\nimport React, { useCallback, useState, useMemo, useEffect } from 'react';\n\nimport { ContextualbarScrollableContent, ContextualbarFooter } from '../../../components/Contextualbar';\nimport GenericModal from '../../../components/GenericModal';\nimport { useFileInput } from '../../../hooks/useFileInput';\nimport { validate, createSoundData } from './lib';\n\ntype EditSoundProps = {\n\tclose?: () => void;\n\tonChange: () => void;\n\tdata: {\n\t\t_id: string;\n\t\tname: string;\n\t\textension?: string;\n\t};\n};\n\nfunction EditSound({ close, onChange, data, ...props }: EditSoundProps): ReactElement {\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst { _id, name: previousName } = data || {};\n\tconst previousSound = useMemo(() => data || {}, [data]);\n\n\tconst [name, setName] = useState(() => data?.name ?? '');\n\tconst [sound, setSound] = useState(() => data);\n\n\tuseEffect(() => {\n\t\tsetName(previousName || '');\n\t\tsetSound(previousSound || '');\n\t}, [previousName, previousSound, _id]);\n\n\tconst deleteCustomSound = useMethod('deleteCustomSound');\n\tconst uploadCustomSound = useMethod('uploadCustomSound');\n\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\n\n\tconst handleChangeFile = useCallback((soundFile) => {\n\t\tsetSound(soundFile);\n\t}, []);\n\n\tconst hasUnsavedChanges = useMemo(() => previousName !== name || previousSound !== sound, [name, previousName, previousSound, sound]);\n\n\tconst saveAction = useCallback(\n\t\tasync (sound) => {\n\t\t\tconst soundData = createSoundData(sound, name, { previousName, previousSound, _id, extension: sound.extension });\n\t\t\tconst validation = validate(soundData, sound);\n\t\t\tif (validation.length === 0) {\n\t\t\t\tlet soundId: string;\n\t\t\t\ttry {\n\t\t\t\t\tsoundId = await insertOrUpdateSound(soundData);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsoundData._id = soundId;\n\t\t\t\tsoundData.random = Math.round(Math.random() * 1000);\n\n\t\t\t\tif (sound && sound !== previousSound) {\n\t\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\n\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.readAsBinaryString(sound);\n\t\t\t\t\treader.onloadend = (): void => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tuploadCustomSound(reader.result as string, sound.type, { ...soundData, _id: soundId });\n\t\t\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvalidation.forEach((error) =>\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('error-the-field-is-required', { field: t(error) }),\n\t\t\t\t}),\n\t\t\t);\n\t\t},\n\t\t[_id, dispatchToastMessage, insertOrUpdateSound, name, previousName, previousSound, t, uploadCustomSound],\n\t);\n\n\tconst handleSave = useCallback(async () => {\n\t\tsaveAction(sound);\n\t\tonChange();\n\t}, [saveAction, sound, onChange]);\n\n\tconst handleDeleteButtonClick = useCallback(() => {\n\t\tconst handleDelete = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait deleteCustomSound(_id);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Has_Been_Deleted') });\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\t} finally {\n\t\t\t\tsetModal(null);\n\t\t\t\tclose?.();\n\t\t\t\tonChange();\n\t\t\t}\n\t\t};\n\n\t\tconst handleCancel = (): void => setModal(null);\n\n\t\tsetModal(() => (\n\t\t\t<GenericModal variant='danger' onConfirm={handleDelete} onCancel={handleCancel} onClose={handleCancel} confirmText={t('Delete')}>\n\t\t\t\t{t('Custom_Sound_Delete_Warning')}\n\t\t\t</GenericModal>\n\t\t));\n\t}, [_id, close, deleteCustomSound, dispatchToastMessage, onChange, setModal, t]);\n\n\tconst [clickUpload] = useFileInput(handleChangeFile, 'audio/mp3');\n\n\treturn (\n\t\t<>\n\t\t\t<ContextualbarScrollableContent {...props}>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel>{t('Name')}</FieldLabel>\n\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\t\tonChange={(e: SyntheticEvent<HTMLInputElement>): void => setName(e.currentTarget.value)}\n\t\t\t\t\t\t\tplaceholder={t('Name')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FieldRow>\n\t\t\t\t</Field>\n\t\t\t\t<Field>\n\t\t\t\t\t<FieldLabel alignSelf='stretch'>{t('Sound_File_mp3')}</FieldLabel>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Margins inline={4}>\n\t\t\t\t\t\t\t<IconButton icon='upload' secondary onClick={clickUpload} />\n\t\t\t\t\t\t\t{sound?.name || 'none'}\n\t\t\t\t\t\t</Margins>\n\t\t\t\t\t</Box>\n\t\t\t\t</Field>\n\t\t\t</ContextualbarScrollableContent>\n\t\t\t<ContextualbarFooter>\n\t\t\t\t<ButtonGroup stretch>\n\t\t\t\t\t<Button onClick={close}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button primary onClick={handleSave} disabled={!hasUnsavedChanges}>\n\t\t\t\t\t\t{t('Save')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t\t<ButtonGroup mbs={8} stretch>\n\t\t\t\t\t<Button icon='trash' danger onClick={handleDeleteButtonClick}>\n\t\t\t\t\t\t{t('Delete')}\n\t\t\t\t\t</Button>\n\t\t\t\t</ButtonGroup>\n\t\t\t</ContextualbarFooter>\n\t\t</>\n\t);\n}\n\nexport default EditSound;\n",null],"names":["_regeneratorRuntime","_objectSpread","_slicedToArray","_objectWithoutProperties","Box","Button","ButtonGroup","Margins","TextInput","Field","FieldLabel","FieldRow","useSetModal","useToastMessageDispatch","useMethod","useTranslation","React","useCallback","useState","useMemo","useEffect","ContextualbarScrollableContent","ContextualbarFooter","GenericModal","useFileInput","validate","createSoundData","module","default","v","link","IconButton","exportDefault","_ref","close","onChange","data","props","_excluded","t","dispatchToastMessage","setModal","_ref2","_id","previousName","name","previousSound","_useState2","_data$name","setName","_useState4","sound","setSound","deleteCustomSound","uploadCustomSound","insertOrUpdateSound","handleChangeFile","soundFile","hasUnsavedChanges","saveAction","soundData","validation","soundId","reader","async","_context","prev","next","extension","length","awrap","sent","t0","type","message","abrupt","random","Math","round","FileReader","readAsBinaryString","onloadend","result","error","forEach","field","stop","Promise","handleSave","_context2","handleDeleteButtonClick","handleDelete","_context3","finish","handleCancel","createElement","variant","onConfirm","onCancel","onClose","confirmText","clickUpload","_useFileInput2","Fragment","value","e","currentTarget","placeholder","alignSelf","display","flexDirection","mbs","inline","icon","secondary","onClick","stretch","primary","disabled","danger"],"mappings":"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"}