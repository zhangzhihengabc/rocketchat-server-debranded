function module(e,n,t){t.link("@babel/runtime/regenerator",{default:function(e){o=e}},0),t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){i=e}},1),t.export({CallProvider:function(){return U}}),t.link("@rocket.chat/core-typings",{VoipClientEvents:function(e){r=e},isVoipEventAgentCalled:function(e){u=e},isVoipEventAgentConnected:function(e){l=e},isVoipEventCallerJoined:function(e){a=e},isVoipEventQueueMemberAdded:function(e){c=e},isVoipEventQueueMemberRemoved:function(e){d=e},isVoipEventCallAbandoned:function(e){s=e},UserState:function(e){f=e}},0),t.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){v=e}},1),t.link("@rocket.chat/random",{Random:function(e){p=e}},2),t.link("@rocket.chat/ui-contexts",{useRouter:function(e){C=e},useUser:function(e){m=e},useSetting:function(e){g=e},useEndpoint:function(e){b=e},useStream:function(e){k=e},useSetOutputMediaDevice:function(e){E=e},useSetInputMediaDevice:function(e){h=e},useSetModal:function(e){w=e},useTranslation:function(e){x=e}},3),t.link("react",{default:function(e){A=e},useMemo:function(e){q=e},useRef:function(e){N=e},useCallback:function(e){I=e},useEffect:function(e){_=e},useState:function(e){M=e}},4),t.link("react-dom",{createPortal:function(e){R=e}},5),t.link("../../../ee/client/hooks/useVoipClient",{isOutboundClient:function(e){S=e},useVoipClient:function(e){y=e}},6),t.link("../../../ee/client/lib/voip/parseOutboundPhoneNumber",{parseOutboundPhoneNumber:function(e){P=e}},7),t.link("../../../ee/client/voip/components/modals/WrapUpCallModal",{WrapUpCallModal:function(e){D=e}},8),t.link("../../contexts/CallContext",{CallContext:function(e){V=e},useIsVoipEnterprise:function(e){O=e}},9),t.link("../../hooks/useDialModal",{useDialModal:function(e){T=e}},10),t.link("../../lib/rooms/roomCoordinator",{roomCoordinator:function(e){B=e}},11),t.link("./hooks/useVoipSounds",{useVoipSounds:function(e){L=e}},12);var o,i,r,u,l,a,c,d,s,f,v,p,C,m,g,b,k,E,h,w,x,A,q,N,I,_,M,R,S,y,P,D,V,O,T,B,L,U=function(e){var n=e.children,t=i(M("unregistered"),2),U=t[0],W=t[1],Q=g("VoIP_Enabled"),F=k("notify-user"),j=b("POST","/v1/voip/events"),H=b("POST","/v1/livechat/visitor"),G=b("GET","/v1/voip/room"),J=b("POST","/v1/voip/room.close"),z=b("GET","/v1/omnichannel/contact.search"),K=w(),X=x(),Y=y(),Z=m(),$=C(),ee=E(),en=h(),et=O(),eo=N(null),ei=i(M(0),2),er=ei[0],eu=ei[1],el=i(M(""),2),ea=el[0],ec=el[1],ed=i(M({v:{},rid:""}),2),es=ed[0],ef=ed[1],ev=T().openDialModal,ep=L(),eC=I(function(){var e,n,t,i=arguments;return o.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=i.length>0&&void 0!==i[0]?i[0]:{},r.t0=es,!r.t0){r.next=5;break}return r.next=5,o.awrap(J({rid:es.rid,token:es.v.token||"",options:{comment:null==n?void 0:n.comment,tags:null==n?void 0:n.tags}}));case 5:$.navigate("/home"),(t=null===(e=Y.voipClient)||void 0===e?void 0:e.getAggregator())&&t.callEnded();case 8:case"end":return r.stop()}},null,null,null,Promise)},[$,null==Y?void 0:Y.voipClient,es,J]),em=I(function(){K(function(){return A.createElement(D,{closeRoom:eC})})},[eC,K]),eg=v(function(e){(null==eo?void 0:eo.current)&&ee({outputDevice:e,HTMLAudioElement:eo.current})}),eb=v(function(e){if(Y.voipClient){var n={audio:{deviceId:{exact:e.id}}};Y.voipClient.changeAudioInputDevice(n),en(e)}}),ek=i(M(),2),eE=ek[0],eh=ek[1],ew=i(M("online"),2),ex=ew[0],eA=ew[1];_(function(){var e=(Y||{}).voipClient;if(e)return eh(e.getAggregator()),function(){if("registered"===U)return e.unregister()}},[Y,U]);var eq=I(function(e){B.openRouteLink("v",{rid:e})},[]),eN=I(function(e){var n,t,i;return o.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=P(e.callerId),r.next=3,o.awrap(z({phone:n}));case 3:if(!(t=r.sent.contact)){r.next=7;break}return r.abrupt("return",t);case 7:return r.next=9,o.awrap(H({visitor:{token:p.id(),phone:n,name:e.callerName||n}}));case 9:return i=r.sent.visitor,r.abrupt("return",i);case 12:case"end":return r.stop()}},null,null,null,Promise)},[z,H]),eI=I(function(e){var n,t,i,r,u,l=arguments;return o.async(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:"inbound",Z){a.next=3;break}return a.abrupt("return","");case 3:return a.prev=3,a.next=6,o.awrap(eN(e));case 6:return i=a.sent,a.next=9,o.awrap(G({token:i.token,agentId:Z._id,direction:n}));case 9:return eq((r=a.sent).room._id),r.room&&ef({v:{token:r.room.v.token},rid:r.room._id}),(u=null===(t=Y.voipClient)||void 0===t?void 0:t.getAggregator())&&u.callStarted(),a.abrupt("return",r.room._id);case 17:return a.prev=17,a.t0=a.catch(3),console.error("Error while creating a visitor "+a.t0),a.abrupt("return","");case 21:case"end":return a.stop()}},null,null,[[3,17]],Promise)},[eq,Y.voipClient,Z,G,eN]);_(function(){if(Q&&Z&&eE)return F(Z._id+"/voip.events",function(e){var n,t,i,r,f,v;return o.async(function(o){for(;;)switch(o.prev=o.next){case 0:if(!u(e)){o.next=5;break}return n=e.data,eE.callRinging({queuename:n.queue,callerid:n.callerId}),ec(eE.getCurrentQueueName()),o.abrupt("return");case 5:if(!l(e)){o.next=11;break}return t=e.data,eE.callPickedup({queuename:t.queue,queuedcalls:t.queuedCalls,waittimeinqueue:t.waitTimeInQueue}),ec(eE.getCurrentQueueName()),eu(eE.getCallWaitingCount()),o.abrupt("return");case 11:if(!a(e)){o.next=16;break}return i=e.data,eE.queueJoined({queuename:i.queue,callerid:i.callerId,queuedcalls:i.queuedCalls}),eu(eE.getCallWaitingCount()),o.abrupt("return");case 16:if(!c(e)){o.next=22;break}return r=e.data,eE.memberAdded({queuename:r.queue,queuedcalls:r.queuedCalls}),ec(eE.getCurrentQueueName()),eu(eE.getCallWaitingCount()),o.abrupt("return");case 22:if(!d(e)){o.next=27;break}return f=e.data,eE.memberRemoved({queuename:f.queue,queuedcalls:f.queuedCalls}),eu(eE.getCallWaitingCount()),o.abrupt("return");case 27:if(!s(e)){o.next=33;break}return v=e.data,eE.queueAbandoned({queuename:v.queue,queuedcallafterabandon:v.queuedCallAfterAbandon}),ec(eE.getCurrentQueueName()),eu(eE.getCallWaitingCount()),o.abrupt("return");case 33:console.warn("Unknown event received");case 34:case"end":return o.stop()}},null,null,null,Promise)})},[F,Z,eE,Q]),_(function(){if(Q&&Z&&eE)return F(Z._id+"/call.hangup",function(e){if(ec(eE.getCurrentQueueName()),et){em();return}eC(),j({event:r["VOIP-CALL-ENDED"],rid:e.roomId})})},[em,eE,F,Z,Q,j,et,eC]),_(function(){if(Y.voipClient){var e=Y.voipClient.on("registered",function(){return W("registered")}),n=Y.voipClient.on("unregistered",function(){return W("unregistered")});return function(){e(),n()}}},[Y.voipClient]),_(function(){Y.voipClient&&eo.current&&Y.voipClient.switchMediaRenderer({remoteMediaElement:eo.current})},[Y.voipClient]),_(function(){if(Y.voipClient&&Z){var e=function(e){var n,t,i;return o.async(function(u){for(;;)switch(u.prev=u.next){case 0:if(e.callInfo){u.next=2;break}return u.abrupt("return");case 2:if(ep.stopAll(),!(e.userState!==f.UAC)){u.next=5;break}return u.abrupt("return");case 5:return t=e.callInfo,eo.current&&(null===(n=Y.voipClient)||void 0===n||n.switchMediaRenderer({remoteMediaElement:eo.current})),u.next=9,o.awrap(eI(t,"outbound"));case 9:i=u.sent,j({event:r["VOIP-CALL-STARTED"],rid:i});case 11:case"end":return u.stop()}},null,null,null,Promise)},n=function(){"offline"===ex&&eA("online")},t=function(){var e,n,t;if("online"===ex)switch(eA("offline"),null===(t=Y.voipClient)||void 0===t?void 0:t.callerInfo.state){case"IN_CALL":case"ON_HOLD":null===(e=Y.voipClient)||void 0===e||e.endCall();break;case"OFFER_RECEIVED":case"ANSWER_SENT":null===(n=Y.voipClient)||void 0===n||n.rejectCall()}},i=function(){ep.play("outbound-call-ringing")},u=function(){ep.play("telephone")},l=function(){ep.play("call-ended",!1),ep.stopAll()},a=function(e){switch(e){case"Not Found":ev({errorMessage:X("Dialed_number_doesnt_exist")});break;case"Address Incomplete":ev({errorMessage:X("Dialed_number_is_incomplete")});break;case"Request Terminated":break;default:ev({errorMessage:X("Something_went_wrong_try_again_later")})}};return Y.voipClient.onNetworkEvent("connected",n),Y.voipClient.onNetworkEvent("disconnected",t),Y.voipClient.onNetworkEvent("connectionerror",t),Y.voipClient.onNetworkEvent("localnetworkonline",n),Y.voipClient.onNetworkEvent("localnetworkoffline",t),Y.voipClient.on("callestablished",e),Y.voipClient.on("ringing",i),Y.voipClient.on("incomingcall",u),Y.voipClient.on("callterminated",l),S(Y.voipClient)&&Y.voipClient.on("callfailed",a),function(){var o,r,c,d,s,f,v,p,C,m;null===(o=Y.voipClient)||void 0===o||o.offNetworkEvent("connected",n),null===(r=Y.voipClient)||void 0===r||r.offNetworkEvent("disconnected",t),null===(c=Y.voipClient)||void 0===c||c.offNetworkEvent("connectionerror",t),null===(d=Y.voipClient)||void 0===d||d.offNetworkEvent("localnetworkonline",n),null===(s=Y.voipClient)||void 0===s||s.offNetworkEvent("localnetworkoffline",t),null===(f=Y.voipClient)||void 0===f||f.off("incomingcall",u),null===(v=Y.voipClient)||void 0===v||v.off("ringing",i),null===(p=Y.voipClient)||void 0===p||p.off("callestablished",e),null===(C=Y.voipClient)||void 0===C||C.off("callterminated",l),S(Y.voipClient)&&(null===(m=Y.voipClient)||void 0===m||m.off("callfailed",a))}}},[eI,j,ex,ev,Y.voipClient,ep,X,Z]);var e_=q(function(){if(!Q||!(null!=Z&&Z.extension))return{enabled:!1,ready:!1,outBoundCallsAllowed:void 0,outBoundCallsEnabled:void 0,outBoundCallsEnabledForUser:void 0};if(Y.error)return{enabled:!0,ready:!1,error:Y.error,outBoundCallsAllowed:void 0,outBoundCallsEnabled:void 0,outBoundCallsEnabledForUser:void 0};if(!Y.voipClient)return{enabled:!0,ready:!1,outBoundCallsAllowed:void 0,outBoundCallsEnabled:void 0,outBoundCallsEnabledForUser:void 0};var e=Y.registrationInfo,n=Y.voipClient;return{outBoundCallsAllowed:et,outBoundCallsEnabled:et,outBoundCallsEnabledForUser:et&&"registered"===U&&!["IN_CALL","ON_HOLD"].includes(n.callerInfo.state),enabled:!0,ready:!0,openedRoomInfo:es,voipClient:n,registrationInfo:e,queueCounter:er,queueName:ea,actions:{mute:function(){return n.muteCall(!0)},unmute:function(){return n.muteCall(!1)},pause:function(){return n.holdCall(!0)},resume:function(){return n.holdCall(!1)},end:function(){return n.endCall()},pickUp:function(){return o.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",eo.current&&n.acceptCall({remoteMediaElement:eo.current}));case 1:case"end":return e.stop()}},null,null,null,Promise)},reject:function(){return n.rejectCall()}},openRoom:eq,createRoom:eI,closeRoom:eC,networkStatus:ex,openWrapUpModal:em,changeAudioOutputDevice:eg,changeAudioInputDevice:eb,register:function(){return n.register()},unregister:function(){return n.unregister()}}},[Q,null==Z?void 0:Z.extension,Y,et,U,es,er,ea,eq,eI,eC,em,eg,eb,ex]);return A.createElement(V.Provider,{value:e_},n,e_.enabled&&R(A.createElement("audio",{ref:eo}),document.body))}}
//# sourceMappingURL=/dynamic/client/providers/CallProvider/4ecfc5314d55ebf349dc514285b1f229f7166525.map
