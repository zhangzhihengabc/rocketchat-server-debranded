)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/DeviceProvider/DeviceProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { Device, IExperimentalHTMLAudioElement, DeviceContextValue } from '@rocket.chat/ui-contexts';\nimport { DeviceContext } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ReactNode } from 'react';\nimport React, { useEffect, useState, useMemo } from 'react';\n\nimport { isSetSinkIdAvailable } from './lib/isSetSinkIdAvailable';\n\ntype DeviceProviderProps = {\n\tchildren?: ReactNode | undefined;\n};\n\nexport const DeviceProvider = ({ children }: DeviceProviderProps): ReactElement => {\n\tconst [enabled] = useState(typeof isSecureContext && isSecureContext);\n\tconst [availableAudioOutputDevices, setAvailableAudioOutputDevices] = useState<Device[]>([]);\n\tconst [availableAudioInputDevices, setAvailableAudioInputDevices] = useState<Device[]>([]);\n\tconst [selectedAudioOutputDevice, setSelectedAudioOutputDevice] = useState<Device>({\n\t\tid: 'default',\n\t\tlabel: '',\n\t\ttype: 'audio',\n\t});\n\tconst [selectedAudioInputDevice, setSelectedAudioInputDevice] = useState<Device>({\n\t\tid: 'default',\n\t\tlabel: '',\n\t\ttype: 'audio',\n\t});\n\n\tconst setAudioInputDevice = (device: Device): void => {\n\t\tif (!isSecureContext) {\n\t\t\tthrow new Error('Device Changes are not available on insecure contexts');\n\t\t}\n\t\tsetSelectedAudioInputDevice(device);\n\t};\n\n\tconst setAudioOutputDevice = useMutableCallback(\n\t\t({ outputDevice, HTMLAudioElement }: { outputDevice: Device; HTMLAudioElement: IExperimentalHTMLAudioElement }): void => {\n\t\t\tif (!isSetSinkIdAvailable()) {\n\t\t\t\tthrow new Error('setSinkId is not available in this browser');\n\t\t\t}\n\t\t\tif (!enabled) {\n\t\t\t\tthrow new Error('Device Changes are not available on insecure contexts');\n\t\t\t}\n\t\t\tsetSelectedAudioOutputDevice(outputDevice);\n\t\t\tHTMLAudioElement.setSinkId(outputDevice.id);\n\t\t},\n\t);\n\n\tuseEffect(() => {\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\t\tconst setMediaDevices = (): void => {\n\t\t\tnavigator.mediaDevices?.enumerateDevices().then((devices) => {\n\t\t\t\tconst audioInput: Device[] = [];\n\t\t\t\tconst audioOutput: Device[] = [];\n\t\t\t\tdevices.forEach((device) => {\n\t\t\t\t\tconst mediaDevice: Device = {\n\t\t\t\t\t\tid: device.deviceId,\n\t\t\t\t\t\tlabel: device.label,\n\t\t\t\t\t\ttype: device.kind,\n\t\t\t\t\t};\n\t\t\t\t\tif (device.kind === 'audioinput') {\n\t\t\t\t\t\taudioInput.push(mediaDevice);\n\t\t\t\t\t} else if (device.kind === 'audiooutput') {\n\t\t\t\t\t\taudioOutput.push(mediaDevice);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetAvailableAudioOutputDevices(audioOutput);\n\t\t\t\tsetAvailableAudioInputDevices(audioInput);\n\t\t\t});\n\t\t};\n\n\t\tnavigator.mediaDevices?.addEventListener('devicechange', setMediaDevices);\n\t\tsetMediaDevices();\n\n\t\treturn (): void => {\n\t\t\tnavigator.mediaDevices?.removeEventListener('devicechange', setMediaDevices);\n\t\t};\n\t}, [enabled]);\n\n\tconst contextValue = useMemo((): DeviceContextValue => {\n\t\tif (!enabled) {\n\t\t\treturn {\n\t\t\t\tenabled,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tenabled,\n\t\t\tavailableAudioOutputDevices,\n\t\t\tavailableAudioInputDevices,\n\t\t\tselectedAudioOutputDevice,\n\t\t\tselectedAudioInputDevice,\n\t\t\tsetAudioOutputDevice,\n\t\t\tsetAudioInputDevice,\n\t\t};\n\t}, [\n\t\tavailableAudioInputDevices,\n\t\tavailableAudioOutputDevices,\n\t\tenabled,\n\t\tselectedAudioInputDevice,\n\t\tselectedAudioOutputDevice,\n\t\tsetAudioOutputDevice,\n\t]);\n\treturn <DeviceContext.Provider value={contextValue}>{children}</DeviceContext.Provider>;\n};\n",null],"names":["module","default","v","_typeof","_slicedToArray","export","DeviceProvider","useMutableCallback","DeviceContext","React","useEffect","useState","useMemo","isSetSinkIdAvailable","_ref","children","enabled","_useState2","isSecureContext","_useState4","availableAudioOutputDevices","setAvailableAudioOutputDevices","_useState6","availableAudioInputDevices","setAvailableAudioInputDevices","_useState8","id","label","type","selectedAudioOutputDevice","setSelectedAudioOutputDevice","_useState10","selectedAudioInputDevice","setSelectedAudioInputDevice","setAudioInputDevice","device","Error","setAudioOutputDevice","_ref2","outputDevice","HTMLAudioElement","setSinkId","_navigator$mediaDevic2","setMediaDevices","_navigator$mediaDevic","navigator","mediaDevices","enumerateDevices","then","devices","audioInput","audioOutput","forEach","mediaDevice","deviceId","kind","push","addEventListener","_navigator$mediaDevic3","removeEventListener","contextValue","createElement","Provider","value"],"mappings":"uBAASA,EAAAA,IAAAA,CAAAA,gCAA0B,CAAAC,QAA8B,SAAAC,CAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAC,QAAAA,SAAAA,CAAAA,EAAAG,EAAAA,CAAA,CAAA,EAAA,GAAjEJ,EAAOK,MAAE,CAAA,CAAAC,eAAoB,WAAM,OAAAA,CAAA,CAAA,GAA8BN,EAAAA,IAAAA,CAAAA,8BAAAA,CAAAO,mBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAP,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAQ,cAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAE,CAAA,EAAAO,EAAAA,CAAA,EAAAC,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAZ,EAAAA,IAAAA,CAAAA,6BAAAA,CAAAa,qBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAY1D,IAZPV,EAAiEC,EAAAG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAYpDP,EAAiB,SAAAQ,CAAA,EAAoD,IAAjDC,EAAQD,EAARC,QAAQ,CACjCC,EAAOC,AAAuDb,EAAnDO,EAAS,CAAA,AAAsB,aAAtB,OAAOO,gBAAe,YAAAf,EAAfe,gBAAe,GAAIA,iBAAgB,EAAvD,CAAA,EAAA,CAC8EC,EAAAf,EAAtBO,EAAmB,EAAE,EAAC,GAArFS,EAA2BD,CAAA,CAAA,EAAA,CAAEE,EAA8BF,CAAA,CAAA,EAAA,CACwBG,EAAAlB,EAAtBO,EAAmB,EAAE,EAAC,GAAnFY,EAA0BD,CAAA,CAAA,EAAA,CAAEE,EAA6BF,CAAA,CAAA,EAAA,CAK9DG,EAAArB,EAJgEO,EAAiB,CAClFe,GAAI,UACJC,MAAO,GACPC,KAAM,UACL,GAJKC,EAAyBJ,CAAA,CAAA,EAAA,CAAEK,EAA4BL,CAAA,CAAA,EAAA,CAS5DM,EAAA3B,EAJ8DO,EAAiB,CAChFe,GAAI,UACJC,MAAO,GACPC,KAAM,UACL,GAJKI,EAAwBD,CAAA,CAAA,EAAA,CAAEE,EAA2BF,CAAA,CAAA,EAAA,CAMtDG,EAAsB,SAACC,CAAc,EAC1C,GAAI,CAACjB,gBACJ,MAAM,AAAIkB,MAAM,yDAEjBH,EAA4BE,EAC7B,EAEME,EAAuB9B,EAC5B,SAAA+B,CAAA,EAAwH,IAArHC,EAAYD,EAAZC,YAAY,CAAEC,EAAgBF,EAAhBE,gBAAgB,CAChC,GAAI,CAAC3B,IACJ,MAAM,AAAIuB,MAAM,8CAEjB,GAAI,CAACpB,EACJ,MAAM,AAAIoB,MAAM,yDAEjBN,EAA6BS,GAC7BC,EAAiBC,SAAS,CAACF,EAAab,EAAE,CAC3C,GAGDhB,EAAU,WACT,GAAKM,GAGL,IAJc0B,EAIRC,EAAkB,WAAW,IAAAC,CAClC,AAAsB,QAAtBA,CAAAA,EAAAC,UAAUC,YAAY,AAAZA,GAAYF,AAAA,KAAA,IAAAA,GAAtBA,EAAwBG,gBAAgB,GAAGC,IAAI,CAAC,SAACC,CAAO,EACvD,IAAMC,EAAuB,EAAE,CACzBC,EAAwB,EAAE,CAChCF,EAAQG,OAAO,CAAC,SAACjB,CAAM,EACtB,IAAMkB,EAAsB,CAC3B3B,GAAIS,EAAOmB,QAAQ,CACnB3B,MAAOQ,EAAOR,KAAK,CACnBC,KAAMO,EAAOoB,IAAAA,CAEVpB,AAAgB,CAAA,eAAhBA,EAAOoB,IAAI,CACdL,EAAWM,IAAI,CAACH,GACU,gBAAhBlB,EAAOoB,IAAI,EACrBJ,EAAYK,IAAI,CAACH,EAEnB,GACAhC,EAA+B8B,GAC/B3B,EAA8B0B,EAC/B,EACD,EAKA,OAHA,AAAsB,OAAtBR,CAAAA,EAAAG,UAAUC,YAAY,AAAZA,GAAYJ,AAAA,KAAA,IAAAA,GAAtBA,EAAwBe,gBAAgB,CAAC,eAAgBd,GACzDA,IAEO,WAAW,IAAAe,CACjB,AAAsB,QAAtBA,CAAAA,EAAAb,UAAUC,YAAY,AAAZA,GAAYY,AAAA,KAAA,IAAAA,GAAtBA,EAAwBC,mBAAmB,CAAC,eAAgBhB,EAC7D,EACD,EAAG,CAAC3B,EAAQ,EAEZ,IAAM4C,EAAehD,EAAQ,kBAC5B,AAAKI,EAME,CACNA,QAAAA,EACAI,4BAAAA,EACAG,2BAAAA,EACAM,0BAAAA,EACAG,yBAAAA,EACAK,qBAAAA,EACAH,oBAAAA,GAZO,CACNlB,QAAAA,EAaH,EAAG,CACFO,EACAH,EACAJ,EACAgB,EACAH,EACAQ,EACA,EACD,OAAO5B,EAAAoD,aAAA,CAACrD,EAAcsD,QAAQ,CAAA,CAACC,MAAOH,CAAa,EAAE7C,EACtD"}