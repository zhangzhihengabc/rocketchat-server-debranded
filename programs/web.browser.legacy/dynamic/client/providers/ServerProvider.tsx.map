)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/ServerProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { Serialized } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport type { Method, PathFor, OperationParams, OperationResult, UrlParams, PathPattern } from '@rocket.chat/rest-typings';\nimport type {\n\tServerMethodName,\n\tServerMethodParameters,\n\tServerMethodReturn,\n\tStreamerCallbackArgs,\n\tUploadResult,\n\tStreamNames,\n\tStreamKeys,\n} from '@rocket.chat/ui-contexts';\nimport { ServerContext } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport { compile } from 'path-to-regexp';\nimport type { FC } from 'react';\nimport React from 'react';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { Info as info } from '../../app/utils/rocketchat.info';\n\nconst absoluteUrl = (path: string): string => Meteor.absoluteUrl(path);\n\nconst callMethod = <MethodName extends ServerMethodName>(\n\tmethodName: MethodName,\n\t...args: ServerMethodParameters<MethodName>\n): Promise<ServerMethodReturn<MethodName>> => Meteor.callAsync(methodName, ...args);\n\nconst callEndpoint = <TMethod extends Method, TPathPattern extends PathPattern>({\n\tmethod,\n\tpathPattern,\n\tkeys,\n\tparams,\n}: {\n\tmethod: TMethod;\n\tpathPattern: TPathPattern;\n\tkeys: UrlParams<TPathPattern>;\n\tparams: OperationParams<TMethod, TPathPattern>;\n}): Promise<Serialized<OperationResult<TMethod, TPathPattern>>> => {\n\tconst compiledPath = compile(pathPattern, { encode: encodeURIComponent })(keys) as any;\n\n\tswitch (method) {\n\t\tcase 'GET':\n\t\t\treturn sdk.rest.get(compiledPath, params as any) as any;\n\n\t\tcase 'POST':\n\t\t\treturn sdk.rest.post(compiledPath, params as any) as any;\n\n\t\tcase 'PUT':\n\t\t\treturn sdk.rest.put(compiledPath, params as never) as never;\n\n\t\tcase 'DELETE':\n\t\t\treturn sdk.rest.delete(compiledPath, params as any) as any;\n\n\t\tdefault:\n\t\t\tthrow new Error('Invalid HTTP method');\n\t}\n};\n\nconst uploadToEndpoint = (endpoint: PathFor<'POST'>, formData: any): Promise<UploadResult> => sdk.rest.post(endpoint as any, formData);\n\nconst getStream = <N extends StreamNames, K extends StreamKeys<N>>(\n\tstreamName: N,\n\t_options?: {\n\t\tretransmit?: boolean | undefined;\n\t\tretransmitToSelf?: boolean | undefined;\n\t},\n): ((eventName: K, callback: (...args: StreamerCallbackArgs<N, K>) => void) => () => void) => {\n\treturn (eventName, callback): (() => void) => {\n\t\treturn sdk.stream(streamName, [eventName], callback as (...args: any[]) => void).stop;\n\t};\n};\n\nconst ee = new Emitter<Record<string, void>>();\n\nconst events = new Map<string, () => void>();\n\nconst getSingleStream = <N extends StreamNames, K extends StreamKeys<N>>(\n\tstreamName: N,\n\t_options?: {\n\t\tretransmit?: boolean | undefined;\n\t\tretransmitToSelf?: boolean | undefined;\n\t},\n): ((eventName: K, callback: (...args: StreamerCallbackArgs<N, K>) => void) => () => void) => {\n\tconst stream = getStream(streamName);\n\treturn (eventName, callback): (() => void) => {\n\t\tee.on(`${streamName}/${eventName}`, callback);\n\n\t\tconst handler = (...args: any[]): void => {\n\t\t\tee.emit(`${streamName}/${eventName}`, ...args);\n\t\t};\n\n\t\tconst stop = (): void => {\n\t\t\t// If someone is still listening, don't unsubscribe\n\t\t\tee.off(`${streamName}/${eventName}`, callback);\n\n\t\t\tif (ee.has(`${streamName}/${eventName}`)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst unsubscribe = events.get(`${streamName}/${eventName}`);\n\t\t\tif (unsubscribe) {\n\t\t\t\tunsubscribe();\n\t\t\t\tevents.delete(`${streamName}/${eventName}`);\n\t\t\t}\n\t\t};\n\n\t\tif (!events.has(`${streamName}/${eventName}`)) {\n\t\t\tevents.set(`${streamName}/${eventName}`, stream(eventName, handler));\n\t\t}\n\t\treturn stop;\n\t};\n};\n\nconst contextValue = {\n\tinfo,\n\tabsoluteUrl,\n\tcallMethod,\n\tcallEndpoint,\n\tuploadToEndpoint,\n\tgetStream,\n\tgetSingleStream,\n};\n\nconst ServerProvider: FC = ({ children }) => <ServerContext.Provider children={children} value={contextValue} />;\n\nexport default ServerProvider;\n",null],"names":["module","link","Emitter","ServerContext","Meteor","compile","v","React","sdk","Info","info","getStream","streamName","_options","eventName","callback","stream","stop","ee","events","Map","contextValue","absoluteUrl","path","callMethod","methodName","_Meteor","_len","arguments","length","args","Array","_key","callAsync","apply","concat","callEndpoint","_ref","method","pathPattern","keys","params","compiledPath","encode","encodeURIComponent","rest","get","post","put","delete","Error","uploadToEndpoint","endpoint","formData","getSingleStream","on","has","set","_len2","_key2","emit","off","unsubscribe","exportDefault","_ref2","children","createElement","Provider","value"],"mappings":"uBACSA,EAASC,IAAA,CAAM,uBAAuB,CAAAC,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAF,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAG,cAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAI,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAJ,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAK,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAL,EAAAA,IAAAA,CAAAA,QAAAA,CAAA,QAAA,SAAAM,CAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAAAP,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAQ,IAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAR,EAAAA,IAAAA,CAAAA,kCAAAA,CAAAS,KAAAA,SAAAA,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GA4D/C,IA5DAR,EAA+CC,EAAAC,EAAAC,EAAAE,EAAAC,EAAAE,EA4DzCC,EAAY,SACjBC,CAAa,CACbC,CAGC,EAED,OAAO,SAACC,CAAS,CAAEC,CAAQ,EAC1B,OAAOP,EAAIQ,MAAM,CAACJ,EAAY,CAACE,EAAU,CAAEC,GAAsCE,IAAI,AACtF,CACD,EAEMC,EAAK,IAAIhB,EAETiB,EAAS,IAAIC,IAuCbC,EAAe,CACpBX,KAAAA,EACAY,YA/FmB,SAACC,CAAY,EAAA,OAAanB,EAAOkB,WAAW,CAACC,EAAK,EAgGrEC,WA9FkB,SAClBC,CAAsB,EAAA,IAAA,IAAAC,EAAAC,EAAAC,UAAAC,MAAA,CACnBC,EAAwC,AAAAC,MAAAJ,EAAA,EAAAA,EAAA,EAAA,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAxCF,CAAwC,CAAAE,EAAA,EAAA,CAAAJ,SAAA,CAAAI,EAAA,CAAA,MACE,AAAAN,CAAAA,EAAAtB,CAAA,EAAO6B,SAAS,CAAAC,KAAA,CAAAR,EAAA,CAACD,EAAU,CAAAU,MAAA,CAAKL,GAAK,EA4FlFM,aA1FoB,SAAAC,CAAA,EAU6C,IATjEC,EAAMD,EAANC,MAAM,CACNC,EAAWF,EAAXE,WAAW,CACXC,EAAIH,EAAJG,IAAI,CACJC,EAAMJ,EAANI,MAAM,CAOAC,EAAerC,EAAQkC,EAAa,CAAEI,OAAQC,kBAAkB,GAAIJ,GAE1E,OAAQF,GACP,IAAK,MACJ,OAAO9B,EAAIqC,IAAI,CAACC,GAAG,CAACJ,EAAcD,EAEnC,KAAK,OACJ,OAAOjC,EAAIqC,IAAI,CAACE,IAAI,CAACL,EAAcD,EAEpC,KAAK,MACJ,OAAOjC,EAAIqC,IAAI,CAACG,GAAG,CAACN,EAAcD,EAEnC,KAAK,SACJ,OAAOjC,EAAIqC,IAAI,CAACI,MAAM,CAACP,EAAcD,EAEtC,SACC,MAAM,AAAIS,MAAM,sBAAuB,CAE1C,EA8DCC,iBA5DwB,SAACC,CAAyB,CAAEC,CAAa,EAAA,OAA4B7C,EAAIqC,IAAI,CAACE,IAAI,CAACK,EAAiBC,EAAS,EA6DrI1C,UAAAA,EACA2C,gBA5CuB,SACvB1C,CAAa,CACbC,CAGC,EAED,IAAMG,EAASL,EAAUC,GACzB,OAAO,SAACE,CAAS,CAAEC,CAAQ,SAC1BG,EAAGqC,EAAE,CAAI3C,EAAU,IAAIE,EAAaC,GAqB/BI,EAAOqC,GAAG,CAAI5C,EAAU,IAAIE,IAChCK,EAAOsC,GAAG,CAAI7C,EAAU,IAAIE,EAAaE,EAAOF,EApBjC,WAAyB,IAAA,IAAA4C,EAAA9B,UAAAC,MAAA,CAArBC,EAAW,AAAAC,MAAA2B,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAX7B,CAAW,CAAA6B,EAAA,CAAA/B,SAAA,CAAA+B,EAAA,CAC9BzC,EAAG0C,IAAI,CAAA1B,KAAA,CAAPhB,EAAE,CAASN,EAAU,IAAIE,EAAS,CAAAqB,MAAA,CAAOL,GAC1C,IAEa,WAIZ,GAFAZ,EAAG2C,GAAG,CAAIjD,EAAU,IAAIE,EAAaC,IAEjCG,EAAGsC,GAAG,CAAI5C,EAAU,IAAIE,IAI5B,IAAMgD,EAAc3C,EAAO2B,GAAG,CAAIlC,EAAU,IAAIE,GAC5CgD,IACHA,IACA3C,EAAO8B,MAAM,CAAIrC,EAAU,IAAIE,IAEjC,CAMD,CACD,GA/GAd,EAAO+D,aAAW,CA2HS,SAAAC,CAAA,EAAA,IAAGC,EAAQD,EAARC,QAAQ,CAAA,OAAO1D,EAAA2D,aAAA,CAAC/D,EAAcgE,QAAQ,CAAA,CAACF,SAAUA,EAAUG,MAAO/C,CAAa,EAAG"}