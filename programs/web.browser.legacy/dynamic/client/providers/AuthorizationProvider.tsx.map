)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/AuthorizationProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRole } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { AuthorizationContext } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport type { FC } from 'react';\nimport React, { useCallback, useEffect } from 'react';\n\nimport { hasPermission, hasAtLeastOnePermission, hasAllPermission, hasRole } from '../../app/authorization/client';\nimport { Roles } from '../../app/models/client/models/Roles';\nimport { useReactiveValue } from '../hooks/useReactiveValue';\nimport { createReactiveSubscriptionFactory } from '../lib/createReactiveSubscriptionFactory';\n\nclass RoleStore extends Emitter<{\n\tchange: { [_id: string]: IRole };\n}> {\n\troles: { [_id: string]: IRole } = {};\n}\n\nconst contextValue = {\n\tqueryPermission: createReactiveSubscriptionFactory((permission, scope, scopeRoles) => hasPermission(permission, scope, scopeRoles)),\n\tqueryAtLeastOnePermission: createReactiveSubscriptionFactory((permissions, scope) => hasAtLeastOnePermission(permissions, scope)),\n\tqueryAllPermissions: createReactiveSubscriptionFactory((permissions, scope) => hasAllPermission(permissions, scope)),\n\tqueryRole: createReactiveSubscriptionFactory(\n\t\t(role, scope?, ignoreSubscriptions = false) =>\n\t\t\t!!Meteor.userId() && hasRole(Meteor.userId() as string, role, scope, ignoreSubscriptions),\n\t),\n\troleStore: new RoleStore(),\n};\n\nconst AuthorizationProvider: FC = ({ children }) => {\n\tconst roles = useReactiveValue(\n\t\tuseCallback(\n\t\t\t() =>\n\t\t\t\tRoles.find()\n\t\t\t\t\t.fetch()\n\t\t\t\t\t.reduce((ret, obj) => {\n\t\t\t\t\t\tret[obj._id] = obj;\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}, {} as Record<string, IRole>),\n\t\t\t[],\n\t\t),\n\t);\n\n\tuseEffect(() => {\n\t\tcontextValue.roleStore.roles = roles;\n\t\tcontextValue.roleStore.emit('change', roles);\n\t}, [roles]);\n\n\treturn <AuthorizationContext.Provider children={children} value={contextValue} />;\n};\n\nexport default AuthorizationProvider;\n",null],"names":["module","link","default","_inheritsLoose","Emitter","AuthorizationContext","Meteor","v","React","useCallback","useEffect","hasPermission","hasAtLeastOnePermission","hasAllPermission","hasRole","Roles","useReactiveValue","createReactiveSubscriptionFactory","RoleStore","_Emitter","_this","_len","arguments","length","args","Array","_key","call","apply","concat","roles","contextValue","queryPermission","permission","scope","scopeRoles","queryAtLeastOnePermission","permissions","queryAllPermissions","queryRole","role","ignoreSubscriptions","undefined","userId","roleStore","exportDefault","_ref","children","find","fetch","reduce","ret","obj","_id","emit","createElement","Provider","value"],"mappings":"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"}