)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/providers/TooltipProvider.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { useDebouncedState, useMediaQuery } from '@rocket.chat/fuselage-hooks';\nimport { TooltipComponent } from '@rocket.chat/ui-client';\nimport { TooltipContext } from '@rocket.chat/ui-contexts';\nimport type { FC, ReactNode } from 'react';\nimport React, { useEffect, useMemo, useRef, memo, useCallback, useState } from 'react';\n\nimport TooltipPortal from '../components/TooltipPortal';\n\nconst TooltipProvider: FC = ({ children }) => {\n\tconst lastAnchor = useRef<HTMLElement>();\n\tconst hasHover = !useMediaQuery('(hover: none)');\n\n\tconst [tooltip, setTooltip] = useDebouncedState<ReactNode>(null, 300);\n\n\tconst restoreTitle = useCallback((previousAnchor: HTMLElement | undefined): void => {\n\t\tsetTimeout(() => {\n\t\t\tif (previousAnchor && !previousAnchor.getAttribute('title')) {\n\t\t\t\tpreviousAnchor.setAttribute('title', previousAnchor.getAttribute('data-title') ?? '');\n\t\t\t\tpreviousAnchor.removeAttribute('data-title');\n\t\t\t}\n\t\t}, 0);\n\t}, []);\n\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\topen: (tooltip: ReactNode, anchor: HTMLElement): void => {\n\t\t\t\tconst previousAnchor = lastAnchor.current;\n\t\t\t\tsetTooltip(<TooltipComponent key={new Date().toISOString()} title={tooltip} anchor={anchor} />);\n\t\t\t\tlastAnchor.current = anchor;\n\t\t\t\tpreviousAnchor && restoreTitle(previousAnchor);\n\t\t\t},\n\t\t\tclose: (): void => {\n\t\t\t\tconst previousAnchor = lastAnchor.current;\n\t\t\t\tsetTooltip(null);\n\t\t\t\tsetTooltip.flush();\n\t\t\t\tlastAnchor.current = undefined;\n\t\t\t\tpreviousAnchor && restoreTitle(previousAnchor);\n\t\t\t},\n\t\t\tdismiss: (): void => {\n\t\t\t\tsetTooltip(null);\n\t\t\t\tsetTooltip.flush();\n\t\t\t},\n\t\t}),\n\t\t[setTooltip, restoreTitle],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!hasHover) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleMouseOver = (e: MouseEvent): void => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (lastAnchor.current === target) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst anchor = target.closest('[title], [data-tooltip]') as HTMLElement;\n\n\t\t\tif (lastAnchor.current === anchor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!anchor) {\n\t\t\t\tcontextValue.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst title = anchor.getAttribute('title') ?? anchor.getAttribute('data-tooltip') ?? '';\n\t\t\tif (!title) {\n\t\t\t\tcontextValue.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line react/no-multi-comp\n\t\t\tconst Handler = () => {\n\t\t\t\tconst [state, setState] = useState(title);\n\t\t\t\tuseEffect(() => {\n\t\t\t\t\tconst close = (): void => contextValue.close();\n\t\t\t\t\t// store the title in a data attribute\n\t\t\t\t\tanchor.setAttribute('data-title', title);\n\t\t\t\t\t// Removes the title attribute to prevent the browser's tooltip from showing\n\t\t\t\t\tanchor.setAttribute('title', '');\n\n\t\t\t\t\tanchor.addEventListener('mouseleave', close);\n\n\t\t\t\t\tconst observer = new MutationObserver(() => {\n\t\t\t\t\t\tconst title = anchor.getAttribute('title') ?? anchor.getAttribute('data-tooltip') ?? '';\n\n\t\t\t\t\t\tif (title === '') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// store the title in a data attribute\n\t\t\t\t\t\tanchor.setAttribute('data-title', title);\n\t\t\t\t\t\t// Removes the title attribute to prevent the browser's tooltip from showing\n\t\t\t\t\t\tanchor.setAttribute('title', '');\n\n\t\t\t\t\t\tsetState(title);\n\t\t\t\t\t});\n\n\t\t\t\t\tobserver.observe(anchor, {\n\t\t\t\t\t\tattributes: true,\n\t\t\t\t\t\tattributeFilter: ['title', 'data-tooltip'],\n\t\t\t\t\t});\n\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tanchor.removeEventListener('mouseleave', close);\n\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t};\n\t\t\t\t}, []);\n\t\t\t\treturn <>{state}</>;\n\t\t\t};\n\t\t\tcontextValue.open(<Handler />, anchor);\n\t\t};\n\n\t\tconst dismissOnClick = (): void => {\n\t\t\tcontextValue.dismiss();\n\t\t};\n\n\t\tdocument.body.addEventListener('mouseover', handleMouseOver, {\n\t\t\tpassive: true,\n\t\t});\n\t\tdocument.body.addEventListener('click', dismissOnClick, { capture: true });\n\n\t\treturn (): void => {\n\t\t\tcontextValue.close();\n\t\t\tdocument.body.removeEventListener('mouseover', handleMouseOver);\n\t\t\tdocument.body.removeEventListener('click', dismissOnClick);\n\t\t};\n\t}, [contextValue, setTooltip, hasHover]);\n\n\treturn (\n\t\t<TooltipContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t{tooltip && <TooltipPortal>{tooltip}</TooltipPortal>}\n\t\t</TooltipContext.Provider>\n\t);\n};\n\nexport default memo<typeof TooltipProvider>(TooltipProvider);\n",null],"names":["_slicedToArray","useDebouncedState","useMediaQuery","TooltipComponent","TooltipContext","React","useEffect","useMemo","useRef","memo","useCallback","useState","TooltipPortal","module","link","default","v","exportDefault","_ref","children","lastAnchor","hasHover","_useDebouncedState2","tooltip","setTooltip","restoreTitle","previousAnchor","setTimeout","getAttribute","_previousAnchor$getAt","setAttribute","removeAttribute","contextValue","open","anchor","current","createElement","key","Date","toISOString","title","close","flush","undefined","dismiss","handleMouseOver","e","_ref2","_anchor$getAttribute","target","closest","_useState2","state","setState","addEventListener","observer","MutationObserver","_ref3","_anchor$getAttribute2","observe","attributes","attributeFilter","removeEventListener","disconnect","Fragment","dismissOnClick","document","body","passive","capture","Provider","value"],"mappings":"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"}