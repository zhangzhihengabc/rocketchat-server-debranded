function module(e,n,t){var r,u,s,a,i,c,o,l,d,p,f,y,b;t.link("@babel/runtime/regenerator",{default:function(e){r=e}},0),t.link("meteor/meteor",{Meteor:function(e){u=e}},0),t.link("meteor/tracker",{Tracker:function(e){s=e}},1),t.link("../../app/e2e/client/rocketchat.e2e",{e2e:function(e){a=e}},2),t.link("../../app/models/client",{Subscriptions:function(e){i=e},ChatRoom:function(e){c=e}},3),t.link("../../app/notifications/client",{Notifications:function(e){o=e}},4),t.link("../../app/settings/client",{settings:function(e){l=e}},5),t.link("../lib/onClientBeforeSendMessage",{onClientBeforeSendMessage:function(e){d=e}},6),t.link("../lib/onClientMessageReceived",{onClientMessageReceived:function(e){p=e}},7),t.link("../lib/utils/isLayoutEmbedded",{isLayoutEmbedded:function(e){f=e}},8),t.link("../lib/utils/waitUntilFind",{waitUntilFind:function(e){y=e}},9),t.link("../providers/RouterProvider",{router:function(e){b=e}},10),u.startup(function(){s.autorun(function(){if(u.userId()&&window.crypto){var e=l.get("E2E_Enable"),n=f()&&b.getLocationPathname().startsWith("/admin");e&&!n?(a.startClient(),a.enabled.set(!0)):(a.enabled.set(!1),a.closeAlert())}});var e,n,t=null;s.autorun(function(){if(!a.isReady()){var u,s,l;null===(u=e)||void 0===u||u(),o.unUser("e2ekeyRequest"),null===(s=t)||void 0===s||s.stop(),null===(l=n)||void 0===l||l();return}o.onUser("e2ekeyRequest",function(e,n){var t;return r.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,r.awrap(a.getInstanceByRoomId(e));case 2:if(t=u.sent){u.next=5;break}return u.abrupt("return");case 5:t.provideKeyToUser(n);case 6:case"end":return u.stop()}},null,null,null,Promise)}),t=i.find().observe({changed:function(e){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:setTimeout(function n(){var n;return r.async(function t(t){for(;;)switch(t.prev=t.next){case 0:if(!(!e.encrypted&&!e.E2EKey)){t.next=3;break}return a.removeInstanceByRoomId(e.rid),t.abrupt("return");case 3:return t.next=5,r.awrap(a.getInstanceByRoomId(e.rid));case 5:if(n=t.sent){t.next=8;break}return t.abrupt("return");case 8:if(!e.E2ESuggestedKey){t.next=17;break}return t.next=11,r.awrap(n.importGroupKey(e.E2ESuggestedKey));case 11:if(!t.sent){t.next=15;break}a.acceptSuggestedKey(e.rid),t.next=17;break;case 15:console.warn("Invalid E2ESuggestedKey, rejecting",e.E2ESuggestedKey),a.rejectSuggestedKey(e.rid);case 17:if(e.encrypted?n.resume():n.pause(),n.isSupportedRoomType(e.t)){t.next=21;break}return n.disable(),t.abrupt("return");case 21:if(!(e.E2EKey&&n.isWaitingKeys())){t.next=24;break}return n.keyReceived(),t.abrupt("return");case 24:if(n.isReady()){t.next=26;break}return t.abrupt("return");case 26:n.decryptSubscription();case 27:case"end":return t.stop()}},null,null,null,Promise)},0);case 1:case"end":return n.stop()}},null,null,null,Promise)},added:function(e){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:setTimeout(function n(){return r.async(function n(n){for(;;)switch(n.prev=n.next){case 0:if(!(!e.encrypted&&!e.E2EKey)){n.next=2;break}return n.abrupt("return");case 2:return n.abrupt("return",a.getInstanceByRoomId(e.rid));case 3:case"end":return n.stop()}},null,null,null,Promise)},0);case 1:case"end":return n.stop()}},null,null,null,Promise)},removed:function(e){a.removeInstanceByRoomId(e.rid)}}),e=p.use(function(e){var n;return r.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.awrap(a.getInstanceByRoomId(e.rid));case 2:if(null!=(n=t.sent)&&n.shouldConvertReceivedMessages()){t.next=5;break}return t.abrupt("return",e);case 5:return t.abrupt("return",a.decryptMessage(e));case 6:case"end":return t.stop()}},null,null,null,Promise)}),n=d.use(function(e){var n,t;return r.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,r.awrap(a.getInstanceByRoomId(e.rid));case 2:if(n=u.sent){u.next=5;break}return u.abrupt("return",e);case 5:return u.next=7,r.awrap(y(function(){return c.findOne({_id:e.rid})}));case 7:return u.sent.encrypted?n.resume():n.pause(),u.next=11,r.awrap(n.shouldConvertSentMessages(e));case 11:if(u.sent){u.next=14;break}return u.abrupt("return",e);case 14:return u.next=16,r.awrap(n.encrypt(e));case 16:return t=u.sent,e.msg=t,e.t="e2e",e.e2e="pending",u.abrupt("return",e);case 21:case"end":return u.stop()}},null,null,null,Promise)})})})}
//# sourceMappingURL=/dynamic/client/startup/f8e6716daa2924276f1f7b237ad7d235de278dd2.map
