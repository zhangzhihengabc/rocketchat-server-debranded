function module(e,t,r){var n,a,u,s,i,c,o,l,f,p,b;r.link("@babel/runtime/regenerator",{default:function(e){n=e}},0),r.link("@babel/runtime/helpers/objectSpread2",{default:function(e){a=e}},1),r.link("@rocket.chat/core-typings",{isOTRMessage:function(e){u=e}},0),r.link("meteor/meteor",{Meteor:function(e){s=e}},1),r.link("meteor/tracker",{Tracker:function(e){i=e}},2),r.link("../../app/otr/client/OTR",{default:function(e){c=e}},3),r.link("../../app/otr/lib/OtrRoomState",{OtrRoomState:function(e){o=e}},4),r.link("../../app/utils/client/lib/SDKClient",{sdk:function(e){l=e}},5),r.link("../../app/utils/lib/i18n",{t:function(e){f=e}},6),r.link("../lib/onClientBeforeSendMessage",{onClientBeforeSendMessage:function(e){p=e}},7),r.link("../lib/onClientMessageReceived",{onClientMessageReceived:function(e){b=e}},8),s.startup(function(){i.autorun(function(){var e=s.userId();e&&l.stream("notify-user",[e+"/otr"],function(t,r){if(r.roomId&&r.userId&&r.userId!==e){var n=c.getInstanceByRoomId(e,r.roomId);null==n||n.onUserStream(t,r)}})}),p.use(function(e){var t,r,u;return n.async(function(i){for(;;)switch(i.prev=i.next){case 0:if(t=s.userId()){i.next=3;break}return i.abrupt("return",e);case 3:if(!((r=c.getInstanceByRoomId(t,e.rid))&&r.getState()===o.ESTABLISHED)){i.next=9;break}return i.next=7,n.awrap(r.encrypt(e));case 7:return u=i.sent,i.abrupt("return",a(a({},e),{},{msg:u,t:"otr"}));case 9:return i.abrupt("return",e);case 10:case"end":return i.stop()}},null,null,null,Promise)}),b.use(function(e){var t,r,i,p,b,d,k,m,g,x;return n.async(function(I){for(;;)switch(I.prev=I.next){case 0:if(t=s.userId()){I.next=3;break}return I.abrupt("return",e);case 3:if(u(e)){I.next=5;break}return I.abrupt("return",e);case 5:if(!("notification"in e)){I.next=7;break}return I.abrupt("return",a(a({},e),{},{msg:f("Encrypted_message")}));case 7:if(!((r=c.getInstanceByRoomId(t,e.rid))&&r.getState()===o.ESTABLISHED)){I.next=32;break}return I.next=11,n.awrap(r.decrypt(e.msg));case 11:if("string"!=typeof(i=I.sent)){I.next=14;break}return I.abrupt("return",a(a({},e),{},{msg:i}));case 14:if(p=i._id,b=i.text,d=i.ack,k=i.ts,m=i.userId,k&&(e.ts=k),!e.otrAck){I.next=26;break}return I.next=19,n.awrap(r.decrypt(e.otrAck));case 19:if("string"!=typeof(g=I.sent)){I.next=22;break}return I.abrupt("return",a(a({},e),{},{msg:g}));case 22:if(d!==g.text){I.next=24;break}return I.abrupt("return",a(a({},e),{},{_id:p,t:"otr-ack",msg:b}));case 24:I.next=31;break;case 26:if(!(m!==s.userId())){I.next=31;break}return I.next=29,n.awrap(r.encryptText(d));case 29:x=I.sent,l.call("updateOTRAck",{message:e,ack:x});case 31:return I.abrupt("return",a(a({},e),{},{_id:p,msg:b}));case 32:return"otr"===e.t&&(e.msg=""),I.abrupt("return",e);case 34:case"end":return I.stop()}},null,null,null,Promise)})})}
//# sourceMappingURL=/dynamic/client/startup/4f66e574d3a726904c322f0711534e2bd374e5be.map
