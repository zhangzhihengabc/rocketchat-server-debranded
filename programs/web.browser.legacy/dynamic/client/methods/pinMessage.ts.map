)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/methods/pinMessage.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { ChatMessage, ChatSubscription } from '../../app/models/client';\nimport { settings } from '../../app/settings/client';\n\nMeteor.methods<ServerMethods>({\n\tpinMessage(message: IMessage) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', {\n\t\t\t\tmethod: 'pinMessage',\n\t\t\t});\n\t\t}\n\t\tif (!settings.get('Message_AllowPinning')) {\n\t\t\tthrow new Meteor.Error('pinning-not-allowed', 'Pinning messages is not allowed', {\n\t\t\t\tmethod: 'pinMessage',\n\t\t\t});\n\t\t}\n\t\tif (!ChatSubscription.findOne({ rid: message.rid })) {\n\t\t\tthrow new Meteor.Error('error-pinning-message', 'Pinning messages is not allowed', {\n\t\t\t\tmethod: 'pinMessage',\n\t\t\t});\n\t\t}\n\t\tif (typeof message._id !== 'string') {\n\t\t\tthrow new Meteor.Error('error-pinning-message', 'Invalid message', {\n\t\t\t\tmethod: 'pinMessage',\n\t\t\t});\n\t\t}\n\n\t\tChatMessage.update(\n\t\t\t{\n\t\t\t\t_id: message._id,\n\t\t\t\trid: message.rid,\n\t\t\t},\n\t\t\t{\n\t\t\t\t$set: {\n\t\t\t\t\tpinned: true,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tconst msg = ChatMessage.findOne({ _id: message._id });\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-pinning-message', 'Error pinning message', {\n\t\t\t\tmethod: 'pinMessage',\n\t\t\t});\n\t\t}\n\n\t\treturn msg;\n\t},\n});\n",null],"names":["Meteor","ChatMessage","ChatSubscription","settings","module","link","methods","pinMessage","message","userId","Error","method","get","findOne","rid","_id","update","$set","pinned","msg"],"mappings":"2BAEAA,EAAuCC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAL,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAH,YAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,EAAAC,iBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,4BAAAA,CAAAD,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAKvCH,EAAOM,OAAO,CAAgB,CAC7BC,WAAU,SAACC,CAAiB,EAC3B,GAAI,CAACR,EAAOS,MAAM,GACjB,MAAM,IAAIT,EAAOU,KAAK,CAAC,uBAAwB,iBAAkB,CAChEC,OAAQ,eAGV,GAAI,CAACR,EAASS,GAAG,CAAC,wBACjB,MAAM,IAAIZ,EAAOU,KAAK,CAAC,sBAAuB,kCAAmC,CAChFC,OAAQ,eAGV,GAAI,CAACT,EAAiBW,OAAO,CAAC,CAAEC,IAAKN,EAAQM,GAAAA,AAAG,GAC/C,MAAM,IAAId,EAAOU,KAAK,CAAC,wBAAyB,kCAAmC,CAClFC,OAAQ,eAGV,GAAI,AAAuB,UAAvB,OAAOH,EAAQO,GAAG,CACrB,MAAM,IAAIf,EAAOU,KAAK,CAAC,wBAAyB,kBAAmB,CAClEC,OAAQ,eAIVV,EAAYe,MAAM,CACjB,CACCD,IAAKP,EAAQO,GAAG,CAChBD,IAAKN,EAAQM,GAAAA,EAEd,CACCG,KAAM,CACLC,OAAQ,CAAA,KAKX,IAAMC,EAAMlB,EAAYY,OAAO,CAAC,CAAEE,IAAKP,EAAQO,GAAAA,AAAG,GAElD,GAAI,CAACI,EACJ,MAAM,IAAInB,EAAOU,KAAK,CAAC,wBAAyB,wBAAyB,CACxEC,OAAQ,eAIV,OAAOQ,CACR"}