function module(e,n,r){r.link("@babel/runtime/regenerator",{default:function(e){t=e}},0),r.link("@babel/runtime/helpers/objectSpread2",{default:function(e){s=e}},1),r.export({createDataAPI:function(){return m}}),r.link("@rocket.chat/random",{Random:function(e){u=e}},0),r.link("moment",{default:function(e){a=e}},1),r.link("../../../app/authorization/client",{hasAtLeastOnePermission:function(e){i=e},hasPermission:function(e){c=e}},2),r.link("../../../app/models/client",{Messages:function(e){o=e},ChatRoom:function(e){l=e},ChatSubscription:function(e){f=e}},3),r.link("../../../app/settings/client",{settings:function(e){d=e}},4),r.link("../../../app/ui-utils/client",{MessageTypes:function(e){p=e}},5),r.link("../../../app/utils/client/lib/SDKClient",{sdk:function(e){b=e}},6),r.link("../onClientBeforeSendMessage",{onClientBeforeSendMessage:function(e){x=e}},7),r.link("../utils/prependReplies",{prependReplies:function(e){v=e}},8);var t,s,u,a,i,c,o,l,f,d,p,b,x,v,m=function(e){var n=e.rid,r=e.tmid,m=function(e){var n;return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",null!==(n=o.findOne({_id:e,_hidden:{$ne:!0}},{reactive:!1}))&&void 0!==n?n:b.call("getSingleMessage",e));case 1:case"end":return r.stop()}},null,null,null,Promise)},g=function(){return t.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.findOne({rid:n,tmid:null!=r?r:{$exists:!1},_hidden:{$ne:!0}},{sort:{ts:-1},reactive:!1}));case 1:case"end":return e.stop()}},null,null,null,Promise)},w=function(){var e;return t.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=Meteor.userId()){t.next=3;break}return t.abrupt("return",void 0);case 3:return t.abrupt("return",o.findOne({rid:n,tmid:null!=r?r:{$exists:!1},"u._id":e,_hidden:{$ne:!0}},{sort:{ts:-1},reactive:!1}));case 4:case"end":return t.stop()}},null,null,null,Promise)},h=function(e){var n,r,s,u,o,l,f;return t.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(!p.isSystemMessage(e)){t.next=2;break}return t.abrupt("return",!1);case 2:if(r=i("edit-message",e.rid),s=null!==(n=d.get("Message_AllowEditing"))&&void 0!==n&&n,u=(null==e?void 0:e.u)&&e.u._id===Meteor.userId(),!(!r&&(!s||!u))){t.next=7;break}return t.abrupt("return",!1);case 7:if(o=d.get("Message_AllowEditing_BlockEditInMinutes"),l=c("bypass-time-limit-edit-and-delete"),f=a().diff(e.ts,"minutes"),!(!l&&f&&o&&f>o)){t.next=12;break}return t.abrupt("return",!1);case 12:return t.abrupt("return",!0);case 13:case"end":return t.stop()}},null,null,null,Promise)},M=function(e){var s,u;return t.async(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=Meteor.userId()){a.next=3;break}return a.abrupt("return",void 0);case 3:if(u=o.findOne({rid:n,tmid:null!=r?r:{$exists:!1},"u._id":s,_hidden:{$ne:!0},ts:{$lt:e.ts}},{sort:{ts:-1},reactive:!1})){a.next=6;break}return a.abrupt("return",void 0);case 6:return a.next=8,t.awrap(h(u));case 8:if(!a.sent){a.next=10;break}return a.abrupt("return",u);case 10:return a.abrupt("return",M(u));case 11:case"end":return a.stop()}},null,null,null,Promise)},k=function(e){var s,u;return t.async(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=Meteor.userId()){a.next=3;break}return a.abrupt("return",void 0);case 3:if(u=o.findOne({rid:n,tmid:null!=r?r:{$exists:!1},"u._id":s,_hidden:{$ne:!0},ts:{$gt:e.ts}},{sort:{ts:1},reactive:!1})){a.next=6;break}return a.abrupt("return",void 0);case 6:return a.next=8,t.awrap(h(u));case 8:if(!a.sent){a.next=10;break}return a.abrupt("return",u);case 10:return a.abrupt("return",k(u));case 11:case"end":return a.stop()}},null,null,null,Promise)},y=new Map,P=function(){return t.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.findOne({_id:n},{reactive:!1}));case 1:case"end":return e.stop()}},null,null,null,Promise)},_=function(e){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",l.findOne({_id:e,prid:{$exists:!0}},{reactive:!1}));case 1:case"end":return n.stop()}},null,null,null,Promise)},O=function(e,n){return function(){var r,s=arguments;return t.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,t.awrap(e.apply(void 0,s));case 2:if(r=u.sent){u.next=5;break}throw Error(n);case 5:return u.abrupt("return",r);case 6:case"end":return u.stop()}},null,null,null,Promise)}},D=function(){return t.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.findOne({rid:n},{reactive:!1}));case 1:case"end":return e.stop()}},null,null,null,Promise)},S=O(D,"Subscription not found"),I=function(e){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",f.findOne({rid:e.rid},{reactive:!1}));case 1:case"end":return n.stop()}},null,null,null,Promise)},$=O(I,"Subscription not found");return{composeMessage:function(e,a){var i,c,o,l,f,d,p,b;return t.async(function(m){for(;;)switch(m.prev=m.next){case 0:return o=a.sendToChannel,l=a.quotedMessages,f=a.originalMessage,m.next=3,t.awrap(v(e,l));case 3:return d=m.sent,p=null!==(i=null==f?void 0:f.rid)&&void 0!==i?i:n,b=f?f.tmid:r,m.next=8,t.awrap(x(s(s({_id:null!==(c=null==f?void 0:f._id)&&void 0!==c?c:u.id(),rid:p},b&&s({tmid:b},o&&{tshow:o})),{},{msg:d})));case 8:return m.abrupt("return",m.sent);case 9:case"end":return m.stop()}},null,null,null,Promise)},findMessageByID:m,getMessageByID:function(e){var n;return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.awrap(m(e));case 2:if(n=r.sent){r.next=5;break}throw Error("Message not found");case 5:return r.abrupt("return",n);case 6:case"end":return r.stop()}},null,null,null,Promise)},findLastMessage:g,getLastMessage:function(){var e;return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.awrap(g());case 2:if(e=n.sent){n.next=5;break}throw Error("Message not found");case 5:return n.abrupt("return",e);case 6:case"end":return n.stop()}},null,null,null,Promise)},findLastOwnMessage:w,getLastOwnMessage:function(){var e;return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.awrap(w());case 2:if(e=n.sent){n.next=5;break}throw Error("Message not found");case 5:return n.abrupt("return",e);case 6:case"end":return n.stop()}},null,null,null,Promise)},findPreviousOwnMessage:M,getPreviousOwnMessage:function(e){var n;return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.awrap(M(e));case 2:if(n=r.sent){r.next=5;break}throw Error("Message not found");case 5:return r.abrupt("return",n);case 6:case"end":return r.stop()}},null,null,null,Promise)},findNextOwnMessage:k,getNextOwnMessage:function(e){var n;return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.awrap(k(e));case 2:if(n=r.sent){r.next=5;break}throw Error("Message not found");case 5:return r.abrupt("return",n);case 6:case"end":return r.stop()}},null,null,null,Promise)},pushEphemeralMessage:function(e){return t.async(function(t){for(;;)switch(t.prev=t.next){case 0:o.upsert({_id:e._id},{$set:s(s({},e),{},{rid:n},r&&{tmid:r})});case 1:case"end":return t.stop()}},null,null,null,Promise)},canUpdateMessage:h,updateMessage:function(e,n){return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",b.call("updateMessage",e,n));case 1:case"end":return r.stop()}},null,null,null,Promise)},canDeleteMessage:function(e){var r,s,u,i,o,l,f;return t.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(Meteor.userId()){t.next=3;break}return t.abrupt("return",!1);case 3:if(!p.isSystemMessage(e)){t.next=5;break}return t.abrupt("return",!1);case 5:if(!c("force-delete-message",e.rid)){t.next=8;break}return t.abrupt("return",!0);case 8:if(d.get("Message_AllowDeleting")){t.next=11;break}return t.abrupt("return",!1);case 11:if(r=c("delete-message",n),s=c("delete-own-message"),u=r||s&&(null==e?void 0:e.u)&&e.u._id===Meteor.userId()){t.next=16;break}return t.abrupt("return",!1);case 16:return i=d.get("Message_AllowDeleting_BlockDeleteInMinutes"),o=c("bypass-time-limit-edit-and-delete"),l=a().diff(e.ts,"minutes"),f=o||!i||!l||l<=i,t.abrupt("return",u&&f);case 21:case"end":return t.stop()}},null,null,null,Promise)},deleteMessage:function(e){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.awrap(b.call("deleteMessage",{_id:e}));case 2:case"end":return n.stop()}},null,null,null,Promise)},getDraft:function(e){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",y.get(e));case 1:case"end":return n.stop()}},null,null,null,Promise)},saveDraft:function(e,n){return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:y.set(e,n);case 1:case"end":return r.stop()}},null,null,null,Promise)},discardDraft:function(e){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:y.delete(e);case 1:case"end":return n.stop()}},null,null,null,Promise)},findRoom:P,getRoom:function(){var e;return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.awrap(P());case 2:if(e=n.sent){n.next=5;break}throw Error("Room not found");case 5:return n.abrupt("return",e);case 6:case"end":return n.stop()}},null,null,null,Promise)},isSubscribedToRoom:function(){return t.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!f.findOne({rid:n},{reactive:!1}));case 1:case"end":return e.stop()}},null,null,null,Promise)},joinRoom:function(){return t.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.awrap(b.call("joinRoom",n));case 2:case"end":return e.stop()}},null,null,null,Promise)},findDiscussionByID:_,getDiscussionByID:function(e){var n;return t.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.awrap(_(e));case 2:if(n=r.sent){r.next=5;break}throw Error("Discussion not found");case 5:return r.abrupt("return",n);case 6:case"end":return r.stop()}},null,null,null,Promise)},findSubscription:D,getSubscription:S,findSubscriptionFromMessage:I,getSubscriptionFromMessage:$}}}
//# sourceMappingURL=/dynamic/client/lib/chats/897e9ab7e393b808c1105c419f70e10f488e1ca3.map
