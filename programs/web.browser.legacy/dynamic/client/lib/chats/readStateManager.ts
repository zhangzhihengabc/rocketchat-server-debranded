function module(e,t,r){r.link("@babel/runtime/regenerator",{default:function(e){n=e}},0),r.link("@babel/runtime/helpers/createClass",{default:function(e){i=e}},1),r.link("@babel/runtime/helpers/inheritsLoose",{default:function(e){s=e}},2),r.export({ReadStateManager:function(){return h}}),r.link("@rocket.chat/emitter",{Emitter:function(e){o=e}},0),r.link("meteor/meteor",{Meteor:function(e){a=e}},1),r.link("../../../app/models/client",{ChatMessage:function(e){d=e}},2),r.link("../../../app/ui-utils/client/lib/LegacyRoomManager",{LegacyRoomManager:function(e){u=e}},3),r.link("../../../app/ui-utils/client/lib/RoomHistoryManager",{RoomHistoryManager:function(e){c=e}},4),r.link("../../../app/utils/client/lib/SDKClient",{sdk:function(e){l=e}},5),r.link("../../../lib/utils/highOrderFunctions",{withDebouncing:function(e){f=e}},6);var n,i,s,o,a,d,u,c,l,f,h=function(e){function t(t){var r;return(r=e.call(this)||this).rid=void 0,r.firstUnreadRecordId=void 0,r.subscription=void 0,r.onUnreadStateChange=function(e){return r.on("unread-state-change",e)},r.getFirstUnreadRecordId=function(){return r.firstUnreadRecordId},r.handleWindowEvents=function(){var e=function(){r.attemptMarkAsRead()},t=function(e){"Escape"===e.key&&(r.markAsRead(),r.updateFirstUnreadRecordId())};return window.addEventListener("focus",e),window.addEventListener("keyup",t),function(){window.removeEventListener("focus",e),window.removeEventListener("keyup",t)}},r.debouncedMarkAsRead=f({wait:1e3})(function(){try{return r.markAsRead()}catch(e){console.error(e)}}),r.rid=t,r}s(t,e);var r=t.prototype;return r.getRid=function(){return this.rid},r.updateSubscription=function(e){if(e){var t,r=!this.subscription;this.subscription=e,null===(t=u.getOpenedRoomByRid(this.rid))||void 0===t||t.unreadSince.set(this.subscription.ls);var n=this.subscription,i=n.unread,s=n.alert;if(i||s){if(r){this.updateFirstUnreadRecordId();return}document.hasFocus()&&this.firstUnreadRecordId||this.updateFirstUnreadRecordId()}}},r.updateFirstUnreadRecordId=function(){var e,t,r=this;if(null!==(e=this.subscription)&&void 0!==e&&e.ls){var n=d.findOne({rid:this.subscription.rid,ts:{$gt:this.subscription.ls},"u._id":{$ne:null!==(t=a.userId())&&void 0!==t?t:void 0}},{sort:{ts:1}});this.setFirstUnreadRecordId(null==n?void 0:n._id),c.once("loaded-messages",function(){return r.updateFirstUnreadRecordId()})}},r.setFirstUnreadRecordId=function(e){this.firstUnreadRecordId=e,this.emit("unread-state-change",this.firstUnreadRecordId)},r.clearUnreadMark=function(){this.setFirstUnreadRecordId(void 0)},r.isUnreadMarkVisible=function(){var e;return!!this.unreadMark&&this.unreadMark.offsetTop>((null===(e=this.unreadMark.offsetParent)||void 0===e?void 0:e.scrollTop)||0)},r.attemptMarkAsRead=function(){var e=this.subscription||{},t=e.alert,r=e.unread;if(!(!t&&0===r||!document.hasFocus()||this.unreadMark&&!this.isUnreadMarkVisible()||c.getRoom(this.rid).unreadNotLoaded.get()>0))return this.markAsRead()},r.markAsRead=function(){var e=this;return n.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.rid){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",l.rest.post("/v1/subscriptions.read",{rid:this.rid}).then(function(){c.getRoom(e.rid).unreadNotLoaded.set(0)}));case 3:case"end":return t.stop()}},null,this,null,Promise)},i(t,[{key:"unreadMark",get:function(){return document.querySelector(".rcx-message-divider--unread")}}]),t}(o)}
//# sourceMappingURL=/dynamic/client/lib/chats/abc27e76b0f5dc7b7d25835a57eeeaa74fc2ae44.map
