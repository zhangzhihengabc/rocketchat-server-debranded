)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/chats/flows/processTooLongMessage.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport { settings } from '../../../../app/settings/client';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport GenericModal from '../../../components/GenericModal';\nimport { imperativeModal } from '../../imperativeModal';\nimport { dispatchToastMessage } from '../../toast';\nimport type { ChatAPI } from '../ChatAPI';\n\nexport const processTooLongMessage = async (chat: ChatAPI, { msg }: Pick<IMessage, 'msg'>): Promise<boolean> => {\n\tconst maxAllowedSize = settings.get('Message_MaxAllowedSize');\n\n\tif (msg.length <= maxAllowedSize) {\n\t\treturn false;\n\t}\n\tconst fileUploadsEnabled = settings.get('FileUpload_Enabled');\n\tconst convertLongMessagesToAttachment = settings.get('Message_AllowConvertLongMessagesToAttachment');\n\n\tif (chat.currentEditing || !fileUploadsEnabled || !convertLongMessagesToAttachment) {\n\t\tdispatchToastMessage({ type: 'error', message: new Error(t('Message_too_long')) });\n\t\tchat.composer?.setText(msg);\n\t\treturn true;\n\t}\n\n\tawait new Promise<void>((resolve) => {\n\t\tconst onConfirm = async (): Promise<void> => {\n\t\t\tconst contentType = 'text/plain';\n\t\t\tconst messageBlob = new Blob([msg], { type: contentType });\n\t\t\tconst fileName = `${Meteor.user()?.username ?? 'anonymous'} - ${new Date()}.txt`; // TODO: proper naming and formatting\n\t\t\tconst file = new File([messageBlob], fileName, {\n\t\t\t\ttype: contentType,\n\t\t\t\tlastModified: Date.now(),\n\t\t\t});\n\n\t\t\timperativeModal.close();\n\t\t\tawait chat.flows.uploadFiles([file]);\n\n\t\t\tresolve();\n\t\t};\n\n\t\tconst onClose = (): void => {\n\t\t\tchat.composer?.setText(msg);\n\n\t\t\timperativeModal.close();\n\t\t\tresolve();\n\t\t};\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle: t('Message_too_long'),\n\t\t\t\tchildren: t('Send_it_as_attachment_instead_question'),\n\t\t\t\tonConfirm,\n\t\t\t\tonClose,\n\t\t\t\tonCancel: onClose,\n\t\t\t\tvariant: 'warning',\n\t\t\t},\n\t\t});\n\t});\n\n\treturn true;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","export","processTooLongMessage","settings","t","v","GenericModal","imperativeModal","dispatchToastMessage","chat","_ref","msg","maxAllowedSize","fileUploadsEnabled","convertLongMessagesToAttachment","_chat$composer","async","_context2","prev","next","get","length","abrupt","currentEditing","type","message","Error","composer","setText","awrap","Promise","resolve","onConfirm","_callee","_Meteor$user$username","_Meteor$user","contentType","messageBlob","fileName","file","_callee$","_context","Blob","Meteor","user","username","Date","File","lastModified","now","close","flows","uploadFiles","stop","onClose","_chat$composer2","open","component","props","title","children","onCancel","variant"],"mappings":"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"}