)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/chats/flows/sendMessage.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport { KonchatNotification } from '../../../../app/ui/client/lib/KonchatNotification';\nimport { sdk } from '../../../../app/utils/client/lib/SDKClient';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport { dispatchToastMessage } from '../../toast';\nimport type { ChatAPI } from '../ChatAPI';\nimport { processMessageEditing } from './processMessageEditing';\nimport { processSetReaction } from './processSetReaction';\nimport { processSlashCommand } from './processSlashCommand';\nimport { processTooLongMessage } from './processTooLongMessage';\n\nconst process = async (chat: ChatAPI, message: IMessage, previewUrls?: string[]): Promise<void> => {\n\tKonchatNotification.removeRoomNotification(message.rid);\n\n\tif (await processSetReaction(chat, message)) {\n\t\treturn;\n\t}\n\n\tif (await processTooLongMessage(chat, message)) {\n\t\treturn;\n\t}\n\n\tif (await processMessageEditing(chat, message, previewUrls)) {\n\t\treturn;\n\t}\n\n\tif (await processSlashCommand(chat, message)) {\n\t\treturn;\n\t}\n\n\tawait sdk.call('sendMessage', message, previewUrls);\n};\n\nexport const sendMessage = async (\n\tchat: ChatAPI,\n\t{ text, tshow, previewUrls }: { text: string; tshow?: boolean; previewUrls?: string[] },\n): Promise<boolean> => {\n\tif (!(await chat.data.isSubscribedToRoom())) {\n\t\ttry {\n\t\t\tawait chat.data.joinRoom();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tchat.readStateManager.clearUnreadMark();\n\tawait chat.readStateManager.debouncedMarkAsRead();\n\n\ttext = text.trim();\n\n\tif (!text && !chat.currentEditing) {\n\t\t// Nothing to do\n\t\treturn false;\n\t}\n\n\tif (text) {\n\t\tconst message = await chat.data.composeMessage(text, {\n\t\t\tsendToChannel: tshow,\n\t\t\tquotedMessages: chat.composer?.quotedMessages.get() ?? [],\n\t\t\toriginalMessage: chat.currentEditing ? await chat.data.findMessageByID(chat.currentEditing.mid) : null,\n\t\t});\n\n\t\ttry {\n\t\t\tawait process(chat, message, previewUrls);\n\t\t\tchat.composer?.dismissAllQuotedMessages();\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t\treturn true;\n\t}\n\n\tif (chat.currentEditing) {\n\t\tconst originalMessage = await chat.data.findMessageByID(chat.currentEditing.mid);\n\n\t\tif (!originalMessage) {\n\t\t\tdispatchToastMessage({ type: 'warning', message: t('Message_not_found') });\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tif (await chat.flows.processMessageEditing({ ...originalMessage, msg: '' }, previewUrls)) {\n\t\t\t\tchat.currentEditing.stop();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tawait chat.currentEditing?.reset();\n\t\t\tawait chat.flows.requestMessageDeletion(originalMessage);\n\t\t\treturn false;\n\t\t} catch (error) {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t}\n\t}\n\n\treturn false;\n};\n",null],"names":["module","default","v","_objectSpread","_regeneratorRuntime","export","sendMessage","link","KonchatNotification","sdk","t","dispatchToastMessage","processMessageEditing","processSetReaction","processSlashCommand","processTooLongMessage","process","chat","message","previewUrls","async","_context","prev","next","removeRoomNotification","rid","awrap","sent","abrupt","call","stop","Promise","_ref","text","tshow","_chat$composer$quoted","_chat$composer","_chat$composer2","originalMessage","_chat$currentEditing","_context2","data","isSubscribedToRoom","joinRoom","t0","type","readStateManager","clearUnreadMark","debouncedMarkAsRead","trim","currentEditing","t1","t2","t3","t4","t5","composer","quotedMessages","get","findMessageByID","mid","t6","t7","t8","sendToChannel","t9","composeMessage","dismissAllQuotedMessages","t10","flows","msg","reset","requestMessageDeletion","t11"],"mappings":"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"}