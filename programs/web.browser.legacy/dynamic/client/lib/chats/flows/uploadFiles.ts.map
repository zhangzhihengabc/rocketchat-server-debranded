)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/chats/flows/uploadFiles.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { isRoomFederated } from '@rocket.chat/core-typings';\n\nimport { fileUploadIsValidContentType } from '../../../../app/utils/client';\nimport FileUploadModal from '../../../views/room/modals/FileUploadModal';\nimport { imperativeModal } from '../../imperativeModal';\nimport { prependReplies } from '../../utils/prependReplies';\nimport type { ChatAPI } from '../ChatAPI';\n\nexport const uploadFiles = async (chat: ChatAPI, files: readonly File[], resetFileInput?: () => void): Promise<void> => {\n\tconst replies = chat.composer?.quotedMessages.get() ?? [];\n\n\tconst msg = await prependReplies('', replies);\n\n\tconst room = await chat.data.getRoom();\n\n\tconst queue = [...files];\n\n\tconst uploadNextFile = (): void => {\n\t\tconst file = queue.pop();\n\t\tif (!file) {\n\t\t\tchat.composer?.dismissAllQuotedMessages();\n\t\t\treturn;\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: FileUploadModal,\n\t\t\tprops: {\n\t\t\t\tfile,\n\t\t\t\tfileName: file.name,\n\t\t\t\tfileDescription: chat.composer?.text ?? '',\n\t\t\t\tshowDescription: room && !isRoomFederated(room),\n\t\t\t\tonClose: (): void => {\n\t\t\t\t\timperativeModal.close();\n\t\t\t\t\tuploadNextFile();\n\t\t\t\t},\n\t\t\t\tonSubmit: (fileName: string, description?: string): void => {\n\t\t\t\t\tObject.defineProperty(file, 'name', {\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tvalue: fileName,\n\t\t\t\t\t});\n\t\t\t\t\tchat.uploads.send(file, {\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tmsg,\n\t\t\t\t\t});\n\t\t\t\t\tchat.composer?.clear();\n\t\t\t\t\timperativeModal.close();\n\t\t\t\t\tuploadNextFile();\n\t\t\t\t},\n\t\t\t\tinvalidContentType: Boolean(file.type && !fileUploadIsValidContentType(file.type)),\n\t\t\t},\n\t\t});\n\t};\n\n\tuploadNextFile();\n\tresetFileInput?.();\n};\n",null],"names":["module","link","default","_regeneratorRuntime","_toConsumableArray","export","uploadFiles","isRoomFederated","fileUploadIsValidContentType","v","FileUploadModal","imperativeModal","prependReplies","chat","files","resetFileInput","_chat$composer$quoted","_chat$composer","replies","msg","room","queue","uploadNextFile","async","_context","prev","next","composer","quotedMessages","get","awrap","sent","data","getRoom","_chat$composer$text","_chat$composer3","_chat$composer2","file","pop","dismissAllQuotedMessages","open","component","props","fileName","name","fileDescription","text","showDescription","onClose","close","onSubmit","description","_chat$composer4","Object","defineProperty","writable","value","uploads","send","clear","invalidContentType","Boolean","type","stop","Promise"],"mappings":"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"}