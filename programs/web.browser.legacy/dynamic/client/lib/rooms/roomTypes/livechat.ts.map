)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/rooms/roomTypes/livechat.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { AtLeast, ValueOf } from '@rocket.chat/core-typings';\n\nimport { hasPermission } from '../../../../app/authorization/client';\nimport { ChatRoom, ChatSubscription } from '../../../../app/models/client';\nimport { settings } from '../../../../app/settings/client';\nimport { getAvatarURL } from '../../../../app/utils/client/getAvatarURL';\nimport type { IRoomTypeClientDirectives } from '../../../../definition/IRoomTypeConfig';\nimport { RoomSettingsEnum, RoomMemberActions, UiTextContext } from '../../../../definition/IRoomTypeConfig';\nimport { getLivechatRoomType } from '../../../../lib/rooms/roomTypes/livechat';\nimport { roomCoordinator } from '../roomCoordinator';\n\nexport const LivechatRoomType = getLivechatRoomType(roomCoordinator);\n\nroomCoordinator.add(\n\t{\n\t\t...LivechatRoomType,\n\t\tlabel: 'Omnichannel',\n\t},\n\t{\n\t\tallowRoomSettingChange(_room, setting) {\n\t\t\tswitch (setting) {\n\t\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\t\treturn false;\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\tallowMemberAction(_room, action) {\n\t\t\treturn ([RoomMemberActions.INVITE, RoomMemberActions.JOIN] as Array<ValueOf<typeof RoomMemberActions>>).includes(action);\n\t\t},\n\n\t\troomName(room) {\n\t\t\treturn room.name || room.fname || (room as any).label;\n\t\t},\n\n\t\tgetUiText(context) {\n\t\t\tswitch (context) {\n\t\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\t\treturn 'Hide_Livechat_Warning';\n\t\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\t\treturn 'Hide_Livechat_Warning';\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\n\t\tcondition() {\n\t\t\treturn settings.get('Livechat_enabled') && hasPermission('view-l-room');\n\t\t},\n\n\t\tgetAvatarPath(room) {\n\t\t\treturn getAvatarURL({ username: `@${this.roomName(room)}` }) || '';\n\t\t},\n\n\t\tfindRoom(identifier) {\n\t\t\treturn ChatRoom.findOne({ _id: identifier });\n\t\t},\n\n\t\tisLivechatRoom() {\n\t\t\treturn true;\n\t\t},\n\n\t\tcanSendMessage(rid) {\n\t\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { open: 1 } });\n\t\t\treturn Boolean(room?.open);\n\t\t},\n\n\t\treadOnly(rid, _user) {\n\t\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { open: 1, servedBy: 1 } });\n\t\t\tif (!room?.open) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst subscription = ChatSubscription.findOne({ rid });\n\t\t\treturn !subscription;\n\t\t},\n\n\t\tgetIcon() {\n\t\t\treturn 'livechat';\n\t\t},\n\n\t\textractOpenRoomParams({ id }) {\n\t\t\treturn { type: 'l', reference: id };\n\t\t},\n\t} as AtLeast<IRoomTypeClientDirectives, 'roomName'>,\n);\n",null],"names":["module","link","default","_objectSpread","export","LivechatRoomType","hasPermission","ChatRoom","ChatSubscription","settings","getAvatarURL","RoomSettingsEnum","RoomMemberActions","UiTextContext","getLivechatRoomType","roomCoordinator","add","label","allowRoomSettingChange","_room","setting","JOIN_CODE","allowMemberAction","action","INVITE","JOIN","includes","roomName","room","name","fname","getUiText","context","HIDE_WARNING","LEAVE_WARNING","condition","get","getAvatarPath","username","findRoom","identifier","findOne","_id","isLivechatRoom","canSendMessage","rid","fields","open","Boolean","readOnly","_user","servedBy","getIcon","extractOpenRoomParams","_ref","type","reference","id"],"mappings":"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"}