)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/createReactiveSubscriptionFactory.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Tracker } from 'meteor/tracker';\n\nimport { queueMicrotask } from './utils/queueMicrotask';\n\ninterface ISubscriptionFactory<T> {\n\t(...args: any[]): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => T];\n}\n\nexport const createReactiveSubscriptionFactory =\n\t<T>(computeCurrentValueWith: (...args: any[]) => T): ISubscriptionFactory<T> =>\n\t(...args: any[]): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => T] => {\n\t\tconst callbacks = new Set<() => void>();\n\n\t\tlet currentValue = computeCurrentValueWith(...args);\n\n\t\tconst reactiveFn = (): void => {\n\t\t\tcurrentValue = computeCurrentValueWith(...args);\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tcallbacks.forEach((callback) => {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\tlet computation: Tracker.Computation | undefined;\n\n\t\tqueueMicrotask(() => {\n\t\t\tcomputation = Tracker.autorun(reactiveFn);\n\t\t});\n\n\t\treturn [\n\t\t\t(callback): (() => void) => {\n\t\t\t\tcallbacks.add(callback);\n\n\t\t\t\treturn (): void => {\n\t\t\t\t\tcallbacks.delete(callback);\n\n\t\t\t\t\tif (callbacks.size === 0) {\n\t\t\t\t\t\tqueueMicrotask(() => computation?.stop());\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\t\t(): T => currentValue,\n\t\t];\n\t};\n",null],"names":["module","export","createReactiveSubscriptionFactory","Tracker","queueMicrotask","computeCurrentValueWith","computation","_len","arguments","length","args","Array","_key","callbacks","Set","currentValue","apply","reactiveFn","forEach","callback","autorun","add","delete","size","_computation","stop"],"mappings":"uBAAAA,EAAOC,MAAE,CAAA,CAAAC,kCAAgC,WAAA,OAAAA,CAAA,CAAA,GAAAF,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAG,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAI,eAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAQlC,IARkCD,EAAAC,EAQ5BF,EACZ,SAAIG,CAA8C,EAAA,OAClD,WAAiG,IAAA,IAc5FC,EAd4FC,EAAAC,UAAAC,MAAA,CAA7FC,EAAW,AAAAC,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAXF,CAAW,CAAAE,EAAA,CAAAJ,SAAA,CAAAI,EAAA,CACd,IAAMC,EAAY,IAAIC,IAElBC,EAAeV,EAAuBW,KAAA,CAAA,KAAA,EAAIN,GAExCO,EAAa,WAClBF,EAAeV,EAAuBW,KAAA,CAAA,KAAA,EAAIN,GAC1CN,EAAe,WACdS,EAAUK,OAAO,CAAC,SAACC,CAAQ,EAC1BA,GACD,EACD,EACD,EAQA,OAJAf,EAAe,WACdE,EAAcH,EAAQiB,OAAO,CAACH,EAC/B,GAEO,CACN,SAACE,CAAQ,EAGR,OAFAN,EAAUQ,GAAG,CAACF,GAEP,WACNN,EAAUS,MAAM,CAACH,GAEM,IAAnBN,EAAUU,IAAI,EACjBnB,EAAe,WAAA,IAAAoB,EAAA,OAAA,AAAiB,OAAjBA,CAAAA,EAAMlB,CAAAA,GAAWkB,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAXA,EAAaC,IAAI,EAAE,EAE1C,CACD,EACA,WAAA,OAASV,CAAY,EACrB,AACF,CAAC"}