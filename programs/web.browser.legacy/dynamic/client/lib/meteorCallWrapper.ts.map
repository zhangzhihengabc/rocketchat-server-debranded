)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/meteorCallWrapper.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { DDPCommon } from 'meteor/ddp-common';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\n\nconst bypassMethods: string[] = ['setUserStatus', 'logout'];\n\nfunction shouldBypass({ method, params }: Meteor.IDDPMessage): boolean {\n\tif (method === 'login' && params[0]?.resume) {\n\t\treturn true;\n\t}\n\n\tif (method.startsWith('UserPresence:') || bypassMethods.includes(method)) {\n\t\treturn true;\n\t}\n\n\tif (method.startsWith('stream-')) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nfunction wrapMeteorDDPCalls(): void {\n\tconst { _send } = Meteor.connection;\n\n\tMeteor.connection._send = function _DDPSendOverREST(message): void {\n\t\tif (message.msg !== 'method' || shouldBypass(message)) {\n\t\t\treturn _send.call(Meteor.connection, message);\n\t\t}\n\n\t\tconst endpoint = Tracker.nonreactive(() => (!Meteor.userId() ? 'method.callAnon' : 'method.call'));\n\n\t\tconst restParams = {\n\t\t\tmessage: DDPCommon.stringifyDDP({ ...message }),\n\t\t};\n\n\t\tconst processResult = (_message: any): void => {\n\t\t\t// Prevent error on reconnections and method retry.\n\t\t\t// On those cases the API will be called 2 times but\n\t\t\t// the handler will be deleted after the first execution.\n\t\t\tif (!Meteor.connection._methodInvokers[message.id]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tMeteor.connection._livedata_data({\n\t\t\t\tmsg: 'updated',\n\t\t\t\tmethods: [message.id],\n\t\t\t});\n\t\t\tMeteor.connection.onMessage(_message);\n\t\t};\n\t\tconst method = encodeURIComponent(message.method.replace(/\\//g, ':'));\n\n\t\tsdk.rest\n\t\t\t.post(`/v1/${endpoint}/${method}`, restParams)\n\t\t\t.then(({ message: _message }) => {\n\t\t\t\tprocessResult(_message);\n\t\t\t\tif (message.method === 'login') {\n\t\t\t\t\tconst parsedMessage = DDPCommon.parseDDP(_message as any) as { result?: { token?: string } };\n\t\t\t\t\tif (parsedMessage.result?.token) {\n\t\t\t\t\t\tMeteor.loginWithToken(parsedMessage.result.token);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t};\n}\n\nwindow.USE_REST_FOR_DDP_CALLS && wrapMeteorDDPCalls();\n",null],"names":["module","link","default","_objectSpread","DDPCommon","Meteor","Tracker","sdk","_send","bypassMethods","window","USE_REST_FOR_DDP_CALLS","connection","message","msg","method","_ref","params","_params$","resume","startsWith","includes","call","endpoint","nonreactive","userId","restParams","stringifyDDP","processResult","_message","_methodInvokers","id","_livedata_data","methods","onMessage","encodeURIComponent","replace","rest","post","then","_ref2","_parsedMessage$result","parsedMessage","parseDDP","result","token","loginWithToken","catch","error","console"],"mappings":"uBAAkBA,EAAEC,IAAM,CAAA,uCAAoB,CAAAC,QAAAA,SAAAA,CAAAA,EAAAC,EAAAA,CAAA,CAAA,EAAA,GAArCH,EAAWC,IAAA,CAAM,oBAAoB,CAAAG,UAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAJ,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAK,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAL,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAM,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAN,EAAAA,IAAAA,CAAAA,uCAAAA,CAAAO,IAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAM9C,IAmBSC,EAzBTL,EAAAC,EAA8CC,EAAAC,EAAAC,EAMxCE,EAA0B,CAAC,gBAAiB,SAAS,AAgE3DC,CAAAA,OAAOC,sBAAsB,GA7CpBH,EAAUH,EAAOO,UAAU,CAA3BJ,KAAK,CAEbH,EAAOO,UAAU,CAACJ,KAAK,CAAG,SAA0BK,CAAO,EAC1D,GAAIA,AAAgB,WAAhBA,EAAQC,GAAG,GApBOC,EAAMC,AAoBiBH,EApBvBE,MAAM,CAAEE,EAAMD,AAoBSH,EApBfI,MAAM,CACtB,UAAXF,GAAkB,AAAa,OAAbG,CAAAA,EAAID,CAAM,CAAC,EAAE,AAAD,GAACC,AAAA,KAAA,IAAAA,GAATA,EAAWC,MAAM,EAIvCJ,EAAOK,UAAU,CAAC,kBAAoBX,EAAcY,QAAQ,CAACN,IAI7DA,EAAOK,UAAU,CAAC,YAYpB,OAAOZ,EAAMc,IAAI,CAACjB,EAAOO,UAAU,CAAEC,GAGtC,IAxB0DK,EAApCH,EAAQE,EAwBxBM,EAAWjB,EAAQkB,WAAW,CAAC,WAAA,OAAO,AAACnB,EAAOoB,MAAM,GAAyB,cAApB,iBAAiC,GAE1FC,EAAa,CAClBb,QAAST,EAAUuB,YAAY,CAAAxB,EAAA,CAAA,EAAMU,KAGhCe,EAAgB,SAACC,CAAa,EAI9BxB,EAAOO,UAAU,CAACkB,eAAe,CAACjB,EAAQkB,EAAE,CAAC,GAGlD1B,EAAOO,UAAU,CAACoB,cAAc,CAAC,CAChClB,IAAK,UACLmB,QAAS,CAACpB,EAAQkB,EAAE,CAAA,GAErB1B,EAAOO,UAAU,CAACsB,SAAS,CAACL,GAC7B,EACMd,EAASoB,mBAAmBtB,EAAQE,MAAM,CAACqB,OAAO,CAAC,MAAO,MAEhE7B,EAAI8B,IAAI,CACNC,IAAI,CAAA,OAAQf,EAAQ,IAAIR,EAAUW,GAClCa,IAAI,CAAC,SAAAC,CAAA,EAA0B,IAAdX,EAAQW,EAAjB3B,OAAO,CAEf,GADAe,EAAcC,GACVhB,AAAmB,UAAnBA,EAAQE,MAAM,CAAc,CAC/B,IAD+B0B,EACzBC,EAAgBtC,EAAUuC,QAAQ,CAACd,EACjB,QAAxBY,CAAAA,EAAIC,EAAcE,MAAM,AAANA,GAAMH,AAAA,KAAA,IAAAA,GAApBA,EAAsBI,KAAK,EAC9BxC,EAAOyC,cAAc,CAACJ,EAAcE,MAAM,CAACC,KAAK,EAGnD,GACCE,KAAK,CAAC,SAACC,CAAK,EACZC,QAAQD,KAAK,CAACA,EACf,EACF"}