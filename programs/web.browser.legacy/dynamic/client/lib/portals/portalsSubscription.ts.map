)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/portals/portalsSubscription.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Random } from '@rocket.chat/random';\nimport type { ReactElement } from 'react';\n\ntype SubscribedPortal = {\n\tportal: ReactElement;\n\tkey: string;\n};\n\ntype PortalsSubscription = {\n\tsubscribe: (callback: () => void) => () => void;\n\tgetSnapshot: () => SubscribedPortal[];\n\thas: (key: unknown) => boolean;\n\tset: (key: unknown, portal: ReactElement) => void;\n\tdelete: (key: unknown) => void;\n};\n\nconst createPortalsSubscription = (): PortalsSubscription => {\n\tconst portalsMap = new Map<unknown, SubscribedPortal>();\n\tlet portals = Array.from(portalsMap.values());\n\tconst emitter = new Emitter<{ update: void }>();\n\n\treturn {\n\t\tgetSnapshot: (): SubscribedPortal[] => portals,\n\t\tsubscribe: (callback): (() => void) => emitter.on('update', callback),\n\t\tdelete: (key): void => {\n\t\t\tportalsMap.delete(key);\n\t\t\tportals = Array.from(portalsMap.values());\n\t\t\temitter.emit('update');\n\t\t},\n\t\tset: (key, portal): void => {\n\t\t\tportalsMap.set(key, { portal, key: Random.id() });\n\t\t\tportals = Array.from(portalsMap.values());\n\t\t\temitter.emit('update');\n\t\t},\n\t\thas: (key): boolean => portalsMap.has(key),\n\t};\n};\n\nexport const portalsSubscription = createPortalsSubscription();\n\nexport const unregisterPortal = (key: unknown): void => {\n\tportalsSubscription.delete(key);\n};\n\nexport const registerPortal = (key: unknown, portal: ReactElement): (() => void) => {\n\tportalsSubscription.set(key, portal);\n\treturn (): void => {\n\t\tunregisterPortal(key);\n\t};\n};\n",null],"names":["module","export","portalsSubscription","unregisterPortal","registerPortal","Emitter","Random","portalsMap","portals","emitter","Array","from","Map","values","getSnapshot","subscribe","callback","on","key","delete","emit","set","portal","id","has"],"mappings":"uBAAAA,EAAOC,MAAE,CAAA,CAAAC,oBAAe,WAAsB,OAACA,CAAA,EAAAC,iBAAAA,WAAA,OAAAA,CAAA,EAAAC,eAAAA,WAAA,OAAAA,CAAA,CAAA,GAAAJ,EAAAA,IAAAA,CAAAA,uBAAAA,CAAAK,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAL,EAAAA,IAAAA,CAAAA,sBAAAA,CAAAM,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAuCxC,IAvCwCD,EAAAC,EAkBxCC,EACFC,EACEC,EAmBMP,GApBRM,EAAUE,MAAMC,IAAI,CAACJ,CADnBA,EAAa,IAAIK,KACaC,MAAM,IACpCJ,EAAU,IAAIJ,EAEb,CACNS,YAAa,WAAA,OAA0BN,CAAO,EAC9CO,UAAW,SAACC,CAAQ,EAAA,OAAmBP,EAAQQ,EAAE,CAAC,SAAUD,EAAS,EACrE,OAAQ,SAACE,CAAG,EACXX,EAAWY,MAAM,CAACD,GAClBV,EAAUE,MAAMC,IAAI,CAACJ,EAAWM,MAAM,IACtCJ,EAAQW,IAAI,CAAC,SACd,EACAC,IAAK,SAACH,CAAG,CAAEI,CAAM,EAChBf,EAAWc,GAAG,CAACH,EAAK,CAAEI,OAAAA,EAAQJ,IAAKZ,EAAOiB,EAAE,EAAE,GAC9Cf,EAAUE,MAAMC,IAAI,CAACJ,EAAWM,MAAM,IACtCJ,EAAQW,IAAI,CAAC,SACd,EACAI,IAAK,SAACN,CAAG,EAAA,OAAcX,EAAWiB,GAAG,CAACN,EAAI,IAM/Bf,EAAmB,SAACe,CAAY,EAC5ChB,EAAoBiB,MAAM,CAACD,EAC5B,EAEad,EAAiB,SAACc,CAAY,CAAEI,CAAoB,EAEhE,OADApB,EAAoBmB,GAAG,CAACH,EAAKI,GACtB,WACNnB,EAAiBe,EAClB,CACD"}