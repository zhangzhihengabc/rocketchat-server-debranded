)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/federation/Federation.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IRoom, ISubscription, IUser, ValueOf } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isPublicRoom } from '@rocket.chat/core-typings';\n\nimport { RoomRoles } from '../../../app/models/client';\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\n\nconst allowedUserActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\n\tRoomMemberActions.REMOVE_USER,\n\tRoomMemberActions.SET_AS_OWNER,\n\tRoomMemberActions.SET_AS_MODERATOR,\n];\n\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\n\nexport const actionAllowed = (\n\troom: Partial<IRoom>,\n\taction: ValueOf<typeof RoomMemberActions>,\n\tdisplayingUserId: IUser['_id'],\n\tuserSubscription?: ISubscription,\n): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\n\tconst subscribed = Boolean(userSubscription);\n\tconst defaultUser = !userSubscription?.roles;\n\tif (!subscribed || defaultUser) {\n\t\treturn false;\n\t}\n\n\tconst myself = userSubscription.u?._id === displayingUserId;\n\tconst removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\n\n\tif (removingMyself) {\n\t\treturn false;\n\t}\n\n\tconst displayingUserRoomRoles = RoomRoles.findOne({ 'rid': room._id, 'u._id': displayingUserId })?.roles || [];\n\tconst loggedInUserRoomRoles = userSubscription.roles || [];\n\n\tif (loggedInUserRoomRoles.includes('owner')) {\n\t\tif (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\treturn displayingUserRoomRoles.includes('owner') ? myself : true;\n\t\t}\n\n\t\tif (action === RoomMemberActions.REMOVE_USER) {\n\t\t\treturn !displayingUserRoomRoles.includes('owner');\n\t\t}\n\t\tconst allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\n\n\t\treturn allowedForOwnersOverDefaultUsers;\n\t}\n\n\tif (loggedInUserRoomRoles.includes('moderator')) {\n\t\tif (displayingUserRoomRoles.includes('owner')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (displayingUserRoomRoles.includes('moderator')) {\n\t\t\tif (action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\t\treturn myself;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconst allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\n\n\t\treturn allowedForModeratorsOverDefaultUsers;\n\t}\n\n\treturn false;\n};\n\nexport const isEditableByTheUser = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn isRoomFederated(room) && Boolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'));\n};\n\nexport const canCreateInviteLinks = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn (\n\t\tisRoomFederated(room) &&\n\t\tisPublicRoom(room) &&\n\t\tBoolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'))\n\t);\n};\n\nexport const isRoomSettingAllowed = (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n};\n",null],"names":["module","export","actionAllowed","isEditableByTheUser","canCreateInviteLinks","isRoomSettingAllowed","isRoomFederated","isDirectMessageRoom","isPublicRoom","RoomRoles","RoomMemberActions","RoomSettingsEnum","allowedUserActionsInFederatedRooms","REMOVE_USER","SET_AS_OWNER","SET_AS_MODERATOR","allowedRoomSettingsChangesInFederatedRooms","NAME","TOPIC","room","action","displayingUserId","userSubscription","_userSubscription$u","_RoomRoles$findOne","defaultUser","roles","Boolean","myself","u","_id","displayingUserRoomRoles","findOne","loggedInUserRoomRoles","includes","user","subscription","_subscription$roles","_subscription$roles2","_subscription$roles3","_subscription$roles4","setting"],"mappings":"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"}