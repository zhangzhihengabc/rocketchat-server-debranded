)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/voip/QueueAggregator.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["/**\n * Class representing the agent's queue information. This class stores the information\n * of all the queues that the agent is serving.\n *\n * @remarks\n * This class stores the necessary information of agent's queue stats.\n * It also maintains a history of agents queue operation history for current\n * login session. (Agent logging in to rocket-chat and logging off from rocket chat.)\n * Currently the data is stored locally but may sent back to server if such need exists.\n */\n\nimport type { IQueueMembershipSubscription, ICallerInfo, IQueueInfo } from '@rocket.chat/core-typings';\n\ninterface IQueueServingRecord {\n\tqueueInfo: IQueueInfo;\n\tcallStarted: Date | undefined;\n\tcallEnded: Date | undefined;\n\tcallerId: ICallerInfo;\n\tagentExtension: string;\n}\n/**\n * Currently this class depends on the external users to update this class.\n * But in theory, this class serves as\n */\nexport class QueueAggregator {\n\t// Maintains the history of the queue that the agent has served\n\tprivate sessionQueueCallServingHistory: IQueueServingRecord[];\n\n\tprivate currentlyServing: IQueueServingRecord;\n\n\tprivate currentQueueMembershipStatus: Record<string, IQueueInfo>;\n\n\tprivate extension: string;\n\n\tconstructor() {\n\t\tthis.sessionQueueCallServingHistory = [];\n\t\tthis.currentQueueMembershipStatus = {};\n\t}\n\n\tprivate updateQueueInfo(queueName: string, queuedCalls: number): void {\n\t\tif (!this.currentQueueMembershipStatus?.[queueName]) {\n\t\t\t// something is wrong. Queue is not found in the membership details.\n\t\t\treturn;\n\t\t}\n\t\tthis.currentQueueMembershipStatus[queueName].callsInQueue = queuedCalls;\n\t}\n\n\tsetMembership(subscription: IQueueMembershipSubscription): void {\n\t\tthis.extension = subscription.extension;\n\n\t\tsubscription.queues.forEach((queue) => {\n\t\t\tconst queueInfo: IQueueInfo = {\n\t\t\t\tqueueName: queue.name,\n\t\t\t\tcallsInQueue: 0,\n\t\t\t};\n\t\t\tthis.currentQueueMembershipStatus[queue.name] = queueInfo;\n\t\t});\n\t}\n\n\tqueueJoined(joiningDetails: { queuename: string; callerid: { id: string }; queuedcalls: string }): void {\n\t\tthis.updateQueueInfo(joiningDetails.queuename, Number(joiningDetails.queuedcalls));\n\t}\n\n\tcallPickedup(queue: { queuename: string; queuedcalls: string; waittimeinqueue: string }): void {\n\t\tthis.updateQueueInfo(queue.queuename, Number(queue.queuedcalls));\n\t}\n\n\tmemberAdded(queue: { queuename: string; queuedcalls: string }): void {\n\t\t// current user is added in the queue which has queue count |queuedcalls|\n\t\tconst queueInfo: IQueueInfo = {\n\t\t\tqueueName: queue.queuename,\n\t\t\tcallsInQueue: Number(queue.queuedcalls),\n\t\t};\n\t\tthis.currentQueueMembershipStatus[queue.queuename] = queueInfo;\n\t}\n\n\tmemberRemoved(queue: { queuename: string; queuedcalls: string }): void {\n\t\t// current user is removed from the queue which has queue count |queuedcalls|\n\t\tif (!this.currentQueueMembershipStatus?.[queue.queuename]) {\n\t\t\t// something is wrong. Queue is not found in the membership details.\n\t\t\treturn;\n\t\t}\n\t\tdelete this.currentQueueMembershipStatus[queue.queuename];\n\t}\n\n\tqueueAbandoned(queue: { queuename: string; queuedcallafterabandon: string }): void {\n\t\tthis.updateQueueInfo(queue.queuename, Number(queue.queuedcallafterabandon));\n\t}\n\n\tgetCallWaitingCount(): number {\n\t\treturn Object.entries(this.currentQueueMembershipStatus).reduce((acc, [_, value]) => acc + value.callsInQueue, 0);\n\t}\n\n\tgetCurrentQueueName(): string {\n\t\tif (this.currentlyServing?.queueInfo) {\n\t\t\treturn this.currentlyServing.queueInfo.queueName;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tcallRinging(queueInfo: { queuename: string; callerid: { id: string; name: string } }): void {\n\t\tif (!this.currentQueueMembershipStatus?.[queueInfo.queuename]) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst queueServing: IQueueServingRecord = {\n\t\t\tqueueInfo: this.currentQueueMembershipStatus[queueInfo.queuename],\n\t\t\tcallerId: {\n\t\t\t\tcallerId: queueInfo.callerid.id,\n\t\t\t\tcallerName: queueInfo.callerid.name,\n\t\t\t},\n\t\t\tcallStarted: undefined,\n\t\t\tcallEnded: undefined,\n\t\t\tagentExtension: this.extension,\n\t\t};\n\t\tthis.currentlyServing = queueServing;\n\t}\n\n\tcallStarted(): void {\n\t\tif (this.currentlyServing) {\n\t\t\tthis.currentlyServing.callStarted = new Date();\n\t\t}\n\t}\n\n\tcallEnded(): void {\n\t\t// Latest calls are at lower index\n\t\tif (this.currentlyServing) {\n\t\t\tthis.currentlyServing.callEnded = new Date();\n\t\t\tthis.sessionQueueCallServingHistory.unshift(this.currentlyServing);\n\t\t}\n\t}\n}\n",null],"names":["module","default","_slicedToArray","QueueAggregator","sessionQueueCallServingHistory","currentlyServing","currentQueueMembershipStatus","extension","_proto","prototype","updateQueueInfo","queueName","queuedCalls","_this$currentQueueMem","callsInQueue","setMembership","subscription","_this","queues","forEach","queue","queueInfo","name","queueJoined","joiningDetails","queuename","Number","queuedcalls","callPickedup","memberAdded","memberRemoved","_this$currentQueueMem2","queueAbandoned","queuedcallafterabandon","getCallWaitingCount","Object","entries","reduce","acc","_ref","_ref2","value","getCurrentQueueName","_this$currentlyServin","callRinging","_this$currentQueueMem3","queueServing","callerId","callerid","id","callerName","callStarted","undefined","callEnded","agentExtension","Date","unshift"],"mappings":"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"}