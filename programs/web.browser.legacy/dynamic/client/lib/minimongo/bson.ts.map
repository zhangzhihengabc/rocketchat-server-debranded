)]}'
{"version":3,"sources":["meteor://ðŸ’»app/client/lib/minimongo/bson.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n",null],"names":["module","link","default","_toConsumableArray","export","getBSONType","compareBSONValues","BSONType","v","Double","String","Boolean","Array","isArray","Null","RegExp","Regex","JavaScript","Date","Uint8Array","BinData","Object","getBSONTypeOrder","type","Int","Long","Symbol","ObjectId","Timestamp","JavaScriptWithScope","a","b","undefined","_Array$prototype$conc","_Array$prototype$conc2","ta","oa","tb","ob","Error","localeCompare","prototype","concat","call","apply","entries","i","length","s","Undefined","toHexString","Number","getTime"],"mappings":"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"}