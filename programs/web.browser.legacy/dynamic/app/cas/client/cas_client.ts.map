)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/cas/client/cas_client.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Random } from '@rocket.chat/random';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = typeof window.screenX !== 'undefined' ? window.screenX : window.screenLeft;\n\tconst screenY = typeof window.screenY !== 'undefined' ? window.screenY : window.screenTop;\n\tconst outerWidth = typeof window.outerWidth !== 'undefined' ? window.outerWidth : document.body.clientWidth;\n\tconst outerHeight = typeof window.outerHeight !== 'undefined' ? window.outerHeight : document.body.clientHeight - 22;\n\t// XXX what is the 22?\n\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\tnewwindow?.focus();\n\n\treturn newwindow;\n};\n\n(Meteor as any).loginWithCas = (_?: unknown, callback?: () => void) => {\n\tconst credentialToken = Random.id();\n\tconst loginUrl = settings.get('CAS_login_url');\n\tconst popupWidth = settings.get('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get('CAS_popup_height') || 600;\n\n\tif (!loginUrl) {\n\t\treturn;\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t// check if the provided CAS URL already has some parameters\n\tconst delim = loginUrl.split('?').length > 1 ? '&' : '?';\n\tconst popupUrl = `${loginUrl}${delim}service=${appUrl}/_cas/${credentialToken}`;\n\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tconst checkPopupOpen = setInterval(() => {\n\t\tlet popupClosed;\n\t\ttry {\n\t\t\t// Fix for #328 - added a second test criteria (popup.closed === undefined)\n\t\t\t// to humour this Android quirk:\n\t\t\t// http://code.google.com/p/android/issues/detail?id=21061\n\t\t\tpopupClosed = popup?.closed || popup?.closed === undefined;\n\t\t} catch (e) {\n\t\t\t// For some unknown reason, IE9 (and others?) sometimes (when\n\t\t\t// the popup closes too quickly?) throws \"SCRIPT16386: No such\n\t\t\t// interface supported\" when trying to read 'popup.closed'. Try\n\t\t\t// again in 100ms.\n\t\t\treturn;\n\t\t}\n\n\t\tif (popupClosed) {\n\t\t\tclearInterval(checkPopupOpen);\n\n\t\t\t// check auth on server.\n\t\t\tAccounts.callLoginMethod({\n\t\t\t\tmethodArguments: [{ cas: { credentialToken } }],\n\t\t\t\tuserCallback: callback,\n\t\t\t});\n\t\t}\n\t}, 100);\n};\n",null],"names":["module","link","Random","Accounts","Meteor","settings","openCenteredPopup","url","width","height","screenX","window","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","newwindow","open","focus","loginWithCas","_","callback","credentialToken","id","loginUrl","get","popupWidth","popupHeight","appUrl","absoluteUrl","replace","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","delim","split","length","popup","checkPopupOpen","setInterval","popupClosed","closed","undefined","e","clearInterval","callLoginMethod","methodArguments","cas","userCallback"],"mappings":"uBAASA,EAAQC,IAAA,CAAM,sBAAsB,CAAAC,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAF,EAAAA,IAAAA,CAAAA,uBAAAA,CAAAG,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAH,EAAAA,IAAAA,CAAAA,gBAAAA,CAAAI,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAJ,EAAAA,IAAAA,CAAAA,wBAAAA,CAAAK,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAM7C,IANAH,EAA6CC,EAAAC,EAAAC,EAMvCC,EAAoB,SAACC,CAAW,CAAEC,CAAa,CAAEC,CAAc,EACpE,IAAMC,EAAU,AAA0B,KAAA,IAAnBC,OAAOD,OAAO,CAAmBC,OAAOD,OAAO,CAAGC,OAAOC,UAAU,CACpFC,EAAU,AAA0B,KAAA,IAAnBF,OAAOE,OAAO,CAAmBF,OAAOE,OAAO,CAAGF,OAAOG,SAAS,CACnFC,EAAa,AAA6B,KAAA,IAAtBJ,OAAOI,UAAU,CAAmBJ,OAAOI,UAAU,CAAGC,SAASC,IAAI,CAACC,WAAW,CACrGC,EAAc,AAA8B,KAAA,IAAvBR,OAAOQ,WAAW,CAAmBR,OAAOQ,WAAW,CAAGH,SAASC,IAAI,CAACG,YAAY,CAAG,GAS5GC,EAAYV,OAAOW,IAAI,CAACf,EAAK,QAFrB,SAAYC,EAAK,WAAWC,EAAM,SAFnCC,CAAAA,EAAU,AAACK,CAAAA,EAAaP,CAAAA,EAAS,CAAA,EAEe,QADjDK,CAAAA,EAAU,AAACM,CAAAA,EAAcV,CAAAA,EAAU,CAAA,EACyB,mBAKxE,OAFAY,MAAAA,GAAAA,EAAWE,KAAK,GAETF,CACR,CAECjB,CAAAA,EAAeoB,YAAY,CAAG,SAACC,CAAW,CAAEC,CAAqB,EACjE,IAAMC,EAAkBzB,EAAO0B,EAAE,GAC3BC,EAAWxB,EAASyB,GAAG,CAAC,iBACxBC,EAAa1B,EAASyB,GAAG,CAAC,oBAAsB,IAChDE,EAAc3B,EAASyB,GAAG,CAAC,qBAAuB,IAExD,GAAKD,EAIL,IAAMI,EAAS7B,EAAO8B,WAAW,GAAGC,OAAO,CAAC,MAAO,IAAMC,0BAA0BC,oBAAoB,CAEjGC,EAAQT,EAASU,KAAK,CAAC,KAAKC,MAAM,CAAG,EAAI,IAAM,IAG/CC,EAAQnC,EAFA,GAAMuB,EAAWS,EAAK,WAAWL,EAAM,SAASN,EAEpBI,EAAYC,GAEhDU,EAAiBC,YAAY,WAClC,IAAIC,EACJ,GAAI,CAIHA,EAAc,AAAAH,CAAAA,MAAAA,EAAK,KAAA,EAALA,EAAOI,MAAM,AAANA,GAAU,AAAAJ,CAAAA,MAAAA,EAAK,KAAA,EAALA,EAAOI,MAAM,AAANA,IAAWC,KAAAA,EAChD,MAAOC,EAAG,CAKX,OAGGH,IACHI,cAAcN,GAGdvC,EAAS8C,eAAe,CAAC,CACxBC,gBAAiB,CAAC,CAAEC,IAAK,CAAExB,gBAAAA,CAAe,CAAE,EAAG,CAC/CyB,aAAc1B,IAGjB,EAAG,IACJ"}