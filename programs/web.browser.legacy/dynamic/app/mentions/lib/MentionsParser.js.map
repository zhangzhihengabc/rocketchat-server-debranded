)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/mentions/lib/MentionsParser.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { escapeHTML } from '@rocket.chat/string-helpers';\n\nconst userTemplateDefault = ({ prefix, className, mention, title, label, type = 'username' }) =>\n\t`${prefix}<a class=\"${className}\" data-${type}=\"${mention}\"${title ? ` title=\"${title}\"` : ''}>${label}</a>`;\nconst roomTemplateDefault = ({ prefix, reference, mention }) =>\n\t`${prefix}<a class=\"mention-link mention-link--room\" data-channel=\"${reference}\">${`#${mention}`}</a>`;\nexport class MentionsParser {\n\tconstructor({ pattern, useRealName, me, roomTemplate = roomTemplateDefault, userTemplate = userTemplateDefault }) {\n\t\tthis.pattern = pattern;\n\t\tthis.useRealName = useRealName;\n\t\tthis.me = me;\n\t\tthis.userTemplate = userTemplate;\n\t\tthis.roomTemplate = roomTemplate;\n\t}\n\n\tset me(m) {\n\t\tthis._me = m;\n\t}\n\n\tget me() {\n\t\treturn typeof this._me === 'function' ? this._me() : this._me;\n\t}\n\n\tset pattern(p) {\n\t\tthis._pattern = p;\n\t}\n\n\tget pattern() {\n\t\treturn typeof this._pattern === 'function' ? this._pattern() : this._pattern;\n\t}\n\n\tset useRealName(s) {\n\t\tthis._useRealName = s;\n\t}\n\n\tget useRealName() {\n\t\treturn typeof this._useRealName === 'function' ? this._useRealName() : this._useRealName;\n\t}\n\n\tget userMentionRegex() {\n\t\treturn new RegExp(`(^|\\\\s|>)@(${this.pattern}(@(${this.pattern}))?(:([0-9a-zA-Z-_.]+))?)`, 'gm');\n\t}\n\n\tget channelMentionRegex() {\n\t\treturn new RegExp(`(^|\\\\s|>)#(${this.pattern}(@(${this.pattern}))?)`, 'gm');\n\t}\n\n\treplaceUsers = (msg, { mentions, temp }, me) =>\n\t\tmsg.replace(this.userMentionRegex, (match, prefix, mention) => {\n\t\t\tconst classNames = ['mention-link'];\n\n\t\t\tif (mention === 'all') {\n\t\t\t\tclassNames.push('mention-link--all');\n\t\t\t\tclassNames.push('mention-link--group');\n\t\t\t} else if (mention === 'here') {\n\t\t\t\tclassNames.push('mention-link--here');\n\t\t\t\tclassNames.push('mention-link--group');\n\t\t\t} else if (mention === me) {\n\t\t\t\tclassNames.push('mention-link--me');\n\t\t\t\tclassNames.push('mention-link--user');\n\t\t\t} else {\n\t\t\t\tclassNames.push('mention-link--user');\n\t\t\t}\n\n\t\t\tconst className = classNames.join(' ');\n\n\t\t\tif (mention === 'all' || mention === 'here') {\n\t\t\t\treturn this.userTemplate({ prefix, className, mention, label: mention, type: 'group' });\n\t\t\t}\n\n\t\t\tconst filterUser = ({ username, type }) => (!type || type === 'user') && username === mention;\n\t\t\tconst filterTeam = ({ name, type }) => type === 'team' && name === mention;\n\n\t\t\tconst [mentionObj] = (mentions || []).filter((m) => filterUser(m) || filterTeam(m));\n\n\t\t\tconst label = temp\n\t\t\t\t? mention && escapeHTML(mention)\n\t\t\t\t: mentionObj && escapeHTML(mentionObj.type === 'team' || this.useRealName ? mentionObj.name : mentionObj.username);\n\n\t\t\tif (!label) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\treturn this.userTemplate({\n\t\t\t\tprefix,\n\t\t\t\tclassName,\n\t\t\t\tmention,\n\t\t\t\tlabel,\n\t\t\t\ttype: mentionObj?.type === 'team' ? 'team' : 'username',\n\t\t\t\ttitle: this.useRealName ? mention : label,\n\t\t\t});\n\t\t});\n\n\treplaceChannels = (msg, { temp, channels }) =>\n\t\tmsg.replace(/&#39;/g, \"'\").replace(this.channelMentionRegex, (match, prefix, mention) => {\n\t\t\tif (\n\t\t\t\t!temp &&\n\t\t\t\t!(\n\t\t\t\t\tchannels &&\n\t\t\t\t\tchannels.find((c) => {\n\t\t\t\t\t\treturn c.dname ? c.dname === mention : c.name === mention;\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tconst channel =\n\t\t\t\tchannels &&\n\t\t\t\tchannels.find(({ name, dname }) => {\n\t\t\t\t\treturn dname ? dname === mention : name === mention;\n\t\t\t\t});\n\t\t\tconst reference = channel ? channel._id : mention;\n\t\t\treturn this.roomTemplate({ prefix, reference, channel, mention });\n\t\t});\n\n\tgetUserMentions(str) {\n\t\treturn (str.match(this.userMentionRegex) || []).map((match) => match.trim());\n\t}\n\n\tgetChannelMentions(str) {\n\t\treturn (str.match(this.channelMentionRegex) || []).map((match) => match.trim());\n\t}\n\n\tparse(message) {\n\t\tlet msg = (message && message.html) || '';\n\t\tif (!msg.trim()) {\n\t\t\treturn message;\n\t\t}\n\t\tmsg = this.replaceUsers(msg, message, this.me);\n\t\tmsg = this.replaceChannels(msg, message, this.me);\n\t\tmessage.html = msg;\n\t\treturn message;\n\t}\n}\n",null],"names":["module","link","default","v","_slicedToArray","_createClass","export","MentionsParser","escapeHTML","userTemplateDefault","_ref","prefix","className","mention","title","label","_ref$type","type","roomTemplateDefault","_ref2","reference","_ref3","_this","pattern","useRealName","me","_ref3$roomTemplate","roomTemplate","_ref3$userTemplate","userTemplate","replaceUsers","msg","_ref4","mentions","temp","replace","userMentionRegex","match","classNames","push","join","filterUser","_ref5","username","filterTeam","_ref6","name","mentionObj","_filter2","filter","m","replaceChannels","_ref7","channels","channelMentionRegex","find","c","dname","channel","_ref8","_id","_proto","prototype","getUserMentions","str","map","trim","getChannelMentions","parse","message","html","key","get","_me","set","_pattern","p","_useRealName","s","RegExp"],"mappings":"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"}