function module(e,t,i){var n,r,a,o,s,c,u,d,l,v,p=["type","triggerId"];i.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){n=e}},0),i.link("@babel/runtime/regenerator",{default:function(e){r=e}},1),i.link("@babel/runtime/helpers/objectSpread2",{default:function(e){a=e}},2),i.export({ActionManager:function(){return g}}),i.link("@rocket.chat/emitter",{Emitter:function(e){o=e}},0),i.link("@rocket.chat/random",{Random:function(e){s=e}},1),i.link("react",{lazy:function(e){c=e}},2),i.link("../../../client/lib/banners",{"*":function(e){u=e}},3),i.link("../../../client/lib/imperativeModal",{imperativeModal:function(e){d=e}},4),i.link("../../utils/client/lib/SDKClient",{sdk:function(e){l=e}},5),i.link("./UiKitTriggerTimeoutError",{UiKitTriggerTimeoutError:function(e){v=e}},6);var I=c(function(){return i.dynamicImport("../../../client/views/modal/uikit/UiKitModal")}),g=function(){function e(e){this.router=void 0,this.events=new o,this.triggersId=new Map,this.viewInstances=new Map,this.router=e}var t=e.prototype;return t.invalidateTriggerId=function(e){var t=this.triggersId.get(e);return this.triggersId.delete(e),t},t.on=function(e,t){return this.events.on(e,t)},t.off=function(e,t){return this.events.off(e,t)},t.notifyBusy=function(){this.events.emit("busy",{busy:!0})},t.notifyIdle=function(){this.events.emit("busy",{busy:!1})},t.generateTriggerId=function(t){var i=this,n=s.id();return this.triggersId.set(n,t),setTimeout(function(){return i.invalidateTriggerId(n)},e.TRIGGER_TIMEOUT),n},t.emitInteraction=function(t,i){var n,o,s=this;return r.async(function(c){for(;;)switch(c.prev=c.next){case 0:return this.notifyBusy(),n=this.generateTriggerId(t),c.next=4,r.awrap(Promise.race([new Promise(function(i,r){o=setTimeout(function(){return r(new v("Timeout",{triggerId:n,appId:t}))},e.TRIGGER_TIMEOUT)}),l.rest.post("/apps/ui.interaction/"+t,a(a({},i),{},{triggerId:n})).then(function(e){return s.handleServerInteraction(e)})]).finally(function(){o&&clearTimeout(o),s.notifyIdle()}));case 4:case"end":return c.stop()}},null,this,null,Promise)},t.handleServerInteraction=function(e){var t=e.triggerId;if(this.triggersId.has(t)&&this.invalidateTriggerId(t)){switch(e.type){case"errors":var i=e.type,r=e.triggerId,a=e.viewId,o=e.appId,s=e.errors;this.events.emit(e.viewId,{type:i,triggerId:r,viewId:a,appId:o,errors:s});break;case"modal.open":var c=e.view;this.openModal(c);break;case"modal.update":case"contextual_bar.update":var u=e.type,d=e.triggerId,l=e.appId,v=e.view;this.events.emit(v.id,{type:u,triggerId:d,viewId:v.id,appId:l,view:v});break;case"modal.close":break;case"banner.open":e.type,e.triggerId;var I=n(e,p);this.openBanner(I);break;case"banner.update":var g=e.type,h=e.triggerId,f=e.appId,w=e.view;this.events.emit(w.viewId,{type:g,triggerId:h,viewId:w.viewId,appId:f,view:w});break;case"banner.close":var m,b=e.viewId;null===(m=this.viewInstances.get(b))||void 0===m||m.close();break;case"contextual_bar.open":var y=e.view;this.openContextualBar(y);break;case"contextual_bar.close":var T,k=e.view;null===(T=this.viewInstances.get(k.id))||void 0===T||T.close()}return e.type}},t.getInteractionPayloadByViewId=function(e){var t;if(!e)throw Error("No viewId provided when checking for `user interaction payload`");return null===(t=this.viewInstances.get(e))||void 0===t?void 0:t.payload},t.openView=function(e,t){switch(e){case"modal":this.openModal(t);break;case"banner":this.openBanner(t);break;case"contextual_bar":this.openContextualBar(t)}},t.openModal=function(e){var t=this,i=d.open({component:I,props:{key:e.id,initialView:e}});this.viewInstances.set(e.id,{close:function(){i.close(),t.viewInstances.delete(e.id)}})},t.openBanner=function(e){u.open(e),this.viewInstances.set(e.viewId,{close:function(){u.closeById(e.viewId)}})},t.openContextualBar=function(e){var t=this;this.viewInstances.set(e.id,{payload:{view:e},close:function(){t.viewInstances.delete(e.id)}});var i=this.router.getRouteName(),n=this.router.getRouteParameters();i&&this.router.navigate({name:i,params:a(a({},n),{},{tab:"app",context:e.id})})},t.disposeView=function(e){var t,i=this.viewInstances.get(e);null==i||null===(t=i.close)||void 0===t||t.call(i),this.viewInstances.delete(e)},e}();g.TRIGGER_TIMEOUT=5e3,g.TRIGGER_TIMEOUT_ERROR="TRIGGER_TIMEOUT_ERROR"}
//# sourceMappingURL=/dynamic/app/ui-message/client/b63d57c061337d4d625a0d62e88b0de09ea3e68c.map
