function module(e,t,n){n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){i=e}},0),n.export({useComposerBoxPopup:function(){return f}}),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){o=e}},0),n.link("react",{useEffect:function(e){r=e},useCallback:function(e){u=e},useState:function(e){l=e},useRef:function(e){s=e}},1),n.link("../../../../../client/views/room/contexts/ChatContext",{useChat:function(e){c=e}},2),n.link("./useComposerBoxPopupQueries",{useComposerBoxPopupQueries:function(e){a=e}},3);var i,o,r,u,l,s,c,a,d={TAB:9,ENTER:13,ESC:27,ARROW_UP:38,ARROW_DOWN:40},f=function(e){var t=e.configurations,n=i(l(void 0),2),f=n[0],v=n[1],p=i(l(void 0),2),g=p[0],h=p[1],m=i(l(""),2),R=m[0],x=m[1],E=s(),y=a(R,f),k=y.queries,w=y.suspended,A=c(),P=g?"popup-item-"+g._id:void 0;r(function(){if(f){if(null!=f&&f.preview&&w){h(void 0);return}h(function(e){var t,n=k.filter(function(e){return e.isSuccess}).flatMap(function(e){return e.data}).sort(function(e,t){return("sort"in e&&e.sort||0)-("sort"in t&&t.sort||0)});return null!==(t=n.find(function(t){return t._id===(null==e?void 0:e._id)}))&&void 0!==t?t:n[0]})}},[k,f,w]);var C=o(function(e){var t;if(!f)throw Error("No popup is open");if(null!==(t=E.current)&&void 0!==t&&t.select)E.current.select(e);else{var n,i,o,r,u,l,s,c,a=null==A?void 0:null===(n=A.composer)||void 0===n?void 0:n.substring(0,null==A?void 0:null===(i=A.composer)||void 0===i?void 0:i.selection.start),d=null!==(o=f.matchSelectorRegex)&&void 0!==o?o:f.triggerAnywhere?RegExp("(?:^| |\n)("+f.trigger+")([^\\s]*$)"):RegExp("(?:^)("+f.trigger+")([^\\s]*$)"),p=null==a?void 0:a.match(d);if(!p||!a)return;null==A||null===(r=A.composer)||void 0===r||r.replaceText((null!==(u=null!==(l=f.prefix)&&void 0!==l?l:f.trigger)&&void 0!==u?u:"")+f.getValue(e)+(null!==(s=f.suffix)&&void 0!==s?s:""),{start:a.lastIndexOf(p[1]+p[2]),end:null==A?void 0:null===(c=A.composer)||void 0===c?void 0:c.selection.start})}v(void 0),h(void 0)}),b=o(function(){var e=null==A?void 0:null===(i=A.composer)||void 0===i?void 0:i.substring(0,null==A?void 0:null===(o=A.composer)||void 0===o?void 0:o.selection.start);if(!e){v(void 0),h(void 0);return}var n=t.find(function(t){var n=t.trigger,i=t.matchSelectorRegex,o=t.triggerAnywhere,r=t.triggerLength,u=null!=i?i:o?RegExp("(?:^| |\n)("+n+")[^\\s]*$"):RegExp("(?:^)("+n+")[^\\s]*$"),l=u.test(e);if(!r||!l)return l;var s=e.match(u);return s&&r<s[0].length});if(v(n),n||(h(void 0),x("")),n){var i,o,r,u,l,s,c=null!==(r=n.matchSelectorRegex)&&void 0!==r?r:n.triggerAnywhere?RegExp("(?:^| |\n)("+n.trigger+")([^\\s]*$)"):RegExp("(?:^)("+n.trigger+")([^\\s]*$)"),a=e.match(c);x(null!==(u=null===(l=E.current)||void 0===l?void 0:null===(s=l.getFilter)||void 0===s?void 0:s.call(l))&&void 0!==u?u:a?a[2]:"")}return n}),S=o(function(){f||b()}),D=o(function(e){b()&&f&&!0===f.closeOnEsc&&e.which===d.ESC&&(v(void 0),h(void 0),e.preventDefault(),e.stopPropagation())}),K=o(function(e){if(f){if(e.which===d.ENTER||e.which===d.TAB){if(!g)return;return C(g),e.preventDefault(),e.stopPropagation(),!0}return e.which!==d.ARROW_UP||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?e.which!==d.ARROW_DOWN||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?void 0:(h(function(e){var t=k.filter(function(e){return e.isSuccess}).flatMap(function(e){return e.data}).sort(function(e,t){return("sort"in e&&e.sort||0)-("sort"in t&&t.sort||0)});if(t){var n=t.findIndex(function(t){return t===e});return n<t.length-1?t[n+1]:t[0]}}),e.preventDefault(),e.stopPropagation(),!0):(h(function(e){var t=k.filter(function(e){return e.isSuccess}).flatMap(function(e){return e.data}).sort(function(e,t){return("sort"in e&&e.sort||0)-("sort"in t&&t.sort||0)});if(t){var n=t.findIndex(function(t){return t===e});return n>0?t[n-1]:t[t.length-1]}}),e.preventDefault(),e.stopPropagation(),!0)}}),O=o(function(){f&&(v(void 0),h(void 0),x(""))}),_=u(function(e){e&&(e.addEventListener("keyup",D),e.addEventListener("keydown",K),e.addEventListener("focus",S))},[D,K,S]);return f?{focused:g,items:k,ariaActiveDescendant:P,popup:f,select:C,filter:R,suspended:w,commandsRef:E,callbackRef:_,clearPopup:O}:{callbackRef:_,focused:void 0,items:void 0,ariaActiveDescendant:void 0,popup:void 0,select:void 0,suspended:!0,commandsRef:E,filter:void 0,clearPopup:O}}}
//# sourceMappingURL=/dynamic/app/ui-message/client/popup/hooks/62b445c71608f6af5832a22a265d93492ad6045e.map
