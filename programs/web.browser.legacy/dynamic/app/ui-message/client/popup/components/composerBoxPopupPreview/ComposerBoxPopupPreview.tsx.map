)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui-message/client/popup/components/composerBoxPopupPreview/ComposerBoxPopupPreview.tsx","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Box, Skeleton, Tile } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod } from '@rocket.chat/ui-contexts';\nimport React, { forwardRef, useEffect, useImperativeHandle } from 'react';\n\nimport { useChat } from '../../../../../../client/views/room/contexts/ChatContext';\nimport type { ComposerBoxPopupProps } from '../../ComposerBoxPopup';\n\ntype ComposerBoxPopupPreviewItem = { _id: string; type: 'image' | 'video' | 'audio' | 'text' | 'other'; value: string; sort?: number };\n\nconst ComposerBoxPopupPreview = forwardRef<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: ComposerBoxPopupPreviewItem) => void;\n\t  }\n\t| undefined,\n\tComposerBoxPopupProps<ComposerBoxPopupPreviewItem> & {\n\t\trid: string;\n\t\ttmid?: string;\n\t\tsuspended?: boolean;\n\t}\n>(function ComposerBoxPopupPreview({ focused, items, rid, tmid, select, suspended }, ref) {\n\tconst id = useUniqueId();\n\tconst chat = useChat();\n\tconst executeSlashCommandPreviewMethod = useMethod('executeSlashCommandPreview');\n\tuseImperativeHandle(\n\t\tref,\n\t\t() => ({\n\t\t\tgetFilter: () => {\n\t\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\t\tif (!value) {\n\t\t\t\t\tthrow new Error('No value');\n\t\t\t\t}\n\t\t\t\tconst matches = value.match(/(\\/[\\w\\d\\S]+ )([^]*)$/);\n\n\t\t\t\tif (!matches) {\n\t\t\t\t\tthrow new Error('No matches');\n\t\t\t\t}\n\n\t\t\t\tconst cmd = matches[1].replace('/', '').trim().toLowerCase();\n\n\t\t\t\tconst params = matches[2];\n\t\t\t\treturn { cmd, params, msg: { rid, tmid } };\n\t\t\t},\n\t\t\t...(!suspended && {\n\t\t\t\tselect: (item) => {\n\t\t\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tthrow new Error('No value');\n\t\t\t\t\t}\n\t\t\t\t\tconst matches = value.match(/(\\/[\\w\\d\\S]+ )([^]*)$/);\n\n\t\t\t\t\tif (!matches) {\n\t\t\t\t\t\tthrow new Error('No matches');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst cmd = matches[1].replace('/', '').trim().toLowerCase();\n\n\t\t\t\t\tconst params = matches[2];\n\t\t\t\t\t// TODO: Fix this solve the typing issue\n\t\t\t\t\tvoid executeSlashCommandPreviewMethod({ cmd, params, msg: { rid, tmid } }, { id: item._id, type: item.type, value: item.value });\n\t\t\t\t\tchat?.composer?.setText('');\n\t\t\t\t},\n\t\t\t}),\n\t\t}),\n\t\t[chat?.composer, executeSlashCommandPreviewMethod, rid, tmid, suspended],\n\t);\n\n\tconst itemsFlat = items\n\t\t.flatMap((item) => {\n\t\t\tif (item.isSuccess) {\n\t\t\t\treturn item.data;\n\t\t\t}\n\t\t\treturn [];\n\t\t})\n\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\tconst isLoading = items.some((item) => item.isLoading && item.fetchStatus !== 'idle');\n\n\tuseEffect(() => {\n\t\tif (focused) {\n\t\t\tconst element = document.getElementById(`popup-item-${focused._id}`);\n\t\t\tif (element) {\n\t\t\t\telement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n\t\t\t}\n\t\t}\n\t}, [focused]);\n\n\tif (suspended) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box className='message-popup-position' position='relative'>\n\t\t\t<Tile className='message-popup' display='flex' padding={8} role='menu' mbe={8} aria-labelledby={id}>\n\t\t\t\t<Box role='listbox' display='flex' overflow='auto' fontSize={0} width={0} flexGrow={1} aria-busy={isLoading}>\n\t\t\t\t\t{isLoading &&\n\t\t\t\t\t\tArray(5)\n\t\t\t\t\t\t\t.fill(5)\n\t\t\t\t\t\t\t.map((_, index) => <Skeleton variant='rect' h='100px' w='120px' m={2} key={index} />)}\n\n\t\t\t\t\t{!isLoading &&\n\t\t\t\t\t\titemsFlat.map((item) => (\n\t\t\t\t\t\t\t<Box\n\t\t\t\t\t\t\t\tonClick={() => select(item)}\n\t\t\t\t\t\t\t\trole='option'\n\t\t\t\t\t\t\t\tclassName={['popup-item', item === focused && 'selected'].filter(Boolean).join(' ')}\n\t\t\t\t\t\t\t\tid={`popup-item-${item._id}`}\n\t\t\t\t\t\t\t\tkey={item._id}\n\t\t\t\t\t\t\t\tbg={item === focused ? 'selected' : undefined}\n\t\t\t\t\t\t\t\tborderColor={item === focused ? 'highlight' : 'transparent'}\n\t\t\t\t\t\t\t\ttabIndex={item === focused ? 0 : -1}\n\t\t\t\t\t\t\t\taria-selected={item === focused}\n\t\t\t\t\t\t\t\tm={2}\n\t\t\t\t\t\t\t\tborderWidth='default'\n\t\t\t\t\t\t\t\tborderRadius='x4'\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{item.type === 'image' && <img src={item.value} alt={item._id} />}\n\t\t\t\t\t\t\t\t{item.type === 'audio' && (\n\t\t\t\t\t\t\t\t\t<audio controls>\n\t\t\t\t\t\t\t\t\t\t<source src={item.value} />\n\t\t\t\t\t\t\t\t\t\tYour browser does not support the audio element.\n\t\t\t\t\t\t\t\t\t</audio>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{item.type === 'video' && (\n\t\t\t\t\t\t\t\t\t<video controls className='inline-video'>\n\t\t\t\t\t\t\t\t\t\t<source src={item.value} />\n\t\t\t\t\t\t\t\t\t\tYour browser does not support the video element.\n\t\t\t\t\t\t\t\t\t</video>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{item.type === 'text' && <h4>{item.value}</h4>}\n\t\t\t\t\t\t\t\t{item.type === 'other' && <code>{item.value}</code>}\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t))}\n\t\t\t\t</Box>\n\t\t\t</Tile>\n\t\t</Box>\n\t);\n});\n\nexport default ComposerBoxPopupPreview;\n",null],"names":["module","link","default","_objectSpread","Box","v","Skeleton","Tile","useUniqueId","useMethod","React","forwardRef","useEffect","useImperativeHandle","useChat","ComposerBoxPopupPreview","_ref","ref","focused","items","rid","tmid","select","suspended","id","chat","executeSlashCommandPreviewMethod","getFilter","_chat$composer","_chat$composer2","value","composer","substring","selection","start","Error","matches","match","cmd","replace","trim","toLowerCase","params","msg","item","_chat$composer3","_chat$composer4","_chat$composer5","_id","type","setText","itemsFlat","flatMap","isSuccess","data","sort","a","b","isLoading","some","fetchStatus","element","document","getElementById","scrollIntoView","behavior","block","createElement","className","position","display","padding","role","mbe","overflow","fontSize","width","flexGrow","Array","fill","map","_","index","variant","h","w","m","key","onClick","filter","Boolean","join","bg","undefined","borderColor","tabIndex","borderWidth","borderRadius","src","alt","controls","exportDefault"],"mappings":"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"}