)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/meteor-accounts-saml/client/saml_client.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Random } from '@rocket.chat/random';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Meteor } from 'meteor/meteor';\nimport { ServiceConfiguration } from 'meteor/service-configuration';\n\nimport { sdk } from '../../utils/client/lib/SDKClient';\n\nif (!Accounts.saml) {\n\tAccounts.saml = {};\n}\n\n// Override the standard logout behaviour.\n//\n// If we find a samlProvider, and we are using single\n// logout we will initiate logout from rocketchat via saml.\n// If not using single logout, we just do the standard logout.\n// This can be overridden by a configured logout behaviour.\n//\n// TODO: This may need some work as it is not clear if we are really\n// logging out of the idp when doing the standard logout.\n\nconst MeteorLogout = Meteor.logout;\nconst logoutBehaviour = {\n\tTERMINATE_SAML: 'SAML',\n\tONLY_RC: 'Local',\n};\n\nMeteor.logout = async function (...args) {\n\tconst samlService = await ServiceConfiguration.configurations.findOneAsync({ service: 'saml' });\n\tif (samlService) {\n\t\tconst provider = samlService.clientConfig && samlService.clientConfig.provider;\n\t\tif (provider) {\n\t\t\tif (samlService.logoutBehaviour == null || samlService.logoutBehaviour === logoutBehaviour.TERMINATE_SAML) {\n\t\t\t\tif (samlService.idpSLORedirectURL) {\n\t\t\t\t\tconsole.info('SAML session terminated via SLO');\n\t\t\t\t\treturn Meteor.logoutWithSaml({ provider });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (samlService.logoutBehaviour === logoutBehaviour.ONLY_RC) {\n\t\t\t\tconsole.info('SAML session not terminated, only the Rocket.Chat session is going to be killed');\n\t\t\t}\n\t\t}\n\t}\n\treturn MeteorLogout.apply(Meteor, args);\n};\n\nMeteor.loginWithSaml = function (options /* , callback*/) {\n\toptions = options || {};\n\tconst credentialToken = `id-${Random.id()}`;\n\toptions.credentialToken = credentialToken;\n\n\twindow.location.href = `_saml/authorize/${options.provider}/${options.credentialToken}`;\n};\n\nMeteor.logoutWithSaml = function (options /* , callback*/) {\n\t// Accounts.saml.idpInitiatedSLO(options, callback);\n\tsdk\n\t\t.call('samlLogout', options.provider)\n\t\t.then((result) => {\n\t\t\tif (!result) {\n\t\t\t\tMeteorLogout.apply(Meteor);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove the userId from the client to prevent calls to the server while the logout is processed.\n\t\t\t// If the logout fails, the userId will be reloaded on the resume call\n\t\t\tMeteor._localStorage.removeItem(Accounts.USER_ID_KEY);\n\n\t\t\t// A nasty bounce: 'result' has the SAML LogoutRequest but we need a proper 302 to redirected from the server.\n\t\t\twindow.location.replace(Meteor.absoluteUrl(`_saml/sloRedirect/${options.provider}/?redirect=${encodeURIComponent(result)}`));\n\t\t})\n\t\t.catch(() => MeteorLogout.apply(Meteor));\n};\n\nMeteor.loginWithSamlToken = function (token, userCallback) {\n\tAccounts.callLoginMethod({\n\t\tmethodArguments: [\n\t\t\t{\n\t\t\t\tsaml: true,\n\t\t\t\tcredentialToken: token,\n\t\t\t},\n\t\t],\n\t\tuserCallback,\n\t});\n};\n",null],"names":["module","link","default","v","_regeneratorRuntime","Random","Accounts","Meteor","ServiceConfiguration","sdk","saml","MeteorLogout","logout","logoutBehaviour","TERMINATE_SAML","ONLY_RC","samlService","provider","_len","args","_key","_args","arguments","async","_context","prev","next","awrap","configurations","findOneAsync","service","sent","clientConfig","idpSLORedirectURL","console","info","abrupt","logoutWithSaml","Array","length","apply","stop","Promise","loginWithSaml","options","credentialToken","id","window","location","href","call","then","result","_localStorage","removeItem","USER_ID_KEY","replace","absoluteUrl","encodeURIComponent","catch","loginWithSamlToken","token","userCallback","callLoginMethod","methodArguments"],"mappings":"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"}