)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui/client/lib/recorderjs/videoRecorder.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\n\nclass VideoRecorder {\n\tpublic cameraStarted = new ReactiveVar(false);\n\n\tprivate started = false;\n\n\tprivate recording = new ReactiveVar(false);\n\n\tprivate recordingAvailable = new ReactiveVar(false);\n\n\tprivate videoel: HTMLVideoElement | undefined;\n\n\tprivate chunks: Blob[] = [];\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate mediaRecorder: MediaRecorder | undefined;\n\n\tpublic getSupportedMimeTypes() {\n\t\tif (window.MediaRecorder.isTypeSupported('video/webm')) {\n\t\t\treturn 'video/webm; codecs=vp8,opus';\n\t\t}\n\t\tif (window.MediaRecorder.isTypeSupported('video/mp4')) {\n\t\t\treturn 'video/mp4';\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic start(videoel?: HTMLVideoElement, cb?: (this: this, success: boolean) => void) {\n\t\tthis.videoel = videoel;\n\n\t\tconst handleSuccess = (stream: MediaStream) => {\n\t\t\tthis.startUserMedia(stream);\n\t\t\tcb?.call(this, true);\n\t\t};\n\n\t\tconst handleError = (error: any) => {\n\t\t\tconsole.error(error);\n\t\t\tcb?.call(this, false);\n\t\t};\n\n\t\tif (navigator.mediaDevices) {\n\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldGetUserMedia = navigator.getUserMedia ?? navigator.webkitGetUserMedia ?? navigator.mozGetUserMedia ?? navigator.msGetUserMedia;\n\n\t\tif (oldGetUserMedia) {\n\t\t\toldGetUserMedia.call(navigator, { audio: true, video: true }, handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tcb?.call(this, false);\n\t}\n\n\tpublic record() {\n\t\tthis.chunks = [];\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder = new MediaRecorder(this.stream, { mimeType: this.getSupportedMimeTypes() });\n\t\tthis.mediaRecorder.ondataavailable = (blobev) => {\n\t\t\tthis.chunks.push(blobev.data);\n\t\t\tif (!this.recordingAvailable.get()) {\n\t\t\t\treturn this.recordingAvailable.set(true);\n\t\t\t}\n\t\t};\n\t\tthis.mediaRecorder.start();\n\t\treturn this.recording.set(true);\n\t}\n\n\tprivate startUserMedia(stream: MediaStream) {\n\t\tif (!this.videoel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.stream = stream;\n\n\t\ttry {\n\t\t\tthis.videoel.srcObject = stream;\n\t\t} catch (error) {\n\t\t\tconst URL = window.URL || window.webkitURL;\n\t\t\tthis.videoel.src = URL.createObjectURL(stream as unknown as MediaSource | Blob);\n\t\t}\n\n\t\tthis.started = true;\n\t\treturn this.cameraStarted.set(true);\n\t}\n\n\tpublic stop(cb?: (blob: Blob) => void) {\n\t\tif (!this.started) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stopRecording();\n\n\t\tif (this.stream) {\n\t\t\tconst vtracks = this.stream.getVideoTracks();\n\t\t\tfor (const vtrack of Array.from(vtracks)) {\n\t\t\t\tvtrack.stop();\n\t\t\t}\n\n\t\t\tconst atracks = this.stream.getAudioTracks();\n\t\t\tfor (const atrack of Array.from(atracks)) {\n\t\t\t\tatrack.stop();\n\t\t\t}\n\t\t}\n\n\t\tif (this.videoel) {\n\t\t\tthis.videoel.pause;\n\t\t\tthis.videoel.src = '';\n\t\t}\n\n\t\tthis.started = false;\n\t\tthis.cameraStarted.set(false);\n\t\tthis.recordingAvailable.set(false);\n\n\t\tif (cb && this.chunks) {\n\t\t\tconst blob = new Blob(this.chunks);\n\t\t\tcb(blob);\n\t\t}\n\n\t\tdelete this.stream;\n\t\tdelete this.videoel;\n\t}\n\n\tpublic stopRecording() {\n\t\tif (!this.started || !this.recording || !this.mediaRecorder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder.stop();\n\t\tthis.recording.set(false);\n\t\tdelete this.mediaRecorder;\n\t}\n}\n\nconst instance = new VideoRecorder();\n\nexport { instance as VideoRecorder };\n",null],"names":["module","export","VideoRecorder","instance","ReactiveVar","cameraStarted","started","recording","recordingAvailable","videoel","chunks","stream","mediaRecorder","_proto","prototype","getSupportedMimeTypes","window","MediaRecorder","isTypeSupported","start","cb","_ref","_ref2","_navigator$getUserMed","_this","handleSuccess","startUserMedia","call","handleError","error","console","navigator","mediaDevices","getUserMedia","audio","video","then","oldGetUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","record","_this2","mimeType","ondataavailable","blobev","push","data","get","set","srcObject","URL","webkitURL","src","createObjectURL","stop","stopRecording","vtracks","getVideoTracks","_i","_Array$from","Array","from","length","vtrack","atracks","getAudioTracks","_i2","_Array$from2","atrack","pause","Blob"],"mappings":"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"}