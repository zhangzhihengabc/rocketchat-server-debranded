)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/ui/client/views/app/photoswipeContent.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\nimport type PhotoSwipe from 'photoswipe';\nimport PhotoSwipeUIDefault from 'photoswipe/dist/photoswipe-ui-default';\n\nimport { createAnchor } from '../../../../../client/lib/utils/createAnchor';\n\nconst parseLength = (x: unknown): number | undefined => {\n\tconst length = typeof x === 'string' ? parseInt(x, 10) : undefined;\n\treturn Number.isFinite(length) ? length : undefined;\n};\n\nconst getImageSize = (src: string): Promise<[w: number, h: number]> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve([img.naturalWidth, img.naturalHeight]);\n\t\t});\n\n\t\timg.addEventListener('error', (error) => {\n\t\t\treject(error.error);\n\t\t});\n\n\t\timg.src = src;\n\t});\n\ntype Slide = PhotoSwipe.Item & { description?: string; title?: string };\n\nconst fromElementToSlide = async (element: Element): Promise<Slide | null> => {\n\tif (!(element instanceof HTMLElement)) {\n\t\treturn null;\n\t}\n\n\tconst title = element.dataset.title || element.title;\n\tconst { description } = element.dataset;\n\n\tif (element instanceof HTMLAnchorElement) {\n\t\tconst src = element.dataset.src || element.href;\n\t\tlet w = parseLength(element.dataset.width);\n\t\tlet h = parseLength(element.dataset.height);\n\n\t\tif (w === undefined || h === undefined) {\n\t\t\t[w, h] = await getImageSize(src);\n\t\t}\n\n\t\treturn { src, w, h, title, description };\n\t}\n\n\tif (element instanceof HTMLImageElement) {\n\t\tlet msrc: string | undefined;\n\t\tlet { src } = element;\n\t\tlet w: number | undefined = element.naturalWidth;\n\t\tlet h: number | undefined = element.naturalHeight;\n\n\t\tif (element.dataset.src) {\n\t\t\tmsrc = element.src;\n\t\t\tsrc = element.dataset.src;\n\t\t\tw = parseLength(element.dataset.width);\n\t\t\th = parseLength(element.dataset.height);\n\n\t\t\tif (w === undefined || h === undefined) {\n\t\t\t\t[w, h] = await getImageSize(src);\n\t\t\t}\n\t\t}\n\n\t\treturn { msrc, src, w, h, title, description };\n\t}\n\n\treturn null;\n};\n\nlet currentGallery: PhotoSwipe<PhotoSwipe.Options> | null = null;\n\nconst initGallery = async (items: Slide[], options: PhotoSwipe.Options): Promise<void> => {\n\tconst anchor = createAnchor('photoswipe-root');\n\n\tanchor.innerHTML = `<div class=\"pswp\" id=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n\t<div class=\"pswp__bg\"></div>\n\t<div class=\"pswp__scroll-wrap\">\n\t\t<div class=\"pswp__container\">\n\t\t\t<div class=\"pswp__item\"></div>\n\t\t\t<div class=\"pswp__item\"></div>\n\t\t\t<div class=\"pswp__item\"></div>\n\t\t</div>\n\n\t\t<div class=\"pswp__ui pswp__ui--hidden\">\n\t\t\t<div class=\"pswp__top-bar\">\n\n\t\t\t\t<button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"></button>\n\t\t\t\t<button class=\"pswp__button pswp__button--fs\" title=\"Toggle fullscreen\"></button>\n\t\t\t\t<button class=\"pswp__button pswp__button--zoom\" title=\"Zoom in/out\"></button>\n\n\t\t\t\t<div class=\"pswp__preloader\">\n\t\t\t\t\t<div class=\"pswp__preloader__icn\">\n\t\t\t\t\t<div class=\"pswp__preloader__cut\">\n\t\t\t\t\t\t<div class=\"pswp__preloader__donut\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<button class=\"pswp__button pswp__button--arrow--left\" title=\"Previous (arrow left)\"></button>\n\n\t\t\t<button class=\"pswp__button pswp__button--arrow--right\" title=\"Next (arrow right)\"></button>\n\n\t\t\t<div class=\"pswp__caption\">\n\t\t\t\t<div class=\"pswp__caption__center\"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>`;\n\tconst [{ default: PhotoSwipe }] = await Promise.all([import('photoswipe'), import('photoswipe/dist/photoswipe.css')]);\n\n\tif (!currentGallery) {\n\t\tconst container = document.getElementById('pswp');\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Photoswipe container element not found');\n\t\t}\n\n\t\tcurrentGallery = new PhotoSwipe(container, PhotoSwipeUIDefault, items, options);\n\n\t\tcurrentGallery.listen('destroy', () => {\n\t\t\tanchor.innerHTML = '';\n\t\t\tcurrentGallery = null;\n\t\t});\n\n\t\tcurrentGallery.init();\n\t}\n};\n\nconst defaultGalleryOptions = {\n\tbgOpacity: 0.7,\n\tcounterEl: false,\n\tindex: 0,\n\twheelToZoom: true,\n\tpadding: { top: 20, bottom: 40, left: 100, right: 100 },\n\taddCaptionHTMLFn(item: Slide, captionEl: HTMLElement): boolean {\n\t\tcaptionEl.children[0].innerHTML = `\n\t\t\t${escapeHTML(item.title ?? '')}<br/>\n\t\t\t<small>${escapeHTML(item.description ?? '')}</small>\n\t\t`;\n\t\treturn true;\n\t},\n};\n\nconst createEventListenerFor =\n\t(className: string) =>\n\t(event: Event): void => {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tconst { currentTarget } = event;\n\n\t\tconst galleryItems = Array.from(document.querySelectorAll(className));\n\n\t\tconst sortedElements = galleryItems.sort((a, b) => {\n\t\t\tif (a === currentTarget) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (b === currentTarget) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t});\n\n\t\tconst slidePromises = sortedElements.map((element) => fromElementToSlide(element));\n\n\t\tlet hasOpenedGallery = false;\n\n\t\tvoid slidePromises.reduce(\n\t\t\t(p, curr) =>\n\t\t\t\tp\n\t\t\t\t\t.then(() => curr)\n\t\t\t\t\t.then(async (slide) => {\n\t\t\t\t\t\tif (!slide) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!currentGallery) {\n\t\t\t\t\t\t\t// If the gallery doesn't exist and has been opened this run the user closed it before all promises ran.\n\t\t\t\t\t\t\t// This means it shouldn't be opened again.\n\t\t\t\t\t\t\tif (hasOpenedGallery) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thasOpenedGallery = true;\n\t\t\t\t\t\t\treturn initGallery([slide], defaultGalleryOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentGallery.items.push(slide);\n\t\t\t\t\t\tcurrentGallery.invalidateCurrItems();\n\t\t\t\t\t\tcurrentGallery.updateSize(true);\n\t\t\t\t\t}),\n\t\t\tPromise.resolve(),\n\t\t);\n\t};\n\nMeteor.startup(() => {\n\t$(document).on('click', '.gallery-item', createEventListenerFor('.gallery-item'));\n});\n",null],"names":["module","link","default","_regeneratorRuntime","_slicedToArray","escapeHTML","Meteor","v","PhotoSwipeUIDefault","createAnchor","parseLength","x","length","parseInt","undefined","Number","isFinite","getImageSize","src","Promise","resolve","reject","img","Image","addEventListener","naturalWidth","naturalHeight","error","fromElementToSlide","element","title","description","w","h","_await$getImageSize2","msrc","_src","_w","_h","_await$getImageSize4","async","_context","prev","next","HTMLElement","abrupt","dataset","HTMLAnchorElement","href","width","height","awrap","sent","HTMLImageElement","stop","currentGallery","initGallery","items","options","anchor","PhotoSwipe","container","_context2","innerHTML","all","dynamicImport","_await$Promise$all2","document","getElementById","Error","listen","init","defaultGalleryOptions","bgOpacity","counterEl","index","wheelToZoom","padding","top","bottom","left","right","addCaptionHTMLFn","item","captionEl","_item$title","_item$description","children","startup","$","on","event","preventDefault","stopPropagation","currentTarget","slidePromises","sortedElements","galleryItems","Array","from","querySelectorAll","sort","a","b","map","hasOpenedGallery","reduce","p","curr","then","slide","_context3","push","invalidateCurrItems","updateSize"],"mappings":"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"}