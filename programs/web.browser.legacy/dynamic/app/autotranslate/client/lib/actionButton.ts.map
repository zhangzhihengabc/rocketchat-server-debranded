)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/autotranslate/client/lib/actionButton.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\nimport { messageArgs } from '../../../../client/lib/utils/messageArgs';\nimport {\n\thasTranslationLanguageInAttachments,\n\thasTranslationLanguageInMessage,\n} from '../../../../client/views/room/MessageList/lib/autoTranslate';\nimport { hasAtLeastOnePermission } from '../../../authorization/client';\nimport { Messages } from '../../../models/client';\nimport { settings } from '../../../settings/client';\nimport { MessageAction } from '../../../ui-utils/client/lib/MessageAction';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\nimport { AutoTranslate } from './autotranslate';\n\nMeteor.startup(() => {\n\tAutoTranslate.init();\n\n\tTracker.autorun(() => {\n\t\tif (settings.get('AutoTranslate_Enabled') && hasAtLeastOnePermission(['auto-translate'])) {\n\t\t\tMessageAction.addButton({\n\t\t\t\tid: 'translate',\n\t\t\t\ticon: 'language',\n\t\t\t\tlabel: 'Translate',\n\t\t\t\tcontext: ['message', 'message-mobile', 'threads'],\n\t\t\t\ttype: 'interaction',\n\t\t\t\taction(_, props) {\n\t\t\t\t\tconst { message = messageArgs(this).msg } = props;\n\t\t\t\t\tconst language = AutoTranslate.getLanguage(message.rid);\n\t\t\t\t\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\n\t\t\t\t\t\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\n\t\t\t\t\t\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\n\t\t\t\t\t\tvoid sdk.call('autoTranslate.translateMessage', message, language);\n\t\t\t\t\t}\n\t\t\t\t\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\n\t\t\t\t\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\n\t\t\t\t},\n\t\t\t\tcondition({ message, subscription, user, room }) {\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\n\t\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\n\t\t\t\t\tconst isDifferentUser = message?.u && message.u._id !== user._id;\n\t\t\t\t\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\n\t\t\t\t\tconst hasLanguage =\n\t\t\t\t\t\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\n\n\t\t\t\t\treturn Boolean(\n\t\t\t\t\t\t(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse ||\n\t\t\t\t\t\t\t(isDifferentUser && autoTranslateEnabled && !hasLanguage),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\torder: 90,\n\t\t\t});\n\t\t\tMessageAction.addButton({\n\t\t\t\tid: 'view-original',\n\t\t\t\ticon: 'language',\n\t\t\t\tlabel: 'View_original',\n\t\t\t\tcontext: ['message', 'message-mobile', 'threads'],\n\t\t\t\ttype: 'interaction',\n\t\t\t\taction(_, props) {\n\t\t\t\t\tconst { message = messageArgs(this).msg } = props;\n\t\t\t\t\tconst language = AutoTranslate.getLanguage(message.rid);\n\t\t\t\t\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\n\t\t\t\t\t\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\n\t\t\t\t\t\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\n\t\t\t\t\t\tvoid sdk.call('autoTranslate.translateMessage', message, language);\n\t\t\t\t\t}\n\t\t\t\t\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\n\t\t\t\t\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\n\t\t\t\t},\n\t\t\t\tcondition({ message, subscription, user, room }) {\n\t\t\t\t\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\n\t\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst isDifferentUser = message?.u && message.u._id !== user._id;\n\t\t\t\t\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\n\t\t\t\t\tconst hasLanguage =\n\t\t\t\t\t\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\n\n\t\t\t\t\treturn Boolean(\n\t\t\t\t\t\t!(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse &&\n\t\t\t\t\t\t\tisDifferentUser &&\n\t\t\t\t\t\t\tautoTranslateEnabled &&\n\t\t\t\t\t\t\thasLanguage,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\torder: 90,\n\t\t\t});\n\t\t} else {\n\t\t\tMessageAction.removeButton('toggle-language');\n\t\t}\n\t});\n});\n",null],"names":["Meteor","Tracker","roomCoordinator","messageArgs","hasTranslationLanguageInAttachments","hasTranslationLanguageInMessage","hasAtLeastOnePermission","Messages","settings","MessageAction","sdk","AutoTranslate","module","link","startup","init","autorun","get","addButton","id","icon","label","context","type","action","_","props","_Messages$update","_props$message","message","msg","language","getLanguage","rid","attachments","messageIdsToWait","_id","update","$set","autoTranslateFetching","call","autoTranslateShowInverse","condition","_ref","subscription","user","room","autoTranslateLanguage","isLivechatRoom","t","isDifferentUser","u","autoTranslateEnabled","autoTranslate","hasLanguage","Boolean","order","_Messages$update2","_props$message2","_ref2","removeButton"],"mappings":"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"}