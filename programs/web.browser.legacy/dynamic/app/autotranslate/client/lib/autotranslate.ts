function module(t,n,a){a.link("@babel/runtime/regenerator",{default:function(t){e=t}},0),a.link("@babel/runtime/helpers/slicedToArray",{default:function(t){i=t}},1),a.link("@babel/runtime/helpers/createForOfIteratorHelperLoose",{default:function(t){r=t}},2),a.export({AutoTranslate:function(){return T},createAutoTranslateMessageStreamHandler:function(){return b}}),a.link("@rocket.chat/core-typings",{isTranslatedMessageAttachment:function(t){s=t}},0),a.link("mem",{default:function(t){o=t}},1),a.link("meteor/meteor",{Meteor:function(t){u=t}},2),a.link("meteor/tracker",{Tracker:function(t){l=t}},3),a.link("../../../../client/views/room/MessageList/lib/autoTranslate",{hasTranslationLanguageInAttachments:function(t){c=t},hasTranslationLanguageInMessage:function(t){d=t}},4),a.link("../../../authorization/client",{hasPermission:function(t){g=t}},5),a.link("../../../models/client",{Subscriptions:function(t){f=t},Messages:function(t){p=t}},6),a.link("../../../utils/client/lib/SDKClient",{sdk:function(t){h=t}},7);var e,i,r,s,o,u,l,c,d,g,f,p,h,m="en",v="";u.startup(function(){l.autorun(function(){var t=u.user();t&&(m=t.language||"en",v=t.username||"")})});var T={initialized:!1,providersMetadata:{},messageIdsToWait:{},supportedLanguages:[],findSubscriptionByRid:o(function(t){return f.findOne({rid:t})}),getLanguage:function(t){t&&(i=this.findSubscriptionByRid(t));var n,a,e,i,r=(null===(n=i)||void 0===n?void 0:n.autoTranslateLanguage)||m||(null===(a=(e=window).defaultUserLanguage)||void 0===a?void 0:a.call(e));return -1===r.indexOf("-")||(this.supportedLanguages||[]).some(function(t){return t.language===r})?r:r.slice(0,2)},translateAttachments:function(t,n,a){if(!s(t))return t;for(var e,i=r(t);!(e=i()).done;){var o=e.value;o.author_name!==v&&(o.text&&o.translations&&o.translations[n]&&(o.translations.original=o.text,a?o.text=o.translations.original:o.text=o.translations[n]),o.description&&o.translations&&o.translations[n]&&(o.translations.original=o.description,a?o.description=o.translations.original:o.description=o.translations[n]),o.attachments&&o.attachments.length>0&&(o.attachments=this.translateAttachments(o.attachments,n)))}return t},init:function(){var t=this;this.initialized||(l.autorun(function(n){var a;return e.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(!u.userId()||!g("auto-translate"))){r.next=3;break}return r.abrupt("return");case 3:return n.stop(),r.prev=4,r.next=7,e.awrap(Promise.all([h.call("autoTranslate.getProviderUiMetadata"),h.call("autoTranslate.getSupportedLanguages","en")]));case 7:a=i(r.sent,2),t.providersMetadata=a[0],t.supportedLanguages=a[1],r.next=16;break;case 13:r.prev=13,r.t0=r.catch(4),console.error(r.t0.message);case 16:case"end":return r.stop()}},null,null,[[4,13]],Promise)}),f.find().observeChanges({changed:function(n,a){(a.hasOwnProperty("autoTranslate")||a.hasOwnProperty("autoTranslateLanguage"))&&o.clear(t.findSubscriptionByRid)}}),this.initialized=!0)}},b=function(){return T.init(),function(t){if(t.u&&t.u._id!==u.userId()){var n=T.findSubscriptionByRid(t.rid),a=T.getLanguage(t.rid);!n||!0!==n.autoTranslate||!t.msg||t.translations&&(d(t,a)||c(t.attachments,a))?void 0!==T.messageIdsToWait[t._id]&&n&&!0!==n.autoTranslate?(p.update({_id:t._id},{$set:{autoTranslateShowInverse:!0},$unset:{autoTranslateFetching:!0}}),delete T.messageIdsToWait[t._id]):!0===t.autoTranslateFetching&&p.update({_id:t._id},{$unset:{autoTranslateFetching:!0}}):p.update({_id:t._id},{$set:{autoTranslateFetching:!0}})}}}}
//# sourceMappingURL=/dynamic/app/autotranslate/client/lib/ec67c4688efa6e1ce1deb84a64c7246d3c56dba0.map
