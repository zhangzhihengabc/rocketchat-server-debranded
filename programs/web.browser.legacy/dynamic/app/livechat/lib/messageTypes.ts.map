)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/livechat/lib/messageTypes.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IOmnichannelSystemMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport formatDistance from 'date-fns/formatDistance';\nimport moment from 'moment';\n\nimport { MessageTypes } from '../../ui-utils/lib/MessageTypes';\nimport { t } from '../../utils/lib/i18n';\n\nMessageTypes.registerType({\n\tid: 'livechat_navigation_history',\n\tsystem: true,\n\tmessage: 'New_visitor_navigation',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\thistory: message.navigation\n\t\t\t\t? `${(message.navigation.page.title ? `${message.navigation.page.title} - ` : '') + message.navigation.page.location.href}`\n\t\t\t\t: '',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transfer_history',\n\tsystem: true,\n\tmessage: 'New_chat_transfer',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.transferData) {\n\t\t\treturn {\n\t\t\t\ttransfer: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { comment } = message.transferData;\n\t\tconst commentLabel = comment && comment !== '' ? '_with_a_comment' : '';\n\t\tconst from =\n\t\t\tmessage.transferData.transferredBy && (message.transferData.transferredBy.name || message.transferData.transferredBy.username);\n\t\tconst transferTypes = {\n\t\t\tagent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tdepartment: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_department${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.nextDepartment?.name || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tqueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToAgent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToQueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t};\n\t\treturn {\n\t\t\ttransfer: transferTypes[message.transferData.scope](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transcript_history',\n\tsystem: true,\n\tmessage: 'Livechat_chat_transcript_sent',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.requestData) {\n\t\t\treturn {\n\t\t\t\ttranscript: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { requestData: { type, visitor, user } = { type: 'user' } } = message;\n\t\tconst requestTypes = {\n\t\t\tvisitor: (): string =>\n\t\t\t\tt('Livechat_visitor_transcript_request', {\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t\tuser: (): string =>\n\t\t\t\tt('Livechat_user_sent_chat_transcript_to_visitor', {\n\t\t\t\t\tagent: user?.name || user?.username || '',\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t};\n\n\t\treturn {\n\t\t\ttranscript: requestTypes[type](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_video_call',\n\tsystem: true,\n\tmessage: 'New_videocall_request',\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_webrtc_video_call',\n\trender(message) {\n\t\tif (message.msg === 'ended' && message.webRtcCallEndTs && message.ts) {\n\t\t\treturn t('WebRTC_call_ended_message', {\n\t\t\t\tcallDuration: formatDistance(new Date(message.webRtcCallEndTs), new Date(message.ts)),\n\t\t\t\tendTime: moment(message.webRtcCallEndTs).format('h:mm A'),\n\t\t\t});\n\t\t}\n\t\tif (message.msg === 'declined' && message.webRtcCallEndTs) {\n\t\t\treturn t('WebRTC_call_declined_message');\n\t\t}\n\t\treturn escapeHTML(message.msg);\n\t},\n\tmessage: 'room_changed_type',\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_placed_chat_on_hold',\n\tsystem: true,\n\tmessage: 'Omnichannel_placed_chat_on_hold',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_on_hold_chat_resumed',\n\tsystem: true,\n\tmessage: 'Omnichannel_on_hold_chat_resumed',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n",null],"names":["_objectSpread","escapeHTML","formatDistance","moment","MessageTypes","t","module","link","default","v","registerType","id","system","message","data","history","navigation","page","title","location","href","transferData","transfer","comment","commentLabel","from","transferredBy","name","username","transferTypes","agent","_message$transferData","_message$transferData2","_message$transferData3","_message$transferData4","to","transferredTo","department","_message$transferData5","_message$transferData6","nextDepartment","queue","autoTransferUnansweredChatsToAgent","_message$transferData7","_message$transferData8","_message$transferData9","_message$transferData10","duration","autoTransferUnansweredChatsToQueue","scope","requestData","transcript","_message$requestData","type","visitor","user","requestTypes","guest","render","msg","webRtcCallEndTs","ts","callDuration","Date","endTime","format"],"mappings":"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"}