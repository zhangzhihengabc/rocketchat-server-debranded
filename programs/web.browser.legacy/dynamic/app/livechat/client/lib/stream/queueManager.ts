function module(e,n,t){var r,u,a,i,s,c,l,o,p,f=["type"],d=["type"];t.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){u=e}},0),t.link("@babel/runtime/regenerator",{default:function(e){a=e}},1),t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},2),t.export({initializeLivechatInquiryStream:function(){return P}}),t.link("../../../../../client/lib/queryClient",{queryClient:function(e){s=e}},0),t.link("../../../../../client/lib/utils/callWithErrorHandling",{callWithErrorHandling:function(e){c=e}},1),t.link("../../../../settings/client",{settings:function(e){l=e}},2),t.link("../../../../utils/client/lib/SDKClient",{sdk:function(e){o=e}},3),t.link("../../collections/LivechatInquiry",{LivechatInquiry:function(e){p=e}},4);var v=new Set,m={added:function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(v.has(e.department)){n.next=2;break}return n.abrupt("return");case 2:return p.insert(i(i({},e),{},{alert:!0,_updatedAt:new Date(e._updatedAt)})),n.next=5,a.awrap(h(e.rid));case 5:case"end":return n.stop()}},null,null,null,Promise)},changed:function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(!("queued"!==e.status||e.department&&!v.has(e.department))){n.next=2;break}return n.abrupt("return",b(e));case 2:return p.upsert({_id:e._id},i(i({},e),{},{alert:!0,_updatedAt:new Date(e._updatedAt)})),n.next=5,a.awrap(h(e.rid));case 5:case"end":return n.stop()}},null,null,null,Promise)},removed:function(e){return b(e)}},h=function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.awrap(s.invalidateQueries(["rooms",{reference:e,type:"l"}]));case 2:return n.next=4,a.awrap(s.removeQueries(["rooms",e]));case 4:return n.next=6,a.awrap(s.removeQueries(["/v1/rooms.info",e]));case 6:case"end":return n.stop()}},null,null,null,Promise)},b=function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.awrap(p.remove(e._id));case 2:return n.abrupt("return",s.invalidateQueries(["rooms",{reference:e.rid,type:"l"}]));case 3:case"end":return n.stop()}},null,null,null,Promise)},x=function(){var e,n,t;return a.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=null!==(e=l.get("Livechat_guest_pool_max_number_incoming_livechats_displayed"))&&void 0!==e?e:0,r.next=3,a.awrap(o.rest.get("/v1/livechat/inquiries.queuedForUser",{count:n}));case 3:return t=r.sent.inquiries,r.abrupt("return",t);case 6:case"end":return r.stop()}},null,null,null,Promise)},y=function(e){o.stop("livechat-inquiry-queue-observer","department/"+e),v.delete(e)},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=e.map(function(e){return v.add(e),o.stream("livechat-inquiry-queue-observer",["department/"+e],function(e){var n,t;return a.async(function(r){for(;;)switch(r.prev=r.next){case 0:if("type"in e){r.next=2;break}return r.abrupt("return");case 2:return n=e.type,t=u(e,f),r.next=5,a.awrap(m[e.type](t));case 5:case"end":return r.stop()}},null,null,null,Promise)}),function(){return y(e)}});return function(){return n.forEach(function(e){return e()})}},g=function(){var e,n=arguments;return a.async(function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:[],t.abrupt("return",e.forEach(function(e){return p.upsert({_id:e._id},i(i({},e),{},{_updatedAt:new Date(e._updatedAt)}))}));case 2:case"end":return t.stop()}},null,null,null,Promise)},_=function(e){var n;return a.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.awrap(o.rest.get("/v1/livechat/agents/"+e+"/departments",{enabledDepartmentsOnly:"true"}));case 2:return n=t.sent.departments,t.abrupt("return",n);case 5:case"end":return t.stop()}},null,null,null,Promise)},q=function(){return o.stop("livechat-inquiry-queue-observer","public")},k=function(e){var n,t,r,i;return a.async(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.awrap(c("livechat:getRoutingConfig"));case 2:if(!(null!=(n=s.sent)&&n.autoAssignAgent)){s.next=5;break}return s.abrupt("return");case 5:return s.next=7,a.awrap(_(e));case 7:return t=w(s.sent.map(function(e){return e.departmentId})),o.stream("livechat-inquiry-queue-observer",["public"],function(e){var n,t;return a.async(function(r){for(;;)switch(r.prev=r.next){case 0:if("type"in e){r.next=2;break}return r.abrupt("return");case 2:return n=e.type,t=u(e,d),r.next=5,a.awrap(m[e.type](t));case 5:case"end":return r.stop()}},null,null,null,Promise)}),r=q,i=Tracker.autorun(function e(){var e;return a.async(function n(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.awrap(x());case 2:return e=n.sent,n.next=5,a.awrap(g(e));case 5:case"end":return n.stop()}},null,null,null,Promise)}),s.abrupt("return",function(){p.remove({}),q(),null==t||t(),null==r||r(),v.clear(),i.stop()});case 12:case"end":return s.stop()}},null,null,null,Promise)},P=function(){var e,n=arguments;return a.async(function(t){for(;;)switch(t.prev=t.next){case 0:return null===(e=r)||void 0===e||e(),t.next=3,a.awrap(k.apply(void 0,n));case 3:r=t.sent;case 4:case"end":return t.stop()}},null,null,null,Promise)}}
//# sourceMappingURL=/dynamic/app/livechat/client/lib/stream/fdd88283ca6af12af994a6d72f674948b03a7246.map
