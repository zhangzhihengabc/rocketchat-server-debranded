)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/otr/lib/functions.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { IOTRAlgorithm } from './IOTR';\n\nconst { subtle } = global.crypto;\n\nexport const joinEncryptedData = ({ encryptedData, iv }: { encryptedData: ArrayBuffer; iv: Uint8Array }): Uint8Array => {\n\tconst cipherText = new Uint8Array(encryptedData);\n\tconst output = new Uint8Array(iv.length + cipherText.length);\n\toutput.set(iv, 0);\n\toutput.set(cipherText, iv.length);\n\treturn output;\n};\nexport const encryptAES = async ({\n\tiv,\n\t_sessionKey,\n\tdata,\n}: {\n\tiv: Uint8Array;\n\t_sessionKey: CryptoKey;\n\tdata: Uint8Array;\n}): Promise<ArrayBuffer> =>\n\tsubtle.encrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tdata,\n\t);\nexport const digest = async (bits: ArrayBuffer): Promise<ArrayBuffer> =>\n\tsubtle.digest(\n\t\t{\n\t\t\tname: 'SHA-256',\n\t\t},\n\t\tbits,\n\t);\nexport const deriveBits = async ({ ecdhObj, _keyPair }: { ecdhObj: IOTRAlgorithm; _keyPair: CryptoKeyPair }): Promise<ArrayBuffer> => {\n\tif (!_keyPair.privateKey) {\n\t\tthrow new Error('No private key');\n\t}\n\n\treturn subtle.deriveBits(ecdhObj, _keyPair.privateKey, 256);\n};\n\nexport const importKey = async (publicKeyObject: JsonWebKey): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'jwk',\n\t\tpublicKeyObject,\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t[],\n\t);\nexport const importKeyRaw = async (sessionKeyData: Uint8Array): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'raw',\n\t\tsessionKeyData,\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t},\n\t\tfalse,\n\t\t['encrypt', 'decrypt'],\n\t);\nexport const exportKey = async (_keyPair: CryptoKey): Promise<JsonWebKey> => subtle.exportKey('jwk', _keyPair);\nexport const generateKeyPair = async (): Promise<CryptoKeyPair> =>\n\tsubtle.generateKey(\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t['deriveKey', 'deriveBits'],\n\t);\nexport const decryptAES = async (cipherText: Uint8Array, _sessionKey: CryptoKey): Promise<ArrayBuffer> => {\n\tconst iv = cipherText.slice(0, 12);\n\tcipherText = cipherText.slice(12);\n\tconst data = await subtle.decrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tcipherText,\n\t);\n\treturn data;\n};\n",null],"names":["module","link","default","_regeneratorRuntime","export","joinEncryptedData","encryptAES","digest","deriveBits","importKey","importKeyRaw","exportKey","generateKeyPair","decryptAES","subtle","global","crypto","_ref","encryptedData","iv","cipherText","Uint8Array","output","length","set","_ref2","_sessionKey","data","async","_context","prev","next","abrupt","encrypt","name","stop","Promise","bits","_context2","_ref3","ecdhObj","_keyPair","_context3","privateKey","Error","publicKeyObject","_context4","namedCurve","sessionKeyData","_context5","_context6","_context7","generateKey","_context8","slice","awrap","decrypt","sent"],"mappings":"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"}