)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/2fa/client/TOTPPassword.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Accounts } from 'meteor/accounts-base';\nimport { Meteor } from 'meteor/meteor';\n\nimport { process2faReturn } from '../../../client/lib/2fa/process2faReturn';\nimport { isTotpInvalidError, isTotpMaxAttemptsError, reportError } from '../../../client/lib/2fa/utils';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\nimport { t } from '../../utils/lib/i18n';\n\nMeteor.loginWithPasswordAndTOTP = function (selector, password, code, callback) {\n\tif (typeof selector === 'string') {\n\t\tif (selector.indexOf('@') === -1) {\n\t\t\tselector = { username: selector };\n\t\t} else {\n\t\t\tselector = { email: selector };\n\t\t}\n\t}\n\n\tAccounts.callLoginMethod({\n\t\tmethodArguments: [\n\t\t\t{\n\t\t\t\ttotp: {\n\t\t\t\t\tlogin: {\n\t\t\t\t\t\tuser: selector,\n\t\t\t\t\t\tpassword: Accounts._hashPassword(password),\n\t\t\t\t\t},\n\t\t\t\t\tcode,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\tuserCallback(error) {\n\t\t\tif (error) {\n\t\t\t\treportError(error, callback);\n\t\t\t} else {\n\t\t\t\tcallback && callback();\n\t\t\t}\n\t\t},\n\t});\n};\n\nconst { loginWithPassword } = Meteor;\n\nMeteor.loginWithPassword = function (email, password, cb) {\n\tloginWithPassword(email, password, async (error) => {\n\t\tawait process2faReturn({\n\t\t\terror,\n\t\t\toriginalCallback: cb,\n\t\t\temailOrUsername: email,\n\t\t\tonCode: (code) => {\n\t\t\t\tMeteor.loginWithPasswordAndTOTP(email, password, code, (error) => {\n\t\t\t\t\tif (isTotpMaxAttemptsError(error)) {\n\t\t\t\t\t\tdispatchToastMessage({\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\tmessage: t('totp-max-attempts'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcb();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (isTotpInvalidError(error)) {\n\t\t\t\t\t\tdispatchToastMessage({\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\tmessage: t('Invalid_two_factor_code'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcb();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcb(error);\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t});\n};\n",null],"names":["module","link","default","v","_regeneratorRuntime","Accounts","Meteor","process2faReturn","isTotpInvalidError","isTotpMaxAttemptsError","reportError","dispatchToastMessage","t","loginWithPasswordAndTOTP","selector","password","code","callback","indexOf","username","email","callLoginMethod","methodArguments","totp","login","user","_hashPassword","userCallback","error","loginWithPassword","_Meteor","cb","async","_context","prev","next","awrap","originalCallback","emailOrUsername","onCode","type","message","stop","Promise"],"mappings":"uBAAwBA,EAAOC,IAAI,CAAC,6BAA6B,CAACC,QAAQ,SAASC,CAAC,EAAEC,EAAoBD,CAAC,CAAC,EAAE,GAAjGH,EAAOC,IAAI,CAAC,uBAAuB,CAACI,SAAS,SAASF,CAAC,EAAEE,EAASF,CAAC,CAAC,EAAE,GAAcH,EAAOC,IAAI,CAAC,gBAAgB,CAACK,OAAO,SAASH,CAAC,EAAEG,EAAOH,CAAC,CAAC,EAAE,GAAwBH,EAAOC,IAAI,CAAC,2CAA2C,CAACM,iBAAiB,SAASJ,CAAC,EAAEI,EAAiBJ,CAAC,CAAC,EAAE,GAA6DH,EAAOC,IAAI,CAAC,gCAAgC,CAACO,mBAAmB,SAASL,CAAC,EAAEK,EAAmBL,CAAC,EAAEM,uBAAuB,SAASN,CAAC,EAAEM,EAAuBN,CAAC,EAAEO,YAAY,SAASP,CAAC,EAAEO,EAAYP,CAAC,CAAC,EAAE,GAA4BH,EAAOC,IAAI,CAAC,4BAA4B,CAACU,qBAAqB,SAASR,CAAC,EAAEQ,EAAqBR,CAAC,CAAC,EAAE,GAASH,EAAOC,IAAI,CAAC,uBAAuB,CAACW,EAAE,SAAST,CAAC,EAAES,EAAET,CAAC,CAAC,EAAE,GAQluBG,EAAOO,wBAAwB,CAAG,SAAUC,CAAQ,CAAEC,CAAQ,CAAEC,CAAI,CAAEC,CAAQ,EACrD,UAApB,OAAOH,IAETA,EADGA,AAA0B,KAA1BA,EAASI,OAAO,CAAC,KACT,CAAEC,SAAUL,CAAS,EAErB,CAAEM,MAAON,CAAS,GAI/BT,EAASgB,eAAe,CAAC,CACxBC,gBAAiB,CAChB,CACCC,KAAM,CACLC,MAAO,CACNC,KAAMX,EACNC,SAAUV,EAASqB,aAAa,CAACX,EAClC,EACAC,KAAAA,CACD,CACD,EACA,CACDW,aAAY,SAACC,CAAK,EACbA,EACHlB,EAAYkB,EAAOX,GAEnBA,GAAYA,GAEd,CACD,EACD,EAEA,IAvCIb,EAAAC,EAAsFC,EAAyEC,EAAkIC,EAAmBC,EAAuBC,EAA0NC,EAA+HC,EAuChqBiB,EAAiBC,AAAKxB,EAAtBuB,iBAAiB,AAEzBvB,CAAAA,EAAOuB,iBAAiB,CAAG,SAAUT,CAAK,CAAEL,CAAQ,CAAEgB,CAAE,EACvDF,EAAkBT,EAAOL,EAAU,SAAOa,CAAK,EAAA,OAAAxB,EAAA4B,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,OAAAF,EAAAE,IAAA,CAAA,EAAA/B,EAAAgC,KAAA,CACxC7B,EAAiB,CACtBqB,MAAAA,EACAS,iBAAkBN,EAClBO,gBAAiBlB,EACjBmB,OAAQ,SAACvB,CAAI,EACZV,EAAOO,wBAAwB,CAACO,EAAOL,EAAUC,EAAM,SAACY,CAAK,EAC5D,GAAInB,EAAuBmB,GAAQ,CAClCjB,EAAqB,CACpB6B,KAAM,QACNC,QAAS7B,EAAE,oBACZ,GACAmB,IACA,MACD,CACA,GAAIvB,EAAmBoB,GAAQ,CAC9BjB,EAAqB,CACpB6B,KAAM,QACNC,QAAS7B,EAAE,0BACZ,GACAmB,IACA,MACD,CACAA,EAAGH,EACJ,EACD,CACD,GAAE,MAAA,EAAA,IAAA,MAAA,OAAAK,EAAAS,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAEJ"}