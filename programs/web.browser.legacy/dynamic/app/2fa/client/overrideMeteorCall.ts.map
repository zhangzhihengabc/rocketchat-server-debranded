)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/2fa/client/overrideMeteorCall.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { process2faReturn, process2faAsyncReturn } from '../../../client/lib/2fa/process2faReturn';\nimport { isTotpInvalidError } from '../../../client/lib/2fa/utils';\nimport { t } from '../../utils/lib/i18n';\n\nconst { call, callAsync } = Meteor;\n\ntype Callback = {\n\t(error: unknown): void;\n\t(error: unknown, result: unknown): void;\n};\n\nconst callWithTotp =\n\t(methodName: string, args: unknown[], callback: Callback) =>\n\t(twoFactorCode: string, twoFactorMethod: string): unknown =>\n\t\tcall(methodName, ...args, { twoFactorCode, twoFactorMethod }, (error: unknown, result: unknown): void => {\n\t\t\tif (isTotpInvalidError(error)) {\n\t\t\t\tcallback(new Error(twoFactorMethod === 'password' ? t('Invalid_password') : t('Invalid_two_factor_code')));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcallback(error, result);\n\t\t});\n\nconst callWithoutTotp = (methodName: string, args: unknown[], callback: Callback) => (): unknown =>\n\tcall(methodName, ...args, async (error: unknown, result: unknown): Promise<void> => {\n\t\tawait process2faReturn({\n\t\t\terror,\n\t\t\tresult,\n\t\t\tonCode: callWithTotp(methodName, args, callback),\n\t\t\toriginalCallback: callback,\n\t\t\temailOrUsername: undefined,\n\t\t});\n\t});\n\nMeteor.call = function (methodName: string, ...args: unknown[]): unknown {\n\tconst callback = args.length > 0 && typeof args[args.length - 1] === 'function' ? (args.pop() as Callback) : (): void => undefined;\n\n\treturn callWithoutTotp(methodName, args, callback)();\n};\n\nMeteor.callAsync = async function _callAsyncWithTotp(methodName: string, ...args: unknown[]): Promise<unknown> {\n\ttry {\n\t\treturn await callAsync(methodName, ...args);\n\t} catch (error: unknown) {\n\t\treturn process2faAsyncReturn({\n\t\t\terror,\n\t\t\tonCode: (twoFactorCode, twoFactorMethod) => Meteor.callAsync(methodName, ...args, { twoFactorCode, twoFactorMethod }),\n\t\t\temailOrUsername: undefined,\n\t\t});\n\t}\n};\n",null],"names":["module","default","_regeneratorRuntime","_toConsumableArray","link","Meteor","process2faReturn","process2faAsyncReturn","isTotpInvalidError","t","_Meteor","call","callAsync","callWithTotp","methodName","args","callback","twoFactorCode","twoFactorMethod","apply","concat","error","result","Error","_len","arguments","length","Array","_key","pop","async","_context","prev","next","awrap","onCode","originalCallback","emailOrUsername","undefined","stop","Promise","_len2","_key2","_args2","_context2","abrupt","sent","t0","_Meteor2"],"mappings":"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"}