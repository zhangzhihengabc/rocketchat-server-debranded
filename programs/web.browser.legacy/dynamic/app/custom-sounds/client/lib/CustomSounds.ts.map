)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/custom-sounds/client/lib/CustomSounds.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import type { ICustomSound } from '@rocket.chat/core-typings';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { getURL } from '../../../utils/client';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\nconst getCustomSoundId = (soundId: ICustomSound['_id']) => `custom-sound-${soundId}`;\nconst getAssetUrl = (asset: string, params?: Record<string, any>) => getURL(asset, params, undefined, true);\n\nconst defaultSounds = [\n\t{ _id: 'chime', name: 'Chime', extension: 'mp3', src: getAssetUrl('sounds/chime.mp3') },\n\t{ _id: 'door', name: 'Door', extension: 'mp3', src: getAssetUrl('sounds/door.mp3') },\n\t{ _id: 'beep', name: 'Beep', extension: 'mp3', src: getAssetUrl('sounds/beep.mp3') },\n\t{ _id: 'chelle', name: 'Chelle', extension: 'mp3', src: getAssetUrl('sounds/chelle.mp3') },\n\t{ _id: 'ding', name: 'Ding', extension: 'mp3', src: getAssetUrl('sounds/ding.mp3') },\n\t{ _id: 'droplet', name: 'Droplet', extension: 'mp3', src: getAssetUrl('sounds/droplet.mp3') },\n\t{ _id: 'highbell', name: 'Highbell', extension: 'mp3', src: getAssetUrl('sounds/highbell.mp3') },\n\t{ _id: 'seasons', name: 'Seasons', extension: 'mp3', src: getAssetUrl('sounds/seasons.mp3') },\n\t{ _id: 'telephone', name: 'Telephone', extension: 'mp3', src: getAssetUrl('sounds/telephone.mp3') },\n\t{ _id: 'outbound-call-ringing', name: 'Outbound Call Ringing', extension: 'mp3', src: getAssetUrl('sounds/outbound-call-ringing.mp3') },\n\t{ _id: 'call-ended', name: 'Call Ended', extension: 'mp3', src: getAssetUrl('sounds/call-ended.mp3') },\n\t{ _id: 'dialtone', name: 'Dialtone', extension: 'mp3', src: getAssetUrl('sounds/dialtone.mp3') },\n\t{ _id: 'ringtone', name: 'Ringtone', extension: 'mp3', src: getAssetUrl('sounds/ringtone.mp3') },\n];\n\nclass CustomSoundsClass {\n\tlist: ReactiveVar<Record<string, ICustomSound>>;\n\n\tinitialFetchDone: boolean;\n\n\tconstructor() {\n\t\tthis.list = new ReactiveVar({});\n\t\tthis.initialFetchDone = false;\n\t\tdefaultSounds.forEach((sound) => this.add(sound));\n\t}\n\n\tadd(sound: ICustomSound) {\n\t\tif (!sound.src) {\n\t\t\tsound.src = this.getURL(sound);\n\t\t}\n\n\t\tconst source = document.createElement('source');\n\t\tsource.src = sound.src;\n\n\t\tconst audio = document.createElement('audio');\n\t\taudio.id = getCustomSoundId(sound._id);\n\t\taudio.preload = 'none';\n\t\taudio.appendChild(source);\n\n\t\tdocument.body.appendChild(audio);\n\n\t\tconst list = this.list.get();\n\t\tlist[sound._id] = sound;\n\t\tthis.list.set(list);\n\t}\n\n\tremove(sound: ICustomSound) {\n\t\tconst list = this.list.get();\n\t\tdelete list[sound._id];\n\t\tthis.list.set(list);\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(sound._id)}`);\n\t\taudio?.remove();\n\t}\n\n\tgetSound(soundId: ICustomSound['_id']) {\n\t\tconst list = this.list.get();\n\t\treturn list[soundId];\n\t}\n\n\tupdate(sound: ICustomSound) {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(sound._id)}`);\n\t\tif (audio) {\n\t\t\tconst list = this.list.get();\n\t\t\tif (!sound.src) {\n\t\t\t\tsound.src = this.getURL(sound);\n\t\t\t}\n\t\t\tlist[sound._id] = sound;\n\t\t\tthis.list.set(list);\n\t\t\tconst sourceEl = audio.querySelector('source');\n\t\t\tif (sourceEl) {\n\t\t\t\tsourceEl.src = sound.src;\n\t\t\t}\n\t\t\taudio.load();\n\t\t} else {\n\t\t\tthis.add(sound);\n\t\t}\n\t}\n\n\tgetURL(sound: ICustomSound) {\n\t\treturn getAssetUrl(`/custom-sounds/${sound._id}.${sound.extension}`, { _dc: sound.random || 0 });\n\t}\n\n\tgetList() {\n\t\tconst list = Object.values(this.list.get());\n\t\treturn list.sort((a, b) => (a.name ?? '').localeCompare(b.name ?? ''));\n\t}\n\n\tplay = async (soundId: ICustomSound['_id'], { volume = 1, loop = false } = {}) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\t\tif (!audio?.play) {\n\t\t\treturn;\n\t\t}\n\n\t\taudio.volume = volume;\n\t\taudio.loop = loop;\n\t\tawait audio.play();\n\n\t\treturn audio;\n\t};\n\n\tpause = (soundId: ICustomSound['_id']) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\t\tif (!audio?.pause) {\n\t\t\treturn;\n\t\t}\n\n\t\taudio.pause();\n\t};\n\n\tstop = (soundId: ICustomSound['_id']) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\t\tif (!audio?.load) {\n\t\t\treturn;\n\t\t}\n\n\t\taudio?.load();\n\t};\n\n\tisPlaying = (soundId: ICustomSound['_id']) => {\n\t\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\n\n\t\treturn audio && audio.duration > 0 && !audio.paused;\n\t};\n\n\tfetchCustomSoundList = async () => {\n\t\tif (this.initialFetchDone) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = await sdk.call('listCustomSounds');\n\t\tfor (const sound of result) {\n\t\t\tthis.add(sound);\n\t\t}\n\t\tthis.initialFetchDone = true;\n\t};\n}\n\nexport const CustomSounds = new CustomSoundsClass();\n",null],"names":["module","default","_createForOfIteratorHelperLoose","_regeneratorRuntime","export","CustomSounds","ReactiveVar","getURL","sdk","getCustomSoundId","soundId","getAssetUrl","asset","params","undefined","defaultSounds","_id","name","extension","src","CustomSoundsClass","_this","list","initialFetchDone","play","_ref","_ref$volume","volume","_ref$loop","loop","audio","_args","arguments","async","_context","prev","next","length","document","querySelector","abrupt","awrap","stop","Promise","pause","load","isPlaying","duration","paused","fetchCustomSoundList","_iterator","_step","sound","_context2","call","sent","done","value","add","forEach","_proto","prototype","source","createElement","id","preload","appendChild","body","get","set","remove","getSound","update","sourceEl","_dc","random","getList","Object","values","sort","a","b","_a$name","_b$name","localeCompare"],"mappings":"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"}