)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/discussion/client/createDiscussionMessageAction.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport CreateDiscussion from '../../../client/components/CreateDiscussion/CreateDiscussion';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { roomCoordinator } from '../../../client/lib/rooms/roomCoordinator';\nimport { messageArgs } from '../../../client/lib/utils/messageArgs';\nimport { hasPermission } from '../../authorization/client';\nimport { settings } from '../../settings/client';\nimport { MessageAction } from '../../ui-utils/client';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (!settings.get('Discussion_enabled')) {\n\t\t\treturn MessageAction.removeButton('start-discussion');\n\t\t}\n\n\t\tMessageAction.addButton({\n\t\t\tid: 'start-discussion',\n\t\t\ticon: 'discussion',\n\t\t\tlabel: 'Discussion_start',\n\t\t\ttype: 'communication',\n\t\t\tcontext: ['message', 'message-mobile', 'videoconf'],\n\t\t\tasync action(_, props) {\n\t\t\t\tconst { message = messageArgs(this).msg, room } = props;\n\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: CreateDiscussion,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tdefaultParentRoom: room?.prid || room?._id,\n\t\t\t\t\t\tonClose: imperativeModal.close,\n\t\t\t\t\t\tparentMessageId: message._id,\n\t\t\t\t\t\tnameSuggestion: message?.msg?.substr(0, 140),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tcondition({\n\t\t\t\tmessage: {\n\t\t\t\t\tu: { _id: uid },\n\t\t\t\t\tdrid,\n\t\t\t\t\tdcount,\n\t\t\t\t},\n\t\t\t\troom,\n\t\t\t\tsubscription,\n\t\t\t\tuser,\n\t\t\t}) {\n\t\t\t\tif (drid || !Number.isNaN(dcount)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!subscription) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\n\t\t\t\tif (isLivechatRoom) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!user) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn uid !== user._id ? hasPermission('start-discussion-other-user', room._id) : hasPermission('start-discussion', room._id);\n\t\t\t},\n\t\t\torder: 1,\n\t\t\tgroup: 'menu',\n\t\t});\n\t});\n});\n",null],"names":["_regeneratorRuntime","Meteor","Tracker","CreateDiscussion","imperativeModal","roomCoordinator","messageArgs","hasPermission","settings","MessageAction","module","default","link","v","startup","autorun","get","removeButton","addButton","id","icon","label","type","context","action","_","props","_message$msg","_props$message","message","room","async","_context","prev","next","msg","open","component","defaultParentRoom","prid","_id","onClose","close","parentMessageId","nameSuggestion","substr","stop","Promise","condition","_ref","_ref$message","uid","u","drid","dcount","subscription","user","Number","isNaN","isLivechatRoom","t","order","group"],"mappings":"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"}