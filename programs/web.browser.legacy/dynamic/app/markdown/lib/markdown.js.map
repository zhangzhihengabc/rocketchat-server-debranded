)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/markdown/lib/markdown.js","meteor://ðŸ’»app/<anon>"],"sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\n\nimport { filtered } from './parser/filtered/filtered';\nimport { code } from './parser/original/code';\nimport { original } from './parser/original/original';\n\nconst parsers = {\n\toriginal,\n\tfiltered,\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: escapeHTML(text),\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text,\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst options = {\n\t\t\trootUrl: Meteor.absoluteUrl(),\n\t\t};\n\n\t\treturn parsers.original(message, options);\n\t}\n\n\tmountTokensBackRecursively(message, tokenList, useHtml = true) {\n\t\tconst missingTokens = [];\n\n\t\tif (tokenList.length > 0) {\n\t\t\tfor (const { token, text, noHtml } of tokenList) {\n\t\t\t\tif (message.html.indexOf(token) >= 0) {\n\t\t\t\t\tmessage.html = message.html.replace(token, () => (useHtml ? text : noHtml)); // Uses lambda so doesn't need to escape $\n\t\t\t\t} else {\n\t\t\t\t\tmissingTokens.push({ token, text, noHtml });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If there are tokens that were missing from the string, but the last iteration replaced at least one token, then go again\n\t\t// this is done because one of the tokens may have been hidden by another one\n\t\tif (missingTokens.length > 0 && missingTokens.length < tokenList.length) {\n\t\t\tthis.mountTokensBackRecursively(message, missingTokens, useHtml);\n\t\t}\n\t}\n\n\tmountTokensBack(message, useHtml = true) {\n\t\tif (message.tokens) {\n\t\t\tthis.mountTokensBackRecursively(message, message.tokens, useHtml);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tcode(...args) {\n\t\treturn code(...args);\n\t}\n\n\tfilterMarkdownFromMessage(message) {\n\t\treturn parsers.filtered(message);\n\t}\n}\n\nexport const Markdown = new MarkdownClass();\n\nexport const filterMarkdown = (message) => Markdown.filterMarkdownFromMessage(message);\n\nexport const createMarkdownMessageRenderer = ({ ...options }) => {\n\tconst markedParser = parsers.marked;\n\treturn (message, useMarkedParser = false) => {\n\t\tif (!message?.html?.trim()) {\n\t\t\treturn message;\n\t\t}\n\n\t\treturn useMarkedParser ? markedParser(message, options) : parsers.original(message, options);\n\t};\n};\n\nexport const createMarkdownNotificationRenderer = () => (message) => parsers.filtered(message);\n",null],"names":["module","link","default","v","_objectDestructuringEmpty","_extends","_createForOfIteratorHelperLoose","export","Markdown","filterMarkdown","createMarkdownMessageRenderer","createMarkdownNotificationRenderer","escapeHTML","Meteor","filtered","code","original","parsers","MarkdownClass","_proto","prototype","parse","text","message","html","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","options","rootUrl","absoluteUrl","mountTokensBackRecursively","tokenList","useHtml","arguments","length","undefined","missingTokens","_step","_loop","noHtml","indexOf","token","replace","push","_iterator","done","_ref","value","tokens","apply","filterMarkdownFromMessage","_ref2","markedParser","marked","_message$html","useMarkedParser","trim"],"mappings":"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"}