)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/threads/client/messageAction/unfollow.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\nimport { Messages } from '../../../models/client';\nimport { settings } from '../../../settings/client';\nimport { MessageAction } from '../../../ui-utils/client';\nimport { t } from '../../../utils/lib/i18n';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (!settings.get('Threads_enabled')) {\n\t\t\treturn MessageAction.removeButton('unfollow-message');\n\t\t}\n\t\tMessageAction.addButton({\n\t\t\tid: 'unfollow-message',\n\t\t\ticon: 'bell-off',\n\t\t\tlabel: 'Unfollow_message',\n\t\t\ttype: 'interaction',\n\t\t\tcontext: ['message', 'message-mobile', 'threads', 'federated', 'videoconf', 'videoconf-threads'],\n\t\t\tasync action(_, { message }) {\n\t\t\t\tif (!message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait callWithErrorHandling('unfollowMessage', { mid: message._id });\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tmessage: t('You_unfollowed_this_message'),\n\t\t\t\t});\n\t\t\t},\n\t\t\tcondition({ message: { _id, tmid, replies = [] }, user, context }) {\n\t\t\t\tif (tmid || context) {\n\t\t\t\t\tconst parentMessage = Messages.findOne({ _id: tmid || _id }, { fields: { replies: 1 } });\n\t\t\t\t\tif (parentMessage) {\n\t\t\t\t\t\treplies = parentMessage.replies || [];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn user?._id ? replies.includes(user._id) : false;\n\t\t\t},\n\t\t\torder: 2,\n\t\t\tgroup: 'menu',\n\t\t});\n\t});\n});\n",null],"names":["_regeneratorRuntime","Meteor","Tracker","dispatchToastMessage","callWithErrorHandling","Messages","settings","MessageAction","t","module","default","link","startup","autorun","get","removeButton","addButton","id","icon","label","type","context","action","_","_ref","message","async","_context","prev","next","abrupt","awrap","mid","_id","stop","Promise","condition","_ref2","_ref2$message","tmid","_ref2$message$replies","replies","user","parentMessage","findOne","fields","includes","order","group"],"mappings":"2BAAAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAhBC,EAAAA,IAAAA,CAAAA,6BAAgB,CAAAC,QAAAA,SAAAA,CAAAA,EAAAV,EAAAA,CAAA,CAAA,EAAA,GAA9BS,EAAQE,IAAA,CAAM,gBAAgB,CAAAV,OAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAQ,EAAAA,IAAAA,CAAAA,iBAAAA,CAAAP,QAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAO,EAAAA,IAAAA,CAAAA,+BAAAA,CAAAN,qBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAM,EAAAA,IAAAA,CAAAA,qDAAAA,CAAAL,sBAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAK,EAAAA,IAAAA,CAAAA,yBAAAA,CAAAJ,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAI,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAH,SAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAG,EAAAA,IAAAA,CAAAA,2BAAAA,CAAAF,cAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAAAE,EAAAA,IAAAA,CAAAA,0BAAAA,CAAAD,EAAAA,SAAAA,CAAAA,EAAAA,EAAAA,CAAA,CAAA,EAAA,GAUvCP,EAAOW,OAAO,CAAC,WACdV,EAAQW,OAAO,CAAC,WACf,GAAI,CAACP,EAASQ,GAAG,CAAC,mBACjB,OAAOP,EAAcQ,YAAY,CAAC,oBAEnCR,EAAcS,SAAS,CAAC,CACvBC,GAAI,mBACJC,KAAM,WACNC,MAAO,mBACPC,KAAM,cACNC,QAAS,CAAC,UAAW,iBAAkB,UAAW,YAAa,YAAa,oBAAoB,CAC1FC,OAAM,SAACC,CAAC,CAAAC,CAAA,EAAA,IAAAC,EAAA,OAAAzB,EAAA0B,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAW,GAAPJ,EAAOD,EAAPC,OAAO,CACZ,CAAAE,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAF,EAAAG,MAAA,CAAA,SAAA,MAAA,EAAA,OAAAH,EAAAE,IAAA,CAAA,EAAA7B,EAAA+B,KAAA,CAIN3B,EAAsB,kBAAmB,CAAE4B,IAAKP,EAAQQ,GAAAA,AAAG,GAAG,MAAA,EACpE9B,EAAqB,CACpBiB,KAAM,UACNK,QAASjB,EAAE,gCACT,MAAA,EAAA,IAAA,MAAA,OAAAmB,EAAAO,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAEJC,UAAS,SAAAC,CAAA,EAAwD,IAAAC,EAAAD,EAArDZ,OAAO,CAAIQ,EAAGK,EAAHL,GAAG,CAAEM,EAAID,EAAJC,IAAI,CAAAC,EAAAF,EAAEG,OAAO,CAAPA,EAAOD,AAAA,KAAA,IAAAA,EAAG,EAAE,CAAAA,EAAIE,EAAIL,EAAJK,IAAI,CAAErB,EAAOgB,EAAPhB,OAAO,CAC9D,GAAIkB,GAAQlB,EAAS,CACpB,IAAMsB,EAAgBtC,EAASuC,OAAO,CAAC,CAAEX,IAAKM,GAAQN,CAAG,EAAI,CAAEY,OAAQ,CAAEJ,QAAS,CAAC,CAAE,GACjFE,GACHF,CAAAA,EAAUE,EAAcF,OAAO,EAAI,EAAE,AAAF,EAGrC,OAAOC,MAAAA,KAAAA,EAAMT,GAAG,EAAGQ,EAAQK,QAAQ,CAACJ,EAAKT,GAAG,CAC7C,EACAc,MAAO,EACPC,MAAO,QAET,EACD"}