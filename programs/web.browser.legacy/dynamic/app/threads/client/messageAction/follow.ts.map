)]}'
{"version":3,"sources":["meteor://ðŸ’»app/app/threads/client/messageAction/follow.ts","meteor://ðŸ’»app/<anon>"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\nimport { Messages } from '../../../models/client';\nimport { settings } from '../../../settings/client';\nimport { MessageAction } from '../../../ui-utils/client';\nimport { t } from '../../../utils/lib/i18n';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (!settings.get('Threads_enabled')) {\n\t\t\treturn MessageAction.removeButton('follow-message');\n\t\t}\n\t\tMessageAction.addButton({\n\t\t\tid: 'follow-message',\n\t\t\ticon: 'bell',\n\t\t\tlabel: 'Follow_message',\n\t\t\ttype: 'interaction',\n\t\t\tcontext: ['message', 'message-mobile', 'threads', 'federated', 'videoconf', 'videoconf-threads'],\n\t\t\tasync action(_, { message }) {\n\t\t\t\tif (!message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait callWithErrorHandling('followMessage', { mid: message._id }).then(() =>\n\t\t\t\t\tdispatchToastMessage({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tmessage: t('You_followed_this_message'),\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t},\n\t\t\tcondition({ message: { _id, tmid, replies = [] }, room, user, context }) {\n\t\t\t\tif (tmid || context) {\n\t\t\t\t\tconst parentMessage = Messages.findOne({ _id: tmid || _id }, { fields: { replies: 1 } });\n\t\t\t\t\tif (parentMessage) {\n\t\t\t\t\t\treplies = parentMessage.replies || [];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\n\t\t\t\tif (isLivechatRoom) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn user?._id ? !replies.includes(user._id) : false;\n\t\t\t},\n\t\t\torder: 1,\n\t\t\tgroup: 'menu',\n\t\t});\n\t});\n});\n",null],"names":["_regeneratorRuntime","Meteor","Tracker","roomCoordinator","dispatchToastMessage","callWithErrorHandling","Messages","settings","MessageAction","t","module","default","link","startup","autorun","get","removeButton","addButton","id","icon","label","type","context","action","_","_ref","message","async","_context","prev","next","abrupt","awrap","mid","_id","then","stop","Promise","condition","_ref2","_ref2$message","tmid","_ref2$message$replies","replies","room","user","parentMessage","findOne","fields","isLivechatRoom","includes","order","group"],"mappings":"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"}